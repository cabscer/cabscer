Javascript:(function()%20%7B%20%09'use%20strict';%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20noop()%20%7B%7D%20%20%09/**%20%09%20*%20@template%20T%20%09%20*%20@template%20S%20%09%20*%20@param%20%7BT%7D%20tar%20%09%20*%20@param%20%7BS%7D%20src%20%09%20*%20@returns%20%7BT%20&%20S%7D%20%09%20*/%20%09function%20assign(tar,%20src)%20%7B%20%09%09//%20@ts-ignore%20%09%09for%20(const%20k%20in%20src)%20tar%5Bk%5D%20=%20src%5Bk%5D;%20%09%09return%20/**%20@type%20%7BT%20&%20S%7D%20*/%20(tar);%20%09%7D%20%20%09function%20run(fn)%20%7B%20%09%09return%20fn();%20%09%7D%20%20%09function%20blank_object()%20%7B%20%09%09return%20Object.create(null);%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BFunction%5B%5D%7D%20fns%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20run_all(fns)%20%7B%20%09%09fns.forEach(run);%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7Bany%7D%20thing%20%09%20*%20@returns%20%7Bthing%20is%20Function%7D%20%09%20*/%20%09function%20is_function(thing)%20%7B%20%09%09return%20typeof%20thing%20===%20'function';%20%09%7D%20%20%09/**%20@returns%20%7Bboolean%7D%20*/%20%09function%20safe_not_equal(a,%20b)%20%7B%20%09%09return%20a%20!=%20a%20?%20b%20==%20b%20:%20a%20!==%20b%20%7C%7C%20(a%20&&%20typeof%20a%20===%20'object')%20%7C%7C%20typeof%20a%20===%20'function';%20%09%7D%20%20%09/**%20@returns%20%7Bboolean%7D%20*/%20%09function%20is_empty(obj)%20%7B%20%09%09return%20Object.keys(obj).length%20===%200;%20%09%7D%20%20%09function%20subscribe(store,%20...callbacks)%20%7B%20%09%09if%20(store%20==%20null)%20%7B%20%09%09%09for%20(const%20callback%20of%20callbacks)%20%7B%20%09%09%09%09callback(undefined);%20%09%09%09%7D%20%09%09%09return%20noop;%20%09%09%7D%20%09%09const%20unsub%20=%20store.subscribe(...callbacks);%20%09%09return%20unsub.unsubscribe%20?%20()%20=%3E%20unsub.unsubscribe()%20:%20unsub;%20%09%7D%20%20%09/**%20%09%20*%20Get%20the%20current%20value%20from%20a%20store%20by%20subscribing%20and%20immediately%20unsubscribing.%20%09%20*%20%09%20*%20https://svelte.dev/docs/svelte-store%23get%20%09%20*%20@template%20T%20%09%20*%20@param%20%7Bimport('../store/public.js').Readable%3CT%3E%7D%20store%20%09%20*%20@returns%20%7BT%7D%20%09%20*/%20%09function%20get_store_value(store)%20%7B%20%09%09let%20value;%20%09%09subscribe(store,%20(_)%20=%3E%20(value%20=%20_))();%20%09%09return%20value;%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20component_subscribe(component,%20store,%20callback)%20%7B%20%09%09component.$$.on_destroy.push(subscribe(store,%20callback));%20%09%7D%20%20%09function%20create_slot(definition,%20ctx,%20$$scope,%20fn)%20%7B%20%09%09if%20(definition)%20%7B%20%09%09%09const%20slot_ctx%20=%20get_slot_context(definition,%20ctx,%20$$scope,%20fn);%20%09%09%09return%20definition%5B0%5D(slot_ctx);%20%09%09%7D%20%09%7D%20%20%09function%20get_slot_context(definition,%20ctx,%20$$scope,%20fn)%20%7B%20%09%09return%20definition%5B1%5D%20&&%20fn%20?%20assign($$scope.ctx.slice(),%20definition%5B1%5D(fn(ctx)))%20:%20$$scope.ctx;%20%09%7D%20%20%09function%20get_slot_changes(definition,%20$$scope,%20dirty,%20fn)%20%7B%20%09%09if%20(definition%5B2%5D%20&&%20fn)%20%7B%20%09%09%09const%20lets%20=%20definition%5B2%5D(fn(dirty));%20%09%09%09if%20($$scope.dirty%20===%20undefined)%20%7B%20%09%09%09%09return%20lets;%20%09%09%09%7D%20%09%09%09if%20(typeof%20lets%20===%20'object')%20%7B%20%09%09%09%09const%20merged%20=%20%5B%5D;%20%09%09%09%09const%20len%20=%20Math.max($$scope.dirty.length,%20lets.length);%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20len;%20i%20+=%201)%20%7B%20%09%09%09%09%09merged%5Bi%5D%20=%20$$scope.dirty%5Bi%5D%20%7C%20lets%5Bi%5D;%20%09%09%09%09%7D%20%09%09%09%09return%20merged;%20%09%09%09%7D%20%09%09%09return%20$$scope.dirty%20%7C%20lets;%20%09%09%7D%20%09%09return%20$$scope.dirty;%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20update_slot_base(%20%09%09slot,%20%09%09slot_definition,%20%09%09ctx,%20%09%09$$scope,%20%09%09slot_changes,%20%09%09get_slot_context_fn%20%09)%20%7B%20%09%09if%20(slot_changes)%20%7B%20%09%09%09const%20slot_context%20=%20get_slot_context(slot_definition,%20ctx,%20$$scope,%20get_slot_context_fn);%20%09%09%09slot.p(slot_context,%20slot_changes);%20%09%09%7D%20%09%7D%20%20%09/**%20@returns%20%7Bany%5B%5D%20%7C%20-1%7D%20*/%20%09function%20get_all_dirty_from_scope($$scope)%20%7B%20%09%09if%20($$scope.ctx.length%20%3E%2032)%20%7B%20%09%09%09const%20dirty%20=%20%5B%5D;%20%09%09%09const%20length%20=%20$$scope.ctx.length%20/%2032;%20%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%09%09%09dirty%5Bi%5D%20=%20-1;%20%09%09%09%7D%20%09%09%09return%20dirty;%20%09%09%7D%20%09%09return%20-1;%20%09%7D%20%20%09const%20is_client%20=%20typeof%20window%20!==%20'undefined';%20%20%09/**%20@type%20%7B()%20=%3E%20number%7D%20*/%20%09let%20now%20=%20is_client%20?%20()%20=%3E%20window.performance.now()%20:%20()%20=%3E%20Date.now();%20%20%09let%20raf%20=%20is_client%20?%20(cb)%20=%3E%20requestAnimationFrame(cb)%20:%20noop;%20%20%09const%20tasks%20=%20new%20Set();%20%20%09/**%20%09%20*%20@param%20%7Bnumber%7D%20now%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20run_tasks(now)%20%7B%20%09%09tasks.forEach((task)%20=%3E%20%7B%20%09%09%09if%20(!task.c(now))%20%7B%20%09%09%09%09tasks.delete(task);%20%09%09%09%09task.f();%20%09%09%09%7D%20%09%09%7D);%20%09%09if%20(tasks.size%20!==%200)%20raf(run_tasks);%20%09%7D%20%20%09/**%20%09%20*%20Creates%20a%20new%20task%20that%20runs%20on%20each%20raf%20frame%20%09%20*%20until%20it%20returns%20a%20falsy%20value%20or%20is%20aborted%20%09%20*%20@param%20%7Bimport('./private.js').TaskCallback%7D%20callback%20%09%20*%20@returns%20%7Bimport('./private.js').Task%7D%20%09%20*/%20%09function%20loop(callback)%20%7B%20%09%09/**%20@type%20%7Bimport('./private.js').TaskEntry%7D%20*/%20%09%09let%20task;%20%09%09if%20(tasks.size%20===%200)%20raf(run_tasks);%20%09%09return%20%7B%20%09%09%09promise:%20new%20Promise((fulfill)%20=%3E%20%7B%20%09%09%09%09tasks.add((task%20=%20%7B%20c:%20callback,%20f:%20fulfill%20%7D));%20%09%09%09%7D),%20%09%09%09abort()%20%7B%20%09%09%09%09tasks.delete(task);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09/**%20@type%20%7Btypeof%20globalThis%7D%20*/%20%09const%20globals%20=%20%09%09typeof%20window%20!==%20'undefined'%20%09%09%09?%20window%20%09%09%09:%20typeof%20globalThis%20!==%20'undefined'%20%09%09%09?%20globalThis%20%09%09%09:%20//%20@ts-ignore%20Node%20typings%20have%20this%20%09%09%09%20%20global;%20%20%09/**%20%09%20*%20@param%20%7BNode%7D%20target%20%09%20*%20@param%20%7BNode%7D%20node%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20append(target,%20node)%20%7B%20%09%09target.appendChild(node);%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BNode%7D%20target%20%09%20*%20@param%20%7Bstring%7D%20style_sheet_id%20%09%20*%20@param%20%7Bstring%7D%20styles%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20append_styles(target,%20style_sheet_id,%20styles)%20%7B%20%09%09const%20append_styles_to%20=%20get_root_for_style(target);%20%09%09if%20(!append_styles_to.getElementById(style_sheet_id))%20%7B%20%09%09%09const%20style%20=%20element('style');%20%09%09%09style.id%20=%20style_sheet_id;%20%09%09%09style.textContent%20=%20styles;%20%09%09%09append_stylesheet(append_styles_to,%20style);%20%09%09%7D%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BNode%7D%20node%20%09%20*%20@returns%20%7BShadowRoot%20%7C%20Document%7D%20%09%20*/%20%09function%20get_root_for_style(node)%20%7B%20%09%09if%20(!node)%20return%20document;%20%09%09const%20root%20=%20node.getRootNode%20?%20node.getRootNode()%20:%20node.ownerDocument;%20%09%09if%20(root%20&&%20/**%20@type%20%7BShadowRoot%7D%20*/%20(root).host)%20%7B%20%09%09%09return%20/**%20@type%20%7BShadowRoot%7D%20*/%20(root);%20%09%09%7D%20%09%09return%20node.ownerDocument;%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BShadowRoot%20%7C%20Document%7D%20node%20%09%20*%20@param%20%7BHTMLStyleElement%7D%20style%20%09%20*%20@returns%20%7BCSSStyleSheet%7D%20%09%20*/%20%09function%20append_stylesheet(node,%20style)%20%7B%20%09%09append(/**%20@type%20%7BDocument%7D%20*/%20(node).head%20%7C%7C%20node,%20style);%20%09%09return%20style.sheet;%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BNode%7D%20target%20%09%20*%20@param%20%7BNode%7D%20node%20%09%20*%20@param%20%7BNode%7D%20%5Banchor%5D%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20insert(target,%20node,%20anchor)%20%7B%20%09%09target.insertBefore(node,%20anchor%20%7C%7C%20null);%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BNode%7D%20node%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20detach(node)%20%7B%20%09%09if%20(node.parentNode)%20%7B%20%09%09%09node.parentNode.removeChild(node);%20%09%09%7D%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7Bvoid%7D%20*/%20%09function%20destroy_each(iterations,%20detaching)%20%7B%20%09%09for%20(let%20i%20=%200;%20i%20%3C%20iterations.length;%20i%20+=%201)%20%7B%20%09%09%09if%20(iterations%5Bi%5D)%20iterations%5Bi%5D.d(detaching);%20%09%09%7D%20%09%7D%20%20%09/**%20%09%20*%20@template%20%7Bkeyof%20HTMLElementTagNameMap%7D%20K%20%09%20*%20@param%20%7BK%7D%20name%20%09%20*%20@returns%20%7BHTMLElementTagNameMap%5BK%5D%7D%20%09%20*/%20%09function%20element(name)%20%7B%20%09%09return%20document.createElement(name);%20%09%7D%20%20%09/**%20%09%20*%20@template%20%7Bkeyof%20SVGElementTagNameMap%7D%20K%20%09%20*%20@param%20%7BK%7D%20name%20%09%20*%20@returns%20%7BSVGElement%7D%20%09%20*/%20%09function%20svg_element(name)%20%7B%20%09%09return%20document.createElementNS('http://www.w3.org/2000/svg',%20name);%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7Bstring%7D%20data%20%09%20*%20@returns%20%7BText%7D%20%09%20*/%20%09function%20text(data)%20%7B%20%09%09return%20document.createTextNode(data);%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7BText%7D%20*/%20%09function%20space()%20%7B%20%09%09return%20text('%20');%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7BText%7D%20*/%20%09function%20empty()%20%7B%20%09%09return%20text('');%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BEventTarget%7D%20node%20%09%20*%20@param%20%7Bstring%7D%20event%20%09%20*%20@param%20%7BEventListenerOrEventListenerObject%7D%20handler%20%09%20*%20@param%20%7Bboolean%20%7C%20AddEventListenerOptions%20%7C%20EventListenerOptions%7D%20%5Boptions%5D%20%09%20*%20@returns%20%7B()%20=%3E%20void%7D%20%09%20*/%20%09function%20listen(node,%20event,%20handler,%20options)%20%7B%20%09%09node.addEventListener(event,%20handler,%20options);%20%09%09return%20()%20=%3E%20node.removeEventListener(event,%20handler,%20options);%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7B(event:%20any)%20=%3E%20any%7D%20*/%20%09function%20prevent_default(fn)%20%7B%20%09%09return%20function%20(event)%20%7B%20%09%09%09event.preventDefault();%20%09%09%09//%20@ts-ignore%20%09%09%09return%20fn.call(this,%20event);%20%09%09%7D;%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7B(event:%20any)%20=%3E%20any%7D%20*/%20%09function%20stop_propagation(fn)%20%7B%20%09%09return%20function%20(event)%20%7B%20%09%09%09event.stopPropagation();%20%09%09%09//%20@ts-ignore%20%09%09%09return%20fn.call(this,%20event);%20%09%09%7D;%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BElement%7D%20node%20%09%20*%20@param%20%7Bstring%7D%20attribute%20%09%20*%20@param%20%7Bstring%7D%20%5Bvalue%5D%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20attr(node,%20attribute,%20value)%20%7B%20%09%09if%20(value%20==%20null)%20node.removeAttribute(attribute);%20%09%09else%20if%20(node.getAttribute(attribute)%20!==%20value)%20node.setAttribute(attribute,%20value);%20%09%7D%20%20%09/**%20@returns%20%7Bnumber%7D%20*/%20%09function%20to_number(value)%20%7B%20%09%09return%20value%20===%20''%20?%20null%20:%20+value;%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BElement%7D%20element%20%09%20*%20@returns%20%7BChildNode%5B%5D%7D%20%09%20*/%20%09function%20children(element)%20%7B%20%09%09return%20Array.from(element.childNodes);%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7BText%7D%20text%20%09%20*%20@param%20%7Bunknown%7D%20data%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20set_data(text,%20data)%20%7B%20%09%09data%20=%20''%20+%20data;%20%09%09if%20(text.data%20===%20data)%20return;%20%09%09text.data%20=%20/**%20@type%20%7Bstring%7D%20*/%20(data);%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7Bvoid%7D%20*/%20%09function%20set_input_value(input,%20value)%20%7B%20%09%09input.value%20=%20value%20==%20null%20?%20''%20:%20value;%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7Bvoid%7D%20*/%20%09function%20set_style(node,%20key,%20value,%20important)%20%7B%20%09%09if%20(value%20==%20null)%20%7B%20%09%09%09node.style.removeProperty(key);%20%09%09%7D%20else%20%7B%20%09%09%09node.style.setProperty(key,%20value,%20'');%20%09%09%7D%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7Bvoid%7D%20*/%20%09function%20toggle_class(element,%20name,%20toggle)%20%7B%20%09%09//%20The%20%60!!%60%20is%20required%20because%20an%20%60undefined%60%20flag%20means%20flipping%20the%20current%20state.%20%09%09element.classList.toggle(name,%20!!toggle);%20%09%7D%20%20%09/**%20%09%20*%20@template%20T%20%09%20*%20@param%20%7Bstring%7D%20type%20%09%20*%20@param%20%7BT%7D%20%5Bdetail%5D%20%09%20*%20@param%20%7B%7B%20bubbles?:%20boolean,%20cancelable?:%20boolean%20%7D%7D%20%5Boptions%5D%20%09%20*%20@returns%20%7BCustomEvent%3CT%3E%7D%20%09%20*/%20%09function%20custom_event(type,%20detail,%20%7B%20bubbles%20=%20false,%20cancelable%20=%20false%20%7D%20=%20%7B%7D)%20%7B%20%09%09return%20new%20CustomEvent(type,%20%7B%20detail,%20bubbles,%20cancelable%20%7D);%20%09%7D%20%20%09/**%20%09%20*%20@typedef%20%7BNode%20&%20%7B%20%09%20*%20%09claim_order?:%20number;%20%09%20*%20%09hydrate_init?:%20true;%20%09%20*%20%09actual_end_child?:%20NodeEx;%20%09%20*%20%09childNodes:%20NodeListOf%3CNodeEx%3E;%20%09%20*%20%7D%7D%20NodeEx%20%09%20*/%20%20%09/**%20@typedef%20%7BChildNode%20&%20NodeEx%7D%20ChildNodeEx%20*/%20%20%09/**%20@typedef%20%7BNodeEx%20&%20%7B%20claim_order:%20number%20%7D%7D%20NodeEx2%20*/%20%20%09/**%20%09%20*%20@typedef%20%7BChildNodeEx%5B%5D%20&%20%7B%20%09%20*%20%09claim_info?:%20%7B%20%09%20*%20%09%09last_index:%20number;%20%09%20*%20%09%09total_claimed:%20number;%20%09%20*%20%09%7D;%20%09%20*%20%7D%7D%20ChildNodeArray%20%09%20*/%20%20%09let%20current_component;%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20set_current_component(component)%20%7B%20%09%09current_component%20=%20component;%20%09%7D%20%20%09function%20get_current_component()%20%7B%20%09%09if%20(!current_component)%20throw%20new%20Error('Function%20called%20outside%20component%20initialization');%20%09%09return%20current_component;%20%09%7D%20%20%09/**%20%09%20*%20The%20%60onMount%60%20function%20schedules%20a%20callback%20to%20run%20as%20soon%20as%20the%20component%20has%20been%20mounted%20to%20the%20DOM.%20%09%20*%20It%20must%20be%20called%20during%20the%20component's%20initialisation%20(but%20doesn't%20need%20to%20live%20*inside*%20the%20component;%20%09%20*%20it%20can%20be%20called%20from%20an%20external%20module).%20%09%20*%20%09%20*%20If%20a%20function%20is%20returned%20_synchronously_%20from%20%60onMount%60,%20it%20will%20be%20called%20when%20the%20component%20is%20unmounted.%20%09%20*%20%09%20*%20%60onMount%60%20does%20not%20run%20inside%20a%20%5Bserver-side%20component%5D(https://svelte.dev/docs%23run-time-server-side-component-api).%20%09%20*%20%09%20*%20https://svelte.dev/docs/svelte%23onmount%20%09%20*%20@template%20T%20%09%20*%20@param%20%7B()%20=%3E%20import('./private.js').NotFunction%3CT%3E%20%7C%20Promise%3Cimport('./private.js').NotFunction%3CT%3E%3E%20%7C%20(()%20=%3E%20any)%7D%20fn%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20onMount(fn)%20%7B%20%09%09get_current_component().$$.on_mount.push(fn);%20%09%7D%20%20%09/**%20%09%20*%20Schedules%20a%20callback%20to%20run%20immediately%20before%20the%20component%20is%20unmounted.%20%09%20*%20%09%20*%20Out%20of%20%60onMount%60,%20%60beforeUpdate%60,%20%60afterUpdate%60%20and%20%60onDestroy%60,%20this%20is%20the%20%09%20*%20only%20one%20that%20runs%20inside%20a%20server-side%20component.%20%09%20*%20%09%20*%20https://svelte.dev/docs/svelte%23ondestroy%20%09%20*%20@param%20%7B()%20=%3E%20any%7D%20fn%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20onDestroy(fn)%20%7B%20%09%09get_current_component().$$.on_destroy.push(fn);%20%09%7D%20%20%09/**%20%09%20*%20Creates%20an%20event%20dispatcher%20that%20can%20be%20used%20to%20dispatch%20%5Bcomponent%20events%5D(https://svelte.dev/docs%23template-syntax-component-directives-on-eventname).%20%09%20*%20Event%20dispatchers%20are%20functions%20that%20can%20take%20two%20arguments:%20%60name%60%20and%20%60detail%60.%20%09%20*%20%09%20*%20Component%20events%20created%20with%20%60createEventDispatcher%60%20create%20a%20%09%20*%20%5BCustomEvent%5D(https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent).%20%09%20*%20These%20events%20do%20not%20%5Bbubble%5D(https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events%23Event_bubbling_and_capture).%20%09%20*%20The%20%60detail%60%20argument%20corresponds%20to%20the%20%5BCustomEvent.detail%5D(https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/detail)%20%09%20*%20property%20and%20can%20contain%20any%20type%20of%20data.%20%09%20*%20%09%20*%20The%20event%20dispatcher%20can%20be%20typed%20to%20narrow%20the%20allowed%20event%20names%20and%20the%20type%20of%20the%20%60detail%60%20argument:%20%09%20*%20%60%60%60ts%20%09%20*%20const%20dispatch%20=%20createEventDispatcher%3C%7B%20%09%20*%20%20loaded:%20never;%20//%20does%20not%20take%20a%20detail%20argument%20%09%20*%20%20change:%20string;%20//%20takes%20a%20detail%20argument%20of%20type%20string,%20which%20is%20required%20%09%20*%20%20optional:%20number%20%7C%20null;%20//%20takes%20an%20optional%20detail%20argument%20of%20type%20number%20%09%20*%20%7D%3E();%20%09%20*%20%60%60%60%20%09%20*%20%09%20*%20https://svelte.dev/docs/svelte%23createeventdispatcher%20%09%20*%20@template%20%7BRecord%3Cstring,%20any%3E%7D%20%5BEventMap=any%5D%20%09%20*%20@returns%20%7Bimport('./public.js').EventDispatcher%3CEventMap%3E%7D%20%09%20*/%20%09function%20createEventDispatcher()%20%7B%20%09%09const%20component%20=%20get_current_component();%20%09%09return%20(type,%20detail,%20%7B%20cancelable%20=%20false%20%7D%20=%20%7B%7D)%20=%3E%20%7B%20%09%09%09const%20callbacks%20=%20component.$$.callbacks%5Btype%5D;%20%09%09%09if%20(callbacks)%20%7B%20%09%09%09%09//%20TODO%20are%20there%20situations%20where%20events%20could%20be%20dispatched%20%09%09%09%09//%20in%20a%20server%20(non-DOM)%20environment?%20%09%09%09%09const%20event%20=%20custom_event(/**%20@type%20%7Bstring%7D%20*/%20(type),%20detail,%20%7B%20cancelable%20%7D);%20%09%09%09%09callbacks.slice().forEach((fn)%20=%3E%20%7B%20%09%09%09%09%09fn.call(component,%20event);%20%09%09%09%09%7D);%20%09%09%09%09return%20!event.defaultPrevented;%20%09%09%09%7D%20%09%09%09return%20true;%20%09%09%7D;%20%09%7D%20%20%09//%20TODO%20figure%20out%20if%20we%20still%20want%20to%20support%20%09//%20shorthand%20events,%20or%20if%20we%20want%20to%20implement%20%09//%20a%20real%20bubbling%20mechanism%20%09/**%20%09%20*%20@param%20component%20%09%20*%20@param%20event%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20bubble(component,%20event)%20%7B%20%09%09const%20callbacks%20=%20component.$$.callbacks%5Bevent.type%5D;%20%09%09if%20(callbacks)%20%7B%20%09%09%09//%20@ts-ignore%20%09%09%09callbacks.slice().forEach((fn)%20=%3E%20fn.call(this,%20event));%20%09%09%7D%20%09%7D%20%20%09const%20dirty_components%20=%20%5B%5D;%20%09const%20binding_callbacks%20=%20%5B%5D;%20%20%09let%20render_callbacks%20=%20%5B%5D;%20%20%09const%20flush_callbacks%20=%20%5B%5D;%20%20%09const%20resolved_promise%20=%20/*%20@__PURE__%20*/%20Promise.resolve();%20%20%09let%20update_scheduled%20=%20false;%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20schedule_update()%20%7B%20%09%09if%20(!update_scheduled)%20%7B%20%09%09%09update_scheduled%20=%20true;%20%09%09%09resolved_promise.then(flush);%20%09%09%7D%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20add_render_callback(fn)%20%7B%20%09%09render_callbacks.push(fn);%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20add_flush_callback(fn)%20%7B%20%09%09flush_callbacks.push(fn);%20%09%7D%20%20%09//%20flush()%20calls%20callbacks%20in%20this%20order:%20%09//%201.%20All%20beforeUpdate%20callbacks,%20in%20order:%20parents%20before%20children%20%09//%202.%20All%20bind:this%20callbacks,%20in%20reverse%20order:%20children%20before%20parents.%20%09//%203.%20All%20afterUpdate%20callbacks,%20in%20order:%20parents%20before%20children.%20EXCEPT%20%09//%20%20%20%20for%20afterUpdates%20called%20during%20the%20initial%20onMount,%20which%20are%20called%20in%20%09//%20%20%20%20reverse%20order:%20children%20before%20parents.%20%09//%20Since%20callbacks%20might%20update%20component%20values,%20which%20could%20trigger%20another%20%09//%20call%20to%20flush(),%20the%20following%20steps%20guard%20against%20this:%20%09//%201.%20During%20beforeUpdate,%20any%20updated%20components%20will%20be%20added%20to%20the%20%09//%20%20%20%20dirty_components%20array%20and%20will%20cause%20a%20reentrant%20call%20to%20flush().%20Because%20%09//%20%20%20%20the%20flush%20index%20is%20kept%20outside%20the%20function,%20the%20reentrant%20call%20will%20pick%20%09//%20%20%20%20up%20where%20the%20earlier%20call%20left%20off%20and%20go%20through%20all%20dirty%20components.%20The%20%09//%20%20%20%20current_component%20value%20is%20saved%20and%20restored%20so%20that%20the%20reentrant%20call%20will%20%09//%20%20%20%20not%20interfere%20with%20the%20%22parent%22%20flush()%20call.%20%09//%202.%20bind:this%20callbacks%20cannot%20trigger%20new%20flush()%20calls.%20%09//%203.%20During%20afterUpdate,%20any%20updated%20components%20will%20NOT%20have%20their%20afterUpdate%20%09//%20%20%20%20callback%20called%20a%20second%20time;%20the%20seen_callbacks%20set,%20outside%20the%20flush()%20%09//%20%20%20%20function,%20guarantees%20this%20behavior.%20%09const%20seen_callbacks%20=%20new%20Set();%20%20%09let%20flushidx%20=%200;%20//%20Do%20*not*%20move%20this%20inside%20the%20flush()%20function%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20flush()%20%7B%20%09%09//%20Do%20not%20reenter%20flush%20while%20dirty%20components%20are%20updated,%20as%20this%20can%20%09%09//%20result%20in%20an%20infinite%20loop.%20Instead,%20let%20the%20inner%20flush%20handle%20it.%20%09%09//%20Reentrancy%20is%20ok%20afterwards%20for%20bindings%20etc.%20%09%09if%20(flushidx%20!==%200)%20%7B%20%09%09%09return;%20%09%09%7D%20%09%09const%20saved_component%20=%20current_component;%20%09%09do%20%7B%20%09%09%09//%20first,%20call%20beforeUpdate%20functions%20%09%09%09//%20and%20update%20components%20%09%09%09try%20%7B%20%09%09%09%09while%20(flushidx%20%3C%20dirty_components.length)%20%7B%20%09%09%09%09%09const%20component%20=%20dirty_components%5Bflushidx%5D;%20%09%09%09%09%09flushidx++;%20%09%09%09%09%09set_current_component(component);%20%09%09%09%09%09update(component.$$);%20%09%09%09%09%7D%20%09%09%09%7D%20catch%20(e)%20%7B%20%09%09%09%09//%20reset%20dirty%20state%20to%20not%20end%20up%20in%20a%20deadlocked%20state%20and%20then%20rethrow%20%09%09%09%09dirty_components.length%20=%200;%20%09%09%09%09flushidx%20=%200;%20%09%09%09%09throw%20e;%20%09%09%09%7D%20%09%09%09set_current_component(null);%20%09%09%09dirty_components.length%20=%200;%20%09%09%09flushidx%20=%200;%20%09%09%09while%20(binding_callbacks.length)%20binding_callbacks.pop()();%20%09%09%09//%20then,%20once%20components%20are%20updated,%20call%20%09%09%09//%20afterUpdate%20functions.%20This%20may%20cause%20%09%09%09//%20subsequent%20updates...%20%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20render_callbacks.length;%20i%20+=%201)%20%7B%20%09%09%09%09const%20callback%20=%20render_callbacks%5Bi%5D;%20%09%09%09%09if%20(!seen_callbacks.has(callback))%20%7B%20%09%09%09%09%09//%20...so%20guard%20against%20infinite%20loops%20%09%09%09%09%09seen_callbacks.add(callback);%20%09%09%09%09%09callback();%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%09render_callbacks.length%20=%200;%20%09%09%7D%20while%20(dirty_components.length);%20%09%09while%20(flush_callbacks.length)%20%7B%20%09%09%09flush_callbacks.pop()();%20%09%09%7D%20%09%09update_scheduled%20=%20false;%20%09%09seen_callbacks.clear();%20%09%09set_current_component(saved_component);%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20update($$)%20%7B%20%09%09if%20($$.fragment%20!==%20null)%20%7B%20%09%09%09$$.update();%20%09%09%09run_all($$.before_update);%20%09%09%09const%20dirty%20=%20$$.dirty;%20%09%09%09$$.dirty%20=%20%5B-1%5D;%20%09%09%09$$.fragment%20&&%20$$.fragment.p($$.ctx,%20dirty);%20%09%09%09$$.after_update.forEach(add_render_callback);%20%09%09%7D%20%09%7D%20%20%09/**%20%09%20*%20Useful%20for%20example%20to%20execute%20remaining%20%60afterUpdate%60%20callbacks%20before%20executing%20%60destroy%60.%20%09%20*%20@param%20%7BFunction%5B%5D%7D%20fns%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20flush_render_callbacks(fns)%20%7B%20%09%09const%20filtered%20=%20%5B%5D;%20%09%09const%20targets%20=%20%5B%5D;%20%09%09render_callbacks.forEach((c)%20=%3E%20(fns.indexOf(c)%20===%20-1%20?%20filtered.push(c)%20:%20targets.push(c)));%20%09%09targets.forEach((c)%20=%3E%20c());%20%09%09render_callbacks%20=%20filtered;%20%09%7D%20%20%09const%20outroing%20=%20new%20Set();%20%20%09/**%20%09%20*%20@type%20%7BOutro%7D%20%09%20*/%20%09let%20outros;%20%20%09/**%20%09%20*%20@returns%20%7Bvoid%7D%20*/%20%09function%20group_outros()%20%7B%20%09%09outros%20=%20%7B%20%09%09%09r:%200,%20%09%09%09c:%20%5B%5D,%20%09%09%09p:%20outros%20//%20parent%20group%20%09%09%7D;%20%09%7D%20%20%09/**%20%09%20*%20@returns%20%7Bvoid%7D%20*/%20%09function%20check_outros()%20%7B%20%09%09if%20(!outros.r)%20%7B%20%09%09%09run_all(outros.c);%20%09%09%7D%20%09%09outros%20=%20outros.p;%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7Bimport('./private.js').Fragment%7D%20block%20%09%20*%20@param%20%7B0%20%7C%201%7D%20%5Blocal%5D%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20transition_in(block,%20local)%20%7B%20%09%09if%20(block%20&&%20block.i)%20%7B%20%09%09%09outroing.delete(block);%20%09%09%09block.i(local);%20%09%09%7D%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7Bimport('./private.js').Fragment%7D%20block%20%09%20*%20@param%20%7B0%20%7C%201%7D%20local%20%09%20*%20@param%20%7B0%20%7C%201%7D%20%5Bdetach%5D%20%09%20*%20@param%20%7B()%20=%3E%20void%7D%20%5Bcallback%5D%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20transition_out(block,%20local,%20detach,%20callback)%20%7B%20%09%09if%20(block%20&&%20block.o)%20%7B%20%09%09%09if%20(outroing.has(block))%20return;%20%09%09%09outroing.add(block);%20%09%09%09outros.c.push(()%20=%3E%20%7B%20%09%09%09%09outroing.delete(block);%20%09%09%09%09if%20(callback)%20%7B%20%09%09%09%09%09if%20(detach)%20block.d(1);%20%09%09%09%09%09callback();%20%09%09%09%09%7D%20%09%09%09%7D);%20%09%09%09block.o(local);%20%09%09%7D%20else%20if%20(callback)%20%7B%20%09%09%09callback();%20%09%09%7D%20%09%7D%20%20%09/**%20@typedef%20%7B1%7D%20INTRO%20*/%20%09/**%20@typedef%20%7B0%7D%20OUTRO%20*/%20%09/**%20@typedef%20%7B%7B%20direction:%20'in'%20%7C%20'out'%20%7C%20'both'%20%7D%7D%20TransitionOptions%20*/%20%09/**%20@typedef%20%7B(node:%20Element,%20params:%20any,%20options:%20TransitionOptions)%20=%3E%20import('../transition/public.js').TransitionConfig%7D%20TransitionFn%20*/%20%20%09/**%20%09%20*%20@typedef%20%7BObject%7D%20Outro%20%09%20*%20@property%20%7Bnumber%7D%20r%20%09%20*%20@property%20%7BFunction%5B%5D%7D%20c%20%09%20*%20@property%20%7BObject%7D%20p%20%09%20*/%20%20%09/**%20%09%20*%20@typedef%20%7BObject%7D%20PendingProgram%20%09%20*%20@property%20%7Bnumber%7D%20start%20%09%20*%20@property%20%7BINTRO%7COUTRO%7D%20b%20%09%20*%20@property%20%7BOutro%7D%20%5Bgroup%5D%20%09%20*/%20%20%09/**%20%09%20*%20@typedef%20%7BObject%7D%20Program%20%09%20*%20@property%20%7Bnumber%7D%20a%20%09%20*%20@property%20%7BINTRO%7COUTRO%7D%20b%20%09%20*%20@property%20%7B1%7C-1%7D%20d%20%09%20*%20@property%20%7Bnumber%7D%20duration%20%09%20*%20@property%20%7Bnumber%7D%20start%20%09%20*%20@property%20%7Bnumber%7D%20end%20%09%20*%20@property%20%7BOutro%7D%20%5Bgroup%5D%20%09%20*/%20%20%09//%20general%20each%20functions:%20%20%09function%20ensure_array_like(array_like_or_iterator)%20%7B%20%09%09return%20array_like_or_iterator?.length%20!==%20undefined%20%09%09%09?%20array_like_or_iterator%20%09%09%09:%20Array.from(array_like_or_iterator);%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20bind(component,%20name,%20callback)%20%7B%20%09%09const%20index%20=%20component.$$.props%5Bname%5D;%20%09%09if%20(index%20!==%20undefined)%20%7B%20%09%09%09component.$$.bound%5Bindex%5D%20=%20callback;%20%09%09%09callback(component.$$.ctx%5Bindex%5D);%20%09%09%7D%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20create_component(block)%20%7B%20%09%09block%20&&%20block.c();%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20mount_component(component,%20target,%20anchor)%20%7B%20%09%09const%20%7B%20fragment,%20after_update%20%7D%20=%20component.$$;%20%09%09fragment%20&&%20fragment.m(target,%20anchor);%20%09%09//%20onMount%20happens%20before%20the%20initial%20afterUpdate%20%09%09add_render_callback(()%20=%3E%20%7B%20%09%09%09const%20new_on_destroy%20=%20component.$$.on_mount.map(run).filter(is_function);%20%09%09%09//%20if%20the%20component%20was%20destroyed%20immediately%20%09%09%09//%20it%20will%20update%20the%20%60$$.on_destroy%60%20reference%20to%20%60null%60.%20%09%09%09//%20the%20destructured%20on_destroy%20may%20still%20reference%20to%20the%20old%20array%20%09%09%09if%20(component.$$.on_destroy)%20%7B%20%09%09%09%09component.$$.on_destroy.push(...new_on_destroy);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09//%20Edge%20case%20-%20component%20was%20destroyed%20immediately,%20%09%09%09%09//%20most%20likely%20as%20a%20result%20of%20a%20binding%20initialising%20%09%09%09%09run_all(new_on_destroy);%20%09%09%09%7D%20%09%09%09component.$$.on_mount%20=%20%5B%5D;%20%09%09%7D);%20%09%09after_update.forEach(add_render_callback);%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20destroy_component(component,%20detaching)%20%7B%20%09%09const%20$$%20=%20component.$$;%20%09%09if%20($$.fragment%20!==%20null)%20%7B%20%09%09%09flush_render_callbacks($$.after_update);%20%09%09%09run_all($$.on_destroy);%20%09%09%09$$.fragment%20&&%20$$.fragment.d(detaching);%20%09%09%09//%20TODO%20null%20out%20other%20refs,%20including%20component.$$%20(but%20need%20to%20%09%09%09//%20preserve%20final%20state?)%20%09%09%09$$.on_destroy%20=%20$$.fragment%20=%20null;%20%09%09%09$$.ctx%20=%20%5B%5D;%20%09%09%7D%20%09%7D%20%20%09/**%20@returns%20%7Bvoid%7D%20*/%20%09function%20make_dirty(component,%20i)%20%7B%20%09%09if%20(component.$$.dirty%5B0%5D%20===%20-1)%20%7B%20%09%09%09dirty_components.push(component);%20%09%09%09schedule_update();%20%09%09%09component.$$.dirty.fill(0);%20%09%09%7D%20%09%09component.$$.dirty%5B(i%20/%2031)%20%7C%200%5D%20%7C=%201%20%3C%3C%20i%20%25%2031;%20%09%7D%20%20%09//%20TODO:%20Document%20the%20other%20params%20%09/**%20%09%20*%20@param%20%7BSvelteComponent%7D%20component%20%09%20*%20@param%20%7Bimport('./public.js').ComponentConstructorOptions%7D%20options%20%09%20*%20%09%20*%20@param%20%7Bimport('./utils.js')%5B'not_equal'%5D%7D%20not_equal%20Used%20to%20compare%20props%20and%20state%20values.%20%09%20*%20@param%20%7B(target:%20Element%20%7C%20ShadowRoot)%20=%3E%20void%7D%20%5Bappend_styles%5D%20Function%20that%20appends%20styles%20to%20the%20DOM%20when%20the%20component%20is%20first%20initialised.%20%09%20*%20This%20will%20be%20the%20%60add_css%60%20function%20from%20the%20compiled%20component.%20%09%20*%20%09%20*%20@returns%20%7Bvoid%7D%20%09%20*/%20%09function%20init(%20%09%09component,%20%09%09options,%20%09%09instance,%20%09%09create_fragment,%20%09%09not_equal,%20%09%09props,%20%09%09append_styles%20=%20null,%20%09%09dirty%20=%20%5B-1%5D%20%09)%20%7B%20%09%09const%20parent_component%20=%20current_component;%20%09%09set_current_component(component);%20%09%09/**%20@type%20%7Bimport('./private.js').T$$%7D%20*/%20%09%09const%20$$%20=%20(component.$$%20=%20%7B%20%09%09%09fragment:%20null,%20%09%09%09ctx:%20%5B%5D,%20%09%09%09//%20state%20%09%09%09props,%20%09%09%09update:%20noop,%20%09%09%09not_equal,%20%09%09%09bound:%20blank_object(),%20%09%09%09//%20lifecycle%20%09%09%09on_mount:%20%5B%5D,%20%09%09%09on_destroy:%20%5B%5D,%20%09%09%09on_disconnect:%20%5B%5D,%20%09%09%09before_update:%20%5B%5D,%20%09%09%09after_update:%20%5B%5D,%20%09%09%09context:%20new%20Map(options.context%20%7C%7C%20(parent_component%20?%20parent_component.$$.context%20:%20%5B%5D)),%20%09%09%09//%20everything%20else%20%09%09%09callbacks:%20blank_object(),%20%09%09%09dirty,%20%09%09%09skip_bound:%20false,%20%09%09%09root:%20options.target%20%7C%7C%20parent_component.$$.root%20%09%09%7D);%20%09%09append_styles%20&&%20append_styles($$.root);%20%09%09let%20ready%20=%20false;%20%09%09$$.ctx%20=%20instance%20%09%09%09?%20instance(component,%20options.props%20%7C%7C%20%7B%7D,%20(i,%20ret,%20...rest)%20=%3E%20%7B%20%09%09%09%09%09const%20value%20=%20rest.length%20?%20rest%5B0%5D%20:%20ret;%20%09%09%09%09%09if%20($$.ctx%20&&%20not_equal($$.ctx%5Bi%5D,%20($$.ctx%5Bi%5D%20=%20value)))%20%7B%20%09%09%09%09%09%09if%20(!$$.skip_bound%20&&%20$$.bound%5Bi%5D)%20$$.bound%5Bi%5D(value);%20%09%09%09%09%09%09if%20(ready)%20make_dirty(component,%20i);%20%09%09%09%09%09%7D%20%09%09%09%09%09return%20ret;%20%09%09%09%20%20%7D)%20%09%09%09:%20%5B%5D;%20%09%09$$.update();%20%09%09ready%20=%20true;%20%09%09run_all($$.before_update);%20%09%09//%20%60false%60%20as%20a%20special%20case%20of%20no%20DOM%20component%20%09%09$$.fragment%20=%20create_fragment%20?%20create_fragment($$.ctx)%20:%20false;%20%09%09if%20(options.target)%20%7B%20%09%09%09if%20(options.hydrate)%20%7B%20%09%09%09%09//%20TODO:%20what%20is%20the%20correct%20type%20here?%20%09%09%09%09//%20@ts-expect-error%20%09%09%09%09const%20nodes%20=%20children(options.target);%20%09%09%09%09$$.fragment%20&&%20$$.fragment.l(nodes);%20%09%09%09%09nodes.forEach(detach);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09//%20eslint-disable-next-line%20@typescript-eslint/no-non-null-assertion%20%09%09%09%09$$.fragment%20&&%20$$.fragment.c();%20%09%09%09%7D%20%09%09%09if%20(options.intro)%20transition_in(component.$$.fragment);%20%09%09%09mount_component(component,%20options.target,%20options.anchor);%20%09%09%09flush();%20%09%09%7D%20%09%09set_current_component(parent_component);%20%09%7D%20%20%09/**%20%09%20*%20Base%20class%20for%20Svelte%20components.%20Used%20when%20dev=false.%20%09%20*%20%09%20*%20@template%20%7BRecord%3Cstring,%20any%3E%7D%20%5BProps=any%5D%20%09%20*%20@template%20%7BRecord%3Cstring,%20any%3E%7D%20%5BEvents=any%5D%20%09%20*/%20%09class%20SvelteComponent%20%7B%20%09%09/**%20%09%09%20*%20%23%23%23%20PRIVATE%20API%20%09%09%20*%20%09%09%20*%20Do%20not%20use,%20may%20change%20at%20any%20time%20%09%09%20*%20%09%09%20*%20@type%20%7Bany%7D%20%09%09%20*/%20%09%09$$%20=%20undefined;%20%09%09/**%20%09%09%20*%20%23%23%23%20PRIVATE%20API%20%09%09%20*%20%09%09%20*%20Do%20not%20use,%20may%20change%20at%20any%20time%20%09%09%20*%20%09%09%20*%20@type%20%7Bany%7D%20%09%09%20*/%20%09%09$$set%20=%20undefined;%20%20%09%09/**%20@returns%20%7Bvoid%7D%20*/%20%09%09$destroy()%20%7B%20%09%09%09destroy_component(this,%201);%20%09%09%09this.$destroy%20=%20noop;%20%09%09%7D%20%20%09%09/**%20%09%09%20*%20@template%20%7BExtract%3Ckeyof%20Events,%20string%3E%7D%20K%20%09%09%20*%20@param%20%7BK%7D%20type%20%09%09%20*%20@param%20%7B((e:%20Events%5BK%5D)%20=%3E%20void)%20%7C%20null%20%7C%20undefined%7D%20callback%20%09%09%20*%20@returns%20%7B()%20=%3E%20void%7D%20%09%09%20*/%20%09%09$on(type,%20callback)%20%7B%20%09%09%09if%20(!is_function(callback))%20%7B%20%09%09%09%09return%20noop;%20%09%09%09%7D%20%09%09%09const%20callbacks%20=%20this.$$.callbacks%5Btype%5D%20%7C%7C%20(this.$$.callbacks%5Btype%5D%20=%20%5B%5D);%20%09%09%09callbacks.push(callback);%20%09%09%09return%20()%20=%3E%20%7B%20%09%09%09%09const%20index%20=%20callbacks.indexOf(callback);%20%09%09%09%09if%20(index%20!==%20-1)%20callbacks.splice(index,%201);%20%09%09%09%7D;%20%09%09%7D%20%20%09%09/**%20%09%09%20*%20@param%20%7BPartial%3CProps%3E%7D%20props%20%09%09%20*%20@returns%20%7Bvoid%7D%20%09%09%20*/%20%09%09$set(props)%20%7B%20%09%09%09if%20(this.$$set%20&&%20!is_empty(props))%20%7B%20%09%09%09%09this.$$.skip_bound%20=%20true;%20%09%09%09%09this.$$set(props);%20%09%09%09%09this.$$.skip_bound%20=%20false;%20%09%09%09%7D%20%09%09%7D%20%09%7D%20%20%09/**%20%09%20*%20@typedef%20%7BObject%7D%20CustomElementPropDefinition%20%09%20*%20@property%20%7Bstring%7D%20%5Battribute%5D%20%09%20*%20@property%20%7Bboolean%7D%20%5Breflect%5D%20%09%20*%20@property%20%7B'String'%7C'Boolean'%7C'Number'%7C'Array'%7C'Object'%7D%20%5Btype%5D%20%09%20*/%20%20%09//%20generated%20during%20release,%20do%20not%20modify%20%20%09const%20PUBLIC_VERSION%20=%20'4';%20%20%09if%20(typeof%20window%20!==%20'undefined')%20%09%09//%20@ts-ignore%20%09%09(window.__svelte%20%7C%7C%20(window.__svelte%20=%20%7B%20v:%20new%20Set()%20%7D)).v.add(PUBLIC_VERSION);%20%20%09var%20commonjsGlobal%20=%20typeof%20globalThis%20!==%20'undefined'%20?%20globalThis%20:%20typeof%20window%20!==%20'undefined'%20?%20window%20:%20typeof%20global%20!==%20'undefined'%20?%20global%20:%20typeof%20self%20!==%20'undefined'%20?%20self%20:%20%7B%7D;%20%20%09function%20getDefaultExportFromCjs%20(x)%20%7B%20%09%09return%20x%20&&%20x.__esModule%20&&%20Object.prototype.hasOwnProperty.call(x,%20'default')%20?%20x%5B'default'%5D%20:%20x;%20%09%7D%20%20%09var%20debounce$2%20=%20%7Bexports:%20%7B%7D%7D;%20%20%09function%20debounce(function_,%20wait%20=%20100,%20options%20=%20%7B%7D)%20%7B%20%09%09if%20(typeof%20function_%20!==%20'function')%20%7B%20%09%09%09throw%20new%20TypeError(%60Expected%20the%20first%20parameter%20to%20be%20a%20function,%20got%20%5C%60$%7Btypeof%20function_%7D%5C%60.%60);%20%09%09%7D%20%20%09%09if%20(wait%20%3C%200)%20%7B%20%09%09%09throw%20new%20RangeError('%60wait%60%20must%20not%20be%20negative.');%20%09%09%7D%20%20%09%09//%20TODO:%20Deprecate%20the%20boolean%20parameter%20at%20some%20point.%20%09%09const%20%7Bimmediate%7D%20=%20typeof%20options%20===%20'boolean'%20?%20%7Bimmediate:%20options%7D%20:%20options;%20%20%09%09let%20storedContext;%20%09%09let%20storedArguments;%20%09%09let%20timeoutId;%20%09%09let%20timestamp;%20%09%09let%20result;%20%20%09%09function%20run()%20%7B%20%09%09%09const%20callContext%20=%20storedContext;%20%09%09%09const%20callArguments%20=%20storedArguments;%20%09%09%09storedContext%20=%20undefined;%20%09%09%09storedArguments%20=%20undefined;%20%09%09%09result%20=%20function_.apply(callContext,%20callArguments);%20%09%09%09return%20result;%20%09%09%7D%20%20%09%09function%20later()%20%7B%20%09%09%09const%20last%20=%20Date.now()%20-%20timestamp;%20%20%09%09%09if%20(last%20%3C%20wait%20&&%20last%20%3E=%200)%20%7B%20%09%09%09%09timeoutId%20=%20setTimeout(later,%20wait%20-%20last);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09timeoutId%20=%20undefined;%20%20%09%09%09%09if%20(!immediate)%20%7B%20%09%09%09%09%09result%20=%20run();%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D%20%20%09%09const%20debounced%20=%20function%20(...arguments_)%20%7B%20%09%09%09if%20(storedContext%20&&%20this%20!==%20storedContext)%20%7B%20%09%09%09%09throw%20new%20Error('Debounced%20method%20called%20with%20different%20contexts.');%20%09%09%09%7D%20%20%09%09%09storedContext%20=%20this;%20//%20eslint-disable-line%20unicorn/no-this-assignment%20%09%09%09storedArguments%20=%20arguments_;%20%09%09%09timestamp%20=%20Date.now();%20%20%09%09%09const%20callNow%20=%20immediate%20&&%20!timeoutId;%20%20%09%09%09if%20(!timeoutId)%20%7B%20%09%09%09%09timeoutId%20=%20setTimeout(later,%20wait);%20%09%09%09%7D%20%20%09%09%09if%20(callNow)%20%7B%20%09%09%09%09result%20=%20run();%20%09%09%09%7D%20%20%09%09%09return%20result;%20%09%09%7D;%20%20%09%09debounced.clear%20=%20()%20=%3E%20%7B%20%09%09%09if%20(!timeoutId)%20%7B%20%09%09%09%09return;%20%09%09%09%7D%20%20%09%09%09clearTimeout(timeoutId);%20%09%09%09timeoutId%20=%20undefined;%20%09%09%7D;%20%20%09%09debounced.flush%20=%20()%20=%3E%20%7B%20%09%09%09if%20(!timeoutId)%20%7B%20%09%09%09%09return;%20%09%09%09%7D%20%20%09%09%09debounced.trigger();%20%09%09%7D;%20%20%09%09debounced.trigger%20=%20()%20=%3E%20%7B%20%09%09%09result%20=%20run();%20%20%09%09%09debounced.clear();%20%09%09%7D;%20%20%09%09return%20debounced;%20%09%7D%20%20%09//%20Adds%20compatibility%20for%20ES%20modules%20%09debounce$2.exports.debounce%20=%20debounce;%20%20%09debounce$2.exports%20=%20debounce;%20%20%09var%20debounceExports%20=%20debounce$2.exports;%20%09var%20debounce$1%20=%20/*@__PURE__*/getDefaultExportFromCjs(debounceExports);%20%20%09const%20subscriber_queue%20=%20%5B%5D;%20%20%09/**%20%09%20*%20Create%20a%20%60Writable%60%20store%20that%20allows%20both%20updating%20and%20reading%20by%20subscription.%20%09%20*%20%09%20*%20https://svelte.dev/docs/svelte-store%23writable%20%09%20*%20@template%20T%20%09%20*%20@param%20%7BT%7D%20%5Bvalue%5D%20initial%20value%20%09%20*%20@param%20%7Bimport('./public.js').StartStopNotifier%3CT%3E%7D%20%5Bstart%5D%20%09%20*%20@returns%20%7Bimport('./public.js').Writable%3CT%3E%7D%20%09%20*/%20%09function%20writable(value,%20start%20=%20noop)%20%7B%20%09%09/**%20@type%20%7Bimport('./public.js').Unsubscriber%7D%20*/%20%09%09let%20stop;%20%09%09/**%20@type%20%7BSet%3Cimport('./private.js').SubscribeInvalidateTuple%3CT%3E%3E%7D%20*/%20%09%09const%20subscribers%20=%20new%20Set();%20%09%09/**%20@param%20%7BT%7D%20new_value%20%09%09%20*%20@returns%20%7Bvoid%7D%20%09%09%20*/%20%09%09function%20set(new_value)%20%7B%20%09%09%09if%20(safe_not_equal(value,%20new_value))%20%7B%20%09%09%09%09value%20=%20new_value;%20%09%09%09%09if%20(stop)%20%7B%20%09%09%09%09%09//%20store%20is%20ready%20%09%09%09%09%09const%20run_queue%20=%20!subscriber_queue.length;%20%09%09%09%09%09for%20(const%20subscriber%20of%20subscribers)%20%7B%20%09%09%09%09%09%09subscriber%5B1%5D();%20%09%09%09%09%09%09subscriber_queue.push(subscriber,%20value);%20%09%09%09%09%09%7D%20%09%09%09%09%09if%20(run_queue)%20%7B%20%09%09%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20subscriber_queue.length;%20i%20+=%202)%20%7B%20%09%09%09%09%09%09%09subscriber_queue%5Bi%5D%5B0%5D(subscriber_queue%5Bi%20+%201%5D);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%09subscriber_queue.length%20=%200;%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D%20%20%09%09/**%20%09%09%20*%20@param%20%7Bimport('./public.js').Updater%3CT%3E%7D%20fn%20%09%09%20*%20@returns%20%7Bvoid%7D%20%09%09%20*/%20%09%09function%20update(fn)%20%7B%20%09%09%09set(fn(value));%20%09%09%7D%20%20%09%09/**%20%09%09%20*%20@param%20%7Bimport('./public.js').Subscriber%3CT%3E%7D%20run%20%09%09%20*%20@param%20%7Bimport('./private.js').Invalidator%3CT%3E%7D%20%5Binvalidate%5D%20%09%09%20*%20@returns%20%7Bimport('./public.js').Unsubscriber%7D%20%09%09%20*/%20%09%09function%20subscribe(run,%20invalidate%20=%20noop)%20%7B%20%09%09%09/**%20@type%20%7Bimport('./private.js').SubscribeInvalidateTuple%3CT%3E%7D%20*/%20%09%09%09const%20subscriber%20=%20%5Brun,%20invalidate%5D;%20%09%09%09subscribers.add(subscriber);%20%09%09%09if%20(subscribers.size%20===%201)%20%7B%20%09%09%09%09stop%20=%20start(set,%20update)%20%7C%7C%20noop;%20%09%09%09%7D%20%09%09%09run(value);%20%09%09%09return%20()%20=%3E%20%7B%20%09%09%09%09subscribers.delete(subscriber);%20%09%09%09%09if%20(subscribers.size%20===%200%20&&%20stop)%20%7B%20%09%09%09%09%09stop();%20%09%09%09%09%09stop%20=%20null;%20%09%09%09%09%7D%20%09%09%09%7D;%20%09%09%7D%20%09%09return%20%7B%20set,%20update,%20subscribe%20%7D;%20%09%7D%20%20%09/**%20%09%20*%20@param%20%7Bany%7D%20obj%20%09%20*%20@returns%20%7Bboolean%7D%20%09%20*/%20%09function%20is_date(obj)%20%7B%20%09%09return%20Object.prototype.toString.call(obj)%20===%20'%5Bobject%20Date%5D';%20%09%7D%20%20%09/**%20%09%20*%20@template%20T%20%09%20*%20@param%20%7Bimport('./private.js').TickContext%3CT%3E%7D%20ctx%20%09%20*%20@param%20%7BT%7D%20last_value%20%09%20*%20@param%20%7BT%7D%20current_value%20%09%20*%20@param%20%7BT%7D%20target_value%20%09%20*%20@returns%20%7BT%7D%20%09%20*/%20%09function%20tick_spring(ctx,%20last_value,%20current_value,%20target_value)%20%7B%20%09%09if%20(typeof%20current_value%20===%20'number'%20%7C%7C%20is_date(current_value))%20%7B%20%09%09%09//%20@ts-ignore%20%09%09%09const%20delta%20=%20target_value%20-%20current_value;%20%09%09%09//%20@ts-ignore%20%09%09%09const%20velocity%20=%20(current_value%20-%20last_value)%20/%20(ctx.dt%20%7C%7C%201%20/%2060);%20//%20guard%20div%20by%200%20%09%09%09const%20spring%20=%20ctx.opts.stiffness%20*%20delta;%20%09%09%09const%20damper%20=%20ctx.opts.damping%20*%20velocity;%20%09%09%09const%20acceleration%20=%20(spring%20-%20damper)%20*%20ctx.inv_mass;%20%09%09%09const%20d%20=%20(velocity%20+%20acceleration)%20*%20ctx.dt;%20%09%09%09if%20(Math.abs(d)%20%3C%20ctx.opts.precision%20&&%20Math.abs(delta)%20%3C%20ctx.opts.precision)%20%7B%20%09%09%09%09return%20target_value;%20//%20settled%20%09%09%09%7D%20else%20%7B%20%09%09%09%09ctx.settled%20=%20false;%20//%20signal%20loop%20to%20keep%20ticking%20%09%09%09%09//%20@ts-ignore%20%09%09%09%09return%20is_date(current_value)%20?%20new%20Date(current_value.getTime()%20+%20d)%20:%20current_value%20+%20d;%20%09%09%09%7D%20%09%09%7D%20else%20if%20(Array.isArray(current_value))%20%7B%20%09%09%09//%20@ts-ignore%20%09%09%09return%20current_value.map((_,%20i)%20=%3E%20%09%09%09%09tick_spring(ctx,%20last_value%5Bi%5D,%20current_value%5Bi%5D,%20target_value%5Bi%5D)%20%09%09%09);%20%09%09%7D%20else%20if%20(typeof%20current_value%20===%20'object')%20%7B%20%09%09%09const%20next_value%20=%20%7B%7D;%20%09%09%09for%20(const%20k%20in%20current_value)%20%7B%20%09%09%09%09//%20@ts-ignore%20%09%09%09%09next_value%5Bk%5D%20=%20tick_spring(ctx,%20last_value%5Bk%5D,%20current_value%5Bk%5D,%20target_value%5Bk%5D);%20%09%09%09%7D%20%09%09%09//%20@ts-ignore%20%09%09%09return%20next_value;%20%09%09%7D%20else%20%7B%20%09%09%09throw%20new%20Error(%60Cannot%20spring%20$%7Btypeof%20current_value%7D%20values%60);%20%09%09%7D%20%09%7D%20%20%09/**%20%09%20*%20The%20spring%20function%20in%20Svelte%20creates%20a%20store%20whose%20value%20is%20animated,%20with%20a%20motion%20that%20simulates%20the%20behavior%20of%20a%20spring.%20This%20means%20when%20the%20value%20changes,%20instead%20of%20transitioning%20at%20a%20steady%20rate,%20it%20%22bounces%22%20like%20a%20spring%20would,%20depending%20on%20the%20physics%20parameters%20provided.%20This%20adds%20a%20level%20of%20realism%20to%20the%20transitions%20and%20can%20enhance%20the%20user%20experience.%20%09%20*%20%09%20*%20https://svelte.dev/docs/svelte-motion%23spring%20%09%20*%20@template%20%5BT=any%5D%20%09%20*%20@param%20%7BT%7D%20%5Bvalue%5D%20%09%20*%20@param%20%7Bimport('./private.js').SpringOpts%7D%20%5Bopts%5D%20%09%20*%20@returns%20%7Bimport('./public.js').Spring%3CT%3E%7D%20%09%20*/%20%09function%20spring(value,%20opts%20=%20%7B%7D)%20%7B%20%09%09const%20store%20=%20writable(value);%20%09%09const%20%7B%20stiffness%20=%200.15,%20damping%20=%200.8,%20precision%20=%200.01%20%7D%20=%20opts;%20%09%09/**%20@type%20%7Bnumber%7D%20*/%20%09%09let%20last_time;%20%09%09/**%20@type%20%7Bimport('../internal/private.js').Task%7D%20*/%20%09%09let%20task;%20%09%09/**%20@type%20%7Bobject%7D%20*/%20%09%09let%20current_token;%20%09%09/**%20@type%20%7BT%7D%20*/%20%09%09let%20last_value%20=%20value;%20%09%09/**%20@type%20%7BT%7D%20*/%20%09%09let%20target_value%20=%20value;%20%09%09let%20inv_mass%20=%201;%20%09%09let%20inv_mass_recovery_rate%20=%200;%20%09%09let%20cancel_task%20=%20false;%20%09%09/**%20%09%09%20*%20@param%20%7BT%7D%20new_value%20%09%09%20*%20@param%20%7Bimport('./private.js').SpringUpdateOpts%7D%20opts%20%09%09%20*%20@returns%20%7BPromise%3Cvoid%3E%7D%20%09%09%20*/%20%09%09function%20set(new_value,%20opts%20=%20%7B%7D)%20%7B%20%09%09%09target_value%20=%20new_value;%20%09%09%09const%20token%20=%20(current_token%20=%20%7B%7D);%20%09%09%09if%20(value%20==%20null%20%7C%7C%20opts.hard%20%7C%7C%20(spring.stiffness%20%3E=%201%20&&%20spring.damping%20%3E=%201))%20%7B%20%09%09%09%09cancel_task%20=%20true;%20//%20cancel%20any%20running%20animation%20%09%09%09%09last_time%20=%20now();%20%09%09%09%09last_value%20=%20new_value;%20%09%09%09%09store.set((value%20=%20target_value));%20%09%09%09%09return%20Promise.resolve();%20%09%09%09%7D%20else%20if%20(opts.soft)%20%7B%20%09%09%09%09const%20rate%20=%20opts.soft%20===%20true%20?%200.5%20:%20+opts.soft;%20%09%09%09%09inv_mass_recovery_rate%20=%201%20/%20(rate%20*%2060);%20%09%09%09%09inv_mass%20=%200;%20//%20infinite%20mass,%20unaffected%20by%20spring%20forces%20%09%09%09%7D%20%09%09%09if%20(!task)%20%7B%20%09%09%09%09last_time%20=%20now();%20%09%09%09%09cancel_task%20=%20false;%20%09%09%09%09task%20=%20loop((now)%20=%3E%20%7B%20%09%09%09%09%09if%20(cancel_task)%20%7B%20%09%09%09%09%09%09cancel_task%20=%20false;%20%09%09%09%09%09%09task%20=%20null;%20%09%09%09%09%09%09return%20false;%20%09%09%09%09%09%7D%20%09%09%09%09%09inv_mass%20=%20Math.min(inv_mass%20+%20inv_mass_recovery_rate,%201);%20%09%09%09%09%09const%20ctx%20=%20%7B%20%09%09%09%09%09%09inv_mass,%20%09%09%09%09%09%09opts:%20spring,%20%09%09%09%09%09%09settled:%20true,%20%09%09%09%09%09%09dt:%20((now%20-%20last_time)%20*%2060)%20/%201000%20%09%09%09%09%09%7D;%20%09%09%09%09%09const%20next_value%20=%20tick_spring(ctx,%20last_value,%20value,%20target_value);%20%09%09%09%09%09last_time%20=%20now;%20%09%09%09%09%09last_value%20=%20value;%20%09%09%09%09%09store.set((value%20=%20next_value));%20%09%09%09%09%09if%20(ctx.settled)%20%7B%20%09%09%09%09%09%09task%20=%20null;%20%09%09%09%09%09%7D%20%09%09%09%09%09return%20!ctx.settled;%20%09%09%09%09%7D);%20%09%09%09%7D%20%09%09%09return%20new%20Promise((fulfil)%20=%3E%20%7B%20%09%09%09%09task.promise.then(()%20=%3E%20%7B%20%09%09%09%09%09if%20(token%20===%20current_token)%20fulfil();%20%09%09%09%09%7D);%20%09%09%09%7D);%20%09%09%7D%20%09%09/**%20@type%20%7Bimport('./public.js').Spring%3CT%3E%7D%20*/%20%09%09const%20spring%20=%20%7B%20%09%09%09set,%20%09%09%09update:%20(fn,%20opts)%20=%3E%20set(fn(target_value,%20value),%20opts),%20%09%09%09subscribe:%20store.subscribe,%20%09%09%09stiffness,%20%09%09%09damping,%20%09%09%09precision%20%09%09%7D;%20%09%09return%20spring;%20%09%7D%20%20%09const%20useGM%20=%20typeof%20GM_getValue%20!==%20'undefined';%20%09function%20setValue(key,%20value)%20%7B%20%09%20%20%20%20if%20(useGM)%20%7B%20%09%20%20%20%20%20%20%20%20GM_setValue(key,%20value);%20%09%20%20%20%20%7D%20%09%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20localStorage.setItem(%60gc-$%7Bkey%7D%60,%20value);%20%09%20%20%20%20%7D%20%09%7D%20%09function%20getValue(key,%20defaultValue)%20%7B%20%09%20%20%20%20if%20(useGM)%20%7B%20%09%20%20%20%20%20%20%20%20return%20GM_getValue(key,%20defaultValue);%20%09%20%20%20%20%7D%20%09%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20return%20localStorage.getItem(%60gc-$%7Bkey%7D%60)%20??%20defaultValue;%20%09%20%20%20%20%7D%20%09%7D%20%20%09const%20defaultCss%20=%20%7B%20%09%20%20%20%20textColor:%20%22rgba(255,%20255,%20255,%201)%22,%20%09%20%20%20%20menuBackgroundColor:%20%22rgba(0,%200,%200,%200.5)%22,%20%09%20%20%20%20menuOutlineColor:%20%22rgba(255,%20255,%20255,%200)%22,%20%09%20%20%20%20menuHeaderBackgroundColor:%20%22rgba(0,%200,%20255,%200.5)%22,%20%09%20%20%20%20menuHeaderTextColor:%20%22rgba(255,%20255,%20255,%201)%22,%20%09%20%20%20%20buttonBackgroundColor:%20%22rgba(0,%200,%200,%200.5)%22,%20%09%20%20%20%20buttonBorderColor:%20%22rgba(255,%20255,%20255,%201)%22%20%09%7D;%20%09const%20defaultMenuTransforms%20=%20%7B%20%09%20%20%20%20%22General%20Cheats%22:%20%7B%20%09%20%20%20%20%20%20%20%20x:%200,%20%09%20%20%20%20%20%20%20%20y:%200,%20%09%20%20%20%20%20%20%20%20width:%20window.innerWidth%20/%204,%20%09%20%20%20%20%20%20%20%20height:%20window.innerHeight%20/%203%20*%202,%20%09%20%20%20%20%20%20%20%20minimized:%20false%20%09%20%20%20%20%7D,%20%09%20%20%20%20%22Gamemode%20Specific%20Cheats%22:%20%7B%20%09%20%20%20%20%20%20%20%20x:%20window.innerWidth%20/%208%20*%203,%20%09%20%20%20%20%20%20%20%20y:%200,%20%09%20%20%20%20%20%20%20%20width:%20window.innerWidth%20/%204,%20%09%20%20%20%20%20%20%20%20height:%20window.innerHeight%20/%203%20*%202,%20%09%20%20%20%20%20%20%20%20minimized:%20false%20%09%20%20%20%20%7D,%20%09%20%20%20%20%22Customization%22:%20%7B%20%09%20%20%20%20%20%20%20%20x:%20window.innerWidth%20/%204%20*%203,%20%09%20%20%20%20%20%20%20%20y:%200,%20%09%20%20%20%20%20%20%20%20width:%20window.innerWidth%20/%204,%20%09%20%20%20%20%20%20%20%20height:%20window.innerHeight%20/%203%20*%202,%20%09%20%20%20%20%20%20%20%20minimized:%20false%20%09%20%20%20%20%7D%20%09%7D;%20%20%09let%20cssVarsString%20=%20getValue('cssVars');%20%09let%20cssVars%20=%20%7B%7D;%20%09if%20(cssVarsString)%20%09%20%20%20%20cssVars%20=%20JSON.parse(cssVarsString);%20%09//%20merge%20default%20css%20vars%20with%20saved%20vars%20%09cssVars%20=%20Object.assign(%7B%7D,%20defaultCss,%20cssVars);%20%09async%20function%20addVars()%20%7B%20%09%20%20%20%20if%20(!document.documentElement)%20%7B%20%09%20%20%20%20%20%20%20%20await%20new%20Promise(res%20=%3E%20window.addEventListener('DOMContentLoaded',%20res));%20%09%20%20%20%20%7D%20%09%20%20%20%20for%20(let%20%5Bkey,%20value%5D%20of%20Object.entries(cssVars))%20%7B%20%09%20%20%20%20%20%20%20%20document.documentElement.style.setProperty(%60--$%7Bkey%7D%60,%20value);%20%09%20%20%20%20%7D%20%09%7D%20%09function%20getCssVar(key)%20%7B%20%09%20%20%20%20return%20cssVars%5Bkey%5D;%20%09%7D%20%09function%20setCssVar(key,%20value)%20%7B%20%09%20%20%20%20cssVars%5Bkey%5D%20=%20value;%20%09%20%20%20%20setValue('cssVars',%20JSON.stringify(cssVars));%20%09%7D%20%09function%20setCssVars(vars)%20%7B%20%09%20%20%20%20cssVars%20=%20Object.assign(%7B%7D,%20cssVars,%20vars);%20%09%20%20%20%20setValue('cssVars',%20JSON.stringify(cssVars));%20%09%7D%20%09let%20menuTransformsString%20=%20getValue('menuTransforms');%20%09let%20menuTransforms%20=%20%7B%7D;%20%09if%20(menuTransformsString)%20%09%20%20%20%20menuTransforms%20=%20JSON.parse(menuTransformsString);%20%09//%20merge%20default%20menu%20transforms%20with%20saved%20transforms%20%09menuTransforms%20=%20Object.assign(%7B%7D,%20defaultMenuTransforms,%20menuTransforms);%20%09function%20getMenuTransform(menuName)%20%7B%20%09%20%20%20%20return%20menuTransforms%5BmenuName%5D;%20%09%7D%20%09function%20setMenuTransform(menuName,%20transform)%20%7B%20%09%20%20%20%20menuTransforms%5BmenuName%5D%20=%20transform;%20%09%20%20%20%20setValue('menuTransforms',%20JSON.stringify(menuTransforms));%20%09%7D%20%09let%20hotkeysString%20=%20getValue('hotkeys');%20%09let%20hotkeys%20=%20%7B%7D;%20%09if%20(hotkeysString)%20%09%20%20%20%20hotkeys%20=%20JSON.parse(hotkeysString);%20%09function%20getHotkey(menuName)%20%7B%20%09%20%20%20%20return%20hotkeys%5BmenuName%5D;%20%09%7D%20%09function%20setHotkey(menuName,%20keys)%20%7B%20%09%20%20%20%20hotkeys%5BmenuName%5D%20=%20keys;%20%09%20%20%20%20setValue('hotkeys',%20JSON.stringify(hotkeys));%20%09%7D%20%20%09function%20findMatchingParent(node,%20selector)%20%7B%20%09%20%20%20%20if%20(node.matches(selector))%20%7B%20%09%20%20%20%20%20%20%20%20return%20node;%20%09%20%20%20%20%7D%20%09%20%20%20%20if%20(node.parentElement)%20%7B%20%09%20%20%20%20%20%20%20%20return%20findMatchingParent(node.parentElement,%20selector);%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20null;%20%09%7D%20%09function%20parseRGBA(string)%20%7B%20%09%20%20%20%20let%20%5Br,%20g,%20b,%20a%5D%20=%20string%20%09%20%20%20%20%20%20%20%20.replace('rgba(',%20'')%20%09%20%20%20%20%20%20%20%20.replace(')',%20'')%20%09%20%20%20%20%20%20%20%20.split(',')%20%09%20%20%20%20%20%20%20%20.map(value%20=%3E%20parseFloat(value.trim()));%20%09%20%20%20%20return%20%7B%20r,%20g,%20b,%20a%20%7D;%20%09%7D%20%09function%20parseHex(string)%20%7B%20%09%20%20%20%20let%20%5Br,%20g,%20b%5D%20=%20string%20%09%20%20%20%20%20%20%20%20.replace('%23',%20'')%20%09%20%20%20%20%20%20%20%20.match(/.%7B1,2%7D/g)%20%09%20%20%20%20%20%20%20%20.map(value%20=%3E%20parseInt(value,%2016));%20%09%20%20%20%20return%20%7B%20r,%20g,%20b%20%7D;%20%09%7D%20%09function%20rgbToHex(r,%20g,%20b)%20%7B%20%09%20%20%20%20return%20%22%23%22%20+%20componentToHex(r)%20+%20componentToHex(g)%20+%20componentToHex(b);%20%09%7D%20%09function%20componentToHex(c)%20%7B%20%09%20%20%20%20var%20hex%20=%20Math.round(c).toString(16);%20%09%20%20%20%20return%20hex.length%20==%201%20?%20%220%22%20+%20hex%20:%20hex;%20%09%7D%20%09function%20getUnsafeWindow()%20%7B%20%09%20%20%20%20if%20(typeof%20unsafeWindow%20===%20'undefined')%20%7B%20%09%20%20%20%20%20%20%20%20return%20window;%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20unsafeWindow;%20%09%7D%20%09function%20parseChangePacket(packet)%20%7B%20%09%20%20%20%20let%20returnVar%20=%20%5B%5D;%20%09%20%20%20%20for%20(let%20change%20of%20packet.changes)%20%7B%20%09%20%20%20%20%20%20%20%20let%20data%20=%20%7B%7D;%20%09%20%20%20%20%20%20%20%20let%20keys%20=%20change%5B1%5D.map((index)%20=%3E%20packet.values%5Bindex%5D);%20%09%20%20%20%20%20%20%20%20for%20(let%20i%20=%200;%20i%20%3C%20keys.length;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20data%5Bkeys%5Bi%5D%5D%20=%20change%5B2%5D%5Bi%5D;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20returnVar.push(%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20id:%20change%5B0%5D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20data%20%09%20%20%20%20%20%20%20%20%7D);%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20returnVar;%20%09%7D%20%20%09//%20this%20code%20was%20stolen%20from%20the%20original%20Gimkit%20Util%20extension%20%09function%20n(t,%20e,%20n)%20%7B%20%09%20%20%20%20for%20(var%20i%20=%200,%20s%20=%200,%20o%20=%20n.length;%20s%20%3C%20o;%20s++)(i%20=%20n.charCodeAt(s))%20%3C%20128%20?%20t.setUint8(e++,%20i)%20:%20(i%20%3C%202048%20?%20t.setUint8(e++,%20192%20%7C%20i%20%3E%3E%206)%20:%20(i%20%3C%2055296%20%7C%7C%2057344%20%3C=%20i%20?%20t.setUint8(e++,%20224%20%7C%20i%20%3E%3E%2012)%20:%20(s++,%20i%20=%2065536%20+%20((1023%20&%20i)%20%3C%3C%2010%20%7C%201023%20&%20n.charCodeAt(s)),%20t.setUint8(e++,%20240%20%7C%20i%20%3E%3E%2018),%20t.setUint8(e++,%20128%20%7C%20i%20%3E%3E%2012%20&%2063)),%20t.setUint8(e++,%20128%20%7C%20i%20%3E%3E%206%20&%2063)),%20t.setUint8(e++,%20128%20%7C%2063%20&%20i));%20%09%7D%20%20%09function%20encode$1(t,%20e,%20s)%20%7B%20%09%20%20%20%20let%20o;%20%20%09%20%20%20%20if(Array.isArray(t))%20%7B%20%09%20%20%20%20%20%20%20%20o%20=%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20type:%202,%20%09%20%20%20%20%20%20%20%20%20%20%20%20data:%20t,%20%09%20%20%20%20%20%20%20%20%20%20%20%20options:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20compress:%20!0%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20nsp:%20%22/%22%20%09%20%20%20%20%20%20%20%20%7D;%20%09%20%20%20%20%7D%20else%20%7B%20%09%20%20%20%20%20%20%20%20o%20=%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20type:%202,%20%09%20%20%20%20%20%20%20%20%20%20%20%20data:%20%5B%22blueboat_SEND_MESSAGE%22,%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room:%20s,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key:%20t,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data:%20e%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%5D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20options:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20compress:%20!0%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20nsp:%20%22/%22%20%09%20%20%20%20%20%20%20%20%7D;%20%09%20%20%20%20%7D%20%20%09%20%20%20%20return%20function(t)%20%7B%20%09%20%20%20%20%20%20%20%20var%20e%20=%20%5B%5D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20i%20=%20%5B%5D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20s%20=%20function%20t(e,%20n,%20i)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20=%20typeof%20i,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20a%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20l%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20u%20=%200;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(%22string%22%20===%20s)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((l%20=%20function(t)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20e%20=%200,%20n%20=%200,%20i%20=%200,%20s%20=%20t.length;%20i%20%3C%20s;%20i++)(e%20=%20t.charCodeAt(i))%20%3C%20128%20?%20n%20+=%201%20:%20e%20%3C%202048%20?%20n%20+=%202%20:%20e%20%3C%2055296%20%7C%7C%2057344%20%3C=%20e%20?%20n%20+=%203%20:%20(i++,%20n%20+=%204);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D(i))%20%3C%2032)%20e.push(160%20%7C%20l),%20u%20=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(l%20%3C%20256)%20e.push(217,%20l),%20u%20=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(l%20%3C%2065536)%20e.push(218,%20l%20%3E%3E%208,%20l),%20u%20=%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!(l%20%3C%204294967296))%20throw%20new%20Error(%22String%20too%20long%22);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e.push(219,%20l%20%3E%3E%2024,%20l%20%3E%3E%2016,%20l%20%3E%3E%208,%20l),%20u%20=%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n.push(%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20h:%20i,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20u:%20l,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20t:%20e.length%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D),%20u%20+%20l%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(%22number%22%20===%20s)%20return%20Math.floor(i)%20===%20i%20&&%20isFinite(i)%20?%200%20%3C=%20i%20?%20i%20%3C%20128%20?%20(e.push(i),%201)%20:%20i%20%3C%20256%20?%20(e.push(204,%20i),%202)%20:%20i%20%3C%2065536%20?%20(e.push(205,%20i%20%3E%3E%208,%20i),%203)%20:%20i%20%3C%204294967296%20?%20(e.push(206,%20i%20%3E%3E%2024,%20i%20%3E%3E%2016,%20i%20%3E%3E%208,%20i),%205)%20:%20(a%20=%20i%20/%20Math.pow(2,%2032)%20%3E%3E%200,%20c%20=%20i%20%3E%3E%3E%200,%20e.push(207,%20a%20%3E%3E%2024,%20a%20%3E%3E%2016,%20a%20%3E%3E%208,%20a,%20c%20%3E%3E%2024,%20c%20%3E%3E%2016,%20c%20%3E%3E%208,%20c),%209)%20:%20-32%20%3C=%20i%20?%20(e.push(i),%201)%20:%20-128%20%3C=%20i%20?%20(e.push(208,%20i),%202)%20:%20-32768%20%3C=%20i%20?%20(e.push(209,%20i%20%3E%3E%208,%20i),%203)%20:%20-2147483648%20%3C=%20i%20?%20(e.push(210,%20i%20%3E%3E%2024,%20i%20%3E%3E%2016,%20i%20%3E%3E%208,%20i),%205)%20:%20(a%20=%20Math.floor(i%20/%20Math.pow(2,%2032)),%20c%20=%20i%20%3E%3E%3E%200,%20e.push(211,%20a%20%3E%3E%2024,%20a%20%3E%3E%2016,%20a%20%3E%3E%208,%20a,%20c%20%3E%3E%2024,%20c%20%3E%3E%2016,%20c%20%3E%3E%208,%20c),%209)%20:%20(e.push(203),%20n.push(%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o:%20i,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20u:%208,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20t:%20e.length%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D),%209);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(%22object%22%20===%20s)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(null%20===%20i)%20return%20e.push(192),%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(Array.isArray(i))%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((l%20=%20i.length)%20%3C%2016)%20e.push(144%20%7C%20l),%20u%20=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(l%20%3C%2065536)%20e.push(220,%20l%20%3E%3E%208,%20l),%20u%20=%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!(l%20%3C%204294967296))%20throw%20new%20Error(%22Array%20too%20large%22);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e.push(221,%20l%20%3E%3E%2024,%20l%20%3E%3E%2016,%20l%20%3E%3E%208,%20l),%20u%20=%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(o%20=%200;%20o%20%3C%20l;%20o++)%20u%20+=%20t(e,%20n,%20i%5Bo%5D);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20u%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20instanceof%20Date)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20h%20=%20i.getTime();%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20a%20=%20Math.floor(h%20/%20Math.pow(2,%2032)),%20c%20=%20h%20%3E%3E%3E%200,%20e.push(215,%200,%20a%20%3E%3E%2024,%20a%20%3E%3E%2016,%20a%20%3E%3E%208,%20a,%20c%20%3E%3E%2024,%20c%20%3E%3E%2016,%20c%20%3E%3E%208,%20c),%2010%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20instanceof%20ArrayBuffer)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((l%20=%20i.byteLength)%20%3C%20256)%20e.push(196,%20l),%20u%20=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(l%20%3C%2065536)%20e.push(197,%20l%20%3E%3E%208,%20l),%20u%20=%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!(l%20%3C%204294967296))%20throw%20new%20Error(%22Buffer%20too%20large%22);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e.push(198,%20l%20%3E%3E%2024,%20l%20%3E%3E%2016,%20l%20%3E%3E%208,%20l),%20u%20=%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n.push(%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20l:%20i,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20u:%20l,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20t:%20e.length%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D),%20u%20+%20l%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(%22function%22%20==%20typeof%20i.toJSON)%20return%20t(e,%20n,%20i.toJSON());%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20d%20=%20%5B%5D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%20=%20%22%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20p%20=%20Object.keys(i);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(o%20=%200,%20r%20=%20p.length;%20o%20%3C%20r;%20o++)%20%22function%22%20!=%20typeof%20i%5Bf%20=%20p%5Bo%5D%5D%20&&%20d.push(f);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((l%20=%20d.length)%20%3C%2016)%20e.push(128%20%7C%20l),%20u%20=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(l%20%3C%2065536)%20e.push(222,%20l%20%3E%3E%208,%20l),%20u%20=%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!(l%20%3C%204294967296))%20throw%20new%20Error(%22Object%20too%20large%22);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e.push(223,%20l%20%3E%3E%2024,%20l%20%3E%3E%2016,%20l%20%3E%3E%208,%20l),%20u%20=%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(o%20=%200;%20o%20%3C%20l;%20o++)%20u%20+=%20t(e,%20n,%20f%20=%20d%5Bo%5D),%20u%20+=%20t(e,%20n,%20i%5Bf%5D);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20u%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(%22boolean%22%20===%20s)%20return%20e.push(i%20?%20195%20:%20194),%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(%22undefined%22%20===%20s)%20return%20e.push(212,%200,%200),%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22Could%20not%20encode%22)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D(e,%20i,%20t),%20%09%20%20%20%20%20%20%20%20%20%20%20%20o%20=%20new%20ArrayBuffer(s),%20%09%20%20%20%20%20%20%20%20%20%20%20%20r%20=%20new%20DataView(o),%20%09%20%20%20%20%20%20%20%20%20%20%20%20a%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20c%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20l%20=%20-1;%20%09%20%20%20%20%20%20%20%200%20%3C%20i.length%20&&%20(l%20=%20i%5B0%5D.t);%20%09%20%20%20%20%20%20%20%20for%20(var%20u,%20h%20=%200,%20d%20=%200,%20f%20=%200,%20p%20=%20e.length;%20f%20%3C%20p;%20f++)%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(r.setUint8(c%20+%20f,%20e%5Bf%5D),%20f%20+%201%20===%20l)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(h%20=%20(u%20=%20i%5Ba%5D).u,%20d%20=%20c%20+%20l,%20u.l)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20g%20=%20new%20Uint8Array(u.l),%20E%20=%200;%20E%20%3C%20h;%20E++)%20r.setUint8(d%20+%20E,%20g%5BE%5D);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20u.h%20?%20n(r,%20d,%20u.h)%20:%20void%200%20!==%20u.o%20&&%20r.setFloat64(d,%20u.o);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c%20+=%20h,%20i%5B++a%5D%20&&%20(l%20=%20i%5Ba%5D.t);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20let%20y%20=%20Array.from(new%20Uint8Array(o));%20%09%20%20%20%20%20%20%20%20y.unshift(4);%20%09%20%20%20%20%20%20%20%20return%20new%20Uint8Array(y).buffer%20%20%09%20%20%20%20%7D(o)%20%09%7D%20%20%09function%20decode$1(packet)%20%7B%20%09%20%20%20%20function%20e(t)%20%7B%20%09%20%20%20%20%20%20%20%20if%20(this.t%20=%200,%20t%20instanceof%20ArrayBuffer)%20this.i%20=%20t,%20this.s%20=%20new%20DataView(this.i);%20%09%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!ArrayBuffer.isView(t))%20return%20null;%20%09%20%20%20%20%20%20%20%20%20%20%20%20this.i%20=%20t.buffer,%20this.s%20=%20new%20DataView(this.i,%20t.byteOffset,%20t.byteLength);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%7D%20%20%09%20%20%20%20e.prototype.g%20=%20function(t)%20%7B%20%09%20%20%20%20%20%20%20%20for%20(var%20e%20=%20new%20Array(t),%20n%20=%200;%20n%20%3C%20t;%20n++)%20e%5Bn%5D%20=%20this.v();%20%09%20%20%20%20%20%20%20%20return%20e%20%09%20%20%20%20%7D,%20e.prototype.M%20=%20function(t)%20%7B%20%09%20%20%20%20%20%20%20%20for%20(var%20e%20=%20%7B%7D,%20n%20=%200;%20n%20%3C%20t;%20n++)%20e%5Bthis.v()%5D%20=%20this.v();%20%09%20%20%20%20%20%20%20%20return%20e%20%09%20%20%20%20%7D,%20e.prototype.h%20=%20function(t)%20%7B%20%09%20%20%20%20%20%20%20%20var%20e%20=%20function(t,%20e,%20n)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%20%22%22,%20s%20=%200,%20o%20=%20e,%20r%20=%20e%20+%20n;%20o%20%3C%20r;%20o++)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20a%20=%20t.getUint8(o);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(0%20!=%20(128%20&%20a))%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(192%20!=%20(224%20&%20a))%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(224%20!=%20(240%20&%20a))%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(240%20!=%20(248%20&%20a))%20throw%20new%20Error(%22Invalid%20byte%20%22%20+%20a.toString(16));%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2065536%20%3C=%20(s%20=%20(7%20&%20a)%20%3C%3C%2018%20%7C%20(63%20&%20t.getUint8(++o))%20%3C%3C%2012%20%7C%20(63%20&%20t.getUint8(++o))%20%3C%3C%206%20%7C%20(63%20&%20t.getUint8(++o))%20%3C%3C%200)%20?%20(s%20-=%2065536,%20i%20+=%20String.fromCharCode(55296%20+%20(s%20%3E%3E%3E%2010),%2056320%20+%20(1023%20&%20s)))%20:%20i%20+=%20String.fromCharCode(s);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20i%20+=%20String.fromCharCode((15%20&%20a)%20%3C%3C%2012%20%7C%20(63%20&%20t.getUint8(++o))%20%3C%3C%206%20%7C%20(63%20&%20t.getUint8(++o))%20%3C%3C%200);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20i%20+=%20String.fromCharCode((31%20&%20a)%20%3C%3C%206%20%7C%2063%20&%20t.getUint8(++o));%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20i%20+=%20String.fromCharCode(a);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20i%20%09%20%20%20%20%20%20%20%20%7D(this.s,%20this.t,%20t);%20%09%20%20%20%20%20%20%20%20return%20this.t%20+=%20t,%20e%20%09%20%20%20%20%7D,%20e.prototype.l%20=%20function(t)%20%7B%20%09%20%20%20%20%20%20%20%20var%20e%20=%20this.i.slice(this.t,%20this.t%20+%20t);%20%09%20%20%20%20%20%20%20%20return%20this.t%20+=%20t,%20e%20%09%20%20%20%20%7D,%20e.prototype.v%20=%20function()%20%7B%20%09%20%20%20%20%20%20%20%20if(!this.s)%20return%20null;%20%09%20%20%20%20%20%20%20%20var%20t,%20e%20=%20this.s.getUint8(this.t++),%20%09%20%20%20%20%20%20%20%20%20%20%20%20n%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20i%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20s%20=%200,%20%09%20%20%20%20%20%20%20%20%20%20%20%20o%20=%200;%20%09%20%20%20%20%20%20%20%20if%20(e%20%3C%20192)%20return%20e%20%3C%20128%20?%20e%20:%20e%20%3C%20144%20?%20this.M(15%20&%20e)%20:%20e%20%3C%20160%20?%20this.g(15%20&%20e)%20:%20this.h(31%20&%20e);%20%09%20%20%20%20%20%20%20%20if%20(223%20%3C%20e)%20return%20-1%20*%20(255%20-%20e%20+%201);%20%09%20%20%20%20%20%20%20%20switch%20(e)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20192:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20null;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20194:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20!1;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20195:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20!0;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20196:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint8(this.t),%20this.t%20+=%201,%20this.l(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20197:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint16(this.t),%20this.t%20+=%202,%20this.l(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20198:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint32(this.t),%20this.t%20+=%204,%20this.l(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20199:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint8(this.t),%20i%20=%20this.s.getInt8(this.t%20+%201),%20this.t%20+=%202,%20%5Bi,%20this.l(n)%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20200:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint16(this.t),%20i%20=%20this.s.getInt8(this.t%20+%202),%20this.t%20+=%203,%20%5Bi,%20this.l(n)%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20201:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint32(this.t),%20i%20=%20this.s.getInt8(this.t%20+%204),%20this.t%20+=%205,%20%5Bi,%20this.l(n)%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20202:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20t%20=%20this.s.getFloat32(this.t),%20this.t%20+=%204,%20t;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20203:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20t%20=%20this.s.getFloat64(this.t),%20this.t%20+=%208,%20t;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20204:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20t%20=%20this.s.getUint8(this.t),%20this.t%20+=%201,%20t;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20205:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20t%20=%20this.s.getUint16(this.t),%20this.t%20+=%202,%20t;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20206:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20t%20=%20this.s.getUint32(this.t),%20this.t%20+=%204,%20t;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20207:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20s%20=%20this.s.getUint32(this.t)%20*%20Math.pow(2,%2032),%20o%20=%20this.s.getUint32(this.t%20+%204),%20this.t%20+=%208,%20s%20+%20o;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20208:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20t%20=%20this.s.getInt8(this.t),%20this.t%20+=%201,%20t;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20209:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20t%20=%20this.s.getInt16(this.t),%20this.t%20+=%202,%20t;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20210:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20t%20=%20this.s.getInt32(this.t),%20this.t%20+=%204,%20t;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20211:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20s%20=%20this.s.getInt32(this.t)%20*%20Math.pow(2,%2032),%20o%20=%20this.s.getUint32(this.t%20+%204),%20this.t%20+=%208,%20s%20+%20o;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20212:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20i%20=%20this.s.getInt8(this.t),%20this.t%20+=%201,%200%20===%20i%20?%20void(this.t%20+=%201)%20:%20%5Bi,%20this.l(1)%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20213:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20i%20=%20this.s.getInt8(this.t),%20this.t%20+=%201,%20%5Bi,%20this.l(2)%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20214:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20i%20=%20this.s.getInt8(this.t),%20this.t%20+=%201,%20%5Bi,%20this.l(4)%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20215:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20i%20=%20this.s.getInt8(this.t),%20this.t%20+=%201,%200%20===%20i%20?%20(s%20=%20this.s.getInt32(this.t)%20*%20Math.pow(2,%2032),%20o%20=%20this.s.getUint32(this.t%20+%204),%20this.t%20+=%208,%20new%20Date(s%20+%20o))%20:%20%5Bi,%20this.l(8)%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20216:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20i%20=%20this.s.getInt8(this.t),%20this.t%20+=%201,%20%5Bi,%20this.l(16)%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20217:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint8(this.t),%20this.t%20+=%201,%20this.h(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20218:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint16(this.t),%20this.t%20+=%202,%20this.h(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20219:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint32(this.t),%20this.t%20+=%204,%20this.h(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20220:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint16(this.t),%20this.t%20+=%202,%20this.g(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20221:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint32(this.t),%20this.t%20+=%204,%20this.g(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20222:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint16(this.t),%20this.t%20+=%202,%20this.M(n);%20%09%20%20%20%20%20%20%20%20%20%20%20%20case%20223:%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20n%20=%20this.s.getUint32(this.t),%20this.t%20+=%204,%20this.M(n)%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20throw%20new%20Error(%22Could%20not%20parse%22)%20%09%20%20%20%20%7D;%20%20%09%20%20%20%20const%20q%20=%20function(t)%20%7B%20%09%20%20%20%20%20%20%20%20var%20n%20=%20new%20e(t%20=%20t.slice(1)),%20%09%20%20%20%20%20%20%20%20%20%20%20%20i%20=%20n.v();%20%09%20%20%20%20%20%20%20%20if%20(n.t%20===%20t.byteLength)%20return%20i;%20%09%20%20%20%20%20%20%20%20return%20null%20%09%20%20%20%20%7D(packet);%20%20%09%20%20%20%20return%20q?.data?.%5B1%5D;%20%09%7D%20%20%09var%20blueboat%20=%20%7B%20%09%20%20%20%20encode:%20encode$1,%20%09%20%20%20%20decode:%20decode$1%20%09%7D;%20%20%09var%20msgpack%20=%20%7B%7D;%20%20%09/**%20%09%20*%20Copyright%20(c)%202014%20Ion%20Drive%20Software%20Ltd.%20%09%20*%20https://github.com/darrachequesne/notepack/%20%09%20*%20%09%20*%20Permission%20is%20hereby%20granted,%20free%20of%20charge,%20to%20any%20person%20obtaining%20a%20copy%20%09%20*%20of%20this%20software%20and%20associated%20documentation%20files%20(the%20%22Software%22),%20to%20deal%20%09%20*%20in%20the%20Software%20without%20restriction,%20including%20without%20limitation%20the%20rights%20%09%20*%20to%20use,%20copy,%20modify,%20merge,%20publish,%20distribute,%20sublicense,%20and/or%20sell%20%09%20*%20copies%20of%20the%20Software,%20and%20to%20permit%20persons%20to%20whom%20the%20Software%20is%20%09%20*%20furnished%20to%20do%20so,%20subject%20to%20the%20following%20conditions:%20%09%20*%20%09%20*%20The%20above%20copyright%20notice%20and%20this%20permission%20notice%20shall%20be%20included%20in%20all%20%09%20*%20copies%20or%20substantial%20portions%20of%20the%20Software.%20%09%20*%20%09%20*%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22,%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND,%20EXPRESS%20OR%20%09%20*%20IMPLIED,%20INCLUDING%20BUT%20NOT%20LIMITED%20TO%20THE%20WARRANTIES%20OF%20MERCHANTABILITY,%20%09%20*%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE%20AND%20NONINFRINGEMENT.%20IN%20NO%20EVENT%20SHALL%20THE%20%09%20*%20AUTHORS%20OR%20COPYRIGHT%20HOLDERS%20BE%20LIABLE%20FOR%20ANY%20CLAIM,%20DAMAGES%20OR%20OTHER%20%09%20*%20LIABILITY,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20TORT%20OR%20OTHERWISE,%20ARISING%20FROM,%20%09%20*%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20SOFTWARE%20OR%20THE%20USE%20OR%20OTHER%20DEALINGS%20IN%20THE%20%09%20*%20SOFTWARE.%20%09%20*/%20%09Object.defineProperty(msgpack,%20%22__esModule%22,%20%7B%20value:%20true%20%7D);%20%09var%20decode_1%20=%20msgpack.decode%20=%20encode_1%20=%20msgpack.encode%20=%20void%200;%20%09/**%20%09%20*%20Patch%20for%20Colyseus:%20%09%20*%20-------------------%20%09%20*%20notepack.io@3.0.1%20%09%20*%20%09%20*%20added%20%60offset%60%20on%20Decoder%20constructor,%20for%20messages%20arriving%20with%20a%20code%20%09%20*%20before%20actual%20msgpack%20data%20%09%20*/%20%09//%20%09//%20DECODER%20%09//%20%09function%20Decoder(buffer,%20offset)%20%7B%20%09%20%20%20%20this._offset%20=%20offset;%20%09%20%20%20%20if%20(buffer%20instanceof%20ArrayBuffer)%20%7B%20%09%20%20%20%20%20%20%20%20this._buffer%20=%20buffer;%20%09%20%20%20%20%20%20%20%20this._view%20=%20new%20DataView(this._buffer);%20%09%20%20%20%20%7D%20%09%20%20%20%20else%20if%20(ArrayBuffer.isView(buffer))%20%7B%20%09%20%20%20%20%20%20%20%20this._buffer%20=%20buffer.buffer;%20%09%20%20%20%20%20%20%20%20this._view%20=%20new%20DataView(this._buffer,%20buffer.byteOffset,%20buffer.byteLength);%20%09%20%20%20%20%7D%20%09%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20throw%20new%20Error('Invalid%20argument');%20%09%20%20%20%20%7D%20%09%7D%20%09function%20utf8Read(view,%20offset,%20length)%20%7B%20%09%20%20%20%20var%20string%20=%20'',%20chr%20=%200;%20%09%20%20%20%20for%20(var%20i%20=%20offset,%20end%20=%20offset%20+%20length;%20i%20%3C%20end;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20var%20byte%20=%20view.getUint8(i);%20%09%20%20%20%20%20%20%20%20if%20((byte%20&%200x80)%20===%200x00)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(byte);%20%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20if%20((byte%20&%200xe0)%20===%200xc0)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x1f)%20%3C%3C%206)%20%7C%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(view.getUint8(++i)%20&%200x3f));%20%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20if%20((byte%20&%200xf0)%20===%200xe0)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x0f)%20%3C%3C%2012)%20%7C%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%200));%20%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20if%20((byte%20&%200xf8)%20===%200xf0)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20chr%20=%20((byte%20&%200x07)%20%3C%3C%2018)%20%7C%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%2012)%20%7C%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%200);%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(chr%20%3E=%200x010000)%20%7B%20//%20surrogate%20pair%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20-=%200x010000;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode((chr%20%3E%3E%3E%2010)%20+%200xD800,%20(chr%20&%200x3FF)%20+%200xDC00);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(chr);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20throw%20new%20Error('Invalid%20byte%20'%20+%20byte.toString(16));%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20string;%20%09%7D%20%09Decoder.prototype._array%20=%20function%20(length)%20%7B%20%09%20%20%20%20var%20value%20=%20new%20Array(length);%20%09%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20value%5Bi%5D%20=%20this._parse();%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20value;%20%09%7D;%20%09Decoder.prototype._map%20=%20function%20(length)%20%7B%20%09%20%20%20%20var%20key%20=%20'',%20value%20=%20%7B%7D;%20%09%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20key%20=%20this._parse();%20%09%20%20%20%20%20%20%20%20value%5Bkey%5D%20=%20this._parse();%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20value;%20%09%7D;%20%09Decoder.prototype._str%20=%20function%20(length)%20%7B%20%09%20%20%20%20var%20value%20=%20utf8Read(this._view,%20this._offset,%20length);%20%09%20%20%20%20this._offset%20+=%20length;%20%09%20%20%20%20return%20value;%20%09%7D;%20%09Decoder.prototype._bin%20=%20function%20(length)%20%7B%20%09%20%20%20%20var%20value%20=%20this._buffer.slice(this._offset,%20this._offset%20+%20length);%20%09%20%20%20%20this._offset%20+=%20length;%20%09%20%20%20%20return%20value;%20%09%7D;%20%09Decoder.prototype._parse%20=%20function%20()%20%7B%20%09%20%20%20%20var%20prefix%20=%20this._view.getUint8(this._offset++);%20%09%20%20%20%20var%20value,%20length%20=%200,%20type%20=%200,%20hi%20=%200,%20lo%20=%200;%20%09%20%20%20%20if%20(prefix%20%3C%200xc0)%20%7B%20%09%20%20%20%20%20%20%20%20//%20positive%20fixint%20%09%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200x80)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20prefix;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20fixmap%20%09%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200x90)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._map(prefix%20&%200x0f);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20fixarray%20%09%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200xa0)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._array(prefix%20&%200x0f);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20fixstr%20%09%20%20%20%20%20%20%20%20return%20this._str(prefix%20&%200x1f);%20%09%20%20%20%20%7D%20%09%20%20%20%20//%20negative%20fixint%20%09%20%20%20%20if%20(prefix%20%3E%200xdf)%20%7B%20%09%20%20%20%20%20%20%20%20return%20(0xff%20-%20prefix%20+%201)%20*%20-1;%20%09%20%20%20%20%7D%20%09%20%20%20%20switch%20(prefix)%20%7B%20%09%20%20%20%20%20%20%20%20//%20nil%20%09%20%20%20%20%20%20%20%20case%200xc0:%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20null;%20%09%20%20%20%20%20%20%20%20//%20false%20%09%20%20%20%20%20%20%20%20case%200xc2:%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%20%20%20%20%20%20%20%20//%20true%20%09%20%20%20%20%20%20%20%20case%200xc3:%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%20%20%20%20%20%20%20%20//%20bin%20%09%20%20%20%20%20%20%20%20case%200xc4:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._bin(length);%20%09%20%20%20%20%20%20%20%20case%200xc5:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._bin(length);%20%09%20%20%20%20%20%20%20%20case%200xc6:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._bin(length);%20%09%20%20%20%20%20%20%20%20//%20ext%20%09%20%20%20%20%20%20%20%20case%200xc7:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset%20+%201);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%20-1)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2096%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ns%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getInt32(this._offset%20+%204);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%208);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%2012;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Date((hi%20*%200x100000000%20+%20lo)%20*%201e3%20+%20ns%20/%201e6);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(length)%5D;%20%09%20%20%20%20%20%20%20%20case%200xc8:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset%20+%202);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(length)%5D;%20%09%20%20%20%20%20%20%20%20case%200xc9:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset%20+%204);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(length)%5D;%20%09%20%20%20%20%20%20%20%20//%20float%20%09%20%20%20%20%20%20%20%20case%200xca:%20%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getFloat32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%20%20%20%20%20%20%20%20case%200xcb:%20%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getFloat64(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%20%20%20%20%20%20%20%20//%20uint%20%09%20%20%20%20%20%20%20%20case%200xcc:%20%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getUint8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%20%20%20%20%20%20%20%20case%200xcd:%20%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getUint16(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%20%20%20%20%20%20%20%20case%200xce:%20%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%20%20%20%20%20%20%20%20case%200xcf:%20%09%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getUint32(this._offset)%20*%20Math.pow(2,%2032);%20%09%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%204);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20hi%20+%20lo;%20%09%20%20%20%20%20%20%20%20//%20int%20%09%20%20%20%20%20%20%20%20case%200xd0:%20%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getInt8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%20%20%20%20%20%20%20%20case%200xd1:%20%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getInt16(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%20%20%20%20%20%20%20%20case%200xd2:%20%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getInt32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%20%20%20%20%20%20%20%20case%200xd3:%20%09%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getInt32(this._offset)%20*%20Math.pow(2,%2032);%20%09%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%204);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20hi%20+%20lo;%20%09%20%20%20%20%20%20%20%20//%20fixext%20%09%20%20%20%20%20%20%20%20case%200xd4:%20%09%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%200x00)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20custom%20encoding%20for%20'undefined'%20(kept%20for%20backward-compatibility)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20void%200;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(1)%5D;%20%09%20%20%20%20%20%20%20%20case%200xd5:%20%09%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(2)%5D;%20%09%20%20%20%20%20%20%20%20case%200xd6:%20%09%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%20-1)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2032%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Date(value%20*%201e3);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(4)%5D;%20%09%20%20%20%20%20%20%20%20case%200xd7:%20%09%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%200x00)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20custom%20date%20encoding%20(kept%20for%20backward-compatibility)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getInt32(this._offset)%20*%20Math.pow(2,%2032);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%204);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Date(hi%20+%20lo);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%20-1)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2064%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%204);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20=%20(hi%20&%200x3)%20*%200x100000000%20+%20lo;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Date(s%20*%201e3%20+%20(hi%20%3E%3E%3E%202)%20/%201e6);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(8)%5D;%20%09%20%20%20%20%20%20%20%20case%200xd8:%20%09%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(16)%5D;%20%09%20%20%20%20%20%20%20%20//%20str%20%09%20%20%20%20%20%20%20%20case%200xd9:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint8(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._str(length);%20%09%20%20%20%20%20%20%20%20case%200xda:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._str(length);%20%09%20%20%20%20%20%20%20%20case%200xdb:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._str(length);%20%09%20%20%20%20%20%20%20%20//%20array%20%09%20%20%20%20%20%20%20%20case%200xdc:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._array(length);%20%09%20%20%20%20%20%20%20%20case%200xdd:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._array(length);%20%09%20%20%20%20%20%20%20%20//%20map%20%09%20%20%20%20%20%20%20%20case%200xde:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._map(length);%20%09%20%20%20%20%20%20%20%20case%200xdf:%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._map(length);%20%09%20%20%20%20%7D%20%09%20%20%20%20throw%20new%20Error('Could%20not%20parse');%20%09%7D;%20%09function%20decode(buffer,%20offset%20=%200)%20%7B%20%09%20%20%20%20var%20decoder%20=%20new%20Decoder(buffer,%20offset);%20%09%20%20%20%20var%20value%20=%20decoder._parse();%20%09%20%20%20%20if%20(decoder._offset%20!==%20buffer.byteLength)%20%7B%20%09%20%20%20%20%20%20%20%20throw%20new%20Error((buffer.byteLength%20-%20decoder._offset)%20+%20'%20trailing%20bytes');%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20value;%20%09%7D%20%09decode_1%20=%20msgpack.decode%20=%20decode;%20%09//%20%09//%20ENCODER%20%09//%20%09var%20TIMESTAMP32_MAX_SEC%20=%200x100000000%20-%201;%20//%2032-bit%20unsigned%20int%20%09var%20TIMESTAMP64_MAX_SEC%20=%200x400000000%20-%201;%20//%2034-bit%20unsigned%20int%20%09function%20utf8Write(view,%20offset,%20str)%20%7B%20%09%20%20%20%20var%20c%20=%200;%20%09%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%20c);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200xc0%20%7C%20(c%20%3E%3E%206));%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20&%200x3f));%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200xe0%20%7C%20(c%20%3E%3E%2012));%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20%3E%3E%206)%20&%200x3f);%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20&%200x3f));%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%20%20%20%20%20%20%20%20%20%20%20%20c%20=%200x10000%20+%20(((c%20&%200x3ff)%20%3C%3C%2010)%20%7C%20(str.charCodeAt(i)%20&%200x3ff));%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200xf0%20%7C%20(c%20%3E%3E%2018));%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20%3E%3E%2012)%20&%200x3f);%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20%3E%3E%206)%20&%200x3f);%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20&%200x3f));%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%7D%20%09%7D%20%09function%20utf8Length(str)%20%7B%20%09%20%20%20%20var%20c%20=%200,%20length%20=%200;%20%09%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%201;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%202;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%203;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%204;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20length;%20%09%7D%20%09function%20_encode(bytes,%20defers,%20value)%20%7B%20%09%20%20%20%20var%20type%20=%20typeof%20value,%20i%20=%200,%20l%20=%200,%20hi%20=%200,%20lo%20=%200,%20length%20=%200,%20size%20=%200;%20%09%20%20%20%20if%20(type%20===%20'string')%20%7B%20%09%20%20%20%20%20%20%20%20length%20=%20utf8Length(value);%20%09%20%20%20%20%20%20%20%20//%20fixstr%20%09%20%20%20%20%20%20%20%20if%20(length%20%3C%200x20)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(length%20%7C%200xa0);%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%201;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20str%208%20%09%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd9,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%202;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20str%2016%20%09%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x10000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xda,%20length%20%3E%3E%208,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20str%2032%20%09%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100000000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdb,%20length%20%3E%3E%2024,%20length%20%3E%3E%2016,%20length%20%3E%3E%208,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('String%20too%20long');%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20defers.push(%7B%20_str:%20value,%20_length:%20length,%20_offset:%20bytes.length%20%7D);%20%09%20%20%20%20%20%20%20%20return%20size%20+%20length;%20%09%20%20%20%20%7D%20%09%20%20%20%20if%20(type%20===%20'number')%20%7B%20%09%20%20%20%20%20%20%20%20//%20TODO:%20encode%20to%20float%2032?%20%09%20%20%20%20%20%20%20%20//%20float%2064%20%09%20%20%20%20%20%20%20%20if%20(Math.floor(value)%20!==%20value%20%7C%7C%20!isFinite(value))%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcb);%20%09%20%20%20%20%20%20%20%20%20%20%20%20defers.push(%7B%20_float:%20value,%20_length:%208,%20_offset:%20bytes.length%20%7D);%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20if%20(value%20%3E=%200)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20positive%20fixnum%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x80)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%208%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x100)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcc,%20value);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2016%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x10000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcd,%20value%20%3E%3E%208,%20value);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2032%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x100000000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xce,%20value%20%3E%3E%2024,%20value%20%3E%3E%2016,%20value%20%3E%3E%208,%20value);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2064%20%09%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20(value%20/%20Math.pow(2,%2032))%20%3E%3E%200;%20%09%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20value%20%3E%3E%3E%200;%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcf,%20hi%20%3E%3E%2024,%20hi%20%3E%3E%2016,%20hi%20%3E%3E%208,%20hi,%20lo%20%3E%3E%2024,%20lo%20%3E%3E%2016,%20lo%20%3E%3E%208,%20lo);%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20negative%20fixnum%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x20)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%208%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x80)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd0,%20value);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2016%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x8000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd1,%20value%20%3E%3E%208,%20value);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2032%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x80000000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd2,%20value%20%3E%3E%2024,%20value%20%3E%3E%2016,%20value%20%3E%3E%208,%20value);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2064%20%09%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20Math.floor(value%20/%20Math.pow(2,%2032));%20%09%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20value%20%3E%3E%3E%200;%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd3,%20hi%20%3E%3E%2024,%20hi%20%3E%3E%2016,%20hi%20%3E%3E%208,%20hi,%20lo%20%3E%3E%2024,%20lo%20%3E%3E%2016,%20lo%20%3E%3E%208,%20lo);%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%7D%20%09%20%20%20%20if%20(type%20===%20'object')%20%7B%20%09%20%20%20%20%20%20%20%20//%20nil%20%09%20%20%20%20%20%20%20%20if%20(value%20===%20null)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc0);%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20if%20(Array.isArray(value))%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20value.length;%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixarray%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x10)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(length%20%7C%200x90);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%201;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20array%2016%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x10000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdc,%20length%20%3E%3E%208,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20array%2032%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100000000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdd,%20length%20%3E%3E%2024,%20length%20%3E%3E%2016,%20length%20%3E%3E%208,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Array%20too%20large');%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20+=%20_encode(bytes,%20defers,%20value%5Bi%5D);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20size;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20if%20(value%20instanceof%20Date)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20var%20ms%20=%20value.getTime();%20%09%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20=%20Math.floor(ms%20/%201e3);%20%09%20%20%20%20%20%20%20%20%20%20%20%20var%20ns%20=%20(ms%20-%20s%20*%201e3)%20*%201e6;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(s%20%3E=%200%20&&%20ns%20%3E=%200%20&&%20s%20%3C=%20TIMESTAMP64_MAX_SEC)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ns%20===%200%20&&%20s%20%3C=%20TIMESTAMP32_MAX_SEC)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2032%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd6,%200xff,%20s%20%3E%3E%2024,%20s%20%3E%3E%2016,%20s%20%3E%3E%208,%20s);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%206;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2064%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20s%20/%200x100000000;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20s%20&%200xffffffff;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd7,%200xff,%20ns%20%3E%3E%2022,%20ns%20%3E%3E%2014,%20ns%20%3E%3E%206,%20hi,%20lo%20%3E%3E%2024,%20lo%20%3E%3E%2016,%20lo%20%3E%3E%208,%20lo);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%2010;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2096%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20Math.floor(s%20/%200x100000000);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20s%20%3E%3E%3E%200;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc7,%200x0c,%200xff,%20ns%20%3E%3E%2024,%20ns%20%3E%3E%2016,%20ns%20%3E%3E%208,%20ns,%20hi%20%3E%3E%2024,%20hi%20%3E%3E%2016,%20hi%20%3E%3E%208,%20hi,%20lo%20%3E%3E%2024,%20lo%20%3E%3E%2016,%20lo%20%3E%3E%208,%20lo);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%2015;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20if%20(value%20instanceof%20ArrayBuffer)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20value.byteLength;%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20bin%208%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x100)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc4,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%202;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20bin%2016%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x10000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc5,%20length%20%3E%3E%208,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20bin%2032%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x100000000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc6,%20length%20%3E%3E%2024,%20length%20%3E%3E%2016,%20length%20%3E%3E%208,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Buffer%20too%20large');%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20defers.push(%7B%20_bin:%20value,%20_length:%20length,%20_offset:%20bytes.length%20%7D);%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20size%20+%20length;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20if%20(typeof%20value.toJSON%20===%20'function')%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_encode(bytes,%20defers,%20value.toJSON());%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20var%20keys%20=%20%5B%5D,%20key%20=%20'';%20%09%20%20%20%20%20%20%20%20var%20allKeys%20=%20Object.keys(value);%20%09%20%20%20%20%20%20%20%20for%20(i%20=%200,%20l%20=%20allKeys.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20key%20=%20allKeys%5Bi%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5Bkey%5D%20!==%20undefined%20&&%20typeof%20value%5Bkey%5D%20!==%20'function')%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20keys.push(key);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20length%20=%20keys.length;%20%09%20%20%20%20%20%20%20%20//%20fixmap%20%09%20%20%20%20%20%20%20%20if%20(length%20%3C%200x10)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(length%20%7C%200x80);%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%201;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20map%2016%20%09%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x10000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xde,%20length%20%3E%3E%208,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20map%2032%20%09%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100000000)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdf,%20length%20%3E%3E%2024,%20length%20%3E%3E%2016,%20length%20%3E%3E%208,%20length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Object%20too%20large');%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20for%20(i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20key%20=%20keys%5Bi%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20+=%20_encode(bytes,%20defers,%20key);%20%09%20%20%20%20%20%20%20%20%20%20%20%20size%20+=%20_encode(bytes,%20defers,%20value%5Bkey%5D);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20return%20size;%20%09%20%20%20%20%7D%20%09%20%20%20%20//%20false/true%20%09%20%20%20%20if%20(type%20===%20'boolean')%20%7B%20%09%20%20%20%20%20%20%20%20bytes.push(value%20?%200xc3%20:%200xc2);%20%09%20%20%20%20%20%20%20%20return%201;%20%09%20%20%20%20%7D%20%09%20%20%20%20if%20(type%20===%20'undefined')%20%7B%20%09%20%20%20%20%20%20%20%20bytes.push(0xc0);%20%09%20%20%20%20%20%20%20%20return%201;%20%09%20%20%20%20%7D%20%09%20%20%20%20//%20custom%20types%20like%20BigInt%20(typeof%20value%20===%20'bigint')%20%09%20%20%20%20if%20(typeof%20value.toJSON%20===%20'function')%20%7B%20%09%20%20%20%20%20%20%20%20return%20_encode(bytes,%20defers,%20value.toJSON());%20%09%20%20%20%20%7D%20%09%20%20%20%20throw%20new%20Error('Could%20not%20encode');%20%09%7D%20%09function%20encode(value)%20%7B%20%09%20%20%20%20var%20bytes%20=%20%5B%5D;%20%09%20%20%20%20var%20defers%20=%20%5B%5D;%20%09%20%20%20%20var%20size%20=%20_encode(bytes,%20defers,%20value);%20%09%20%20%20%20var%20buf%20=%20new%20ArrayBuffer(size);%20%09%20%20%20%20var%20view%20=%20new%20DataView(buf);%20%09%20%20%20%20var%20deferIndex%20=%200;%20%09%20%20%20%20var%20deferWritten%20=%200;%20%09%20%20%20%20var%20nextOffset%20=%20-1;%20%09%20%20%20%20if%20(defers.length%20%3E%200)%20%7B%20%09%20%20%20%20%20%20%20%20nextOffset%20=%20defers%5B0%5D._offset;%20%09%20%20%20%20%7D%20%09%20%20%20%20var%20defer,%20deferLength%20=%200,%20offset%20=%200;%20%09%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20bytes.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%20%20%20%20%20%20%20%20view.setUint8(deferWritten%20+%20i,%20bytes%5Bi%5D);%20%09%20%20%20%20%20%20%20%20if%20(i%20+%201%20!==%20nextOffset)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20defer%20=%20defers%5BdeferIndex%5D;%20%09%20%20%20%20%20%20%20%20deferLength%20=%20defer._length;%20%09%20%20%20%20%20%20%20%20offset%20=%20deferWritten%20+%20nextOffset;%20%09%20%20%20%20%20%20%20%20if%20(defer._bin)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20var%20bin%20=%20new%20Uint8Array(defer._bin);%20%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20j%20=%200;%20j%20%3C%20deferLength;%20j++)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset%20+%20j,%20bin%5Bj%5D);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20if%20(defer._str)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20utf8Write(view,%20offset,%20defer._str);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20if%20(defer._float%20!==%20undefined)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20view.setFloat64(offset,%20defer._float);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20deferIndex++;%20%09%20%20%20%20%20%20%20%20deferWritten%20+=%20deferLength;%20%09%20%20%20%20%20%20%20%20if%20(defers%5BdeferIndex%5D)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20nextOffset%20=%20defers%5BdeferIndex%5D._offset;%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20buf;%20%09%7D%20%09var%20encode_1%20=%20msgpack.encode%20=%20encode;%20%20%09var%20colyseus%20=%20%7Bexports:%20%7B%7D%7D;%20%20%09(function%20(module,%20exports)%20%7B%20%09%09//%20colyseus.js@0.15.26%20(@colyseus/schema%202.0.9)%20%09%09(function%20(global,%20factory)%20%7B%20%09%09%20%20%20%20factory(exports)%20;%20%09%09%7D)(commonjsGlobal,%20(function%20(exports)%20%7B%20%09%09%20%20%20%20function%20_mergeNamespaces(n,%20m)%20%7B%20%09%09%20%20%20%20%20%20%20%20m.forEach(function%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20e%20&&%20typeof%20e%20!==%20'string'%20&&%20!Array.isArray(e)%20&&%20Object.keys(e).forEach(function%20(k)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(k%20!==%20'default'%20&&%20!(k%20in%20n))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20d%20=%20Object.getOwnPropertyDescriptor(e,%20k);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperty(n,%20k,%20d.get%20?%20d%20:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20return%20e%5Bk%5D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20return%20Object.freeze(n);%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20//%20%09%09%20%20%20%20//%20Polyfills%20for%20legacy%20environments%20%09%09%20%20%20%20//%20%09%09%20%20%20%20/*%20%09%09%20%20%20%20%20*%20Support%20Android%204.4.x%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20if%20(!ArrayBuffer.isView)%20%7B%20%09%09%20%20%20%20%20%20%20%20ArrayBuffer.isView%20=%20function%20(a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20a%20!==%20null%20&&%20typeof%20(a)%20===%20'object'%20&&%20a.buffer%20instanceof%20ArrayBuffer;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20//%20Define%20globalThis%20if%20not%20available.%20%09%09%20%20%20%20//%20https://github.com/colyseus/colyseus.js/issues/86%20%09%09%20%20%20%20if%20(typeof%20(globalThis)%20===%20%22undefined%22%20&&%20%09%09%20%20%20%20%20%20%20%20typeof%20(window)%20!==%20%22undefined%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20window%5B'globalThis'%5D%20=%20window;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20/******************************************************************************%20%09%09%20%20%20%20Copyright%20(c)%20Microsoft%20Corporation.%20%20%09%09%20%20%20%20Permission%20to%20use,%20copy,%20modify,%20and/or%20distribute%20this%20software%20for%20any%20%09%09%20%20%20%20purpose%20with%20or%20without%20fee%20is%20hereby%20granted.%20%20%09%09%20%20%20%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22%20AND%20THE%20AUTHOR%20DISCLAIMS%20ALL%20WARRANTIES%20WITH%20%09%09%20%20%20%20REGARD%20TO%20THIS%20SOFTWARE%20INCLUDING%20ALL%20IMPLIED%20WARRANTIES%20OF%20MERCHANTABILITY%20%09%09%20%20%20%20AND%20FITNESS.%20IN%20NO%20EVENT%20SHALL%20THE%20AUTHOR%20BE%20LIABLE%20FOR%20ANY%20SPECIAL,%20DIRECT,%20%09%09%20%20%20%20INDIRECT,%20OR%20CONSEQUENTIAL%20DAMAGES%20OR%20ANY%20DAMAGES%20WHATSOEVER%20RESULTING%20FROM%20%09%09%20%20%20%20LOSS%20OF%20USE,%20DATA%20OR%20PROFITS,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20NEGLIGENCE%20OR%20%09%09%20%20%20%20OTHER%20TORTIOUS%20ACTION,%20ARISING%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20USE%20OR%20%09%09%20%20%20%20PERFORMANCE%20OF%20THIS%20SOFTWARE.%20%09%09%20%20%20%20*****************************************************************************%20*/%20%09%09%20%20%20%20/*%20global%20Reflect,%20Promise%20*/%20%20%09%09%20%20%20%20var%20extendStatics%20=%20function(d,%20b)%20%7B%20%09%09%20%20%20%20%20%20%20%20extendStatics%20=%20Object.setPrototypeOf%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20(%7B%20__proto__:%20%5B%5D%20%7D%20instanceof%20Array%20&&%20function%20(d,%20b)%20%7B%20d.__proto__%20=%20b;%20%7D)%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20(d,%20b)%20%7B%20for%20(var%20p%20in%20b)%20if%20(Object.prototype.hasOwnProperty.call(b,%20p))%20d%5Bp%5D%20=%20b%5Bp%5D;%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20extendStatics(d,%20b);%20%09%09%20%20%20%20%7D;%20%20%09%09%20%20%20%20function%20__extends(d,%20b)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(typeof%20b%20!==%20%22function%22%20&&%20b%20!==%20null)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20TypeError(%22Class%20extends%20value%20%22%20+%20String(b)%20+%20%22%20is%20not%20a%20constructor%20or%20null%22);%20%09%09%20%20%20%20%20%20%20%20extendStatics(d,%20b);%20%09%09%20%20%20%20%20%20%20%20function%20__()%20%7B%20this.constructor%20=%20d;%20%7D%20%09%09%20%20%20%20%20%20%20%20d.prototype%20=%20b%20===%20null%20?%20Object.create(b)%20:%20(__.prototype%20=%20b.prototype,%20new%20__());%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20__assign%20=%20function()%20%7B%20%09%09%20%20%20%20%20%20%20%20__assign%20=%20Object.assign%20%7C%7C%20function%20__assign(t)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20s,%20i%20=%201,%20n%20=%20arguments.length;%20i%20%3C%20n;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s%20=%20arguments%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20p%20in%20s)%20if%20(Object.prototype.hasOwnProperty.call(s,%20p))%20t%5Bp%5D%20=%20s%5Bp%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20t;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20__assign.apply(this,%20arguments);%20%09%09%20%20%20%20%7D;%20%20%09%09%20%20%20%20function%20__awaiter(thisArg,%20_arguments,%20P,%20generator)%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20adopt(value)%20%7B%20return%20value%20instanceof%20P%20?%20value%20:%20new%20P(function%20(resolve)%20%7B%20resolve(value);%20%7D);%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20new%20(P%20%7C%7C%20(P%20=%20Promise))(function%20(resolve,%20reject)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20fulfilled(value)%20%7B%20try%20%7B%20step(generator.next(value));%20%7D%20catch%20(e)%20%7B%20reject(e);%20%7D%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20rejected(value)%20%7B%20try%20%7B%20step(generator%5B%22throw%22%5D(value));%20%7D%20catch%20(e)%20%7B%20reject(e);%20%7D%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20step(result)%20%7B%20result.done%20?%20resolve(result.value)%20:%20adopt(result.value).then(fulfilled,%20rejected);%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20step((generator%20=%20generator.apply(thisArg,%20%5B%5D)).next());%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20function%20__generator(thisArg,%20body)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20_%20=%20%7B%20label:%200,%20sent:%20function()%20%7B%20if%20(t%5B0%5D%20&%201)%20throw%20t%5B1%5D;%20return%20t%5B1%5D;%20%7D,%20trys:%20%5B%5D,%20ops:%20%5B%5D%20%7D,%20f,%20y,%20t,%20g;%20%09%09%20%20%20%20%20%20%20%20return%20g%20=%20%7B%20next:%20verb(0),%20%22throw%22:%20verb(1),%20%22return%22:%20verb(2)%20%7D,%20typeof%20Symbol%20===%20%22function%22%20&&%20(g%5BSymbol.iterator%5D%20=%20function()%20%7B%20return%20this;%20%7D),%20g;%20%09%09%20%20%20%20%20%20%20%20function%20verb(n)%20%7B%20return%20function%20(v)%20%7B%20return%20step(%5Bn,%20v%5D);%20%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20step(op)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(f)%20throw%20new%20TypeError(%22Generator%20is%20already%20executing.%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20while%20(g%20&&%20(g%20=%200,%20op%5B0%5D%20&&%20(_%20=%200)),%20_)%20try%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(f%20=%201,%20y%20&&%20(t%20=%20op%5B0%5D%20&%202%20?%20y%5B%22return%22%5D%20:%20op%5B0%5D%20?%20y%5B%22throw%22%5D%20%7C%7C%20((t%20=%20y%5B%22return%22%5D)%20&&%20t.call(y),%200)%20:%20y.next)%20&&%20!(t%20=%20t.call(y,%20op%5B1%5D)).done)%20return%20t;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(y%20=%200,%20t)%20op%20=%20%5Bop%5B0%5D%20&%202,%20t.value%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(op%5B0%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20case%201:%20t%20=%20op;%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%204:%20_.label++;%20return%20%7B%20value:%20op%5B1%5D,%20done:%20false%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%205:%20_.label++;%20y%20=%20op%5B1%5D;%20op%20=%20%5B0%5D;%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%207:%20op%20=%20_.ops.pop();%20_.trys.pop();%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20default:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!(t%20=%20_.trys,%20t%20=%20t.length%20%3E%200%20&&%20t%5Bt.length%20-%201%5D)%20&&%20(op%5B0%5D%20===%206%20%7C%7C%20op%5B0%5D%20===%202))%20%7B%20_%20=%200;%20continue;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(op%5B0%5D%20===%203%20&&%20(!t%20%7C%7C%20(op%5B1%5D%20%3E%20t%5B0%5D%20&&%20op%5B1%5D%20%3C%20t%5B3%5D)))%20%7B%20_.label%20=%20op%5B1%5D;%20break;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(op%5B0%5D%20===%206%20&&%20_.label%20%3C%20t%5B1%5D)%20%7B%20_.label%20=%20t%5B1%5D;%20t%20=%20op;%20break;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(t%20&&%20_.label%20%3C%20t%5B2%5D)%20%7B%20_.label%20=%20t%5B2%5D;%20_.ops.push(op);%20break;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(t%5B2%5D)%20_.ops.pop();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_.trys.pop();%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op%20=%20body.call(thisArg,%20_);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%20op%20=%20%5B6,%20e%5D;%20y%20=%200;%20%7D%20finally%20%7B%20f%20=%20t%20=%200;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(op%5B0%5D%20&%205)%20throw%20op%5B1%5D;%20return%20%7B%20value:%20op%5B0%5D%20?%20op%5B1%5D%20:%20void%200,%20done:%20true%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20function%20__classPrivateFieldGet(receiver,%20state,%20kind,%20f)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(kind%20===%20%22a%22%20&&%20!f)%20throw%20new%20TypeError(%22Private%20accessor%20was%20defined%20without%20a%20getter%22);%20%09%09%20%20%20%20%20%20%20%20if%20(typeof%20state%20===%20%22function%22%20?%20receiver%20!==%20state%20%7C%7C%20!f%20:%20!state.has(receiver))%20throw%20new%20TypeError(%22Cannot%20read%20private%20member%20from%20an%20object%20whose%20class%20did%20not%20declare%20it%22);%20%09%09%20%20%20%20%20%20%20%20return%20kind%20===%20%22m%22%20?%20f%20:%20kind%20===%20%22a%22%20?%20f.call(receiver)%20:%20f%20?%20f.value%20:%20state.get(receiver);%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20function%20__classPrivateFieldSet(receiver,%20state,%20value,%20kind,%20f)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(typeof%20state%20===%20%22function%22%20?%20receiver%20!==%20state%20%7C%7C%20!f%20:%20!state.has(receiver))%20throw%20new%20TypeError(%22Cannot%20write%20private%20member%20to%20an%20object%20whose%20class%20did%20not%20declare%20it%22);%20%09%09%20%20%20%20%20%20%20%20return%20(state.set(receiver,%20value)),%20value;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20CloseCode;%20%09%09%20%20%20%20(function%20(CloseCode)%20%7B%20%09%09%20%20%20%20%20%20%20%20CloseCode%5BCloseCode%5B%22CONSENTED%22%5D%20=%204000%5D%20=%20%22CONSENTED%22;%20%09%09%20%20%20%20%20%20%20%20CloseCode%5BCloseCode%5B%22DEVMODE_RESTART%22%5D%20=%204010%5D%20=%20%22DEVMODE_RESTART%22;%20%09%09%20%20%20%20%7D)(CloseCode%20%7C%7C%20(CloseCode%20=%20%7B%7D));%20%09%09%20%20%20%20var%20ServerError%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20__extends(ServerError,%20_super);%20%09%09%20%20%20%20%20%20%20%20function%20ServerError(code,%20message)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20_super.call(this,%20message)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_this.name%20=%20%22ServerError%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_this.code%20=%20code;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_this;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20ServerError;%20%09%09%20%20%20%20%7D(Error));%20%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20Copyright%20(c)%202014%20Ion%20Drive%20Software%20Ltd.%20%09%09%20%20%20%20%20*%20https://github.com/darrachequesne/notepack/%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20Permission%20is%20hereby%20granted,%20free%20of%20charge,%20to%20any%20person%20obtaining%20a%20copy%20%09%09%20%20%20%20%20*%20of%20this%20software%20and%20associated%20documentation%20files%20(the%20%22Software%22),%20to%20deal%20%09%09%20%20%20%20%20*%20in%20the%20Software%20without%20restriction,%20including%20without%20limitation%20the%20rights%20%09%09%20%20%20%20%20*%20to%20use,%20copy,%20modify,%20merge,%20publish,%20distribute,%20sublicense,%20and/or%20sell%20%09%09%20%20%20%20%20*%20copies%20of%20the%20Software,%20and%20to%20permit%20persons%20to%20whom%20the%20Software%20is%20%09%09%20%20%20%20%20*%20furnished%20to%20do%20so,%20subject%20to%20the%20following%20conditions:%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20The%20above%20copyright%20notice%20and%20this%20permission%20notice%20shall%20be%20included%20in%20all%20%09%09%20%20%20%20%20*%20copies%20or%20substantial%20portions%20of%20the%20Software.%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22,%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND,%20EXPRESS%20OR%20%09%09%20%20%20%20%20*%20IMPLIED,%20INCLUDING%20BUT%20NOT%20LIMITED%20TO%20THE%20WARRANTIES%20OF%20MERCHANTABILITY,%20%09%09%20%20%20%20%20*%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE%20AND%20NONINFRINGEMENT.%20IN%20NO%20EVENT%20SHALL%20THE%20%09%09%20%20%20%20%20*%20AUTHORS%20OR%20COPYRIGHT%20HOLDERS%20BE%20LIABLE%20FOR%20ANY%20CLAIM,%20DAMAGES%20OR%20OTHER%20%09%09%20%20%20%20%20*%20LIABILITY,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20TORT%20OR%20OTHERWISE,%20ARISING%20FROM,%20%09%09%20%20%20%20%20*%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20SOFTWARE%20OR%20THE%20USE%20OR%20OTHER%20DEALINGS%20IN%20THE%20%09%09%20%20%20%20%20*%20SOFTWARE.%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20Patch%20for%20Colyseus:%20%09%09%20%20%20%20%20*%20-------------------%20%09%09%20%20%20%20%20*%20notepack.io@3.0.1%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20added%20%60offset%60%20on%20Decoder%20constructor,%20for%20messages%20arriving%20with%20a%20code%20%09%09%20%20%20%20%20*%20before%20actual%20msgpack%20data%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20//%20%09%09%20%20%20%20//%20DECODER%20%09%09%20%20%20%20//%20%09%09%20%20%20%20function%20Decoder(buffer,%20offset)%20%7B%20%09%09%20%20%20%20%20%20%20%20this._offset%20=%20offset;%20%09%09%20%20%20%20%20%20%20%20if%20(buffer%20instanceof%20ArrayBuffer)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this._buffer%20=%20buffer;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this._view%20=%20new%20DataView(this._buffer);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(ArrayBuffer.isView(buffer))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this._buffer%20=%20buffer.buffer;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this._view%20=%20new%20DataView(this._buffer,%20buffer.byteOffset,%20buffer.byteLength);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Invalid%20argument');%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20utf8Read$1(view,%20offset,%20length)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20string%20=%20'',%20chr%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%20offset,%20end%20=%20offset%20+%20length;%20i%20%3C%20end;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20byte%20=%20view.getUint8(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200x80)%20===%200x00)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(byte);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xe0)%20===%200xc0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x1f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(view.getUint8(++i)%20&%200x3f));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xf0)%20===%200xe0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x0f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%200));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xf8)%20===%200xf0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20=%20((byte%20&%200x07)%20%3C%3C%2018)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view.getUint8(++i)%20&%200x3f)%20%3C%3C%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(chr%20%3E=%200x010000)%20%7B%20//%20surrogate%20pair%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20-=%200x010000;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode((chr%20%3E%3E%3E%2010)%20+%200xD800,%20(chr%20&%200x3FF)%20+%200xDC00);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(chr);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Invalid%20byte%20'%20+%20byte.toString(16));%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20string;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20Decoder.prototype._array%20=%20function%20(length)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20value%20=%20new%20Array(length);%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20value%5Bi%5D%20=%20this._parse();%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%7D;%20%09%09%20%20%20%20Decoder.prototype._map%20=%20function%20(length)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20key%20=%20'',%20value%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20key%20=%20this._parse();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20value%5Bkey%5D%20=%20this._parse();%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%7D;%20%09%09%20%20%20%20Decoder.prototype._str%20=%20function%20(length)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20value%20=%20utf8Read$1(this._view,%20this._offset,%20length);%20%09%09%20%20%20%20%20%20%20%20this._offset%20+=%20length;%20%09%09%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%7D;%20%09%09%20%20%20%20Decoder.prototype._bin%20=%20function%20(length)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20value%20=%20this._buffer.slice(this._offset,%20this._offset%20+%20length);%20%09%09%20%20%20%20%20%20%20%20this._offset%20+=%20length;%20%09%09%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%7D;%20%09%09%20%20%20%20Decoder.prototype._parse%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20prefix%20=%20this._view.getUint8(this._offset++);%20%09%09%20%20%20%20%20%20%20%20var%20value,%20length%20=%200,%20type%20=%200,%20hi%20=%200,%20lo%20=%200;%20%09%09%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200xc0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20positive%20fixint%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20prefix;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixmap%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200x90)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._map(prefix%20&%200x0f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixarray%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200xa0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._array(prefix%20&%200x0f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixstr%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this._str(prefix%20&%200x1f);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20//%20negative%20fixint%20%09%09%20%20%20%20%20%20%20%20if%20(prefix%20%3E%200xdf)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(0xff%20-%20prefix%20+%201)%20*%20-1;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20switch%20(prefix)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20nil%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc0:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20null;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20false%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc2:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc3:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20bin%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc4:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._bin(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc5:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._bin(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc6:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._bin(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20ext%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc7:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset%20+%201);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%20-1)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2096%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ns%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getInt32(this._offset%20+%204);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%208);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%2012;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Date((hi%20*%200x100000000%20+%20lo)%20*%201e3%20+%20ns%20/%201e6);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(length)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc8:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset%20+%202);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(length)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xc9:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset%20+%204);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(length)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20float%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xca:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getFloat32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xcb:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getFloat64(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xcc:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getUint8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xcd:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getUint16(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xce:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xcf:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getUint32(this._offset)%20*%20Math.pow(2,%2032);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%204);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20hi%20+%20lo;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd0:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getInt8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd1:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getInt16(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd2:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getInt32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd3:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getInt32(this._offset)%20*%20Math.pow(2,%2032);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%204);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20hi%20+%20lo;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixext%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd4:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%200x00)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20custom%20encoding%20for%20'undefined'%20(kept%20for%20backward-compatibility)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(1)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd5:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(2)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd6:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%20-1)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Date(value%20*%201e3);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(4)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd7:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%200x00)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20custom%20date%20encoding%20(kept%20for%20backward-compatibility)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getInt32(this._offset)%20*%20Math.pow(2,%2032);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%204);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Date(hi%20+%20lo);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(type%20===%20-1)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20this._view.getUint32(this._offset%20+%204);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%208;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20=%20(hi%20&%200x3)%20*%200x100000000%20+%20lo;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Date(s%20*%201e3%20+%20(hi%20%3E%3E%3E%202)%20/%201e6);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(8)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd8:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this._view.getInt8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btype,%20this._bin(16)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xd9:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint8(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._str(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xda:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._str(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xdb:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._str(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20array%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xdc:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._array(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xdd:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._array(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20map%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xde:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint16(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._map(length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%200xdf:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20this._view.getUint32(this._offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this._map(length);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20throw%20new%20Error('Could%20not%20parse');%20%09%09%20%20%20%20%7D;%20%09%09%20%20%20%20function%20decode(buffer,%20offset)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(offset%20===%20void%200)%20%7B%20offset%20=%200;%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20decoder%20=%20new%20Decoder(buffer,%20offset);%20%09%09%20%20%20%20%20%20%20%20var%20value%20=%20decoder._parse();%20%09%09%20%20%20%20%20%20%20%20if%20(decoder._offset%20!==%20buffer.byteLength)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error((buffer.byteLength%20-%20decoder._offset)%20+%20'%20trailing%20bytes');%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20//%20%09%09%20%20%20%20//%20ENCODER%20%09%09%20%20%20%20//%20%09%09%20%20%20%20var%20TIMESTAMP32_MAX_SEC%20=%200x100000000%20-%201;%20//%2032-bit%20unsigned%20int%20%09%09%20%20%20%20var%20TIMESTAMP64_MAX_SEC%20=%200x400000000%20-%201;%20//%2034-bit%20unsigned%20int%20%09%09%20%20%20%20function%20utf8Write(view,%20offset,%20str)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20c%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%20c);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200xc0%20%7C%20(c%20%3E%3E%206));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20&%200x3f));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200xe0%20%7C%20(c%20%3E%3E%2012));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20%3E%3E%206)%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20&%200x3f));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c%20=%200x10000%20+%20(((c%20&%200x3ff)%20%3C%3C%2010)%20%7C%20(str.charCodeAt(i)%20&%200x3ff));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200xf0%20%7C%20(c%20%3E%3E%2018));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20%3E%3E%2012)%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20%3E%3E%206)%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset++,%200x80%20%7C%20(c%20&%200x3f));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20utf8Length$1(str)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20c%20=%200,%20length%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20length;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20_encode(bytes,%20defers,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20type%20=%20typeof%20value,%20i%20=%200,%20l%20=%200,%20hi%20=%200,%20lo%20=%200,%20length%20=%200,%20size%20=%200;%20%09%09%20%20%20%20%20%20%20%20if%20(type%20===%20'string')%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20utf8Length$1(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixstr%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(length%20%7C%200xa0);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd9,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xda,%20length%20%3E%3E%208,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdb,%20length%20%3E%3E%2024,%20length%20%3E%3E%2016,%20length%20%3E%3E%208,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('String%20too%20long');%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20defers.push(%7B%20_str:%20value,%20_length:%20length,%20_offset:%20bytes.length%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20size%20+%20length;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20(type%20===%20'number')%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20encode%20to%20float%2032?%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20float%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(Math.floor(value)%20!==%20value%20%7C%7C%20!isFinite(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcb);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20defers.push(%7B%20_float:%20value,%20_length:%208,%20_offset:%20bytes.length%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20positive%20fixnum%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x100)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcc,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcd,%20value%20%3E%3E%208,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xce,%20value%20%3E%3E%2024,%20value%20%3E%3E%2016,%20value%20%3E%3E%208,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20(value%20/%20Math.pow(2,%2032))%20%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20value%20%3E%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcf,%20hi%20%3E%3E%2024,%20hi%20%3E%3E%2016,%20hi%20%3E%3E%208,%20hi,%20lo%20%3E%3E%2024,%20lo%20%3E%3E%2016,%20lo%20%3E%3E%208,%20lo);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20negative%20fixnum%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd0,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x8000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd1,%20value%20%3E%3E%208,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x80000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd2,%20value%20%3E%3E%2024,%20value%20%3E%3E%2016,%20value%20%3E%3E%208,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20Math.floor(value%20/%20Math.pow(2,%2032));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20value%20%3E%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd3,%20hi%20%3E%3E%2024,%20hi%20%3E%3E%2016,%20hi%20%3E%3E%208,%20hi,%20lo%20%3E%3E%2024,%20lo%20%3E%3E%2016,%20lo%20%3E%3E%208,%20lo);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20(type%20===%20'object')%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20nil%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc0);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(Array.isArray(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20value.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20fixarray%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x10)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(length%20%7C%200x90);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20array%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdc,%20length%20%3E%3E%208,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20array%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdd,%20length%20%3E%3E%2024,%20length%20%3E%3E%2016,%20length%20%3E%3E%208,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Array%20too%20large');%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20+=%20_encode(bytes,%20defers,%20value%5Bi%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20instanceof%20Date)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ms%20=%20value.getTime();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20=%20Math.floor(ms%20/%201e3);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ns%20=%20(ms%20-%20s%20*%201e3)%20*%201e6;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(s%20%3E=%200%20&&%20ns%20%3E=%200%20&&%20s%20%3C=%20TIMESTAMP64_MAX_SEC)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ns%20===%200%20&&%20s%20%3C=%20TIMESTAMP32_MAX_SEC)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd6,%200xff,%20s%20%3E%3E%2024,%20s%20%3E%3E%2016,%20s%20%3E%3E%208,%20s);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%206;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20s%20/%200x100000000;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20s%20&%200xffffffff;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd7,%200xff,%20ns%20%3E%3E%2022,%20ns%20%3E%3E%2014,%20ns%20%3E%3E%206,%20hi,%20lo%20%3E%3E%2024,%20lo%20%3E%3E%2016,%20lo%20%3E%3E%208,%20lo);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%2010;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20timestamp%2096%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hi%20=%20Math.floor(s%20/%200x100000000);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lo%20=%20s%20%3E%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc7,%200x0c,%200xff,%20ns%20%3E%3E%2024,%20ns%20%3E%3E%2016,%20ns%20%3E%3E%208,%20ns,%20hi%20%3E%3E%2024,%20hi%20%3E%3E%2016,%20hi%20%3E%3E%208,%20hi,%20lo%20%3E%3E%2024,%20lo%20%3E%3E%2016,%20lo%20%3E%3E%208,%20lo);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%2015;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20instanceof%20ArrayBuffer)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20value.byteLength;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20bin%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x100)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc4,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20bin%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc5,%20length%20%3E%3E%208,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20bin%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc6,%20length%20%3E%3E%2024,%20length%20%3E%3E%2016,%20length%20%3E%3E%208,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Buffer%20too%20large');%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20defers.push(%7B%20_bin:%20value,%20_length:%20length,%20_offset:%20bytes.length%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20size%20+%20length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20value.toJSON%20===%20'function')%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_encode(bytes,%20defers,%20value.toJSON());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20keys%20=%20%5B%5D,%20key%20=%20'';%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20allKeys%20=%20Object.keys(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(i%20=%200,%20l%20=%20allKeys.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key%20=%20allKeys%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5Bkey%5D%20!==%20undefined%20&&%20typeof%20value%5Bkey%5D%20!==%20'function')%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20keys.push(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20keys.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixmap%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x10)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(length%20%7C%200x80);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20map%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xde,%20length%20%3E%3E%208,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20map%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdf,%20length%20%3E%3E%2024,%20length%20%3E%3E%2016,%20length%20%3E%3E%208,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Object%20too%20large');%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(i%20=%200;%20i%20%3C%20length;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key%20=%20keys%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20+=%20_encode(bytes,%20defers,%20key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20+=%20_encode(bytes,%20defers,%20value%5Bkey%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20size;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20//%20false/true%20%09%09%20%20%20%20%20%20%20%20if%20(type%20===%20'boolean')%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value%20?%200xc3%20:%200xc2);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20(type%20===%20'undefined')%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xc0);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20//%20custom%20types%20like%20BigInt%20(typeof%20value%20===%20'bigint')%20%09%09%20%20%20%20%20%20%20%20if%20(typeof%20value.toJSON%20===%20'function')%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_encode(bytes,%20defers,%20value.toJSON());%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20throw%20new%20Error('Could%20not%20encode');%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20encode(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20bytes%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20var%20defers%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20var%20size%20=%20_encode(bytes,%20defers,%20value);%20%09%09%20%20%20%20%20%20%20%20var%20buf%20=%20new%20ArrayBuffer(size);%20%09%09%20%20%20%20%20%20%20%20var%20view%20=%20new%20DataView(buf);%20%09%09%20%20%20%20%20%20%20%20var%20deferIndex%20=%200;%20%09%09%20%20%20%20%20%20%20%20var%20deferWritten%20=%200;%20%09%09%20%20%20%20%20%20%20%20var%20nextOffset%20=%20-1;%20%09%09%20%20%20%20%20%20%20%20if%20(defers.length%20%3E%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20nextOffset%20=%20defers%5B0%5D._offset;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20defer,%20deferLength%20=%200,%20offset%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20bytes.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(deferWritten%20+%20i,%20bytes%5Bi%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20+%201%20!==%20nextOffset)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20defer%20=%20defers%5BdeferIndex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20deferLength%20=%20defer._length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20offset%20=%20deferWritten%20+%20nextOffset;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(defer._bin)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20bin%20=%20new%20Uint8Array(defer._bin);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20j%20=%200;%20j%20%3C%20deferLength;%20j++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setUint8(offset%20+%20j,%20bin%5Bj%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(defer._str)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20utf8Write(view,%20offset,%20defer._str);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(defer._float%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view.setFloat64(offset,%20defer._float);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20deferIndex++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20deferWritten%20+=%20deferLength;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(defers%5BdeferIndex%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nextOffset%20=%20defers%5BdeferIndex%5D._offset;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20buf;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20browser%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20throw%20new%20Error(%20%09%09%20%20%20%20%20%20%20%20'ws%20does%20not%20work%20in%20the%20browser.%20Browser%20clients%20must%20use%20the%20native%20'%20+%20%09%09%20%20%20%20%20%20%20%20%20%20'WebSocket%20object'%20%09%09%20%20%20%20%20%20);%20%09%09%20%20%20%20%7D;%20%20%09%09%20%20%20%20var%20WebSocket%20=%20globalThis.WebSocket%20%7C%7C%20browser;%20%09%09%20%20%20%20var%20WebSocketTransport%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20WebSocketTransport(events)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.events%20=%20events;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20WebSocketTransport.prototype.send%20=%20function%20(data)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(data%20instanceof%20ArrayBuffer)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.ws.send(data);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(Array.isArray(data))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.ws.send((new%20Uint8Array(data)).buffer);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20WebSocketTransport.prototype.connect%20=%20function%20(url)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.ws%20=%20new%20WebSocket(url,%20this.protocols);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.ws.binaryType%20=%20'arraybuffer';%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.ws.onopen%20=%20this.events.onopen;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.ws.onmessage%20=%20this.events.onmessage;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.ws.onclose%20=%20this.events.onclose;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.ws.onerror%20=%20this.events.onerror;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20WebSocketTransport.prototype.close%20=%20function%20(code,%20reason)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.ws.close(code,%20reason);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(WebSocketTransport.prototype,%20%22isOpen%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.ws.readyState%20===%20WebSocket.OPEN;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20return%20WebSocketTransport;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20var%20Connection%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20Connection()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.events%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.transport%20=%20new%20WebSocketTransport(this.events);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20Connection.prototype.send%20=%20function%20(data)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.transport.send(data);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Connection.prototype.connect%20=%20function%20(url)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.transport.connect(url);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Connection.prototype.close%20=%20function%20(code,%20reason)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.transport.close(code,%20reason);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(Connection.prototype,%20%22isOpen%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.transport.isOpen;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20return%20Connection;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20//%20Use%20codes%20between%200~127%20for%20lesser%20throughput%20(1%20byte)%20%09%09%20%20%20%20exports.Protocol%20=%20void%200;%20%09%09%20%20%20%20(function%20(Protocol)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20Room-related%20(10~19)%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22HANDSHAKE%22%5D%20=%209%5D%20=%20%22HANDSHAKE%22;%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22JOIN_ROOM%22%5D%20=%2010%5D%20=%20%22JOIN_ROOM%22;%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22ERROR%22%5D%20=%2011%5D%20=%20%22ERROR%22;%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22LEAVE_ROOM%22%5D%20=%2012%5D%20=%20%22LEAVE_ROOM%22;%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22ROOM_DATA%22%5D%20=%2013%5D%20=%20%22ROOM_DATA%22;%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22ROOM_STATE%22%5D%20=%2014%5D%20=%20%22ROOM_STATE%22;%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22ROOM_STATE_PATCH%22%5D%20=%2015%5D%20=%20%22ROOM_STATE_PATCH%22;%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22ROOM_DATA_SCHEMA%22%5D%20=%2016%5D%20=%20%22ROOM_DATA_SCHEMA%22;%20%09%09%20%20%20%20%20%20%20%20Protocol%5BProtocol%5B%22ROOM_DATA_BYTES%22%5D%20=%2017%5D%20=%20%22ROOM_DATA_BYTES%22;%20%09%09%20%20%20%20%7D)(exports.Protocol%20%7C%7C%20(exports.Protocol%20=%20%7B%7D));%20%09%09%20%20%20%20exports.ErrorCode%20=%20void%200;%20%09%09%20%20%20%20(function%20(ErrorCode)%20%7B%20%09%09%20%20%20%20%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_NO_HANDLER%22%5D%20=%204210%5D%20=%20%22MATCHMAKE_NO_HANDLER%22;%20%09%09%20%20%20%20%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_INVALID_CRITERIA%22%5D%20=%204211%5D%20=%20%22MATCHMAKE_INVALID_CRITERIA%22;%20%09%09%20%20%20%20%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_INVALID_ROOM_ID%22%5D%20=%204212%5D%20=%20%22MATCHMAKE_INVALID_ROOM_ID%22;%20%09%09%20%20%20%20%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_UNHANDLED%22%5D%20=%204213%5D%20=%20%22MATCHMAKE_UNHANDLED%22;%20%09%09%20%20%20%20%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_EXPIRED%22%5D%20=%204214%5D%20=%20%22MATCHMAKE_EXPIRED%22;%20%09%09%20%20%20%20%20%20%20%20ErrorCode%5BErrorCode%5B%22AUTH_FAILED%22%5D%20=%204215%5D%20=%20%22AUTH_FAILED%22;%20%09%09%20%20%20%20%20%20%20%20ErrorCode%5BErrorCode%5B%22APPLICATION_ERROR%22%5D%20=%204216%5D%20=%20%22APPLICATION_ERROR%22;%20%09%09%20%20%20%20%7D)(exports.ErrorCode%20%7C%7C%20(exports.ErrorCode%20=%20%7B%7D));%20%09%09%20%20%20%20function%20utf8Read(view,%20offset)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20length%20=%20view%5Boffset++%5D;%20%09%09%20%20%20%20%20%20%20%20var%20string%20=%20'',%20chr%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%20offset,%20end%20=%20offset%20+%20length;%20i%20%3C%20end;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20byte%20=%20view%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200x80)%20===%200x00)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(byte);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xe0)%20===%200xc0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x1f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(view%5B++i%5D%20&%200x3f));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xf0)%20===%200xe0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x0f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%200));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xf8)%20===%200xf0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20=%20((byte%20&%200x07)%20%3C%3C%2018)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(chr%20%3E=%200x010000)%20%7B%20//%20surrogate%20pair%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20-=%200x010000;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode((chr%20%3E%3E%3E%2010)%20+%200xD800,%20(chr%20&%200x3FF)%20+%200xDC00);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(chr);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('Invalid%20byte%20'%20+%20byte.toString(16));%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20string;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20//%20Faster%20for%20short%20strings%20than%20Buffer.byteLength%20%09%09%20%20%20%20function%20utf8Length(str)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(str%20===%20void%200)%20%7B%20str%20=%20'';%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20c%20=%200;%20%09%09%20%20%20%20%20%20%20%20var%20length%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20length%20+%201;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20serializers%20=%20%7B%7D;%20%09%09%20%20%20%20function%20registerSerializer(id,%20serializer)%20%7B%20%09%09%20%20%20%20%20%20%20%20serializers%5Bid%5D%20=%20serializer;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20getSerializer(id)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20serializer%20=%20serializers%5Bid%5D;%20%09%09%20%20%20%20%20%20%20%20if%20(!serializer)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22missing%20serializer:%20%22%20+%20id);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20serializer;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20The%20MIT%20License%20(MIT)%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20Copyright%202016%20Andrey%20Sitnik%20%3Candrey@sitnik.ru%3E%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20Permission%20is%20hereby%20granted,%20free%20of%20charge,%20to%20any%20person%20obtaining%20a%20copy%20of%20%09%09%20%20%20%20%20*%20this%20software%20and%20associated%20documentation%20files%20(the%20%22Software%22),%20to%20deal%20in%20%09%09%20%20%20%20%20*%20the%20Software%20without%20restriction,%20including%20without%20limitation%20the%20rights%20to%20%09%09%20%20%20%20%20*%20use,%20copy,%20modify,%20merge,%20publish,%20distribute,%20sublicense,%20and/or%20sell%20copies%20of%20%09%09%20%20%20%20%20*%20the%20Software,%20and%20to%20permit%20persons%20to%20whom%20the%20Software%20is%20furnished%20to%20do%20so,%20%09%09%20%20%20%20%20*%20subject%20to%20the%20following%20conditions:%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20The%20above%20copyright%20notice%20and%20this%20permission%20notice%20shall%20be%20included%20in%20all%20%09%09%20%20%20%20%20*%20copies%20or%20substantial%20portions%20of%20the%20Software.%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22,%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND,%20EXPRESS%20OR%20%09%09%20%20%20%20%20*%20IMPLIED,%20INCLUDING%20BUT%20NOT%20LIMITED%20TO%20THE%20WARRANTIES%20OF%20MERCHANTABILITY,%20FITNESS%20%09%09%20%20%20%20%20*%20FOR%20A%20PARTICULAR%20PURPOSE%20AND%20NONINFRINGEMENT.%20IN%20NO%20EVENT%20SHALL%20THE%20AUTHORS%20OR%20%09%09%20%20%20%20%20*%20COPYRIGHT%20HOLDERS%20BE%20LIABLE%20FOR%20ANY%20CLAIM,%20DAMAGES%20OR%20OTHER%20LIABILITY,%20WHETHER%20%09%09%20%20%20%20%20*%20IN%20AN%20ACTION%20OF%20CONTRACT,%20TORT%20OR%20OTHERWISE,%20ARISING%20FROM,%20OUT%20OF%20OR%20IN%20%09%09%20%20%20%20%20*%20CONNECTION%20WITH%20THE%20SOFTWARE%20OR%20THE%20USE%20OR%20OTHER%20DEALINGS%20IN%20THE%20SOFTWARE.%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20var%20createNanoEvents%20=%20function%20()%20%7B%20return%20(%7B%20%09%09%20%20%20%20%20%20%20%20emit:%20function%20(event)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20args%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%201;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%5B_i%20-%201%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20callbacks%20=%20this.events%5Bevent%5D%20%7C%7C%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20length_1%20=%20callbacks.length;%20i%20%3C%20length_1;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20callbacks%5Bi%5D.apply(callbacks,%20args);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20events:%20%7B%7D,%20%09%09%20%20%20%20%20%20%20%20on:%20function%20(event,%20cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20((_a%20=%20this.events%5Bevent%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.push(cb))%20%7C%7C%20(this.events%5Bevent%5D%20=%20%5Bcb%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.events%5Bevent%5D%20=%20(_a%20=%20_this.events%5Bevent%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.filter(function%20(i)%20%7B%20return%20cb%20!==%20i;%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D);%20%7D;%20%20%09%09%20%20%20%20var%20EventEmitter%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20EventEmitter()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.handlers%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20EventEmitter.prototype.register%20=%20function%20(cb,%20once)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.handlers.push(cb);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20EventEmitter.prototype.invoke%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20args%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.handlers.forEach(function%20(handler)%20%7B%20return%20handler.apply(_this,%20args);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20EventEmitter.prototype.invokeAsync%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20args%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Promise.all(this.handlers.map(function%20(handler)%20%7B%20return%20handler.apply(_this,%20args);%20%7D));%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20EventEmitter.prototype.remove%20=%20function%20(cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.handlers.indexOf(cb);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.handlers%5Bindex%5D%20=%20this.handlers%5Bthis.handlers.length%20-%201%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.handlers.pop();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20EventEmitter.prototype.clear%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.handlers%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20EventEmitter;%20%09%09%20%20%20%20%7D());%20%09%09%20%20%20%20function%20createSignal()%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20emitter%20=%20new%20EventEmitter();%20%09%09%20%20%20%20%20%20%20%20function%20register(cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20emitter.register(cb,%20this%20===%20null);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20register.once%20=%20function%20(cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20callback%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20args%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cb.apply(this,%20args);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20emitter.remove(callback);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20emitter.register(callback);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20register.remove%20=%20function%20(cb)%20%7B%20return%20emitter.remove(cb);%20%7D;%20%09%09%20%20%20%20%20%20%20%20register.invoke%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20args%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20emitter.invoke.apply(emitter,%20args);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20register.invokeAsync%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20args%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20emitter.invokeAsync.apply(emitter,%20args);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20register.clear%20=%20function%20()%20%7B%20return%20emitter.clear();%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20register;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20commonjsGlobal$1%20=%20typeof%20globalThis%20!==%20'undefined'%20?%20globalThis%20:%20typeof%20window%20!==%20'undefined'%20?%20window%20:%20typeof%20commonjsGlobal%20!==%20'undefined'%20?%20commonjsGlobal%20:%20typeof%20self%20!==%20'undefined'%20?%20self%20:%20%7B%7D;%20%20%09%09%20%20%20%20function%20createCommonjsModule(fn)%20%7B%20%09%09%20%20%20%20%20%20var%20module%20=%20%7B%20exports:%20%7B%7D%20%7D;%20%09%09%20%20%20%20%09return%20fn(module,%20module.exports),%20module.exports;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20umd%20=%20createCommonjsModule(function%20(module,%20exports)%20%7B%20%09%09%20%20%20%20(function%20(global,%20factory)%20%7B%20%09%09%20%20%20%20%20%20%20%20factory(exports)%20;%20%09%09%20%20%20%20%7D)(commonjsGlobal$1,%20(function%20(exports)%20%7B%20%09%09%20%20%20%20%20%20%20%20/******************************************************************************%20%09%09%20%20%20%20%20%20%20%20Copyright%20(c)%20Microsoft%20Corporation.%20%20%09%09%20%20%20%20%20%20%20%20Permission%20to%20use,%20copy,%20modify,%20and/or%20distribute%20this%20software%20for%20any%20%09%09%20%20%20%20%20%20%20%20purpose%20with%20or%20without%20fee%20is%20hereby%20granted.%20%20%09%09%20%20%20%20%20%20%20%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22%20AND%20THE%20AUTHOR%20DISCLAIMS%20ALL%20WARRANTIES%20WITH%20%09%09%20%20%20%20%20%20%20%20REGARD%20TO%20THIS%20SOFTWARE%20INCLUDING%20ALL%20IMPLIED%20WARRANTIES%20OF%20MERCHANTABILITY%20%09%09%20%20%20%20%20%20%20%20AND%20FITNESS.%20IN%20NO%20EVENT%20SHALL%20THE%20AUTHOR%20BE%20LIABLE%20FOR%20ANY%20SPECIAL,%20DIRECT,%20%09%09%20%20%20%20%20%20%20%20INDIRECT,%20OR%20CONSEQUENTIAL%20DAMAGES%20OR%20ANY%20DAMAGES%20WHATSOEVER%20RESULTING%20FROM%20%09%09%20%20%20%20%20%20%20%20LOSS%20OF%20USE,%20DATA%20OR%20PROFITS,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20NEGLIGENCE%20OR%20%09%09%20%20%20%20%20%20%20%20OTHER%20TORTIOUS%20ACTION,%20ARISING%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20USE%20OR%20%09%09%20%20%20%20%20%20%20%20PERFORMANCE%20OF%20THIS%20SOFTWARE.%20%09%09%20%20%20%20%20%20%20%20*****************************************************************************%20*/%20%09%09%20%20%20%20%20%20%20%20/*%20global%20Reflect,%20Promise%20*/%20%20%09%09%20%20%20%20%20%20%20%20var%20extendStatics%20=%20function(d,%20b)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20extendStatics%20=%20Object.setPrototypeOf%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(%7B%20__proto__:%20%5B%5D%20%7D%20instanceof%20Array%20&&%20function%20(d,%20b)%20%7B%20d.__proto__%20=%20b;%20%7D)%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20function%20(d,%20b)%20%7B%20for%20(var%20p%20in%20b)%20if%20(Object.prototype.hasOwnProperty.call(b,%20p))%20d%5Bp%5D%20=%20b%5Bp%5D;%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20extendStatics(d,%20b);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%20%09%09%20%20%20%20%20%20%20%20function%20__extends(d,%20b)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20b%20!==%20%22function%22%20&&%20b%20!==%20null)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20TypeError(%22Class%20extends%20value%20%22%20+%20String(b)%20+%20%22%20is%20not%20a%20constructor%20or%20null%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20extendStatics(d,%20b);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20__()%20%7B%20this.constructor%20=%20d;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20d.prototype%20=%20b%20===%20null%20?%20Object.create(b)%20:%20(__.prototype%20=%20b.prototype,%20new%20__());%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20function%20__decorate(decorators,%20target,%20key,%20desc)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20c%20=%20arguments.length,%20r%20=%20c%20%3C%203%20?%20target%20:%20desc,%20d;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20Reflect%20===%20%22object%22%20&&%20typeof%20Reflect.decorate%20===%20%22function%22)%20r%20=%20Reflect.decorate(decorators,%20target,%20key,%20desc);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20for%20(var%20i%20=%20decorators.length%20-%201;%20i%20%3E=%200;%20i--)%20if%20(d%20=%20decorators%5Bi%5D)%20r%20=%20(c%20%3C%203%20?%20d(r)%20:%20c%20%3E%203%20?%20d(target,%20key,%20r)%20:%20d(target,%20key))%20%7C%7C%20r;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20c%20%3E%203%20&&%20r%20&&%20Object.defineProperty(target,%20key,%20r),%20r;%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20function%20__spreadArray(to,%20from,%20pack)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(arguments.length%20===%202)%20for%20(var%20i%20=%200,%20l%20=%20from.length,%20ar;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ar%20%7C%7C%20!(i%20in%20from))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!ar)%20ar%20=%20Array.prototype.slice.call(from,%200,%20i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ar%5Bi%5D%20=%20from%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20to.concat(ar%20%7C%7C%20Array.prototype.slice.call(from));%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20//%20export%20const%20SWITCH_TO_STRUCTURE%20=%20193;%20(easily%20collides%20with%20DELETE_AND_ADD%20+%20fieldIndex%20=%202)%20%09%09%20%20%20%20%20%20%20%20var%20SWITCH_TO_STRUCTURE%20=%20255;%20//%20(decoding%20collides%20with%20DELETE_AND_ADD%20+%20fieldIndex%20=%2063)%20%09%09%20%20%20%20%20%20%20%20var%20TYPE_ID%20=%20213;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Encoding%20Schema%20field%20operations.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20exports.OPERATION%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20(function%20(OPERATION)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20add%20new%20structure/primitive%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22ADD%22%5D%20=%20128%5D%20=%20%22ADD%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20replace%20structure/primitive%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22REPLACE%22%5D%20=%200%5D%20=%20%22REPLACE%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20delete%20field%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22DELETE%22%5D%20=%2064%5D%20=%20%22DELETE%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20DELETE%20field,%20followed%20by%20an%20ADD%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22DELETE_AND_ADD%22%5D%20=%20192%5D%20=%20%22DELETE_AND_ADD%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TOUCH%20is%20used%20to%20determine%20hierarchy%20of%20nested%20Schema%20structures%20during%20serialization.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20touches%20are%20NOT%20encoded.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22TOUCH%22%5D%20=%201%5D%20=%20%22TOUCH%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20MapSchema%20Operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22CLEAR%22%5D%20=%2010%5D%20=%20%22CLEAR%22;%20%09%09%20%20%20%20%20%20%20%20%7D)(exports.OPERATION%20%7C%7C%20(exports.OPERATION%20=%20%7B%7D));%20%09%09%20%20%20%20%20%20%20%20//%20export%20enum%20OPERATION%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20//%20add%20new%20structure/primitive%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20//%20(128)%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20ADD%20=%20128,%20//%2010000000,%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20//%20replace%20structure/primitive%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20REPLACE%20=%201,//%2000000001%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20//%20delete%20field%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20DELETE%20=%20192,%20//%2011000000%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20//%20DELETE%20field,%20followed%20by%20an%20ADD%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20DELETE_AND_ADD%20=%20224,%20//%2011100000%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20//%20TOUCH%20is%20used%20to%20determine%20hierarchy%20of%20nested%20Schema%20structures%20during%20serialization.%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20//%20touches%20are%20NOT%20encoded.%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20TOUCH%20=%200,%20//%2000000000%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20//%20MapSchema%20Operations%20%09%09%20%20%20%20%20%20%20%20//%20%20%20%20%20CLEAR%20=%2010,%20%09%09%20%20%20%20%20%20%20%20//%20%7D%20%20%09%09%20%20%20%20%20%20%20%20var%20ChangeTree%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20ChangeTree(ref,%20parent,%20root)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changed%20=%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges%20=%20new%20Set();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20cached%20indexes%20for%20filtering%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.caches%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.currentCustomOperation%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.ref%20=%20ref;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.setParent(parent,%20root);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.setParent%20=%20function%20(parent,%20root,%20parentIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.indexes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.indexes%20=%20(this.ref%20instanceof%20Schema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.ref%5B'_definition'%5D.indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.parent%20=%20parent;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.parentIndex%20=%20parentIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20avoid%20setting%20parents%20with%20empty%20%60root%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!root)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.root%20=%20root;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20assign%20same%20parent%20on%20child%20structures%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.ref%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20this.ref%5B'_definition'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20field%20in%20definition.schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20this.ref%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20parentIndex_1%20=%20definition.indexes%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this.ref,%20root,%20parentIndex_1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(typeof%20(this.ref)%20===%20%22object%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.ref.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTreee%20=%20value%5B'$changes'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20parentIndex_2%20=%20_this.ref%5B'$changes'%5D.indexes%5Bkey%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTreee.setParent(_this.ref,%20_this.root,%20parentIndex_2);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.operation%20=%20function%20(op)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.set(--this.currentCustomOperation,%20op);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.change%20=%20function%20(fieldName,%20operation)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation%20===%20void%200)%20%7B%20operation%20=%20exports.OPERATION.ADD;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20(typeof%20(fieldName)%20===%20%22number%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20fieldName%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this.indexes%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.assertValidIndex(index,%20fieldName);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20previousChange%20=%20this.changes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!previousChange%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousChange.op%20===%20exports.OPERATION.DELETE%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousChange.op%20===%20exports.OPERATION.TOUCH%20//%20(mazmorra.io's%20BattleAction%20issue)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.set(index,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op:%20(!previousChange)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20operation%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20(previousChange.op%20===%20exports.OPERATION.DELETE)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20exports.OPERATION.DELETE_AND_ADD%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20operation,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20:%20OPERATION.REPLACE,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20index:%20index%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges.add(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changed%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.touchParents();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.touch%20=%20function%20(fieldName)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20(typeof%20(fieldName)%20===%20%22number%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20fieldName%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this.indexes%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.assertValidIndex(index,%20fieldName);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.changes.has(index))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.set(index,%20%7B%20op:%20exports.OPERATION.TOUCH,%20index:%20index%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges.add(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ensure%20touch%20is%20placed%20until%20the%20$root%20is%20found.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.touchParents();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.touchParents%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.parent)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.parent%5B'$changes'%5D.touch(this.parentIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.getType%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.ref%5B'_definition'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20this.ref%5B'_definition'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20definition.schema%5Bdefinition.fieldsByIndex%5Bindex%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20this.parent%5B'_definition'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20parentType%20=%20definition.schema%5Bdefinition.fieldsByIndex%5Bthis.parentIndex%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Get%20the%20child%20type%20from%20parent%20structure.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20%5B%22string%22%5D%20=%3E%20%22string%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20%7B%20map:%20%22string%22%20%7D%20=%3E%20%22string%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20%7B%20set:%20%22string%22%20%7D%20=%3E%20%22string%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Object.values(parentType)%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.getChildrenFilter%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20childFilters%20=%20this.parent%5B'_definition'%5D.childFilters;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20childFilters%20&&%20childFilters%5Bthis.parentIndex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20used%20during%20%60.encode()%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.getValue%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.ref%5B'getByIndex'%5D(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.delete%20=%20function%20(fieldName)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20(typeof%20(fieldName)%20===%20%22number%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20fieldName%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this.indexes%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.warn(%22@colyseus/schema%20%22.concat(this.ref.constructor.name,%20%22:%20trying%20to%20delete%20non-existing%20index:%20%22).concat(fieldName,%20%22%20(%22).concat(index,%20%22)%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20previousValue%20=%20this.getValue(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log(%22$changes.delete%20=%3E%22,%20%7B%20fieldName,%20index,%20previousValue%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.set(index,%20%7B%20op:%20exports.OPERATION.DELETE,%20index:%20index%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20delete%20cache%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20delete%20this.caches%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20remove%20%60root%60%20reference%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%20&&%20previousValue%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue%5B'$changes'%5D.parent%20=%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changed%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.touchParents();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.discard%20=%20function%20(changed,%20discardAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(changed%20===%20void%200)%20%7B%20changed%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(discardAll%20===%20void%200)%20%7B%20discardAll%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Map,%20Array,%20etc:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Remove%20cached%20key%20to%20ensure%20ADD%20operations%20is%20unsed%20instead%20of%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20REPLACE%20in%20case%20same%20key%20is%20used%20on%20next%20patches.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20this.%20this%20is%20not%20relevant%20for%20Collection%20and%20Set.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!(this.ref%20instanceof%20Schema))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.forEach(function%20(change)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20_this.ref%5B'getIndex'%5D(change.index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20delete%20_this.indexes%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changed%20=%20changed;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(discardAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20re-set%20%60currentCustomOperation%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.currentCustomOperation%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Recursively%20discard%20all%20changes%20from%20this,%20and%20child%20structures.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.discardAll%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.forEach(function%20(change)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20_this.getValue(change.index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.discardAll();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.discard();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20cache(field:%20number,%20beginIndex:%20number,%20endIndex:%20number)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.cache%20=%20function%20(field,%20cachedBytes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.caches%5Bfield%5D%20=%20cachedBytes;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.clone%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20ChangeTree(this.ref,%20this.parent,%20this.root);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.ensureRefId%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20skip%20if%20refId%20is%20already%20set.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.refId%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refId%20=%20this.root.getNextUniqueId();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ChangeTree.prototype.assertValidIndex%20=%20function%20(index,%20fieldName)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ChangeTree:%20missing%20index%20for%20field%20%5C%22%22.concat(fieldName,%20%22%5C%22%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20ChangeTree;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%20%09%09%20%20%20%20%20%20%20%20function%20addCallback($callbacks,%20op,%20callback,%20existing)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20initialize%20list%20of%20callbacks%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!$callbacks%5Bop%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$callbacks%5Bop%5D%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20$callbacks%5Bop%5D.push(callback);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Trigger%20callback%20for%20existing%20elements%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20OPERATION.ADD%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20OPERATION.REPLACE%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20existing%20===%20null%20%7C%7C%20existing%20===%20void%200%20?%20void%200%20:%20existing.forEach(function%20(item,%20key)%20%7B%20return%20callback(item,%20key);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20()%20%7B%20return%20spliceOne($callbacks%5Bop%5D,%20$callbacks%5Bop%5D.indexOf(callback));%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20removeChildRefs(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20needRemoveRef%20=%20(typeof%20(this.$changes.getType())%20!==%20%22string%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.forEach(function%20(item,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changes.push(%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId:%20_this.$changes.refId,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op:%20exports.OPERATION.DELETE,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field:%20key,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20undefined,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue:%20item%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(needRemoveRef)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.$changes.root.removeRef(item%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20spliceOne(arr,%20index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20manually%20splice%20an%20array%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20-1%20%7C%7C%20index%20%3E=%20arr.length)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20len%20=%20arr.length%20-%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%20index;%20i%20%3C%20len;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20arr%5Bi%5D%20=%20arr%5Bi%20+%201%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20arr.length%20=%20len;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20var%20DEFAULT_SORT%20=%20function%20(a,%20b)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20A%20=%20a.toString();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20B%20=%20b.toString();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(A%20%3C%20B)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20-1;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(A%20%3E%20B)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%200;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20function%20getArrayProxy(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$proxy'%5D%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20compatibility%20with%20@colyseus/schema%200.5.x%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20allow%20%60map%5B%22key%22%5D%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20allow%20%60map%5B%22key%22%5D%20=%20%22xxx%22%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20allow%20%60delete%20map%5B%22key%22%5D%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20new%20Proxy(value,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20(obj,%20prop)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20!==%20%22symbol%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20!isNaN(prop)%20//%20https://stackoverflow.com/a/175787/892698%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj.at(prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj%5Bprop%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(obj,%20prop,%20setValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20!==%20%22symbol%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20!isNaN(prop))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(obj%5B'$items'%5D.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20parseInt(indexes%5Bprop%5D%20%7C%7C%20prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(setValue%20===%20undefined%20%7C%7C%20setValue%20===%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.deleteAt(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.setAt(key,%20setValue);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%5Bprop%5D%20=%20setValue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20deleteProperty:%20function%20(obj,%20prop)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20===%20%22number%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.deleteAt(prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20delete%20obj%5Bprop%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20ArraySchema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20ArraySchema()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20items%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20items%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes%20=%20new%20ChangeTree(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.push.apply(this,%20items);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.onAdd%20=%20function%20(callback,%20triggerAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(triggerAll%20===%20void%200)%20%7B%20triggerAll%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D)),%20exports.OPERATION.ADD,%20callback,%20(triggerAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.onRemove%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.DELETE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.onChange%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.REPLACE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20type%20format:%20%5B%22string%22%5D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Array.isArray(type)%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20type%20format:%20%7B%20array:%20%22string%22%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(type%5B'array'%5D%20!==%20undefined));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperty(ArraySchema.prototype,%20%22length%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.splice(value,%20this.length%20-%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.push%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20values%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20values%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20lastIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20values.forEach(function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20set%20%22index%22%20for%20reference.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lastIndex%20=%20_this.$refId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(lastIndex,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20lastIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Removes%20the%20last%20element%20from%20an%20array%20and%20returns%20it.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.pop%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20Array.from(this.$indexes.values()).pop();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(key%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20this.$items.get(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.at%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20FIXME:%20this%20should%20be%20O(1)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20Array.from(this.$items.keys())%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.setAt%20=%20function%20(index,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(_b%20=%20(_a%20=%20this.$changes.indexes%5Bindex%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.op)%20!==%20null%20&&%20_b%20!==%20void%200%20?%20_b%20:%20exports.OPERATION.ADD;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%5Bindex%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.set(index,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(index,%20operation);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.deleteAt%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20Array.from(this.$items.keys())%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(key%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$deleteAt(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.$deleteAt%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20delete%20at%20internal%20index%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.clear%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20discard%20previous%20operations.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discard(true,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20previous%20indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20When%20decoding:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20enqueue%20items%20for%20DELETE%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20flag%20child%20items%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeChildRefs.call(this,%20changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.operation(%7B%20index:%200,%20op:%20exports.OPERATION.CLEAR%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20touch%20all%20structures%20until%20reach%20root%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.touchParents();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Combines%20two%20or%20more%20arrays.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20items%20Additional%20items%20to%20add%20to%20the%20end%20of%20array1.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.concat%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20items%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20items%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20(_a%20=%20Array.from(this.$items.values())).concat.apply(_a,%20items),%20false)))();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Adds%20all%20the%20elements%20of%20an%20array%20separated%20by%20the%20specified%20separator%20string.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20separator%20A%20string%20used%20to%20separate%20one%20element%20of%20an%20array%20from%20the%20next%20in%20the%20resulting%20String.%20If%20omitted,%20the%20array%20elements%20are%20separated%20with%20a%20comma.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.join%20=%20function%20(separator)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).join(separator);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Reverses%20the%20elements%20in%20an%20Array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.reverse%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20reversedItems%20=%20Array.from(this.$items.values()).reverse();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reversedItems.forEach(function%20(item,%20i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(indexes%5Bi%5D,%20item);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Removes%20the%20first%20element%20from%20an%20array%20and%20returns%20it.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.shift%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20shiftAt%20=%20indexes.shift();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(shiftAt%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20this.$items.get(shiftAt);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$deleteAt(shiftAt);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20a%20section%20of%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20start%20The%20beginning%20of%20the%20specified%20portion%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20end%20The%20end%20of%20the%20specified%20portion%20of%20the%20array.%20This%20is%20exclusive%20of%20the%20element%20at%20the%20index%20'end'.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.slice%20=%20function%20(start,%20end)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20sliced%20=%20new%20ArraySchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sliced.push.apply(sliced,%20Array.from(this.$items.values()).slice(start,%20end));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20sliced;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Sorts%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20compareFn%20Function%20used%20to%20determine%20the%20order%20of%20the%20elements.%20It%20is%20expected%20to%20return%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20a%20negative%20value%20if%20first%20argument%20is%20less%20than%20second%20argument,%20zero%20if%20they're%20equal%20and%20a%20positive%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20value%20otherwise.%20If%20omitted,%20the%20elements%20are%20sorted%20in%20ascending,%20ASCII%20character%20order.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20%60%60%60ts%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20%5B11,2,22,1%5D.sort((a,%20b)%20=%3E%20a%20-%20b)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.sort%20=%20function%20(compareFn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(compareFn%20===%20void%200)%20%7B%20compareFn%20=%20DEFAULT_SORT;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20sortedItems%20=%20Array.from(this.$items.values()).sort(compareFn);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sortedItems.forEach(function%20(item,%20i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(indexes%5Bi%5D,%20item);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Removes%20elements%20from%20an%20array%20and,%20if%20necessary,%20inserts%20new%20elements%20in%20their%20place,%20returning%20the%20deleted%20elements.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20start%20The%20zero-based%20location%20in%20the%20array%20from%20which%20to%20start%20removing%20elements.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20deleteCount%20The%20number%20of%20elements%20to%20remove.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20items%20Elements%20to%20insert%20into%20the%20array%20in%20place%20of%20the%20deleted%20elements.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.splice%20=%20function%20(start,%20deleteCount)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(deleteCount%20===%20void%200)%20%7B%20deleteCount%20=%20this.length%20-%20start;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20removedItems%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%20start;%20i%20%3C%20start%20+%20deleteCount;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removedItems.push(this.$items.get(indexes%5Bi%5D));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$deleteAt(indexes%5Bi%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20removedItems;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Inserts%20new%20elements%20at%20the%20start%20of%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20items%20%20Elements%20to%20insert%20at%20the%20start%20of%20the%20Array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.unshift%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20items%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20items%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20length%20=%20this.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20addedLength%20=%20items.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20previousValues%20=%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20items.forEach(function%20(item,%20i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(i,%20item);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValues.forEach(function%20(previousValue,%20i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(addedLength%20+%20i,%20previousValue);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20length%20+%20addedLength;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20the%20index%20of%20the%20first%20occurrence%20of%20a%20value%20in%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20searchElement%20The%20value%20to%20locate%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20fromIndex%20The%20array%20index%20at%20which%20to%20begin%20the%20search.%20If%20fromIndex%20is%20omitted,%20the%20search%20starts%20at%20index%200.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.indexOf%20=%20function%20(searchElement,%20fromIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).indexOf(searchElement,%20fromIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20the%20index%20of%20the%20last%20occurrence%20of%20a%20specified%20value%20in%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20searchElement%20The%20value%20to%20locate%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20fromIndex%20The%20array%20index%20at%20which%20to%20begin%20the%20search.%20If%20fromIndex%20is%20omitted,%20the%20search%20starts%20at%20the%20last%20index%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.lastIndexOf%20=%20function%20(searchElement,%20fromIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(fromIndex%20===%20void%200)%20%7B%20fromIndex%20=%20this.length%20-%201;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).lastIndexOf(searchElement,%20fromIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Determines%20whether%20all%20the%20members%20of%20an%20array%20satisfy%20the%20specified%20test.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20The%20every%20method%20calls%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20the%20callbackfn%20function%20for%20each%20element%20in%20the%20array%20until%20the%20callbackfn%20returns%20a%20value%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20which%20is%20coercible%20to%20the%20Boolean%20value%20false,%20or%20until%20the%20end%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callbackfn%20function.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20If%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.every%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).every(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Determines%20whether%20the%20specified%20callback%20function%20returns%20true%20for%20any%20element%20of%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20The%20some%20method%20calls%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20the%20callbackfn%20function%20for%20each%20element%20in%20the%20array%20until%20the%20callbackfn%20returns%20a%20value%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20which%20is%20coercible%20to%20the%20Boolean%20value%20true,%20or%20until%20the%20end%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callbackfn%20function.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20If%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.some%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).some(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Performs%20the%20specified%20action%20for%20each%20element%20in%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20forEach%20calls%20the%20callbackfn%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callbackfn%20function.%20If%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.forEach%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Array.from(this.$items.values()).forEach(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Calls%20a%20defined%20callback%20function%20on%20each%20element%20of%20an%20array,%20and%20returns%20an%20array%20that%20contains%20the%20results.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20The%20map%20method%20calls%20the%20callbackfn%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callbackfn%20function.%20If%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.map%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).map(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.filter%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).filter(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Calls%20the%20specified%20callback%20function%20for%20all%20the%20elements%20in%20an%20array.%20The%20return%20value%20of%20the%20callback%20function%20is%20the%20accumulated%20result,%20and%20is%20provided%20as%20an%20argument%20in%20the%20next%20call%20to%20the%20callback%20function.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20four%20arguments.%20The%20reduce%20method%20calls%20the%20callbackfn%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20initialValue%20If%20initialValue%20is%20specified,%20it%20is%20used%20as%20the%20initial%20value%20to%20start%20the%20accumulation.%20The%20first%20call%20to%20the%20callbackfn%20function%20provides%20this%20value%20as%20an%20argument%20instead%20of%20an%20array%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.reduce%20=%20function%20(callbackfn,%20initialValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.prototype.reduce.apply(Array.from(this.$items.values()),%20arguments);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Calls%20the%20specified%20callback%20function%20for%20all%20the%20elements%20in%20an%20array,%20in%20descending%20order.%20The%20return%20value%20of%20the%20callback%20function%20is%20the%20accumulated%20result,%20and%20is%20provided%20as%20an%20argument%20in%20the%20next%20call%20to%20the%20callback%20function.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20four%20arguments.%20The%20reduceRight%20method%20calls%20the%20callbackfn%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20initialValue%20If%20initialValue%20is%20specified,%20it%20is%20used%20as%20the%20initial%20value%20to%20start%20the%20accumulation.%20The%20first%20call%20to%20the%20callbackfn%20function%20provides%20this%20value%20as%20an%20argument%20instead%20of%20an%20array%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.reduceRight%20=%20function%20(callbackfn,%20initialValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.prototype.reduceRight.apply(Array.from(this.$items.values()),%20arguments);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20the%20value%20of%20the%20first%20element%20in%20the%20array%20where%20predicate%20is%20true,%20and%20undefined%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20otherwise.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20predicate%20find%20calls%20predicate%20once%20for%20each%20element%20of%20the%20array,%20in%20ascending%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20order,%20until%20it%20finds%20one%20where%20predicate%20returns%20true.%20If%20such%20an%20element%20is%20found,%20find%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20immediately%20returns%20that%20element%20value.%20Otherwise,%20find%20returns%20undefined.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20If%20provided,%20it%20will%20be%20used%20as%20the%20this%20value%20for%20each%20invocation%20of%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20predicate.%20If%20it%20is%20not%20provided,%20undefined%20is%20used%20instead.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.find%20=%20function%20(predicate,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).find(predicate,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20the%20index%20of%20the%20first%20element%20in%20the%20array%20where%20predicate%20is%20true,%20and%20-1%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20otherwise.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20predicate%20find%20calls%20predicate%20once%20for%20each%20element%20of%20the%20array,%20in%20ascending%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20order,%20until%20it%20finds%20one%20where%20predicate%20returns%20true.%20If%20such%20an%20element%20is%20found,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20findIndex%20immediately%20returns%20that%20element%20index.%20Otherwise,%20findIndex%20returns%20-1.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20If%20provided,%20it%20will%20be%20used%20as%20the%20this%20value%20for%20each%20invocation%20of%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20predicate.%20If%20it%20is%20not%20provided,%20undefined%20is%20used%20instead.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.findIndex%20=%20function%20(predicate,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).findIndex(predicate,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20the%20this%20object%20after%20filling%20the%20section%20identified%20by%20start%20and%20end%20with%20value%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20value%20value%20to%20fill%20array%20section%20with%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20start%20index%20to%20start%20filling%20the%20array%20at.%20If%20start%20is%20negative,%20it%20is%20treated%20as%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20length+start%20where%20length%20is%20the%20length%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20end%20index%20to%20stop%20filling%20the%20array%20at.%20If%20end%20is%20negative,%20it%20is%20treated%20as%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20length+end.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.fill%20=%20function%20(value,%20start,%20end)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ArraySchema%23fill()%20not%20implemented%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20the%20this%20object%20after%20copying%20a%20section%20of%20the%20array%20identified%20by%20start%20and%20end%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20to%20the%20same%20array%20starting%20at%20position%20target%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20target%20If%20target%20is%20negative,%20it%20is%20treated%20as%20length+target%20where%20length%20is%20the%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20length%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20start%20If%20start%20is%20negative,%20it%20is%20treated%20as%20length+start.%20If%20end%20is%20negative,%20it%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20is%20treated%20as%20length+end.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20end%20If%20not%20specified,%20length%20of%20the%20this%20object%20is%20used%20as%20its%20default%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.copyWithin%20=%20function%20(target,%20start,%20end)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ArraySchema%23copyWithin()%20not%20implemented%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20a%20string%20representation%20of%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.toString%20=%20function%20()%20%7B%20return%20this.$items.toString();%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20a%20string%20representation%20of%20an%20array.%20The%20elements%20are%20converted%20to%20string%20using%20their%20toLocalString%20methods.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.toLocaleString%20=%20function%20()%20%7B%20return%20this.$items.toLocaleString();%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20Iterator%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype%5BSymbol.iterator%5D%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values())%5BSymbol.iterator%5D();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20an%20iterable%20of%20key,%20value%20pairs%20for%20every%20entry%20in%20the%20array%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.entries%20=%20function%20()%20%7B%20return%20this.$items.entries();%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20an%20iterable%20of%20keys%20in%20the%20array%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.keys%20=%20function%20()%20%7B%20return%20this.$items.keys();%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20an%20iterable%20of%20values%20in%20the%20array%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.values%20=%20function%20()%20%7B%20return%20this.$items.values();%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Determines%20whether%20an%20array%20includes%20a%20certain%20element,%20returning%20true%20or%20false%20as%20appropriate.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20searchElement%20The%20element%20to%20search%20for.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20fromIndex%20The%20position%20in%20this%20array%20at%20which%20to%20begin%20searching%20for%20searchElement.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.includes%20=%20function%20(searchElement,%20fromIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).includes(searchElement,%20fromIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Calls%20a%20defined%20callback%20function%20on%20each%20element%20of%20an%20array.%20Then,%20flattens%20the%20result%20into%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20a%20new%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20This%20is%20identical%20to%20a%20map%20followed%20by%20flat%20with%20depth%201.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20callback%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20The%20flatMap%20method%20calls%20the%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20callback%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callback%20function.%20If%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.flatMap%20=%20function%20(callback,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ArraySchema%23flatMap()%20is%20not%20supported.%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Returns%20a%20new%20array%20with%20all%20sub-array%20elements%20concatenated%20into%20it%20recursively%20up%20to%20the%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20specified%20depth.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20depth%20The%20maximum%20recursion%20depth%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.flat%20=%20function%20(depth)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ArraySchema%23flat()%20is%20not%20supported.%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.findLast%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20arr%20=%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20arr.findLast.apply(arr,%20arguments);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.findLastIndex%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20arr%20=%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20arr.findLastIndex.apply(arr,%20arguments);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20get%20size%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.setIndex%20=%20function%20(index,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.getIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(this.$indexes.get(index));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.toArray%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.toArray().map(function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(typeof%20(value%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20value%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Decoding%20utilities%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ArraySchema.prototype.clone%20=%20function%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20Array.from(this.$items.values()),%20false)))();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20this.map(function%20(item)%20%7B%20return%20((item%5B'$changes'%5D)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20item.clone()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20item);%20%7D),%20false)))();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20ArraySchema;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%20%09%09%20%20%20%20%20%20%20%20function%20getMapProxy(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$proxy'%5D%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20new%20Proxy(value,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20(obj,%20prop)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20!==%20%22symbol%22%20&&%20//%20accessing%20properties%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20(obj%5Bprop%5D)%20===%20%22undefined%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj.get(prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj%5Bprop%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(obj,%20prop,%20setValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20!==%20%22symbol%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(prop.indexOf(%22$%22)%20===%20-1%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prop%20!==%20%22onAdd%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prop%20!==%20%22onRemove%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prop%20!==%20%22onChange%22))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.set(prop,%20setValue);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%5Bprop%5D%20=%20setValue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20deleteProperty:%20function%20(obj,%20prop)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.delete(prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20MapSchema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20MapSchema(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes%20=%20new%20ChangeTree(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(initialValues%20instanceof%20Map%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialValues%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialValues.forEach(function%20(v,%20k)%20%7B%20return%20_this.set(k,%20v);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20k%20in%20initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.set(k,%20initialValues%5Bk%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.onAdd%20=%20function%20(callback,%20triggerAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(triggerAll%20===%20void%200)%20%7B%20triggerAll%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D)),%20exports.OPERATION.ADD,%20callback,%20(triggerAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.onRemove%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.DELETE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.onChange%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.REPLACE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20type%5B'map'%5D%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20Iterator%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype%5BSymbol.iterator%5D%20=%20function%20()%20%7B%20return%20this.$items%5BSymbol.iterator%5D();%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperty(MapSchema.prototype,%20Symbol.toStringTag,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20return%20this.$items%5BSymbol.toStringTag%5D;%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.set%20=%20function%20(key,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%20undefined%20%7C%7C%20value%20===%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22MapSchema%23set('%22.concat(key,%20%22',%20%22).concat(value,%20%22):%20trying%20to%20set%20%22).concat(value,%20%22%20value%20on%20'%22).concat(key,%20%22'.%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20get%20%22index%22%20for%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20hasIndex%20=%20typeof%20(this.$changes.indexes%5Bkey%5D)%20!==%20%22undefined%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20(hasIndex)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$changes.indexes%5Bkey%5D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this.$refId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(hasIndex)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20exports.OPERATION.REPLACE%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20exports.OPERATION.ADD;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isRef%20=%20(value%5B'$changes'%5D)%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isRef)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20(encoding)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20set%20a%20unique%20id%20to%20relate%20directly%20with%20this%20key/value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!hasIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%5Bkey%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(isRef%20&&%20//%20if%20is%20schema,%20force%20ADD%20operation%20if%20value%20differ%20from%20previous%20one.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.get(key)%20!==%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20operation%20=%20exports.OPERATION.ADD;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.set(key,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(key,%20operation);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.get%20=%20function%20(key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.delete%20=%20function%20(key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20add%20a%20%22purge%22%20method%20after%20.encode()%20runs,%20to%20cleanup%20removed%20%60$indexes%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20We%20don't%20remove%20$indexes%20to%20allow%20setting%20the%20same%20key%20in%20the%20same%20patch%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20(See%20%22should%20allow%20to%20remove%20and%20set%20an%20item%20in%20the%20same%20place%22%20test)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20//%20const%20index%20=%20this.$changes.indexes%5Bkey%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20//%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.clear%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20discard%20previous%20operations.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discard(true,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20previous%20indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20When%20decoding:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20enqueue%20items%20for%20DELETE%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20flag%20child%20items%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeChildRefs.call(this,%20changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.operation(%7B%20index:%200,%20op:%20exports.OPERATION.CLEAR%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20touch%20all%20structures%20until%20reach%20root%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.touchParents();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.has%20=%20function%20(key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.has(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.forEach%20=%20function%20(callbackfn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.forEach(callbackfn);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.entries%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.keys%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.keys();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.values%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.values();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperty(MapSchema.prototype,%20%22size%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.setIndex%20=%20function%20(index,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.getIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(this.$indexes.get(index));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20map%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20map%5Bkey%5D%20=%20(typeof%20(value%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20value%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20map;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Decoding%20utilities%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20MapSchema.prototype.clone%20=%20function%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20client-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20Object.assign(new%20MapSchema(),%20this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20server-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20MapSchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.set(key,%20value%5B'clone'%5D());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.set(key,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20MapSchema;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%20%09%09%20%20%20%20%20%20%20%20var%20registeredTypes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20function%20registerType(identifier,%20definition)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20registeredTypes%5Bidentifier%5D%20=%20definition;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20getType(identifier)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20registeredTypes%5Bidentifier%5D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20var%20SchemaDefinition%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20SchemaDefinition()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20use%20a%20%22field%22%20structure%20combining%20all%20these%20properties%20per-field.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.fieldsByIndex%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.deprecated%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.descriptors%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SchemaDefinition.create%20=%20function%20(parent)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20new%20SchemaDefinition();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20support%20inheritance%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.schema%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.schema%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.indexes%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.indexes%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.fieldsByIndex%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.fieldsByIndex%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.descriptors%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.deprecated%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.deprecated%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SchemaDefinition.prototype.addField%20=%20function%20(field,%20type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.getNextFieldIndex();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.fieldsByIndex%5Bindex%5D%20=%20field;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.indexes%5Bfield%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.schema%5Bfield%5D%20=%20(Array.isArray(type))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20%7B%20array:%20type%5B0%5D%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20type;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SchemaDefinition.prototype.hasField%20=%20function%20(field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.indexes%5Bfield%5D%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SchemaDefinition.prototype.addFilter%20=%20function%20(field,%20cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.filters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.filters%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.indexesWithFilters%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.filters%5Bthis.indexes%5Bfield%5D%5D%20=%20cb;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.indexesWithFilters.push(this.indexes%5Bfield%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SchemaDefinition.prototype.addChildrenFilter%20=%20function%20(field,%20cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.indexes%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20this.schema%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(getType(Object.keys(type)%5B0%5D))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.childFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.childFilters%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.childFilters%5Bindex%5D%20=%20cb;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.warn(%22@filterChildren:%20field%20'%22.concat(field,%20%22'%20can't%20have%20children.%20Ignoring%20filter.%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SchemaDefinition.prototype.getChildrenFilter%20=%20function%20(field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.childFilters%20&&%20this.childFilters%5Bthis.indexes%5Bfield%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SchemaDefinition.prototype.getNextFieldIndex%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Object.keys(this.schema%20%7C%7C%20%7B%7D).length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20SchemaDefinition;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%09%09%20%20%20%20%20%20%20%20function%20hasFilter(klass)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20klass._context%20&&%20klass._context.useFilters;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20Context%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20Context()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.types%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.schemas%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.useFilters%20=%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Context.prototype.has%20=%20function%20(schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.schemas.has(schema);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Context.prototype.get%20=%20function%20(typeid)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.types%5Btypeid%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Context.prototype.add%20=%20function%20(schema,%20typeid)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeid%20===%20void%200)%20%7B%20typeid%20=%20this.schemas.size;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20FIXME:%20move%20this%20to%20somewhere%20else?%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20support%20inheritance%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20schema._definition%20=%20SchemaDefinition.create(schema._definition);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20schema._typeid%20=%20typeid;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.types%5Btypeid%5D%20=%20schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.schemas.set(schema,%20typeid);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Context.create%20=%20function%20(options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20(definition)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!options.context)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20options.context%20=%20new%20Context();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20type(definition,%20options);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Context;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%09%09%20%20%20%20%20%20%20%20var%20globalContext%20=%20new%20Context();%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20%5BSee%20documentation%5D(https://docs.colyseus.io/state/schema/)%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20Annotate%20a%20Schema%20property%20to%20be%20serializeable.%20%09%09%20%20%20%20%20%20%20%20%20*%20%5C@type()'d%20fields%20are%20automatically%20flagged%20as%20%22dirty%22%20for%20the%20next%20patch.%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20@example%20Standard%20usage,%20with%20automatic%20change%20tracking.%20%09%09%20%20%20%20%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20%20%20%20%20*%20%5C@type(%22string%22)%20propertyName:%20string;%20%09%09%20%20%20%20%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20@example%20You%20can%20provide%20the%20%22manual%22%20option%20if%20you'd%20like%20to%20manually%20control%20your%20patches%20via%20.setDirty().%20%09%09%20%20%20%20%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20%20%20%20%20*%20%5C@type(%22string%22,%20%7B%20manual:%20true%20%7D)%20%09%09%20%20%20%20%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20function%20type(type,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20(target,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20context%20=%20options.context%20%7C%7C%20globalContext;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20constructor%20=%20target.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20constructor._context%20=%20context;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22%22.concat(constructor.name,%20%22:%20@type()%20reference%20provided%20for%20%5C%22%22).concat(field,%20%22%5C%22%20is%20undefined.%20Make%20sure%20you%20don't%20have%20any%20circular%20dependencies.%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%20static%20schema%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!context.has(constructor))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20context.add(constructor);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20constructor._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.addField(field,%20type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%20skip%20if%20descriptor%20already%20exists%20for%20this%20field%20(%60@deprecated()%60)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(definition.descriptors%5Bfield%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(definition.deprecated%5Bfield%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20do%20not%20create%20accessors%20for%20deprecated%20properties.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20trying%20to%20define%20same%20property%20multiple%20times%20across%20inheritance.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20https://github.com/colyseus/colyseus-unity3d/issues/131%23issuecomment-814308572%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22@colyseus/schema:%20Duplicate%20'%22.concat(field,%20%22'%20definition%20on%20'%22).concat(constructor.name,%20%22'.%5CnCheck%20@type()%20annotation%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20catch%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definitionAtLine%20=%20e.stack.split(%22%5Cn%22)%5B4%5D.trim();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22%22.concat(e.message,%20%22%20%22).concat(definitionAtLine));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isArray%20=%20ArraySchema.is(type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isMap%20=%20!isArray%20&&%20MapSchema.is(type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20me.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Allow%20abstract%20intermediary%20classes%20with%20no%20fields%20to%20be%20serialized%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20(See%20%22should%20support%20an%20inheritance%20with%20a%20Schema%20type%20without%20fields%22%20test)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(type)%20!==%20%22string%22%20&&%20!Schema.is(type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20childType%20=%20Object.values(type)%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(childType)%20!==%20%22string%22%20&&%20!context.has(childType))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20context.add(childType);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(options.manual)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20do%20not%20declare%20getter/setter%20descriptor%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%5Bfield%5D%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldCached%20=%20%22_%22.concat(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%5BfieldCached%5D%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%5Bfield%5D%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this%5BfieldCached%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Create%20Proxy%20for%20array%20or%20map%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20skip%20if%20value%20is%20the%20same%20as%20cached.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%20this%5BfieldCached%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20!==%20undefined%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20!==%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20automaticallty%20transform%20Array%20into%20ArraySchema%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isArray%20&&%20!(value%20instanceof%20ArraySchema))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20value,%20false)))();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20automaticallty%20transform%20Map%20into%20MapSchema%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isMap%20&&%20!(value%20instanceof%20MapSchema))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20new%20MapSchema(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20try%20to%20turn%20provided%20structure%20into%20a%20Proxy%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$proxy'%5D%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isMap)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20getMapProxy(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(isArray)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20getArrayProxy(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20flag%20the%20change%20for%20encoding.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20call%20setParent()%20recursively%20for%20this%20and%20its%20child%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20structures.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20this._definition.indexes%5Bfield%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(this%5BfieldCached%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Setting%20a%20field%20to%20%60null%60%20or%20%60undefined%60%20will%20delete%20it.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%5BfieldCached%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20%60@filter()%60%20decorator%20for%20defining%20data%20filters%20per%20client%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20function%20filter(cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20(target,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20constructor%20=%20target.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20constructor._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(definition.addFilter(field,%20cb))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20constructor._context.useFilters%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20filterChildren(cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20(target,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20constructor%20=%20target.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20constructor._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(definition.addChildrenFilter(field,%20cb))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20constructor._context.useFilters%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20%60@deprecated()%60%20flag%20a%20field%20as%20deprecated.%20%09%09%20%20%20%20%20%20%20%20%20*%20The%20previous%20%60@type()%60%20annotation%20should%20remain%20along%20with%20this%20one.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20function%20deprecated(throws)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(throws%20===%20void%200)%20%7B%20throws%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20(target,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20constructor%20=%20target.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20constructor._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.deprecated%5Bfield%5D%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(throws)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%5Bfield%5D%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20throw%20new%20Error(%22%22.concat(field,%20%22%20is%20deprecated.%22));%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(value)%20%7B%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20defineTypes(target,%20fields,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!options.context)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20options.context%20=%20target._context%20%7C%7C%20options.context%20%7C%7C%20globalContext;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20field%20in%20fields)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(fields%5Bfield%5D,%20options)(target.prototype,%20field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20target;%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Copyright%20(c)%202018%20Endel%20Dreyer%20%09%09%20%20%20%20%20%20%20%20%20*%20Copyright%20(c)%202014%20Ion%20Drive%20Software%20Ltd.%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20Permission%20is%20hereby%20granted,%20free%20of%20charge,%20to%20any%20person%20obtaining%20a%20copy%20%09%09%20%20%20%20%20%20%20%20%20*%20of%20this%20software%20and%20associated%20documentation%20files%20(the%20%22Software%22),%20to%20deal%20%09%09%20%20%20%20%20%20%20%20%20*%20in%20the%20Software%20without%20restriction,%20including%20without%20limitation%20the%20rights%20%09%09%20%20%20%20%20%20%20%20%20*%20to%20use,%20copy,%20modify,%20merge,%20publish,%20distribute,%20sublicense,%20and/or%20sell%20%09%09%20%20%20%20%20%20%20%20%20*%20copies%20of%20the%20Software,%20and%20to%20permit%20persons%20to%20whom%20the%20Software%20is%20%09%09%20%20%20%20%20%20%20%20%20*%20furnished%20to%20do%20so,%20subject%20to%20the%20following%20conditions:%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20The%20above%20copyright%20notice%20and%20this%20permission%20notice%20shall%20be%20included%20in%20all%20%09%09%20%20%20%20%20%20%20%20%20*%20copies%20or%20substantial%20portions%20of%20the%20Software.%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22,%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND,%20EXPRESS%20OR%20%09%09%20%20%20%20%20%20%20%20%20*%20IMPLIED,%20INCLUDING%20BUT%20NOT%20LIMITED%20TO%20THE%20WARRANTIES%20OF%20MERCHANTABILITY,%20%09%09%20%20%20%20%20%20%20%20%20*%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE%20AND%20NONINFRINGEMENT.%20IN%20NO%20EVENT%20SHALL%20THE%20%09%09%20%20%20%20%20%20%20%20%20*%20AUTHORS%20OR%20COPYRIGHT%20HOLDERS%20BE%20LIABLE%20FOR%20ANY%20CLAIM,%20DAMAGES%20OR%20OTHER%20%09%09%20%20%20%20%20%20%20%20%20*%20LIABILITY,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20TORT%20OR%20OTHERWISE,%20ARISING%20FROM,%20%09%09%20%20%20%20%20%20%20%20%20*%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20SOFTWARE%20OR%20THE%20USE%20OR%20OTHER%20DEALINGS%20IN%20THE%20%09%09%20%20%20%20%20%20%20%20%20*%20SOFTWARE%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20msgpack%20implementation%20highly%20based%20on%20notepack.io%20%09%09%20%20%20%20%20%20%20%20%20*%20https://github.com/darrachequesne/notepack%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20function%20utf8Length(str)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20c%20=%200,%20length%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20length;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20utf8Write(view,%20offset,%20str)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20c%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%20c;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200xc0%20%7C%20(c%20%3E%3E%206);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200xe0%20%7C%20(c%20%3E%3E%2012);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20%3E%3E%206%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c%20=%200x10000%20+%20(((c%20&%200x3ff)%20%3C%3C%2010)%20%7C%20(str.charCodeAt(i)%20&%200x3ff));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200xf0%20%7C%20(c%20%3E%3E%2018);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20%3E%3E%2012%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20%3E%3E%206%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20int8$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20uint8$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20int16$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%208)%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20uint16$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%208)%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20int32$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%208)%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%2016)%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%2024)%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20uint32$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20b4%20=%20value%20%3E%3E%2024;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20b3%20=%20value%20%3E%3E%2016;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20b2%20=%20value%20%3E%3E%208;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20b1%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(b1%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(b2%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(b3%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(b4%20&%20255);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20int64$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20high%20=%20Math.floor(value%20/%20Math.pow(2,%2032));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20low%20=%20value%20%3E%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint32$1(bytes,%20low);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint32$1(bytes,%20high);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20uint64$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20high%20=%20(value%20/%20Math.pow(2,%2032))%20%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20low%20=%20value%20%3E%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint32$1(bytes,%20low);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint32$1(bytes,%20high);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20float32$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20writeFloat32(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20float64$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20writeFloat64(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20_int32$1%20=%20new%20Int32Array(2);%20%09%09%20%20%20%20%20%20%20%20var%20_float32$1%20=%20new%20Float32Array(_int32$1.buffer);%20%09%09%20%20%20%20%20%20%20%20var%20_float64$1%20=%20new%20Float64Array(_int32$1.buffer);%20%09%09%20%20%20%20%20%20%20%20function%20writeFloat32(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_float32$1%5B0%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int32$1(bytes,%20_int32$1%5B0%5D);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20writeFloat64(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_float64$1%5B0%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int32$1(bytes,%20_int32$1%5B0%20%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int32$1(bytes,%20_int32$1%5B1%20%5D);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20boolean$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20uint8$1(bytes,%20value%20?%201%20:%200);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20string$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20encode%20%60null%60%20strings%20as%20empty.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20%22%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20length%20=%20utf8Length(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20size%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixstr%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(length%20%3C%200x20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(length%20%7C%200xa0);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd9);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xda);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint16$1(bytes,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdb);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint32$1(bytes,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('String%20too%20long');%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20utf8Write(bytes,%20bytes.length,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20size%20+%20length;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20number$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(isNaN(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20number$1(bytes,%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(!isFinite(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20number$1(bytes,%20(value%20%3E%200)%20?%20Number.MAX_SAFE_INTEGER%20:%20-Number.MAX_SAFE_INTEGER);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(value%20!==%20(value%20%7C%200))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcb);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writeFloat64(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20encode%20float%2032?%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20is%20it%20possible%20to%20differentiate%20between%20float32%20/%20float64%20here?%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20//%20float%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20bytes.push(0xca);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20writeFloat32(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20return%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20positive%20fixnum%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x100)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcc);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcd);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint16$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xce);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint32$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcf);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint64$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20negative%20fixnum%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xe0%20%7C%20(value%20+%200x20));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd0);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int8$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x8000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int16$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x80000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd2);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int32$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd3);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int64$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20var%20encode%20=%20/*%23__PURE__*/Object.freeze(%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__proto__:%20null,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20utf8Write:%20utf8Write,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int8:%20int8$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint8:%20uint8$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int16:%20int16$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint16:%20uint16$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int32:%20int32$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint32:%20uint32$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int64:%20int64$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint64:%20uint64$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20float32:%20float32$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20float64:%20float64$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20writeFloat32:%20writeFloat32,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20writeFloat64:%20writeFloat64,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20boolean:%20boolean$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20string:%20string$1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20number:%20number$1%20%09%09%20%20%20%20%20%20%20%20%7D);%20%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Copyright%20(c)%202018%20Endel%20Dreyer%20%09%09%20%20%20%20%20%20%20%20%20*%20Copyright%20(c)%202014%20Ion%20Drive%20Software%20Ltd.%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20Permission%20is%20hereby%20granted,%20free%20of%20charge,%20to%20any%20person%20obtaining%20a%20copy%20%09%09%20%20%20%20%20%20%20%20%20*%20of%20this%20software%20and%20associated%20documentation%20files%20(the%20%22Software%22),%20to%20deal%20%09%09%20%20%20%20%20%20%20%20%20*%20in%20the%20Software%20without%20restriction,%20including%20without%20limitation%20the%20rights%20%09%09%20%20%20%20%20%20%20%20%20*%20to%20use,%20copy,%20modify,%20merge,%20publish,%20distribute,%20sublicense,%20and/or%20sell%20%09%09%20%20%20%20%20%20%20%20%20*%20copies%20of%20the%20Software,%20and%20to%20permit%20persons%20to%20whom%20the%20Software%20is%20%09%09%20%20%20%20%20%20%20%20%20*%20furnished%20to%20do%20so,%20subject%20to%20the%20following%20conditions:%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20The%20above%20copyright%20notice%20and%20this%20permission%20notice%20shall%20be%20included%20in%20all%20%09%09%20%20%20%20%20%20%20%20%20*%20copies%20or%20substantial%20portions%20of%20the%20Software.%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22,%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND,%20EXPRESS%20OR%20%09%09%20%20%20%20%20%20%20%20%20*%20IMPLIED,%20INCLUDING%20BUT%20NOT%20LIMITED%20TO%20THE%20WARRANTIES%20OF%20MERCHANTABILITY,%20%09%09%20%20%20%20%20%20%20%20%20*%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE%20AND%20NONINFRINGEMENT.%20IN%20NO%20EVENT%20SHALL%20THE%20%09%09%20%20%20%20%20%20%20%20%20*%20AUTHORS%20OR%20COPYRIGHT%20HOLDERS%20BE%20LIABLE%20FOR%20ANY%20CLAIM,%20DAMAGES%20OR%20OTHER%20%09%09%20%20%20%20%20%20%20%20%20*%20LIABILITY,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20TORT%20OR%20OTHERWISE,%20ARISING%20FROM,%20%09%09%20%20%20%20%20%20%20%20%20*%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20SOFTWARE%20OR%20THE%20USE%20OR%20OTHER%20DEALINGS%20IN%20THE%20%09%09%20%20%20%20%20%20%20%20%20*%20SOFTWARE%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20function%20utf8Read(bytes,%20offset,%20length)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20string%20=%20'',%20chr%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%20offset,%20end%20=%20offset%20+%20length;%20i%20%3C%20end;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20byte%20=%20bytes%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200x80)%20===%200x00)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(byte);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xe0)%20===%200xc0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x1f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(bytes%5B++i%5D%20&%200x3f));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xf0)%20===%200xe0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x0f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%200));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xf8)%20===%200xf0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20=%20((byte%20&%200x07)%20%3C%3C%2018)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(chr%20%3E=%200x010000)%20%7B%20//%20surrogate%20pair%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20-=%200x010000;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode((chr%20%3E%3E%3E%2010)%20+%200xD800,%20(chr%20&%200x3FF)%20+%200xDC00);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(chr);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.error('Invalid%20byte%20'%20+%20byte.toString(16));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20(do%20not%20throw%20error%20to%20avoid%20server/client%20from%20crashing%20due%20to%20hack%20attemps)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20throw%20new%20Error('Invalid%20byte%20'%20+%20byte.toString(16));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20string;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20int8(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20uint8(bytes,%20it)%20%3C%3C%2024%20%3E%3E%2024;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20uint8(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20bytes%5Bit.offset++%5D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20int16(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20uint16(bytes,%20it)%20%3C%3C%2016%20%3E%3E%2016;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20uint16(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20bytes%5Bit.offset++%5D%20%7C%20bytes%5Bit.offset++%5D%20%3C%3C%208;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20int32(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20bytes%5Bit.offset++%5D%20%7C%20bytes%5Bit.offset++%5D%20%3C%3C%208%20%7C%20bytes%5Bit.offset++%5D%20%3C%3C%2016%20%7C%20bytes%5Bit.offset++%5D%20%3C%3C%2024;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20uint32(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20int32(bytes,%20it)%20%3E%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20float32(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20readFloat32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20float64(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20readFloat64(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20int64(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20low%20=%20uint32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20high%20=%20int32(bytes,%20it)%20*%20Math.pow(2,%2032);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20high%20+%20low;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20uint64(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20low%20=%20uint32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20high%20=%20uint32(bytes,%20it)%20*%20Math.pow(2,%2032);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20high%20+%20low;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20_int32%20=%20new%20Int32Array(2);%20%09%09%20%20%20%20%20%20%20%20var%20_float32%20=%20new%20Float32Array(_int32.buffer);%20%09%09%20%20%20%20%20%20%20%20var%20_float64%20=%20new%20Float64Array(_int32.buffer);%20%09%09%20%20%20%20%20%20%20%20function%20readFloat32(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_int32%5B0%5D%20=%20int32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_float32%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20readFloat64(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_int32%5B0%20%5D%20=%20int32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_int32%5B1%20%5D%20=%20int32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_float64%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20boolean(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20uint8(bytes,%20it)%20%3E%200;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20string(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20prefix%20=%20bytes%5Bit.offset++%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200xc0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20fixstr%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20prefix%20&%200x1f;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd9)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20uint8(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xda)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20uint16(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xdb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20uint32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20utf8Read(bytes,%20it.offset,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20it.offset%20+=%20length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20stringCheck(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20prefix%20=%20bytes%5Bit.offset%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixstr%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20(prefix%20%3C%200xc0%20&&%20prefix%20%3E%200xa0)%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20str%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prefix%20===%200xd9%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20str%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prefix%20===%200xda%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20str%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prefix%20===%200xdb);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20number(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20prefix%20=%20bytes%5Bit.offset++%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20positive%20fixint%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20prefix;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xca)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20float%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20readFloat32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xcb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20float%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20readFloat64(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xcc)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20uint8(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xcd)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20uint16(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xce)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20uint32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xcf)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20uint64(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20int8(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd1)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20int16(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd2)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20int32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd3)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20int64(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(prefix%20%3E%200xdf)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20negative%20fixint%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(0xff%20-%20prefix%20+%201)%20*%20-1;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20numberCheck(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20prefix%20=%20bytes%5Bit.offset%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20positive%20fixint%20-%200x00%20-%200x7f%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20float%2032%20%20%20%20%20%20%20%20-%200xca%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20float%2064%20%20%20%20%20%20%20%20-%200xcb%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%208%20%20%20%20%20%20%20%20%20%20-%200xcc%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2016%20%20%20%20%20%20%20%20%20-%200xcd%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2032%20%20%20%20%20%20%20%20%20-%200xce%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2064%20%20%20%20%20%20%20%20%20-%200xcf%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%208%20%20%20%20%20%20%20%20%20%20%20-%200xd0%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2016%20%20%20%20%20%20%20%20%20%20-%200xd1%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2032%20%20%20%20%20%20%20%20%20%20-%200xd2%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2064%20%20%20%20%20%20%20%20%20%20-%200xd3%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(prefix%20%3C%200x80%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(prefix%20%3E=%200xca%20&&%20prefix%20%3C=%200xd3));%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20arrayCheck(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20bytes%5Bit.offset%5D%20%3C%200xa0;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20prefix%20=%20bytes%5Bit.offset%5D%20;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20(prefix%20%3C%200xa0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20return%20prefix;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20//%20array%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D%20else%20if%20(prefix%20===%200xdc)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20it.offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D%20else%20if%20(0xdd)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20it.offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20return%20prefix;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20switchStructureCheck(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20previous%20byte%20should%20be%20%60SWITCH_TO_STRUCTURE%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes%5Bit.offset%20-%201%5D%20===%20SWITCH_TO_STRUCTURE%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20next%20byte%20should%20be%20a%20number%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(bytes%5Bit.offset%5D%20%3C%200x80%20%7C%7C%20(bytes%5Bit.offset%5D%20%3E=%200xca%20&&%20bytes%5Bit.offset%5D%20%3C=%200xd3)));%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20var%20decode%20=%20/*%23__PURE__*/Object.freeze(%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__proto__:%20null,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int8:%20int8,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint8:%20uint8,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int16:%20int16,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint16:%20uint16,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int32:%20int32,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint32:%20uint32,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20float32:%20float32,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20float64:%20float64,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int64:%20int64,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint64:%20uint64,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20readFloat32:%20readFloat32,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20readFloat64:%20readFloat64,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20boolean:%20boolean,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20string:%20string,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20stringCheck:%20stringCheck,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20number:%20number,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20numberCheck:%20numberCheck,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20arrayCheck:%20arrayCheck,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20switchStructureCheck:%20switchStructureCheck%20%09%09%20%20%20%20%20%20%20%20%7D);%20%20%09%09%20%20%20%20%20%20%20%20var%20CollectionSchema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20CollectionSchema(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes%20=%20new%20ChangeTree(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialValues.forEach(function%20(v)%20%7B%20return%20_this.add(v);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.onAdd%20=%20function%20(callback,%20triggerAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(triggerAll%20===%20void%200)%20%7B%20triggerAll%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D)),%20exports.OPERATION.ADD,%20callback,%20(triggerAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.onRemove%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.DELETE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.onChange%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.REPLACE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20type%5B'collection'%5D%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.add%20=%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20set%20%22index%22%20for%20reference.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.$refId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isRef%20=%20(value%5B'$changes'%5D)%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isRef)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%5Bindex%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.set(index,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.at%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20Array.from(this.$items.keys())%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.entries%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.delete%20=%20function%20(item)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20entries%20=%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20entry;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(entry%20=%20entries.next())%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(entry.done)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(item%20===%20entry.value%5B1%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20index%20=%20entry.value%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.clear%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20discard%20previous%20operations.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discard(true,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20previous%20indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20When%20decoding:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20enqueue%20items%20for%20DELETE%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20flag%20child%20items%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeChildRefs.call(this,%20changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.operation(%7B%20index:%200,%20op:%20exports.OPERATION.CLEAR%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20touch%20all%20structures%20until%20reach%20root%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.touchParents();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.has%20=%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).some(function%20(v)%20%7B%20return%20v%20===%20value;%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.forEach%20=%20function%20(callbackfn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.forEach(function%20(value,%20key,%20_)%20%7B%20return%20callbackfn(value,%20key,%20_this);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.values%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.values();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperty(CollectionSchema.prototype,%20%22size%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.setIndex%20=%20function%20(index,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.getIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(this.$indexes.get(index));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.toArray%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20values%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20values.push((typeof%20(value%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20value%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20values;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Decoding%20utilities%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20CollectionSchema.prototype.clone%20=%20function%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20client-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20Object.assign(new%20CollectionSchema(),%20this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20server-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20CollectionSchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.add(value%5B'clone'%5D());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.add(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20CollectionSchema;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%20%09%09%20%20%20%20%20%20%20%20var%20SetSchema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20SetSchema(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes%20=%20new%20ChangeTree(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialValues.forEach(function%20(v)%20%7B%20return%20_this.add(v);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.onAdd%20=%20function%20(callback,%20triggerAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(triggerAll%20===%20void%200)%20%7B%20triggerAll%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D)),%20exports.OPERATION.ADD,%20callback,%20(triggerAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.onRemove%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.DELETE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.onChange%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.REPLACE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20type%5B'set'%5D%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.add%20=%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20immediatelly%20return%20false%20if%20value%20already%20added.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.has(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20set%20%22index%22%20for%20reference.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.$refId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((value%5B'$changes'%5D)%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(_b%20=%20(_a%20=%20this.$changes.indexes%5Bindex%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.op)%20!==%20null%20&&%20_b%20!==%20void%200%20?%20_b%20:%20exports.OPERATION.ADD;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%5Bindex%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.set(index,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(index,%20operation);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.entries%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.delete%20=%20function%20(item)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20entries%20=%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20entry;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(entry%20=%20entries.next())%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(entry.done)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(item%20===%20entry.value%5B1%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20index%20=%20entry.value%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.clear%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20discard%20previous%20operations.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discard(true,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20previous%20indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20When%20decoding:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20enqueue%20items%20for%20DELETE%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20flag%20child%20items%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeChildRefs.call(this,%20changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.operation(%7B%20index:%200,%20op:%20exports.OPERATION.CLEAR%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20touch%20all%20structures%20until%20reach%20root%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.touchParents();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.has%20=%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20values%20=%20this.$items.values();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20has%20=%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20entry;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(entry%20=%20values.next())%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(entry.done)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%20entry.value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20has%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20has;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.forEach%20=%20function%20(callbackfn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.forEach(function%20(value,%20key,%20_)%20%7B%20return%20callbackfn(value,%20key,%20_this);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.values%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.values();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperty(SetSchema.prototype,%20%22size%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.setIndex%20=%20function%20(index,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.getIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(this.$indexes.get(index));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.toArray%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20values%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20values.push((typeof%20(value%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20value%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20values;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Decoding%20utilities%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20SetSchema.prototype.clone%20=%20function%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20client-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20Object.assign(new%20SetSchema(),%20this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20server-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20SetSchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.add(value%5B'clone'%5D());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.add(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20SetSchema;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%20%09%09%20%20%20%20%20%20%20%20var%20ClientState%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20ClientState()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refIds%20=%20new%20WeakSet();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.containerIndexes%20=%20new%20WeakMap();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20containerIndexes%20=%20new%20Map%3CChangeTree,%20Set%3Cnumber%3E%3E();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ClientState.prototype.addRefId%20=%20function%20(changeTree)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.refIds.has(changeTree))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refIds.add(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.containerIndexes.set(changeTree,%20new%20Set());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ClientState.get%20=%20function%20(client)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(client.$filterState%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20client.$filterState%20=%20new%20ClientState();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20client.$filterState;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20ClientState;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%20%09%09%20%20%20%20%20%20%20%20var%20ReferenceTracker%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20ReferenceTracker()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Relation%20of%20refId%20=%3E%20Schema%20structure%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20For%20direct%20access%20of%20structures%20during%20decoding%20time.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refs%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refCounts%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs%20=%20new%20Set();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.nextUniqueId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ReferenceTracker.prototype.getNextUniqueId%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.nextUniqueId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20for%20decoding%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ReferenceTracker.prototype.addRef%20=%20function%20(refId,%20ref,%20incrementCount)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(incrementCount%20===%20void%200)%20%7B%20incrementCount%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refs.set(refId,%20ref);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(incrementCount)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refCounts%5BrefId%5D%20=%20(this.refCounts%5BrefId%5D%20%7C%7C%200)%20+%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20for%20decoding%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ReferenceTracker.prototype.removeRef%20=%20function%20(refId)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refCounts%5BrefId%5D%20=%20this.refCounts%5BrefId%5D%20-%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs.add(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ReferenceTracker.prototype.clearRefs%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refs.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refCounts%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20for%20decoding%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20ReferenceTracker.prototype.garbageCollectDeletedRefs%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs.forEach(function%20(refId)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Skip%20active%20references.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(_this.refCounts%5BrefId%5D%20%3E%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20_this.refs.get(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Ensure%20child%20schema%20instances%20have%20their%20references%20removed%20as%20well.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20fieldName%20in%20ref%5B'_definition'%5D.schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(ref%5B'_definition'%5D.schema%5BfieldName%5D)%20!==%20%22string%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5BfieldName%5D%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5BfieldName%5D%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.removeRef(ref%5BfieldName%5D%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20ref%5B'$changes'%5D.parent._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20definition.schema%5Bdefinition.fieldsByIndex%5Bref%5B'$changes'%5D.parentIndex%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(Object.values(type)%5B0%5D)%20===%20%22function%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Array.from(ref.values())%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.forEach(function%20(child)%20%7B%20return%20_this.removeRef(child%5B'$changes'%5D.refId);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.refs.delete(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20delete%20_this.refCounts%5BrefId%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20deleted%20refs.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20ReferenceTracker;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%20%09%09%20%20%20%20%20%20%20%20var%20EncodeSchemaError%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__extends(EncodeSchemaError,%20_super);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20EncodeSchemaError()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20EncodeSchemaError;%20%09%09%20%20%20%20%20%20%20%20%7D(Error));%20%09%09%20%20%20%20%20%20%20%20function%20assertType(value,%20type,%20klass,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20typeofTarget;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20allowNull%20=%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20switch%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22number%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22int8%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22uint8%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22int16%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22uint16%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22int32%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22uint32%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22int64%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22uint64%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22float32%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22float64%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeofTarget%20=%20%22number%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isNaN(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(%22trying%20to%20encode%20%5C%22NaN%5C%22%20in%20%22.concat(klass.constructor.name,%20%22%23%22).concat(field));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22string%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeofTarget%20=%20%22string%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20allowNull%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22boolean%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20boolean%20is%20always%20encoded%20as%20true/false%20based%20on%20truthiness%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(value)%20!==%20typeofTarget%20&&%20(!allowNull%20%7C%7C%20(allowNull%20&&%20value%20!==%20null)))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20foundValue%20=%20%22'%22.concat(JSON.stringify(value),%20%22'%22).concat((value%20&&%20value.constructor%20&&%20%22%20(%22.concat(value.constructor.name,%20%22)%22))%20%7C%7C%20'');%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20EncodeSchemaError(%22a%20'%22.concat(typeofTarget,%20%22'%20was%20expected,%20but%20%22).concat(foundValue,%20%22%20was%20provided%20in%20%22).concat(klass.constructor.name,%20%22%23%22).concat(field));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20assertInstanceType(value,%20type,%20klass,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!(value%20instanceof%20type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20EncodeSchemaError(%22a%20'%22.concat(type.name,%20%22'%20was%20expected,%20but%20'%22).concat(value.constructor.name,%20%22'%20was%20provided%20in%20%22).concat(klass.constructor.name,%20%22%23%22).concat(field));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20encodePrimitiveType(type,%20bytes,%20value,%20klass,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20assertType(value,%20type,%20klass,%20field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20encodeFunc%20=%20encode%5Btype%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(encodeFunc)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20encodeFunc(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20EncodeSchemaError(%22a%20'%22.concat(type,%20%22'%20was%20expected,%20but%20%22).concat(value,%20%22%20was%20provided%20in%20%22).concat(klass.constructor.name,%20%22%23%22).concat(field));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20function%20decodePrimitiveType(type,%20bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20decode%5Btype%5D(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Schema%20encoder%20/%20decoder%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20var%20Schema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20allow%20inherited%20classes%20to%20have%20a%20constructor%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20Schema()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20args%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20fix%20enumerability%20of%20fields%20for%20end-user%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperties(this,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$changes:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20new%20ChangeTree(this,%20undefined,%20new%20ReferenceTracker()),%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20$listeners:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20value:%20undefined,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20writable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$callbacks:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20undefined,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20descriptors%20=%20this._definition.descriptors;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(descriptors)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperties(this,%20descriptors);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Assign%20initial%20values%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(args%5B0%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.assign(args%5B0%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.onError%20=%20function%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.error(e);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(type%5B'_definition'%5D%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%5B'_definition'%5D.schema%20!==%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.onChange%20=%20function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D)),%20exports.OPERATION.REPLACE,%20callback);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.onRemove%20=%20function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D)),%20exports.OPERATION.DELETE,%20callback);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.assign%20=%20function%20(props)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Object.assign(this,%20props);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperty(Schema.prototype,%20%22_definition%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20return%20this.constructor._definition;%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20(Server-side):%20Flag%20a%20property%20to%20be%20encoded%20for%20the%20next%20patch.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20instance%20Schema%20instance%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20property%20string%20representing%20the%20property%20name,%20or%20number%20representing%20the%20index%20of%20the%20property.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20operation%20OPERATION%20to%20perform%20(detected%20automatically)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.setDirty%20=%20function%20(property,%20operation)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(property,%20operation);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Client-side:%20listen%20for%20changes%20on%20property.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20prop%20the%20property%20name%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20callback%20callback%20to%20be%20triggered%20on%20property%20change%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20@param%20immediate%20trigger%20immediatelly%20if%20property%20has%20been%20already%20set.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.listen%20=%20function%20(prop,%20callback,%20immediate)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(immediate%20===%20void%200)%20%7B%20immediate%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.$callbacks)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$callbacks%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.$callbacks%5Bprop%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$callbacks%5Bprop%5D%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$callbacks%5Bprop%5D.push(callback);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(immediate%20&&%20this%5Bprop%5D%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20callback(this%5Bprop%5D,%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20return%20un-register%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20()%20%7B%20return%20spliceOne(_this.$callbacks%5Bprop%5D,%20_this.$callbacks%5Bprop%5D.indexOf(callback));%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.decode%20=%20function%20(bytes,%20it,%20ref)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(it%20===%20void%200)%20%7B%20it%20=%20%7B%20offset:%200%20%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20===%20void%200)%20%7B%20ref%20=%20this;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20allChanges%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20$root%20=%20this.$changes.root;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20totalBytes%20=%20bytes.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.refs.set(refId,%20this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(it.offset%20%3C%20totalBytes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20byte%20=%20bytes%5Bit.offset++%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(byte%20==%20SWITCH_TO_STRUCTURE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId%20=%20number(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20nextRef%20=%20$root.refs.get(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Trying%20to%20access%20a%20reference%20that%20haven't%20been%20decoded%20yet.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!nextRef)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22%5C%22refId%5C%22%20not%20found:%20%22.concat(refId));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%20=%20nextRef;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTree%20=%20ref%5B'$changes'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isSchema%20=%20(ref%5B'_definition'%5D%20!==%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(isSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20(byte%20%3E%3E%206)%20%3C%3C%206%20//%20%22compressed%22%20index%20+%20operation%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20byte;%20//%20%22uncompressed%22%20index%20+%20operation%20(array/map%20items)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation%20===%20exports.OPERATION.CLEAR)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20me!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20The%20%60.clear()%60%20method%20is%20calling%20%60$root.removeRef(refId)%60%20for%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20each%20item%20inside%20this%20collection%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref.clear(allChanges);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldIndex%20=%20(isSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20byte%20%25%20(operation%20%7C%7C%20255)%20//%20if%20%22REPLACE%22%20operation%20(0),%20use%20255%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20number(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldName%20=%20(isSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20(ref%5B'_definition'%5D.fieldsByIndex%5BfieldIndex%5D)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20%22%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20changeTree.getType(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20previousValue%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20dynamicIndex%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue%20=%20ref%5B'getByIndex'%5D(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((operation%20&%20exports.OPERATION.ADD)%20===%20exports.OPERATION.ADD)%20%7B%20//%20ADD%20or%20DELETE_AND_ADD%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dynamicIndex%20=%20(ref%20instanceof%20MapSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20string(bytes,%20it)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20fieldIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'setIndex'%5D(fieldIndex,%20dynamicIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20here%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dynamicIndex%20=%20ref%5B'getIndex'%5D(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue%20=%20ref%5B%22_%22.concat(fieldName)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Delete%20operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((operation%20&%20exports.OPERATION.DELETE)%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation%20!==%20exports.OPERATION.DELETE_AND_ADD)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'deleteByIndex'%5D(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Flag%20%60refId%60%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%20&&%20previousValue%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.removeRef(previousValue%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20null;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(fieldName%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.warn(%22@colyseus/schema:%20definition%20mismatch%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20keep%20skipping%20next%20bytes%20until%20reaches%20a%20known%20structure%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20by%20local%20decoder.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20nextIterator%20=%20%7B%20offset:%20it.offset%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(it.offset%20%3C%20totalBytes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(switchStructureCheck(bytes,%20it))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nextIterator.offset%20=%20it.offset%20+%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20($root.refs.has(number(bytes,%20nextIterator)))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20it.offset++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(operation%20===%20exports.OPERATION.DELETE)%20;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(Schema.is(type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refId_1%20=%20number(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20$root.refs.get(refId_1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation%20!==%20exports.OPERATION.REPLACE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20childType%20=%20this.getSchemaType(bytes,%20it,%20type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this.createTypeInstance(childType);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value.$changes.refId%20=%20refId_1;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value.$callbacks%20=%20previousValue.$callbacks;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20value.$listeners%20=%20previousValue.$listeners;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%5B'$changes'%5D.refId%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId_1%20!==%20previousValue%5B'$changes'%5D.refId)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.removeRef(previousValue%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.addRef(refId_1,%20value,%20(value%20!==%20previousValue));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(typeof%20(type)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20primitive%20value%20(number,%20string,%20boolean,%20etc)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20decodePrimitiveType(type,%20bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20typeDef%20=%20getType(Object.keys(type)%5B0%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refId_2%20=%20number(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20valueRef%20=%20($root.refs.has(refId_2))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20previousValue%20%7C%7C%20$root.refs.get(refId_2)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20new%20typeDef.constructor();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20valueRef.clone(true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value.$changes.refId%20=%20refId_2;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20preserve%20schema%20callbacks%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$callbacks'%5D%20=%20previousValue%5B'$callbacks'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%5B'$changes'%5D.refId%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId_2%20!==%20previousValue%5B'$changes'%5D.refId)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.removeRef(previousValue%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Trigger%20onRemove%20if%20structure%20has%20been%20replaced.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20entries%20=%20previousValue.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20iter%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20((iter%20=%20entries.next())%20&&%20!iter.done)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20(_a%20=%20iter.value,%20_a%5B0%5D),%20value_1%20=%20_a%5B1%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20allChanges.push(%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId:%20refId_2,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op:%20exports.OPERATION.DELETE,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field:%20key,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20undefined,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue:%20value_1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.addRef(refId_2,%20value,%20(valueRef%20!==%20previousValue));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20!==%20null%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(changeTree.ref,%20changeTree.root,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5BfieldName%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ref%5B%60_$%7BfieldName%7D%60%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(ref%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20key%20=%20ref%5B'$indexes'%5D.get(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20dynamicIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ref.set(key,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'$items'%5D.set(key,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'$changes'%5D.allChanges.add(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(ref%20instanceof%20ArraySchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20key%20=%20ref%5B'$indexes'%5D%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log(%22SETTING%20FOR%20ArraySchema%20=%3E%22,%20%7B%20field,%20key,%20value%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ref%5Bkey%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref.setAt(fieldIndex,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(ref%20instanceof%20CollectionSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20ref.add(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'setIndex'%5D(fieldIndex,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(ref%20instanceof%20SetSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20ref.add(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20!==%20false)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'setIndex'%5D(fieldIndex,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%20!==%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20allChanges.push(%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId:%20refId,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op:%20operation,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field:%20fieldName,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dynamicIndex:%20dynamicIndex,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20value,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue:%20previousValue,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this._triggerChanges(allChanges);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20drop%20references%20of%20unused%20schemas%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.garbageCollectDeletedRefs();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20allChanges;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.encode%20=%20function%20(encodeAll,%20bytes,%20useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(encodeAll%20===%20void%200)%20%7B%20encodeAll%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(bytes%20===%20void%200)%20%7B%20bytes%20=%20%5B%5D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(useFilters%20===%20void%200)%20%7B%20useFilters%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rootChangeTree%20=%20this.$changes;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refIdsVisited%20=%20new%20WeakSet();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTrees%20=%20%5BrootChangeTree%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20numChangeTrees%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20numChangeTrees;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTree%20=%20changeTrees%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20changeTree.ref;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isSchema%20=%20(ref%20instanceof%20Schema);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Generate%20unique%20refId%20for%20the%20ChangeTree.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.ensureRefId();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20mark%20this%20ChangeTree%20as%20visited.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refIdsVisited.add(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20root%20%60refId%60%20is%20skipped.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(changeTree%20!==%20rootChangeTree%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(changeTree.changed%20%7C%7C%20encodeAll))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20SWITCH_TO_STRUCTURE);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20changeTree.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changes%20=%20(encodeAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20Array.from(changeTree.allChanges)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20Array.from(changeTree.changes.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20j%20=%200,%20cl%20=%20changes.length;%20j%20%3C%20cl;%20j++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(encodeAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20%7B%20op:%20exports.OPERATION.ADD,%20index:%20changes%5Bj%5D%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20changes%5Bj%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldIndex%20=%20operation.index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20field%20=%20(isSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20ref%5B'_definition'%5D.fieldsByIndex%20&&%20ref%5B'_definition'%5D.fieldsByIndex%5BfieldIndex%5D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20fieldIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20cache%20begin%20index%20if%20%60useFilters%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20beginIndex%20=%20bytes.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20encode%20field%20index%20+%20operation%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation.op%20!==%20exports.OPERATION.TOUCH)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Compress%20%60fieldIndex%60%20+%20%60operation%60%20into%20a%20single%20byte.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20This%20adds%20a%20limitaion%20of%2064%20fields%20per%20Schema%20structure%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20(fieldIndex%20%7C%20operation.op));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20operation.op);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20custom%20operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation.op%20===%20exports.OPERATION.CLEAR)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20indexed%20operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20encode%20%22alias%22%20for%20dynamic%20fields%20(maps)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!isSchema%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(operation.op%20&%20exports.OPERATION.ADD)%20==%20exports.OPERATION.ADD%20//%20ADD%20or%20DELETE_AND_ADD%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20MapSchema%20dynamic%20key%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20dynamicIndex%20=%20changeTree.ref%5B'$indexes'%5D.get(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string$1(bytes,%20dynamicIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation.op%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20delete%20from%20filter%20cache%20data.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20(useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20delete%20changeTree.caches%5BfieldIndex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20type%20=%20changeTree.childType%20%7C%7C%20ref._schema%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20changeTree.getType(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20type%20=%20changeTree.getType(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20changeTree.getValue(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Enqueue%20ChangeTree%20to%20be%20visited%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20!refIdsVisited.has(value%5B'$changes'%5D))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTrees.push(value%5B'$changes'%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.ensureRefId();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20numChangeTrees++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation.op%20===%20exports.OPERATION.TOUCH)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(Schema.is(type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20assertInstanceType(value,%20type,%20ref,%20field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Encode%20refId%20for%20this%20instance.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20The%20actual%20instance%20is%20going%20to%20be%20encoded%20on%20next%20%60changeTree%60%20iteration.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20value.$changes.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Try%20to%20encode%20inherited%20TYPE_ID%20if%20it's%20an%20ADD%20operation.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((operation.op%20&%20exports.OPERATION.ADD)%20===%20exports.OPERATION.ADD)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.tryEncodeTypeId(bytes,%20type,%20value.constructor);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(typeof%20(type)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Primitive%20values%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20encodePrimitiveType(type,%20bytes,%20value,%20ref,%20field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Custom%20type%20(MapSchema,%20ArraySchema,%20etc)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20getType(Object.keys(type)%5B0%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ensure%20a%20ArraySchema%20has%20been%20provided%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20assertInstanceType(ref%5B%22_%22.concat(field)%5D,%20definition.constructor,%20ref,%20field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Encode%20refId%20for%20this%20instance.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20The%20actual%20instance%20is%20going%20to%20be%20encoded%20on%20next%20%60changeTree%60%20iteration.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20value.$changes.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20cache%20begin%20/%20end%20index%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.cache(fieldIndex,%20bytes.slice(beginIndex));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!encodeAll%20&&%20!useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.discard();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20bytes;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.encodeAll%20=%20function%20(useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.encode(true,%20%5B%5D,%20useFilters);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.applyFilters%20=%20function%20(client,%20encodeAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(encodeAll%20===%20void%200)%20%7B%20encodeAll%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20root%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refIdsDissallowed%20=%20new%20Set();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20$filterState%20=%20ClientState.get(client);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTrees%20=%20%5Bthis.$changes%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20numChangeTrees%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20filteredBytes%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_loop_1%20=%20function%20(i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTree%20=%20changeTrees%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(refIdsDissallowed.has(changeTree.refId))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%22continue%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20changeTree.ref;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isSchema%20=%20ref%20instanceof%20Schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20SWITCH_TO_STRUCTURE);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20changeTree.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20clientHasRefId%20=%20$filterState.refIds.has(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isEncodeAll%20=%20(encodeAll%20%7C%7C%20!clientHasRefId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log(%22REF:%22,%20ref.constructor.name);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log(%22Encode%20all?%22,%20isEncodeAll);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20include%20%60changeTree%60%20on%20list%20of%20known%20refIds%20by%20this%20client.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$filterState.addRefId(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20containerIndexes%20=%20$filterState.containerIndexes.get(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changes%20=%20(isEncodeAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20Array.from(changeTree.allChanges)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20Array.from(changeTree.changes.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20WORKAROUND:%20tries%20to%20re-evaluate%20previously%20not%20included%20@filter()%20attributes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20see%20%22DELETE%20a%20field%20of%20Schema%22%20test%20case.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!encodeAll%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20isSchema%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref._definition.indexesWithFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20indexesWithFilters%20=%20ref._definition.indexesWithFilters;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20indexesWithFilters.forEach(function%20(indexWithFilter)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!containerIndexes.has(indexWithFilter)%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.allChanges.has(indexWithFilter))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isEncodeAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changes.push(indexWithFilter);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changes.push(%7B%20op:%20exports.OPERATION.ADD,%20index:%20indexWithFilter,%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20j%20=%200,%20cl%20=%20changes.length;%20j%20%3C%20cl;%20j++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20change%20=%20(isEncodeAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20%7B%20op:%20exports.OPERATION.ADD,%20index:%20changes%5Bj%5D%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20changes%5Bj%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20custom%20operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.CLEAR)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20change.op);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldIndex%20=%20change.index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Deleting%20fields:%20encode%20the%20operation%20+%20field%20index%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20DELETE%20operations%20also%20need%20to%20go%20through%20filtering.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20cache%20the%20previous%20value%20so%20we%20can%20access%20the%20value%20(primitive%20or%20%60refId%60)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20(check%20against%20%60$filterState.refIds%60)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20change.op%20%7C%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20change.op);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20indexed%20operation%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20changeTree.getValue(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20changeTree.getType(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Is%20a%20Schema!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20filter%20=%20(ref._definition.filters%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref._definition.filters%5BfieldIndex%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(filter%20&&%20!filter.call(ref,%20client,%20value,%20root))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refIdsDissallowed.add(value%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Is%20a%20collection!%20(map,%20array,%20etc.)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20parent%20=%20changeTree.parent;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20filter%20=%20changeTree.getChildrenFilter();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(filter%20&&%20!filter.call(parent,%20client,%20ref%5B'$indexes'%5D.get(fieldIndex),%20value,%20root))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refIdsDissallowed.add(value%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20visit%20child%20ChangeTree%20on%20further%20iteration.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTrees.push(value%5B'$changes'%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20numChangeTrees++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Copy%20cached%20bytes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20!==%20exports.OPERATION.TOUCH)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20me!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.ADD%20%7C%7C%20isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20use%20cached%20bytes%20directly%20if%20is%20from%20Schema%20type.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20filteredBytes.push.apply(filteredBytes,%20(_a%20=%20changeTree.caches%5BfieldIndex%5D)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20%5B%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20containerIndexes.add(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(containerIndexes.has(fieldIndex))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20use%20cached%20bytes%20if%20already%20has%20the%20field%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20filteredBytes.push.apply(filteredBytes,%20(_b%20=%20changeTree.caches%5BfieldIndex%5D)%20!==%20null%20&&%20_b%20!==%20void%200%20?%20_b%20:%20%5B%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20force%20ADD%20operation%20if%20field%20is%20not%20known%20by%20this%20client.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20containerIndexes.add(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20exports.OPERATION.ADD);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20MapSchema%20dynamic%20key%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20dynamicIndex%20=%20changeTree.ref%5B'$indexes'%5D.get(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string$1(filteredBytes,%20dynamicIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20value%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%22encodePrimitiveType%22%20without%20type%20checking.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20the%20type%20checking%20has%20been%20done%20on%20the%20first%20.encode()%20call.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20encode%5Btype%5D(filteredBytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(value%5B'$changes'%5D%20&&%20!isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20track%20ADD/REPLACE/DELETE%20instances%20on%20%60$filterState%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20do%20NOT%20always%20encode%20dynamicIndex%20for%20MapSchema.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20(If%20client%20already%20has%20that%20key,%20only%20the%20first%20index%20is%20necessary.)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20exports.OPERATION.ADD);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20MapSchema%20dynamic%20key%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20dynamicIndex%20=%20changeTree.ref%5B'$indexes'%5D.get(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string$1(filteredBytes,%20dynamicIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20value%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20numChangeTrees;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_loop_1(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20filteredBytes;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.clone%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned%20=%20new%20(this.constructor);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20schema%20=%20this._definition.schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20field%20in%20schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(this%5Bfield%5D)%20===%20%22object%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20((_a%20=%20this%5Bfield%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.clone)%20===%20%22function%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20deep%20clone%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%5Bfield%5D%20=%20this%5Bfield%5D.clone();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20primitive%20values%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%5Bfield%5D%20=%20this%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20schema%20=%20this._definition.schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20deprecated%20=%20this._definition.deprecated;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20obj%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20field%20in%20schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!deprecated%5Bfield%5D%20&&%20this%5Bfield%5D%20!==%20null%20&&%20typeof%20(this%5Bfield%5D)%20!==%20%22undefined%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%5Bfield%5D%20=%20(typeof%20(this%5Bfield%5D%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this%5Bfield%5D%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this%5B%22_%22.concat(field)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.discardAllChanges%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discardAll();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this%5Bthis._definition.fieldsByIndex%5Bindex%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%5Bthis._definition.fieldsByIndex%5Bindex%5D%5D%20=%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.tryEncodeTypeId%20=%20function%20(bytes,%20type,%20targetType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(type._typeid%20!==%20targetType._typeid)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20TYPE_ID);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20targetType._typeid);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.getSchemaType%20=%20function%20(bytes,%20it,%20defaultType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(bytes%5Bit.offset%5D%20===%20TYPE_ID)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20it.offset++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this.constructor._context.get(number(bytes,%20it));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20type%20%7C%7C%20defaultType;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype.createTypeInstance%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20instance%20=%20new%20type();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20assign%20root%20on%20$changes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20instance.$changes.root%20=%20this.$changes.root;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20instance;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema.prototype._triggerChanges%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b,%20_c,%20_d,%20_e,%20_f,%20_g,%20_h,%20_j;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20uniqueRefIds%20=%20new%20Set();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20$refs%20=%20this.$changes.root.refs;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_loop_2%20=%20function%20(i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20change%20=%20changes%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refId%20=%20change.refId;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20$refs.get(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20$callbacks%20=%20ref%5B'$callbacks'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20trigger%20onRemove%20on%20child%20structure.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((change.op%20&%20exports.OPERATION.DELETE)%20===%20exports.OPERATION.DELETE%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20change.previousValue%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_b%20=%20(_a%20=%20change.previousValue%5B'$callbacks'%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a%5Bexports.OPERATION.DELETE%5D)%20===%20null%20%7C%7C%20_b%20===%20void%200%20?%20void%200%20:%20_b.forEach(function%20(callback)%20%7B%20return%20callback();%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20no%20callbacks%20defined,%20skip%20this%20structure!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!$callbacks)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%22continue%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!uniqueRefIds.has(refId))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20trigger%20onChange%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_c%20=%20$callbacks%20===%20null%20%7C%7C%20$callbacks%20===%20void%200%20?%20void%200%20:%20$callbacks%5Bexports.OPERATION.REPLACE%5D)%20===%20null%20%7C%7C%20_c%20===%20void%200%20?%20void%200%20:%20_c.forEach(function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20callback(changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20catch%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Schema.onError(e);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20($callbacks.hasOwnProperty(change.field))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_d%20=%20$callbacks%5Bchange.field%5D)%20===%20null%20%7C%7C%20_d%20===%20void%200%20?%20void%200%20:%20_d.forEach(function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20callback(change.value,%20change.previousValue);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20catch%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Schema.onError(e);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20is%20a%20collection%20of%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.ADD%20&&%20change.previousValue%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20triger%20onAdd%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_e%20=%20$callbacks%5Bexports.OPERATION.ADD%5D)%20===%20null%20%7C%7C%20_e%20===%20void%200%20?%20void%200%20:%20_e.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.value,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(change.op%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20FIXME:%20%60previousValue%60%20should%20always%20be%20available.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ADD%20+%20DELETE%20operations%20are%20still%20encoding%20DELETE%20operation.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.previousValue%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20triger%20onRemove%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_f%20=%20$callbacks%5Bexports.OPERATION.DELETE%5D)%20===%20null%20%7C%7C%20_f%20===%20void%200%20?%20void%200%20:%20_f.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.previousValue,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(change.op%20===%20exports.OPERATION.DELETE_AND_ADD)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20triger%20onRemove%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.previousValue%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_g%20=%20$callbacks%5Bexports.OPERATION.DELETE%5D)%20===%20null%20%7C%7C%20_g%20===%20void%200%20?%20void%200%20:%20_g.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.previousValue,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20triger%20onAdd%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_h%20=%20$callbacks%5Bexports.OPERATION.ADD%5D)%20===%20null%20%7C%7C%20_h%20===%20void%200%20?%20void%200%20:%20_h.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.value,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20trigger%20onChange%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.value%20!==%20change.previousValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_j%20=%20$callbacks%5Bexports.OPERATION.REPLACE%5D)%20===%20null%20%7C%7C%20_j%20===%20void%200%20?%20void%200%20:%20_j.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.value,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uniqueRefIds.add(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20changes.length;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_loop_2(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Schema._definition%20=%20SchemaDefinition.create();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Schema;%20%09%09%20%20%20%20%20%20%20%20%7D());%20%20%09%09%20%20%20%20%20%20%20%20function%20dumpChanges(schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTrees%20=%20%5Bschema%5B'$changes'%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20numChangeTrees%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20dump%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20currentStructure%20=%20dump;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_loop_1%20=%20function%20(i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTree%20=%20changeTrees%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.changes.forEach(function%20(change)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20changeTree.ref;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldIndex%20=%20change.index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20field%20=%20(ref%5B'_definition'%5D)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20ref%5B'_definition'%5D.fieldsByIndex%5BfieldIndex%5D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20ref%5B'$indexes'%5D.get(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20currentStructure%5Bfield%5D%20=%20changeTree.getValue(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20numChangeTrees;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_loop_1(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20dump;%20%09%09%20%20%20%20%20%20%20%20%7D%20%20%09%09%20%20%20%20%20%20%20%20var%20reflectionContext%20=%20%7B%20context:%20new%20Context()%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Reflection%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20var%20ReflectionField%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__extends(ReflectionField,%20_super);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20ReflectionField()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(%22string%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%5D,%20ReflectionField.prototype,%20%22name%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(%22string%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%5D,%20ReflectionField.prototype,%20%22type%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(%22number%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%5D,%20ReflectionField.prototype,%20%22referencedType%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20ReflectionField;%20%09%09%20%20%20%20%20%20%20%20%7D(Schema));%20%09%09%20%20%20%20%20%20%20%20var%20ReflectionType%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__extends(ReflectionType,%20_super);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20ReflectionType()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.fields%20=%20new%20ArraySchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(%22number%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%5D,%20ReflectionType.prototype,%20%22id%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(%5BReflectionField%5D,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%5D,%20ReflectionType.prototype,%20%22fields%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20ReflectionType;%20%09%09%20%20%20%20%20%20%20%20%7D(Schema));%20%09%09%20%20%20%20%20%20%20%20var%20Reflection%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__extends(Reflection,%20_super);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20Reflection()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.types%20=%20new%20ArraySchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Reflection.encode%20=%20function%20(instance)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rootSchemaType%20=%20instance.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20reflection%20=%20new%20Reflection();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reflection.rootType%20=%20rootSchemaType._typeid;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20buildType%20=%20function%20(currentType,%20schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20fieldName%20in%20schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20field%20=%20new%20ReflectionField();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field.name%20=%20fieldName;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldType%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(schema%5BfieldName%5D)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20=%20schema%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type_1%20=%20schema%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20childTypeSchema%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20below.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(Schema.is(type_1))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20=%20%22ref%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20childTypeSchema%20=%20schema%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20=%20Object.keys(type_1)%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(type_1%5BfieldType%5D)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20+=%20%22:%22%20+%20type_1%5BfieldType%5D;%20//%20array:string%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20childTypeSchema%20=%20type_1%5BfieldType%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field.referencedType%20=%20(childTypeSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20childTypeSchema._typeid%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20-1;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field.type%20=%20fieldType;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20currentType.fields.push(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reflection.types.push(currentType);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20types%20=%20rootSchemaType._context.types;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20typeid%20in%20types)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type_2%20=%20new%20ReflectionType();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type_2.id%20=%20Number(typeid);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20buildType(type_2,%20types%5Btypeid%5D._definition.schema);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20reflection.encodeAll();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Reflection.decode%20=%20function%20(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20context%20=%20new%20Context();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20reflection%20=%20new%20Reflection();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reflection.decode(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20schemaTypes%20=%20reflection.types.reduce(function%20(types,%20reflectionType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20schema%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20__extends(_,%20_super);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20function%20_()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D(Schema));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20typeid%20=%20reflectionType.id;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20types%5Btypeid%5D%20=%20schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20context.add(schema,%20typeid);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20types;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reflection.types.forEach(function%20(reflectionType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20schemaType%20=%20schemaTypes%5BreflectionType.id%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reflectionType.fields.forEach(function%20(field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(field.referencedType%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldType%20=%20field.type;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refType%20=%20schemaTypes%5Bfield.referencedType%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20map%20or%20array%20of%20primitive%20type%20(-1)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!refType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20typeInfo%20=%20field.type.split(%22:%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20=%20typeInfo%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refType%20=%20typeInfo%5B1%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(fieldType%20===%20%22ref%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(refType,%20%7B%20context:%20context%20%7D)(schemaType.prototype,%20field.name);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type((_a%20=%20%7B%7D,%20_a%5BfieldType%5D%20=%20refType,%20_a),%20%7B%20context:%20context%20%7D)(schemaType.prototype,%20field.name);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(field.type,%20%7B%20context:%20context%20%7D)(schemaType.prototype,%20field.name);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rootType%20=%20schemaTypes%5Breflection.rootType%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rootInstance%20=%20new%20rootType();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%20auto-initialize%20referenced%20types%20on%20root%20type%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%20to%20allow%20registering%20listeners%20immediatelly%20on%20client-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20fieldName%20in%20rootType._definition.schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldType%20=%20rootType._definition.schema%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(fieldType)%20!==%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rootInstance%5BfieldName%5D%20=%20(typeof%20(fieldType)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20new%20fieldType()%20//%20is%20a%20schema%20reference%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20new%20(getType(Object.keys(fieldType)%5B0%5D)).constructor();%20//%20is%20a%20%22collection%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20rootInstance;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(%5BReflectionType%5D,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%5D,%20Reflection.prototype,%20%22types%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(%22number%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%5D,%20Reflection.prototype,%20%22rootType%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Reflection;%20%09%09%20%20%20%20%20%20%20%20%7D(Schema));%20%20%09%09%20%20%20%20%20%20%20%20registerType(%22map%22,%20%7B%20constructor:%20MapSchema%20%7D);%20%09%09%20%20%20%20%20%20%20%20registerType(%22array%22,%20%7B%20constructor:%20ArraySchema%20%7D);%20%09%09%20%20%20%20%20%20%20%20registerType(%22set%22,%20%7B%20constructor:%20SetSchema%20%7D);%20%09%09%20%20%20%20%20%20%20%20registerType(%22collection%22,%20%7B%20constructor:%20CollectionSchema,%20%7D);%20%20%09%09%20%20%20%20%20%20%20%20exports.ArraySchema%20=%20ArraySchema;%20%09%09%20%20%20%20%20%20%20%20exports.CollectionSchema%20=%20CollectionSchema;%20%09%09%20%20%20%20%20%20%20%20exports.Context%20=%20Context;%20%09%09%20%20%20%20%20%20%20%20exports.MapSchema%20=%20MapSchema;%20%09%09%20%20%20%20%20%20%20%20exports.Reflection%20=%20Reflection;%20%09%09%20%20%20%20%20%20%20%20exports.ReflectionField%20=%20ReflectionField;%20%09%09%20%20%20%20%20%20%20%20exports.ReflectionType%20=%20ReflectionType;%20%09%09%20%20%20%20%20%20%20%20exports.Schema%20=%20Schema;%20%09%09%20%20%20%20%20%20%20%20exports.SchemaDefinition%20=%20SchemaDefinition;%20%09%09%20%20%20%20%20%20%20%20exports.SetSchema%20=%20SetSchema;%20%09%09%20%20%20%20%20%20%20%20exports.decode%20=%20decode;%20%09%09%20%20%20%20%20%20%20%20exports.defineTypes%20=%20defineTypes;%20%09%09%20%20%20%20%20%20%20%20exports.deprecated%20=%20deprecated;%20%09%09%20%20%20%20%20%20%20%20exports.dumpChanges%20=%20dumpChanges;%20%09%09%20%20%20%20%20%20%20%20exports.encode%20=%20encode;%20%09%09%20%20%20%20%20%20%20%20exports.filter%20=%20filter;%20%09%09%20%20%20%20%20%20%20%20exports.filterChildren%20=%20filterChildren;%20%09%09%20%20%20%20%20%20%20%20exports.hasFilter%20=%20hasFilter;%20%09%09%20%20%20%20%20%20%20%20exports.registerType%20=%20registerType;%20%09%09%20%20%20%20%20%20%20%20exports.type%20=%20type;%20%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(exports,%20'__esModule',%20%7B%20value:%20true%20%7D);%20%20%09%09%20%20%20%20%7D));%20%09%09%20%20%20%20%7D);%20%20%09%09%20%20%20%20var%20Room%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20Room(name,%20rootSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Public%20signals%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onStateChange%20=%20createSignal();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onError%20=%20createSignal();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onLeave%20=%20createSignal();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onJoin%20=%20createSignal();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.hasJoined%20=%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onMessageHandlers%20=%20createNanoEvents();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.roomId%20=%20null;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.name%20=%20name;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(rootSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.serializer%20=%20new%20(getSerializer(%22schema%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.rootSchema%20=%20rootSchema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.serializer.state%20=%20new%20rootSchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onError(function%20(code,%20message)%20%7B%20var%20_a;%20return%20(_a%20=%20console.warn)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.call(console,%20%22colyseus.js%20-%20onError%20=%3E%20(%22.concat(code,%20%22)%20%22).concat(message));%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onLeave(function%20()%20%7B%20return%20_this.removeAllListeners();%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(Room.prototype,%20%22id%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20deprecate%20me%20on%20version%201.0%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20return%20this.roomId;%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20Room.prototype.connect%20=%20function%20(endpoint,%20devModeCloseCallback,%20room%20//%20when%20reconnecting%20on%20devMode,%20re-use%20previous%20room%20intance%20for%20handling%20events.%20%09%09%20%20%20%20%20%20%20%20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(room%20===%20void%200)%20%7B%20room%20=%20this;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20connection%20=%20new%20Connection();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20room.connection%20=%20connection;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20connection.events.onmessage%20=%20Room.prototype.onMessageCallback.bind(room);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20connection.events.onclose%20=%20function%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!room.hasJoined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_a%20=%20console.warn)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.call(console,%20%22Room%20connection%20was%20closed%20unexpectedly%20(%22.concat(e.code,%20%22):%20%22).concat(e.reason));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room.onError.invoke(e.code,%20e.reason);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(e.code%20===%20CloseCode.DEVMODE_RESTART%20&&%20devModeCloseCallback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20devModeCloseCallback();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room.onLeave.invoke(e.code);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room.destroy();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20connection.events.onerror%20=%20function%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_a%20=%20console.warn)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.call(console,%20%22Room,%20onError%20(%22.concat(e.code,%20%22):%20%22).concat(e.reason));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room.onError.invoke(e.code,%20e.reason);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20connection.connect(endpoint);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.leave%20=%20function%20(consented)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(consented%20===%20void%200)%20%7B%20consented%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Promise(function%20(resolve)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.onLeave(function%20(code)%20%7B%20return%20resolve(code);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(_this.connection)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(consented)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.connection.send(%5Bexports.Protocol.LEAVE_ROOM%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.connection.close();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.onLeave.invoke(CloseCode.CONSENTED);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.onMessage%20=%20function%20(type,%20callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.onMessageHandlers.on(this.getMessageHandlerKey(type),%20callback);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.send%20=%20function%20(type,%20message)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20initialBytes%20=%20%5Bexports.Protocol.ROOM_DATA%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(type)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20umd.encode.string(initialBytes,%20type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20umd.encode.number(initialBytes,%20type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20arr;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(message%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20encoded%20=%20encode(message);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20arr%20=%20new%20Uint8Array(initialBytes.length%20+%20encoded.byteLength);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20arr.set(new%20Uint8Array(initialBytes),%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20arr.set(new%20Uint8Array(encoded),%20initialBytes.length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20arr%20=%20new%20Uint8Array(initialBytes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.connection.send(arr.buffer);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.sendBytes%20=%20function%20(type,%20bytes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20initialBytes%20=%20%5Bexports.Protocol.ROOM_DATA_BYTES%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(type)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20umd.encode.string(initialBytes,%20type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20umd.encode.number(initialBytes,%20type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20arr;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20arr%20=%20new%20Uint8Array(initialBytes.length%20+%20(bytes.byteLength%20%7C%7C%20bytes.length));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20arr.set(new%20Uint8Array(initialBytes),%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20arr.set(new%20Uint8Array(bytes),%20initialBytes.length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.connection.send(arr.buffer);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(Room.prototype,%20%22state%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.serializer.getState();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20Room.prototype.removeAllListeners%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onJoin.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onStateChange.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onError.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onLeave.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onMessageHandlers.events%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.onMessageCallback%20=%20function%20(event)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20bytes%20=%20Array.from(new%20Uint8Array(event.data));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20code%20=%20bytes%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(code%20===%20exports.Protocol.JOIN_ROOM)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20offset%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20reconnectionToken%20=%20utf8Read(bytes,%20offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20offset%20+=%20utf8Length(reconnectionToken);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.serializerId%20=%20utf8Read(bytes,%20offset);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20offset%20+=%20utf8Length(this.serializerId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Instantiate%20serializer%20if%20not%20locally%20available.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.serializer)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20serializer%20=%20getSerializer(this.serializerId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.serializer%20=%20new%20serializer();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(bytes.length%20%3E%20offset%20&&%20this.serializer.handshake)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.serializer.handshake(bytes,%20%7B%20offset:%20offset%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.reconnectionToken%20=%20%22%22.concat(this.roomId,%20%22:%22).concat(reconnectionToken);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.hasJoined%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.onJoin.invoke();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20acknowledge%20successfull%20JOIN_ROOM%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.connection.send(%5Bexports.Protocol.JOIN_ROOM%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(code%20===%20exports.Protocol.ERROR)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20it_1%20=%20%7B%20offset:%201%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20code_1%20=%20umd.decode.number(bytes,%20it_1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20message%20=%20umd.decode.string(bytes,%20it_1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.onError.invoke(code_1,%20message);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(code%20===%20exports.Protocol.LEAVE_ROOM)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.leave();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(code%20===%20exports.Protocol.ROOM_DATA_SCHEMA)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20it_2%20=%20%7B%20offset:%201%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20context_1%20=%20this.serializer.getState().constructor._context;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20context_1.get(umd.decode.number(bytes,%20it_2));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20message%20=%20new%20type();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20message.decode(bytes,%20it_2);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.dispatchMessage(type,%20message);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(code%20===%20exports.Protocol.ROOM_STATE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.shift();%20//%20drop%20%60code%60%20byte%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.setState(bytes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(code%20===%20exports.Protocol.ROOM_STATE_PATCH)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.shift();%20//%20drop%20%60code%60%20byte%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.patch(bytes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(code%20===%20exports.Protocol.ROOM_DATA)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20it_3%20=%20%7B%20offset:%201%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20(umd.decode.stringCheck(bytes,%20it_3))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20umd.decode.string(bytes,%20it_3)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20umd.decode.number(bytes,%20it_3);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20message%20=%20(bytes.length%20%3E%20it_3.offset)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20decode(event.data,%20it_3.offset)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.dispatchMessage(type,%20message);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(code%20===%20exports.Protocol.ROOM_DATA_BYTES)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20it_4%20=%20%7B%20offset:%201%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20(umd.decode.stringCheck(bytes,%20it_4))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20umd.decode.string(bytes,%20it_4)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20umd.decode.number(bytes,%20it_4);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.dispatchMessage(type,%20new%20Uint8Array(bytes.slice(it_4.offset)));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.setState%20=%20function%20(encodedState)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.serializer.setState(encodedState);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onStateChange.invoke(this.serializer.getState());%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.patch%20=%20function%20(binaryPatch)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.serializer.patch(binaryPatch);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.onStateChange.invoke(this.serializer.getState());%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.dispatchMessage%20=%20function%20(type,%20message)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20messageType%20=%20this.getMessageHandlerKey(type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.onMessageHandlers.events%5BmessageType%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.onMessageHandlers.emit(messageType,%20message);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(this.onMessageHandlers.events%5B'*'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.onMessageHandlers.emit('*',%20type,%20message);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_a%20=%20console.warn)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.call(console,%20%22colyseus.js:%20onMessage()%20not%20registered%20for%20type%20'%22.concat(type,%20%22'.%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.destroy%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.serializer)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.serializer.teardown();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Room.prototype.getMessageHandlerKey%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20switch%20(typeof%20(type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20typeof%20Schema%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22function%22:%20return%20%22$%22.concat(type._typeid);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20string%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22string%22:%20return%20type;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20number%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%20%22number%22:%20return%20%22i%22.concat(type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20default:%20throw%20new%20Error(%22invalid%20message%20type.%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20Room;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20function%20apply(src,%20tar)%20%7B%20%09%09%20%20%20%20%09tar.statusMessage%20=%20src.statusText;%20%09%09%20%20%20%20%09tar.statusCode%20=%20src.status;%20%09%09%20%20%20%20%09tar.data%20=%20src.body;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20function%20send(method,%20uri,%20opts)%20%7B%20%09%09%20%20%20%20%09opts%20=%20opts%20%7C%7C%20%7B%7D;%20%09%09%20%20%20%20%09var%20timer,%20ctrl,%20tmp=opts.body;%20%20%09%09%20%20%20%20%09opts.method%20=%20method;%20%09%09%20%20%20%20%09opts.headers%20=%20opts.headers%20%7C%7C%20%7B%7D;%20%20%09%09%20%20%20%20%09if%20(tmp%20instanceof%20FormData)%20;%20else%20if%20(tmp%20&&%20typeof%20tmp%20==%20'object')%20%7B%20%09%09%20%20%20%20%09%09opts.headers%5B'content-type'%5D%20=%20'application/json';%20%09%09%20%20%20%20%09%09opts.body%20=%20JSON.stringify(tmp);%20%09%09%20%20%20%20%09%7D%20%20%09%09%20%20%20%20%09if%20(opts.withCredentials)%20%7B%20%09%09%20%20%20%20%09%09opts.credentials%20=%20'include';%20%09%09%20%20%20%20%09%7D%20%20%09%09%20%20%20%20%09if%20(opts.timeout)%20%7B%20%09%09%20%20%20%20%09%09ctrl%20=%20new%20AbortController;%20%09%09%20%20%20%20%09%09opts.signal%20=%20ctrl.signal;%20%09%09%20%20%20%20%09%09timer%20=%20setTimeout(ctrl.abort,%20opts.timeout);%20%09%09%20%20%20%20%09%7D%20%20%09%09%20%20%20%20%09return%20new%20Promise((res,%20rej)%20=%3E%20%7B%20%09%09%20%20%20%20%09%09fetch(uri,%20opts).then((rr,%20reply)%20=%3E%20%7B%20%09%09%20%20%20%20%09%09%09clearTimeout(timer);%20%20%09%09%20%20%20%20%09%09%09apply(rr,%20rr);%20//=%3E%20rr.headers%20%09%09%20%20%20%20%09%09%09reply%20=%20rr.status%20%3E=%20400%20?%20rej%20:%20res;%20%20%09%09%20%20%20%20%09%09%09tmp%20=%20rr.headers.get('content-type');%20%09%09%20%20%20%20%09%09%09if%20(!tmp%20%7C%7C%20!~tmp.indexOf('application/json'))%20%7B%20%09%09%20%20%20%20%09%09%09%09reply(rr);%20%09%09%20%20%20%20%09%09%09%7D%20else%20%7B%20%09%09%20%20%20%20%09%09%09%09rr.text().then(str%20=%3E%20%7B%20%09%09%20%20%20%20%09%09%09%09%09try%20%7B%20%09%09%20%20%20%20%09%09%09%09%09%09rr.data%20=%20JSON.parse(str,%20opts.reviver);%20%09%09%20%20%20%20%09%09%09%09%09%09reply(rr);%20%09%09%20%20%20%20%09%09%09%09%09%7D%20catch%20(err)%20%7B%20%09%09%20%20%20%20%09%09%09%09%09%09err.headers%20=%20rr.headers;%20%09%09%20%20%20%20%09%09%09%09%09%09apply(rr,%20err);%20%09%09%20%20%20%20%09%09%09%09%09%09rej(err);%20%09%09%20%20%20%20%09%09%09%09%09%7D%20%09%09%20%20%20%20%09%09%09%09%7D);%20%09%09%20%20%20%20%09%09%09%7D%20%09%09%20%20%20%20%09%09%7D).catch(err%20=%3E%20%7B%20%09%09%20%20%20%20%09%09%09err.timeout%20=%20ctrl%20&&%20ctrl.signal.aborted;%20%09%09%20%20%20%20%09%09%09rej(err);%20%09%09%20%20%20%20%09%09%7D);%20%09%09%20%20%20%20%09%7D);%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20get%20=%20/*%23__PURE__*/%20send.bind(send,%20'GET');%20%09%09%20%20%20%20var%20post%20=%20/*%23__PURE__*/%20send.bind(send,%20'POST');%20%09%09%20%20%20%20var%20patch%20=%20/*%23__PURE__*/%20send.bind(send,%20'PATCH');%20%09%09%20%20%20%20var%20del%20=%20/*%23__PURE__*/%20send.bind(send,%20'DELETE');%20%09%09%20%20%20%20var%20put%20=%20/*%23__PURE__*/%20send.bind(send,%20'PUT');%20%20%09%09%20%20%20%20var%20del_1%20=%20del;%20%09%09%20%20%20%20var%20get_1%20=%20get;%20%09%09%20%20%20%20var%20patch_1%20=%20patch;%20%09%09%20%20%20%20var%20post_1%20=%20post;%20%09%09%20%20%20%20var%20put_1%20=%20put;%20%09%09%20%20%20%20var%20send_1%20=%20send;%20%20%09%09%20%20%20%20var%20fetch_1%20=%20%7B%20%09%09%20%20%20%20%09del:%20del_1,%20%09%09%20%20%20%20%09get:%20get_1,%20%09%09%20%20%20%20%09patch:%20patch_1,%20%09%09%20%20%20%20%09post:%20post_1,%20%09%09%20%20%20%20%09put:%20put_1,%20%09%09%20%20%20%20%09send:%20send_1%20%09%09%20%20%20%20%7D;%20%20%09%09%20%20%20%20var%20httpie%20=%20/*%23__PURE__*/_mergeNamespaces(%7B%20%09%09%20%20%20%20%20%20%20%20__proto__:%20null,%20%09%09%20%20%20%20%20%20%20%20'default':%20fetch_1,%20%09%09%20%20%20%20%20%20%20%20del:%20del_1,%20%09%09%20%20%20%20%20%20%20%20get:%20get_1,%20%09%09%20%20%20%20%20%20%20%20patch:%20patch_1,%20%09%09%20%20%20%20%20%20%20%20post:%20post_1,%20%09%09%20%20%20%20%20%20%20%20put:%20put_1,%20%09%09%20%20%20%20%20%20%20%20send:%20send_1%20%09%09%20%20%20%20%7D,%20%5Bfetch_1%5D);%20%20%09%09%20%20%20%20var%20HTTP%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20HTTP(client)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.client%20=%20client;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20HTTP.prototype.get%20=%20function%20(path,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.request(%22get%22,%20path,%20options);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20HTTP.prototype.post%20=%20function%20(path,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.request(%22post%22,%20path,%20options);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20HTTP.prototype.del%20=%20function%20(path,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.request(%22del%22,%20path,%20options);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20HTTP.prototype.put%20=%20function%20(path,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.request(%22put%22,%20path,%20options);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20HTTP.prototype.request%20=%20function%20(method,%20path,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20httpie%5Bmethod%5D(this.client%5B'getHttpEndpoint'%5D(path),%20this.getOptions(options)).catch(function%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20status%20=%20e.statusCode;%20//%20%20%7C%7C%20-1%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20message%20=%20((_a%20=%20e.data)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.error)%20%7C%7C%20e.statusMessage%20%7C%7C%20e.message;%20//%20%20%7C%7C%20%22offline%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!status%20&&%20!message)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20e;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20ServerError(status,%20message);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20HTTP.prototype.getOptions%20=%20function%20(options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.authToken)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!options.headers)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20options.headers%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20options.headers%5B'Authorization'%5D%20=%20%22Bearer%20%22.concat(this.authToken);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(cc)%20!==%20'undefined'%20&&%20cc.sys%20&&%20cc.sys.isNative)%20;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20always%20include%20credentials%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20options.withCredentials%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20options;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20HTTP;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20///%20%3Creference%20path=%22../typings/cocos-creator.d.ts%22%20/%3E%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20We%20do%20not%20assign%20'storage'%20to%20window.localStorage%20immediatelly%20for%20React%20%09%09%20%20%20%20%20*%20Native%20compatibility.%20window.localStorage%20is%20not%20present%20when%20this%20module%20is%20%09%09%20%20%20%20%20*%20loaded.%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20var%20storage;%20%09%09%20%20%20%20function%20getStorage()%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(!storage)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20storage%20=%20(typeof%20(cc)%20!==%20'undefined'%20&&%20cc.sys%20&&%20cc.sys.localStorage)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20cc.sys.localStorage%20//%20compatibility%20with%20cocos%20creator%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20window.localStorage;%20//%20RN%20does%20have%20window%20object%20at%20this%20point,%20but%20localStorage%20is%20not%20defined%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20catch%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ignore%20error%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20(!storage)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20mock%20localStorage%20if%20not%20available%20(Node.js%20or%20RN%20environment)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20storage%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache:%20%7B%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20setItem:%20function%20(key,%20value)%20%7B%20this.cache%5Bkey%5D%20=%20value;%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20getItem:%20function%20(key)%20%7B%20this.cache%5Bkey%5D;%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeItem:%20function%20(key)%20%7B%20delete%20this.cache%5Bkey%5D;%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20storage;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20setItem(key,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20getStorage().setItem(key,%20value);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20removeItem(key)%20%7B%20%09%09%20%20%20%20%20%20%20%20getStorage().removeItem(key);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20getItem(key,%20callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20value%20=%20getStorage().getItem(key);%20%09%09%20%20%20%20%20%20%20%20if%20(typeof%20(Promise)%20===%20'undefined'%20%7C%7C%20//%20old%20browsers%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20!(value%20instanceof%20Promise))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20browser%20has%20synchronous%20return%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20callback(value);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20react-native%20is%20asynchronous%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20value.then(function%20(id)%20%7B%20return%20callback(id);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20_Auth__initialized,%20_Auth__initializationPromise,%20_Auth__signInWindow,%20_Auth__events;%20%09%09%20%20%20%20var%20Auth%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20Auth(http)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.http%20=%20http;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.settings%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20path:%20%22/auth%22,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key:%20%22colyseus-auth-token%22,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_Auth__initialized.set(this,%20false);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_Auth__initializationPromise.set(this,%20void%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_Auth__signInWindow.set(this,%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_Auth__events.set(this,%20createNanoEvents());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20getItem(this.settings.key,%20function%20(token)%20%7B%20return%20_this.token%20=%20token;%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(Auth.prototype,%20%22token%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.http.authToken;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(token)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.http.authToken%20=%20token;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.onChange%20=%20function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20unbindChange%20=%20__classPrivateFieldGet(this,%20_Auth__events,%20%22f%22).on(%22change%22,%20callback);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!__classPrivateFieldGet(this,%20_Auth__initialized,%20%22f%22))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20__classPrivateFieldSet(this,%20_Auth__initializationPromise,%20new%20Promise(function%20(resolve,%20reject)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.getUserData().then(function%20(userData)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.emitChange(__assign(__assign(%7B%7D,%20userData),%20%7B%20token:%20_this.token%20%7D));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D).catch(function%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20user%20is%20not%20logged%20in,%20or%20service%20is%20down%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.emitChange(%7B%20user:%20null,%20token:%20undefined%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D).finally(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__classPrivateFieldSet(this,%20_Auth__initialized,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20unbindChange;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.getUserData%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.token)%20return%20%5B3%20/*break*/,%202%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B4%20/*yield*/,%20this.http.get(%22%22.concat(this.settings.path,%20%22/userdata%22))%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20return%20%5B2%20/*return*/,%20(_a.sent()).data%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%202:%20throw%20new%20Error(%22missing%20auth.token%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.registerWithEmailAndPassword%20=%20function%20(email,%20password,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20data;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.http.post(%22%22.concat(this.settings.path,%20%22/register%22),%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20body:%20%7B%20email:%20email,%20password:%20password,%20options:%20options,%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data%20=%20(_a.sent()).data;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.emitChange(data);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B2%20/*return*/,%20data%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.signInWithEmailAndPassword%20=%20function%20(email,%20password)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20data;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.http.post(%22%22.concat(this.settings.path,%20%22/login%22),%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20body:%20%7B%20email:%20email,%20password:%20password,%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data%20=%20(_a.sent()).data;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.emitChange(data);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B2%20/*return*/,%20data%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.signInAnonymously%20=%20function%20(options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20data;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.http.post(%22%22.concat(this.settings.path,%20%22/anonymous%22),%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20body:%20%7B%20options:%20options,%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data%20=%20(_a.sent()).data;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.emitChange(data);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B2%20/*return*/,%20data%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.sendPasswordResetEmail%20=%20function%20(email)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.http.post(%22%22.concat(this.settings.path,%20%22/forgot-password%22),%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20body:%20%7B%20email:%20email,%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20return%20%5B2%20/*return*/,%20(_a.sent()).data%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.signInWithProvider%20=%20function%20(providerName,%20settings)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(settings%20===%20void%200)%20%7B%20settings%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B2%20/*return*/,%20new%20Promise(function%20(resolve,%20reject)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20w%20=%20settings.width%20%7C%7C%20480;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20h%20=%20settings.height%20%7C%7C%20768;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20forward%20existing%20token%20for%20upgrading%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20upgradingToken%20=%20_this.token%20?%20%22?token=%22.concat(_this.token)%20:%20%22%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Capitalize%20first%20letter%20of%20providerName%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20title%20=%20%22Login%20with%20%22.concat((providerName%5B0%5D.toUpperCase()%20+%20providerName.substring(1)));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20url%20=%20_this.http%5B'client'%5D%5B'getHttpEndpoint'%5D(%22%22.concat((settings.prefix%20%7C%7C%20%22%22.concat(_this.settings.path,%20%22/provider%22)),%20%22/%22).concat(providerName).concat(upgradingToken));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20left%20=%20(screen.width%20/%202)%20-%20(w%20/%202);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20top%20=%20(screen.height%20/%202)%20-%20(h%20/%202);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20__classPrivateFieldSet(_this,%20_Auth__signInWindow,%20window.open(url,%20title,%20'toolbar=no,%20location=no,%20directories=no,%20status=no,%20menubar=no,%20scrollbars=no,%20resizable=no,%20copyhistory=no,%20width='%20+%20w%20+%20',%20height='%20+%20h%20+%20',%20top='%20+%20top%20+%20',%20left='%20+%20left));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20onMessage%20=%20function%20(event)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20it%20is%20a%20good%20idea%20to%20check%20if%20event.origin%20can%20be%20trusted!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20(event.origin.indexOf(window.location.hostname)%20===%20-1)%20%7B%20return;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20require%20'user'%20and%20'token'%20inside%20received%20data.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(event.data.user%20===%20undefined%20&&%20event.data.token%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20clearInterval(rejectionChecker);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20__classPrivateFieldGet(_this,%20_Auth__signInWindow,%20%22f%22).close();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20__classPrivateFieldSet(_this,%20_Auth__signInWindow,%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.removeEventListener(%22message%22,%20onMessage);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(event.data.error%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reject(event.data.error);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve(event.data);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.emitChange(event.data);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rejectionChecker%20=%20setInterval(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!__classPrivateFieldGet(_this,%20_Auth__signInWindow,%20%22f%22)%20%7C%7C%20__classPrivateFieldGet(_this,%20_Auth__signInWindow,%20%22f%22).closed)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20__classPrivateFieldSet(_this,%20_Auth__signInWindow,%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reject(%22cancelled%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.removeEventListener(%22message%22,%20onMessage);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.addEventListener(%22message%22,%20onMessage);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.signOut%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.emitChange(%7B%20user:%20null,%20token:%20null%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B2%20/*return*/%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Auth.prototype.emitChange%20=%20function%20(authData)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(authData.token%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.token%20=%20authData.token;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(authData.token%20===%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeItem(this.settings.key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20store%20key%20in%20localStorage%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20setItem(this.settings.key,%20authData.token);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20__classPrivateFieldGet(this,%20_Auth__events,%20%22f%22).emit(%22change%22,%20authData);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20Auth;%20%09%09%20%20%20%20%7D());%20%09%09%20%20%20%20_Auth__initialized%20=%20new%20WeakMap(),%20_Auth__initializationPromise%20=%20new%20WeakMap(),%20_Auth__signInWindow%20=%20new%20WeakMap(),%20_Auth__events%20=%20new%20WeakMap();%20%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20Discord%20Embedded%20App%20SDK%20%09%09%20%20%20%20%20*%20https://github.com/colyseus/colyseus/issues/707%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20All%20URLs%20must%20go%20through%20the%20local%20proxy%20from%20%09%09%20%20%20%20%20*%20https://%3Capp_id%3E.discordsays.com/.proxy/%3Cmapped_url%3E/...%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20URL%20Mapping%20Examples:%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%201.%20Using%20Colyseus%20Cloud:%20%09%09%20%20%20%20%20*%20%20%20-%20/colyseus/%7Bsubdomain%7D%20-%3E%20%7Bsubdomain%7D.colyseus.cloud%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20%20%20Example:%20%09%09%20%20%20%20%20*%20%20%20%20%20const%20client%20=%20new%20Client(%22https://xxxx.colyseus.cloud%22);%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20-------------------------------------------------------------%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%202.%20Using%20%60cloudflared%60%20tunnel:%20%09%09%20%20%20%20%20*%20%20%20-%20/colyseus/%20-%3E%20%3Cyour-cloudflared-url%3E.trycloudflare.com%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20%20%20Example:%20%09%09%20%20%20%20%20*%20%20%20%20%20const%20client%20=%20new%20Client(%22https://%3Cyour-cloudflared-url%3E.trycloudflare.com%22);%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20-------------------------------------------------------------%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%203.%20Providing%20a%20manual%20/.proxy/your-mapping:%20%09%09%20%20%20%20%20*%20%20%20-%20/your-mapping/%20-%3E%20your-endpoint.com%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20%20%20Example:%20%09%09%20%20%20%20%20*%20%20%20%20%20const%20client%20=%20new%20Client(%22/.proxy/your-mapping%22);%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20function%20discordURLBuilder(url)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20var%20localHostname%20=%20((_a%20=%20window%20===%20null%20%7C%7C%20window%20===%20void%200%20?%20void%200%20:%20window.location)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.hostname)%20%7C%7C%20%22localhost%22;%20%09%09%20%20%20%20%20%20%20%20var%20remoteHostnameSplitted%20=%20url.hostname.split('.');%20%09%09%20%20%20%20%20%20%20%20var%20subdomain%20=%20(!url.hostname.includes(%22trycloudflare.com%22)%20&&%20//%20ignore%20cloudflared%20subdomains%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20!url.hostname.includes(%22discordsays.com%22)%20&&%20//%20ignore%20discordsays.com%20subdomains%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20remoteHostnameSplitted.length%20%3E%202)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20?%20%22/%22.concat(remoteHostnameSplitted%5B0%5D)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20:%20'';%20%09%09%20%20%20%20%20%20%20%20return%20(url.pathname.startsWith(%22/.proxy%22))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20?%20%22%22.concat(url.protocol,%20%22//%22).concat(localHostname).concat(subdomain).concat(url.pathname).concat(url.search)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20:%20%22%22.concat(url.protocol,%20%22//%22).concat(localHostname,%20%22/.proxy/colyseus%22).concat(subdomain).concat(url.pathname).concat(url.search);%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20_a;%20%09%09%20%20%20%20var%20MatchMakeError%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20__extends(MatchMakeError,%20_super);%20%09%09%20%20%20%20%20%20%20%20function%20MatchMakeError(message,%20code)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20_super.call(this,%20message)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_this.code%20=%20code;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.setPrototypeOf(_this,%20MatchMakeError.prototype);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_this;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20MatchMakeError;%20%09%09%20%20%20%20%7D(Error));%20%09%09%20%20%20%20//%20-%20React%20Native%20does%20not%20provide%20%60window.location%60%20%09%09%20%20%20%20//%20-%20Cocos%20Creator%20(Native)%20does%20not%20provide%20%60window.location.hostname%60%20%09%09%20%20%20%20var%20DEFAULT_ENDPOINT%20=%20(typeof%20(window)%20!==%20%22undefined%22%20&&%20typeof%20((_a%20=%20window%20===%20null%20%7C%7C%20window%20===%20void%200%20?%20void%200%20:%20window.location)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.hostname)%20!==%20%22undefined%22)%20%09%09%20%20%20%20%20%20%20%20?%20%22%22.concat(window.location.protocol.replace(%22http%22,%20%22ws%22),%20%22//%22).concat(window.location.hostname).concat((window.location.port%20&&%20%22:%22.concat(window.location.port)))%20%09%09%20%20%20%20%20%20%20%20:%20%22ws://127.0.0.1:2567%22;%20%09%09%20%20%20%20var%20Client%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20Client(settings,%20customURLBuilder)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(settings%20===%20void%200)%20%7B%20settings%20=%20DEFAULT_ENDPOINT;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(settings)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20endpoint%20by%20url%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20url%20=%20(settings.startsWith(%22/%22))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20new%20URL(settings,%20DEFAULT_ENDPOINT)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20new%20URL(settings);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20secure%20=%20(url.protocol%20===%20%22https:%22%20%7C%7C%20url.protocol%20===%20%22wss:%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20port%20=%20Number(url.port%20%7C%7C%20(secure%20?%20443%20:%2080));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.settings%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hostname:%20url.hostname,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pathname:%20url.pathname,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20port:%20port,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20secure:%20secure%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20endpoint%20by%20settings%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(settings.port%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20settings.port%20=%20(settings.secure)%20?%20443%20:%2080;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(settings.pathname%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20settings.pathname%20=%20%22%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.settings%20=%20settings;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20make%20sure%20pathname%20does%20not%20end%20with%20%22/%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.settings.pathname.endsWith(%22/%22))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.settings.pathname%20=%20this.settings.pathname.slice(0,%20-1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.http%20=%20new%20HTTP(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.auth%20=%20new%20Auth(this.http);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.urlBuilder%20=%20customURLBuilder;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Discord%20Embedded%20SDK%20requires%20a%20custom%20URL%20builder%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.urlBuilder%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20(window)%20!==%20%22undefined%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((_b%20=%20(_a%20=%20window%20===%20null%20%7C%7C%20window%20===%20void%200%20?%20void%200%20:%20window.location)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.hostname)%20===%20null%20%7C%7C%20_b%20===%20void%200%20?%20void%200%20:%20_b.includes(%22discordsays.com%22)))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.urlBuilder%20=%20discordURLBuilder;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(%22Colyseus%20SDK:%20Discord%20Embedded%20SDK%20detected.%20Using%20custom%20URL%20builder.%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20Client.prototype.joinOrCreate%20=%20function%20(roomName,%20options,%20rootSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.createMatchMakeRequest('joinOrCreate',%20roomName,%20options,%20rootSchema)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20return%20%5B2%20/*return*/,%20_a.sent()%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.create%20=%20function%20(roomName,%20options,%20rootSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.createMatchMakeRequest('create',%20roomName,%20options,%20rootSchema)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20return%20%5B2%20/*return*/,%20_a.sent()%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.join%20=%20function%20(roomName,%20options,%20rootSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.createMatchMakeRequest('join',%20roomName,%20options,%20rootSchema)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20return%20%5B2%20/*return*/,%20_a.sent()%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.joinById%20=%20function%20(roomId,%20options,%20rootSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.createMatchMakeRequest('joinById',%20roomId,%20options,%20rootSchema)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20return%20%5B2%20/*return*/,%20_a.sent()%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Re-establish%20connection%20with%20a%20room%20this%20client%20was%20previously%20connected%20to.%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20reconnectionToken%20The%20%60room.reconnectionToken%60%20from%20previously%20connected%20room.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20rootSchema%20(optional)%20Concrete%20root%20schema%20definition%20%09%09%20%20%20%20%20%20%20%20%20*%20@returns%20Promise%3CRoom%3E%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20Client.prototype.reconnect%20=%20function%20(reconnectionToken,%20rootSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20roomId,%20token;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_b)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_b.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(reconnectionToken)%20===%20%22string%22%20&&%20typeof%20(rootSchema)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22DEPRECATED:%20.reconnect()%20now%20only%20accepts%20'reconnectionToken'%20as%20argument.%5CnYou%20can%20get%20this%20token%20from%20previously%20connected%20%60room.reconnectionToken%60%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_a%20=%20reconnectionToken.split(%22:%22),%20roomId%20=%20_a%5B0%5D,%20token%20=%20_a%5B1%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!roomId%20%7C%7C%20!token)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22Invalid%20reconnection%20token%20format.%5CnThe%20format%20should%20be%20roomId:reconnectionToken%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B4%20/*yield*/,%20this.createMatchMakeRequest('reconnect',%20roomId,%20%7B%20reconnectionToken:%20token%20%7D,%20rootSchema)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20return%20%5B2%20/*return*/,%20_b.sent()%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.getAvailableRooms%20=%20function%20(roomName)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(roomName%20===%20void%200)%20%7B%20roomName%20=%20%22%22;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.http.get(%22matchmake/%22.concat(roomName),%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20headers:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Accept':%20'application/json'%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20return%20%5B2%20/*return*/,%20(_a.sent()).data%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.consumeSeatReservation%20=%20function%20(response,%20rootSchema,%20reuseRoomInstance%20//%20used%20in%20devMode%20%09%09%20%20%20%20%20%20%20%20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20room,%20options,%20targetRoom;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room%20=%20this.createRoom(response.room.name,%20rootSchema);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room.roomId%20=%20response.room.roomId;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room.sessionId%20=%20response.sessionId;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20options%20=%20%7B%20sessionId:%20room.sessionId%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20forward%20%22reconnection%20token%22%20in%20case%20of%20reconnection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(response.reconnectionToken)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20options.reconnectionToken%20=%20response.reconnectionToken;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20targetRoom%20=%20reuseRoomInstance%20%7C%7C%20room;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20room.connect(this.buildEndpoint(response.room,%20options),%20response.devMode%20&&%20(function%20()%20%7B%20return%20__awaiter(_this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20retryCount,%20retryMaxRetries,%20retryReconnection;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.info(%22%5BColyseus%20devMode%5D:%20%22.concat(String.fromCodePoint(0x1F504),%20%22%20Re-establishing%20connection%20with%20room%20id%20'%22).concat(room.roomId,%20%22'...%22));%20//%20🔄%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20retryCount%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20retryMaxRetries%20=%208;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20retryReconnection%20=%20function%20()%20%7B%20return%20__awaiter(_this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20retryCount++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_a.label%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_a.trys.push(%5B1,%203,%20,%204%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B4%20/*yield*/,%20this.consumeSeatReservation(response,%20rootSchema,%20targetRoom)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%202:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_a.sent();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.info(%22%5BColyseus%20devMode%5D:%20%22.concat(String.fromCodePoint(0x2705),%20%22%20Successfully%20re-established%20connection%20with%20room%20'%22).concat(room.roomId,%20%22'%22));%20//%20✅%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B3%20/*break*/,%204%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%203:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_a.sent();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(retryCount%20%3C%20retryMaxRetries)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.info(%22%5BColyseus%20devMode%5D:%20%22.concat(String.fromCodePoint(0x1F504),%20%22%20retrying...%20(%22).concat(retryCount,%20%22%20out%20of%20%22).concat(retryMaxRetries,%20%22)%22));%20//%20🔄%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20setTimeout(retryReconnection,%202000);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.info(%22%5BColyseus%20devMode%5D:%20%22.concat(String.fromCodePoint(0x274C),%20%22%20Failed%20to%20reconnect.%20Is%20your%20server%20running?%20Please%20check%20server%20logs.%22));%20//%20❌%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B3%20/*break*/,%204%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%204:%20return%20%5B2%20/*return*/%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20setTimeout(retryReconnection,%202000);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B2%20/*return*/%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%7D),%20targetRoom);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B2%20/*return*/,%20new%20Promise(function%20(resolve,%20reject)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20onError%20=%20function%20(code,%20message)%20%7B%20return%20reject(new%20ServerError(code,%20message));%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20targetRoom.onError.once(onError);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20targetRoom%5B'onJoin'%5D.once(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20targetRoom.onError.remove(onError);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve(targetRoom);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.createMatchMakeRequest%20=%20function%20(method,%20roomName,%20options,%20rootSchema,%20reuseRoomInstance)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20__awaiter(this,%20void%200,%20void%200,%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20response;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20__generator(this,%20function%20(_a)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20switch%20(_a.label)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%200:%20return%20%5B4%20/*yield*/,%20this.http.post(%22matchmake/%22.concat(method,%20%22/%22).concat(roomName),%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20headers:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Accept':%20'application/json',%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Content-Type':%20'application/json'%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20body:%20JSON.stringify(options)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%201:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20response%20=%20(_a.sent()).data;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20FIXME:%20HTTP%20class%20is%20already%20handling%20this%20as%20ServerError.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(response.error)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20MatchMakeError(response.error,%20response.code);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20forward%20reconnection%20token%20during%20%22reconnect%22%20methods.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(method%20===%20%22reconnect%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20response.reconnectionToken%20=%20options.reconnectionToken;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5B4%20/*yield*/,%20this.consumeSeatReservation(response,%20rootSchema,%20reuseRoomInstance)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20case%202:%20return%20%5B2%20/*return*/,%20_a.sent()%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.createRoom%20=%20function%20(roomName,%20rootSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20Room(roomName,%20rootSchema);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.buildEndpoint%20=%20function%20(room,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20params%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20append%20provided%20options%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20name_1%20in%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!options.hasOwnProperty(name_1))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20params.push(%22%22.concat(name_1,%20%22=%22).concat(options%5Bname_1%5D));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20endpoint%20=%20(this.settings.secure)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20%22wss://%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20%22ws://%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(room.publicAddress)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20endpoint%20+=%20%22%22.concat(room.publicAddress);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20endpoint%20+=%20%22%22.concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20endpointURL%20=%20%22%22.concat(endpoint,%20%22/%22).concat(room.processId,%20%22/%22).concat(room.roomId,%20%22?%22).concat(params.join('&'));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(this.urlBuilder)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.urlBuilder(new%20URL(endpointURL))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20endpointURL;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.getHttpEndpoint%20=%20function%20(segments)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(segments%20===%20void%200)%20%7B%20segments%20=%20'';%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20path%20=%20segments.startsWith(%22/%22)%20?%20segments%20:%20%22/%22.concat(segments);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20endpointURL%20=%20%22%22.concat((this.settings.secure)%20?%20%22https%22%20:%20%22http%22,%20%22://%22).concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname).concat(path);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(this.urlBuilder)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.urlBuilder(new%20URL(endpointURL))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20endpointURL;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Client.prototype.getEndpointPort%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(this.settings.port%20!==%2080%20&&%20this.settings.port%20!==%20443)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20%22:%22.concat(this.settings.port)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20%22%22;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20Client;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20var%20SchemaSerializer%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20SchemaSerializer()%20%7B%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20SchemaSerializer.prototype.setState%20=%20function%20(rawState)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.state.decode(rawState);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaSerializer.prototype.getState%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.state;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaSerializer.prototype.patch%20=%20function%20(patches)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.state.decode(patches);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaSerializer.prototype.teardown%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20(_b%20=%20(_a%20=%20this.state)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a%5B'$changes'%5D)%20===%20null%20%7C%7C%20_b%20===%20void%200%20?%20void%200%20:%20_b.root.clearRefs();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaSerializer.prototype.handshake%20=%20function%20(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.state)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20validate%20client/server%20definitinos%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20reflection%20=%20new%20umd.Reflection();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reflection.decode(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20initialize%20reflected%20state%20from%20server%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.state%20=%20umd.Reflection.decode(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20SchemaSerializer;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20var%20NoneSerializer%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20NoneSerializer()%20%7B%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20NoneSerializer.prototype.setState%20=%20function%20(rawState)%20%7B%20%7D;%20%09%09%20%20%20%20%20%20%20%20NoneSerializer.prototype.getState%20=%20function%20()%20%7B%20return%20null;%20%7D;%20%09%09%20%20%20%20%20%20%20%20NoneSerializer.prototype.patch%20=%20function%20(patches)%20%7B%20%7D;%20%09%09%20%20%20%20%20%20%20%20NoneSerializer.prototype.teardown%20=%20function%20()%20%7B%20%7D;%20%09%09%20%20%20%20%20%20%20%20NoneSerializer.prototype.handshake%20=%20function%20(bytes)%20%7B%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20NoneSerializer;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20registerSerializer('schema',%20SchemaSerializer);%20%09%09%20%20%20%20registerSerializer('none',%20NoneSerializer);%20%20%09%09%20%20%20%20exports.Auth%20=%20Auth;%20%09%09%20%20%20%20exports.Client%20=%20Client;%20%09%09%20%20%20%20exports.Room%20=%20Room;%20%09%09%20%20%20%20exports.SchemaSerializer%20=%20SchemaSerializer;%20%09%09%20%20%20%20exports.registerSerializer%20=%20registerSerializer;%20%20%09%09%20%20%20%20Object.defineProperty(exports,%20'__esModule',%20%7B%20value:%20true%20%7D);%20%20%09%09%7D));%20%09%09%20%09%7D%20(colyseus,%20colyseus.exports));%20%20%09var%20colyseusExports%20=%20colyseus.exports;%20%20%09var%20umd%20=%20%7Bexports:%20%7B%7D%7D;%20%20%09(function%20(module,%20exports)%20%7B%20%09%09(function%20(global,%20factory)%20%7B%20%09%09%20%20%20%20factory(exports)%20;%20%09%09%7D)(commonjsGlobal,%20(function%20(exports)%20%7B%20%09%09%20%20%20%20/******************************************************************************%20%09%09%20%20%20%20Copyright%20(c)%20Microsoft%20Corporation.%20%20%09%09%20%20%20%20Permission%20to%20use,%20copy,%20modify,%20and/or%20distribute%20this%20software%20for%20any%20%09%09%20%20%20%20purpose%20with%20or%20without%20fee%20is%20hereby%20granted.%20%20%09%09%20%20%20%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22%20AND%20THE%20AUTHOR%20DISCLAIMS%20ALL%20WARRANTIES%20WITH%20%09%09%20%20%20%20REGARD%20TO%20THIS%20SOFTWARE%20INCLUDING%20ALL%20IMPLIED%20WARRANTIES%20OF%20MERCHANTABILITY%20%09%09%20%20%20%20AND%20FITNESS.%20IN%20NO%20EVENT%20SHALL%20THE%20AUTHOR%20BE%20LIABLE%20FOR%20ANY%20SPECIAL,%20DIRECT,%20%09%09%20%20%20%20INDIRECT,%20OR%20CONSEQUENTIAL%20DAMAGES%20OR%20ANY%20DAMAGES%20WHATSOEVER%20RESULTING%20FROM%20%09%09%20%20%20%20LOSS%20OF%20USE,%20DATA%20OR%20PROFITS,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20NEGLIGENCE%20OR%20%09%09%20%20%20%20OTHER%20TORTIOUS%20ACTION,%20ARISING%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20USE%20OR%20%09%09%20%20%20%20PERFORMANCE%20OF%20THIS%20SOFTWARE.%20%09%09%20%20%20%20*****************************************************************************%20*/%20%09%09%20%20%20%20/*%20global%20Reflect,%20Promise,%20SuppressedError,%20Symbol%20*/%20%20%09%09%20%20%20%20var%20extendStatics%20=%20function(d,%20b)%20%7B%20%09%09%20%20%20%20%20%20%20%20extendStatics%20=%20Object.setPrototypeOf%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20(%7B%20__proto__:%20%5B%5D%20%7D%20instanceof%20Array%20&&%20function%20(d,%20b)%20%7B%20d.__proto__%20=%20b;%20%7D)%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20function%20(d,%20b)%20%7B%20for%20(var%20p%20in%20b)%20if%20(Object.prototype.hasOwnProperty.call(b,%20p))%20d%5Bp%5D%20=%20b%5Bp%5D;%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20extendStatics(d,%20b);%20%09%09%20%20%20%20%7D;%20%20%09%09%20%20%20%20function%20__extends(d,%20b)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(typeof%20b%20!==%20%22function%22%20&&%20b%20!==%20null)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20TypeError(%22Class%20extends%20value%20%22%20+%20String(b)%20+%20%22%20is%20not%20a%20constructor%20or%20null%22);%20%09%09%20%20%20%20%20%20%20%20extendStatics(d,%20b);%20%09%09%20%20%20%20%20%20%20%20function%20__()%20%7B%20this.constructor%20=%20d;%20%7D%20%09%09%20%20%20%20%20%20%20%20d.prototype%20=%20b%20===%20null%20?%20Object.create(b)%20:%20(__.prototype%20=%20b.prototype,%20new%20__());%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20function%20__decorate(decorators,%20target,%20key,%20desc)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20c%20=%20arguments.length,%20r%20=%20c%20%3C%203%20?%20target%20:%20desc,%20d;%20%09%09%20%20%20%20%20%20%20%20if%20(typeof%20Reflect%20===%20%22object%22%20&&%20typeof%20Reflect.decorate%20===%20%22function%22)%20r%20=%20Reflect.decorate(decorators,%20target,%20key,%20desc);%20%09%09%20%20%20%20%20%20%20%20else%20for%20(var%20i%20=%20decorators.length%20-%201;%20i%20%3E=%200;%20i--)%20if%20(d%20=%20decorators%5Bi%5D)%20r%20=%20(c%20%3C%203%20?%20d(r)%20:%20c%20%3E%203%20?%20d(target,%20key,%20r)%20:%20d(target,%20key))%20%7C%7C%20r;%20%09%09%20%20%20%20%20%20%20%20return%20c%20%3E%203%20&&%20r%20&&%20Object.defineProperty(target,%20key,%20r),%20r;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20function%20__spreadArray(to,%20from,%20pack)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(arguments.length%20===%202)%20for%20(var%20i%20=%200,%20l%20=%20from.length,%20ar;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(ar%20%7C%7C%20!(i%20in%20from))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!ar)%20ar%20=%20Array.prototype.slice.call(from,%200,%20i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ar%5Bi%5D%20=%20from%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20to.concat(ar%20%7C%7C%20Array.prototype.slice.call(from));%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20typeof%20SuppressedError%20===%20%22function%22%20?%20SuppressedError%20:%20function%20(error,%20suppressed,%20message)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20e%20=%20new%20Error(message);%20%09%09%20%20%20%20%20%20%20%20return%20e.name%20=%20%22SuppressedError%22,%20e.error%20=%20error,%20e.suppressed%20=%20suppressed,%20e;%20%09%09%20%20%20%20%7D;%20%20%09%09%20%20%20%20//%20export%20const%20SWITCH_TO_STRUCTURE%20=%20193;%20(easily%20collides%20with%20DELETE_AND_ADD%20+%20fieldIndex%20=%202)%20%09%09%20%20%20%20var%20SWITCH_TO_STRUCTURE%20=%20255;%20//%20(decoding%20collides%20with%20DELETE_AND_ADD%20+%20fieldIndex%20=%2063)%20%09%09%20%20%20%20var%20TYPE_ID%20=%20213;%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20Encoding%20Schema%20field%20operations.%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20exports.OPERATION%20=%20void%200;%20%09%09%20%20%20%20(function%20(OPERATION)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20add%20new%20structure/primitive%20%09%09%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22ADD%22%5D%20=%20128%5D%20=%20%22ADD%22;%20%09%09%20%20%20%20%20%20%20%20//%20replace%20structure/primitive%20%09%09%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22REPLACE%22%5D%20=%200%5D%20=%20%22REPLACE%22;%20%09%09%20%20%20%20%20%20%20%20//%20delete%20field%20%09%09%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22DELETE%22%5D%20=%2064%5D%20=%20%22DELETE%22;%20%09%09%20%20%20%20%20%20%20%20//%20DELETE%20field,%20followed%20by%20an%20ADD%20%09%09%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22DELETE_AND_ADD%22%5D%20=%20192%5D%20=%20%22DELETE_AND_ADD%22;%20%09%09%20%20%20%20%20%20%20%20//%20TOUCH%20is%20used%20to%20determine%20hierarchy%20of%20nested%20Schema%20structures%20during%20serialization.%20%09%09%20%20%20%20%20%20%20%20//%20touches%20are%20NOT%20encoded.%20%09%09%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22TOUCH%22%5D%20=%201%5D%20=%20%22TOUCH%22;%20%09%09%20%20%20%20%20%20%20%20//%20MapSchema%20Operations%20%09%09%20%20%20%20%20%20%20%20OPERATION%5BOPERATION%5B%22CLEAR%22%5D%20=%2010%5D%20=%20%22CLEAR%22;%20%09%09%20%20%20%20%7D)(exports.OPERATION%20%7C%7C%20(exports.OPERATION%20=%20%7B%7D));%20%09%09%20%20%20%20//%20export%20enum%20OPERATION%20%7B%20%09%09%20%20%20%20//%20%20%20%20%20//%20add%20new%20structure/primitive%20%09%09%20%20%20%20//%20%20%20%20%20//%20(128)%20%09%09%20%20%20%20//%20%20%20%20%20ADD%20=%20128,%20//%2010000000,%20%09%09%20%20%20%20//%20%20%20%20%20//%20replace%20structure/primitive%20%09%09%20%20%20%20//%20%20%20%20%20REPLACE%20=%201,//%2000000001%20%09%09%20%20%20%20//%20%20%20%20%20//%20delete%20field%20%09%09%20%20%20%20//%20%20%20%20%20DELETE%20=%20192,%20//%2011000000%20%09%09%20%20%20%20//%20%20%20%20%20//%20DELETE%20field,%20followed%20by%20an%20ADD%20%09%09%20%20%20%20//%20%20%20%20%20DELETE_AND_ADD%20=%20224,%20//%2011100000%20%09%09%20%20%20%20//%20%20%20%20%20//%20TOUCH%20is%20used%20to%20determine%20hierarchy%20of%20nested%20Schema%20structures%20during%20serialization.%20%09%09%20%20%20%20//%20%20%20%20%20//%20touches%20are%20NOT%20encoded.%20%09%09%20%20%20%20//%20%20%20%20%20TOUCH%20=%200,%20//%2000000000%20%09%09%20%20%20%20//%20%20%20%20%20//%20MapSchema%20Operations%20%09%09%20%20%20%20//%20%20%20%20%20CLEAR%20=%2010,%20%09%09%20%20%20%20//%20%7D%20%20%09%09%20%20%20%20var%20ChangeTree%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20ChangeTree(ref,%20parent,%20root)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changed%20=%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges%20=%20new%20Set();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20cached%20indexes%20for%20filtering%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.caches%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.currentCustomOperation%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.ref%20=%20ref;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.setParent(parent,%20root);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.setParent%20=%20function%20(parent,%20root,%20parentIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.indexes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.indexes%20=%20(this.ref%20instanceof%20Schema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.ref%5B'_definition'%5D.indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.parent%20=%20parent;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.parentIndex%20=%20parentIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20avoid%20setting%20parents%20with%20empty%20%60root%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!root)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.root%20=%20root;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20assign%20same%20parent%20on%20child%20structures%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.ref%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20this.ref%5B'_definition'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20field%20in%20definition.schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20this.ref%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20parentIndex_1%20=%20definition.indexes%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this.ref,%20root,%20parentIndex_1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(typeof%20(this.ref)%20===%20%22object%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.ref.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTreee%20=%20value%5B'$changes'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20parentIndex_2%20=%20_this.ref%5B'$changes'%5D.indexes%5Bkey%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTreee.setParent(_this.ref,%20_this.root,%20parentIndex_2);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.operation%20=%20function%20(op)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changes.set(--this.currentCustomOperation,%20op);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.change%20=%20function%20(fieldName,%20operation)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation%20===%20void%200)%20%7B%20operation%20=%20exports.OPERATION.ADD;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20(typeof%20(fieldName)%20===%20%22number%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20fieldName%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this.indexes%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.assertValidIndex(index,%20fieldName);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20previousChange%20=%20this.changes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!previousChange%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousChange.op%20===%20exports.OPERATION.DELETE%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousChange.op%20===%20exports.OPERATION.TOUCH%20//%20(mazmorra.io's%20BattleAction%20issue)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.set(index,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op:%20(!previousChange)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20operation%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20(previousChange.op%20===%20exports.OPERATION.DELETE)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20exports.OPERATION.DELETE_AND_ADD%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20operation,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20:%20OPERATION.REPLACE,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20index:%20index%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges.add(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changed%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.touchParents();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.touch%20=%20function%20(fieldName)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20(typeof%20(fieldName)%20===%20%22number%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20fieldName%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this.indexes%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.assertValidIndex(index,%20fieldName);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.changes.has(index))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.set(index,%20%7B%20op:%20exports.OPERATION.TOUCH,%20index:%20index%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges.add(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20ensure%20touch%20is%20placed%20until%20the%20$root%20is%20found.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.touchParents();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.touchParents%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.parent)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.parent%5B'$changes'%5D.touch(this.parentIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.getType%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.ref%5B'_definition'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20this.ref%5B'_definition'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20definition.schema%5Bdefinition.fieldsByIndex%5Bindex%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20this.parent%5B'_definition'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20parentType%20=%20definition.schema%5Bdefinition.fieldsByIndex%5Bthis.parentIndex%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Get%20the%20child%20type%20from%20parent%20structure.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20%5B%22string%22%5D%20=%3E%20%22string%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20%7B%20map:%20%22string%22%20%7D%20=%3E%20%22string%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20%7B%20set:%20%22string%22%20%7D%20=%3E%20%22string%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Object.values(parentType)%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.getChildrenFilter%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20childFilters%20=%20this.parent%5B'_definition'%5D.childFilters;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20childFilters%20&&%20childFilters%5Bthis.parentIndex%5D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20used%20during%20%60.encode()%60%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.getValue%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.ref%5B'getByIndex'%5D(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.delete%20=%20function%20(fieldName)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20(typeof%20(fieldName)%20===%20%22number%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20fieldName%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this.indexes%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.warn(%22@colyseus/schema%20%22.concat(this.ref.constructor.name,%20%22:%20trying%20to%20delete%20non-existing%20index:%20%22).concat(fieldName,%20%22%20(%22).concat(index,%20%22)%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20previousValue%20=%20this.getValue(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log(%22$changes.delete%20=%3E%22,%20%7B%20fieldName,%20index,%20previousValue%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changes.set(index,%20%7B%20op:%20exports.OPERATION.DELETE,%20index:%20index%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20delete%20cache%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20delete%20this.caches%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20remove%20%60root%60%20reference%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%20&&%20previousValue%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue%5B'$changes'%5D.parent%20=%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changed%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.touchParents();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.discard%20=%20function%20(changed,%20discardAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(changed%20===%20void%200)%20%7B%20changed%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(discardAll%20===%20void%200)%20%7B%20discardAll%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Map,%20Array,%20etc:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Remove%20cached%20key%20to%20ensure%20ADD%20operations%20is%20unsed%20instead%20of%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20REPLACE%20in%20case%20same%20key%20is%20used%20on%20next%20patches.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20this.%20this%20is%20not%20relevant%20for%20Collection%20and%20Set.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!(this.ref%20instanceof%20Schema))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.changes.forEach(function%20(change)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20_this.ref%5B'getIndex'%5D(change.index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20delete%20_this.indexes%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changed%20=%20changed;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(discardAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.allChanges.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20re-set%20%60currentCustomOperation%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.currentCustomOperation%20=%200;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Recursively%20discard%20all%20changes%20from%20this,%20and%20child%20structures.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.discardAll%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.changes.forEach(function%20(change)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20_this.getValue(change.index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.discardAll();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.discard();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20cache(field:%20number,%20beginIndex:%20number,%20endIndex:%20number)%20%7B%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.cache%20=%20function%20(field,%20cachedBytes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.caches%5Bfield%5D%20=%20cachedBytes;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.clone%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20ChangeTree(this.ref,%20this.parent,%20this.root);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.ensureRefId%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20skip%20if%20refId%20is%20already%20set.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.refId%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.refId%20=%20this.root.getNextUniqueId();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ChangeTree.prototype.assertValidIndex%20=%20function%20(index,%20fieldName)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ChangeTree:%20missing%20index%20for%20field%20%5C%22%22.concat(fieldName,%20%22%5C%22%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20ChangeTree;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20function%20addCallback($callbacks,%20op,%20callback,%20existing)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20initialize%20list%20of%20callbacks%20%09%09%20%20%20%20%20%20%20%20if%20(!$callbacks%5Bop%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20$callbacks%5Bop%5D%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20$callbacks%5Bop%5D.push(callback);%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20Trigger%20callback%20for%20existing%20elements%20%09%09%20%20%20%20%20%20%20%20//%20-%20OPERATION.ADD%20%09%09%20%20%20%20%20%20%20%20//%20-%20OPERATION.REPLACE%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20existing%20===%20null%20%7C%7C%20existing%20===%20void%200%20?%20void%200%20:%20existing.forEach(function%20(item,%20key)%20%7B%20return%20callback(item,%20key);%20%7D);%20%09%09%20%20%20%20%20%20%20%20return%20function%20()%20%7B%20return%20spliceOne($callbacks%5Bop%5D,%20$callbacks%5Bop%5D.indexOf(callback));%20%7D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20removeChildRefs(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20var%20needRemoveRef%20=%20(typeof%20(this.$changes.getType())%20!==%20%22string%22);%20%09%09%20%20%20%20%20%20%20%20this.$items.forEach(function%20(item,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20changes.push(%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId:%20_this.$changes.refId,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op:%20exports.OPERATION.DELETE,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field:%20key,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20undefined,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue:%20item%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(needRemoveRef)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.$changes.root.removeRef(item%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20spliceOne(arr,%20index)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20manually%20splice%20an%20array%20%09%09%20%20%20%20%20%20%20%20if%20(index%20===%20-1%20%7C%7C%20index%20%3E=%20arr.length)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20len%20=%20arr.length%20-%201;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%20index;%20i%20%3C%20len;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20arr%5Bi%5D%20=%20arr%5Bi%20+%201%5D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20arr.length%20=%20len;%20%09%09%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20DEFAULT_SORT%20=%20function%20(a,%20b)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20A%20=%20a.toString();%20%09%09%20%20%20%20%20%20%20%20var%20B%20=%20b.toString();%20%09%09%20%20%20%20%20%20%20%20if%20(A%20%3C%20B)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20-1;%20%09%09%20%20%20%20%20%20%20%20else%20if%20(A%20%3E%20B)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20else%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%200;%20%09%09%20%20%20%20%7D;%20%09%09%20%20%20%20function%20getArrayProxy(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20value%5B'$proxy'%5D%20=%20true;%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20compatibility%20with%20@colyseus/schema%200.5.x%20%09%09%20%20%20%20%20%20%20%20//%20-%20allow%20%60map%5B%22key%22%5D%60%20%09%09%20%20%20%20%20%20%20%20//%20-%20allow%20%60map%5B%22key%22%5D%20=%20%22xxx%22%60%20%09%09%20%20%20%20%20%20%20%20//%20-%20allow%20%60delete%20map%5B%22key%22%5D%60%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20value%20=%20new%20Proxy(value,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20(obj,%20prop)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20!==%20%22symbol%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20!isNaN(prop)%20//%20https://stackoverflow.com/a/175787/892698%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj.at(prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj%5Bprop%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(obj,%20prop,%20setValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20!==%20%22symbol%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20!isNaN(prop))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(obj%5B'$items'%5D.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20parseInt(indexes%5Bprop%5D%20%7C%7C%20prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(setValue%20===%20undefined%20%7C%7C%20setValue%20===%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.deleteAt(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.setAt(key,%20setValue);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%5Bprop%5D%20=%20setValue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20deleteProperty:%20function%20(obj,%20prop)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20===%20%22number%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.deleteAt(prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20delete%20obj%5Bprop%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20has:%20function%20(obj,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(key)%20!==%20%22symbol%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20!isNaN(Number(key)))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj%5B'$items'%5D.has(Number(key));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Reflect.has(obj,%20key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20var%20ArraySchema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20ArraySchema()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20items%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20items%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes%20=%20new%20ChangeTree(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.push.apply(this,%20items);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.onAdd%20=%20function%20(callback,%20triggerAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(triggerAll%20===%20void%200)%20%7B%20triggerAll%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%7B%7D)),%20exports.OPERATION.ADD,%20callback,%20(triggerAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.onRemove%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%7B%7D),%20exports.OPERATION.DELETE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.onChange%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%7B%7D),%20exports.OPERATION.REPLACE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20type%20format:%20%5B%22string%22%5D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Array.isArray(type)%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20type%20format:%20%7B%20array:%20%22string%22%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(type%5B'array'%5D%20!==%20undefined));%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(ArraySchema.prototype,%20%22length%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.splice(value,%20this.length%20-%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.push%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20values%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20values%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20lastIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20values.forEach(function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20set%20%22index%22%20for%20reference.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20lastIndex%20=%20_this.$refId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(lastIndex,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20lastIndex;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Removes%20the%20last%20element%20from%20an%20array%20and%20returns%20it.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.pop%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20Array.from(this.$indexes.values()).pop();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(key%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20this.$items.get(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.at%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20FIXME:%20this%20should%20be%20O(1)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20index%20=%20Math.trunc(index)%20%7C%7C%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Allow%20negative%20indexing%20from%20the%20end%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20%3C%200)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20index%20+=%20this.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20OOB%20access%20is%20guaranteed%20to%20return%20undefined%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20%3C%200%20%7C%7C%20index%20%3E=%20this.length)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20Array.from(this.$items.keys())%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.setAt%20=%20function%20(index,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%20undefined%20%7C%7C%20value%20===%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.error(%22ArraySchema%20items%20cannot%20be%20null%20nor%20undefined;%20Use%20%60deleteAt(index)%60%20instead.%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20skip%20if%20the%20value%20is%20the%20same%20as%20cached.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.$items.get(index)%20===%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(_b%20=%20(_a%20=%20this.$changes.indexes%5Bindex%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.op)%20!==%20null%20&&%20_b%20!==%20void%200%20?%20_b%20:%20exports.OPERATION.ADD;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%5Bindex%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.set(index,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(index,%20operation);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.deleteAt%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20Array.from(this.$items.keys())%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(key%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$deleteAt(key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.$deleteAt%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20delete%20at%20internal%20index%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.delete(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.clear%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20discard%20previous%20operations.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discard(true,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20previous%20indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20When%20decoding:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20enqueue%20items%20for%20DELETE%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20flag%20child%20items%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeChildRefs.call(this,%20changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.operation(%7B%20index:%200,%20op:%20exports.OPERATION.CLEAR%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20touch%20all%20structures%20until%20reach%20root%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.touchParents();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Combines%20two%20or%20more%20arrays.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20items%20Additional%20items%20to%20add%20to%20the%20end%20of%20array1.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.concat%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20items%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20items%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20(_a%20=%20Array.from(this.$items.values())).concat.apply(_a,%20items),%20false)))();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Adds%20all%20the%20elements%20of%20an%20array%20separated%20by%20the%20specified%20separator%20string.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20separator%20A%20string%20used%20to%20separate%20one%20element%20of%20an%20array%20from%20the%20next%20in%20the%20resulting%20String.%20If%20omitted,%20the%20array%20elements%20are%20separated%20with%20a%20comma.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.join%20=%20function%20(separator)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).join(separator);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Reverses%20the%20elements%20in%20an%20Array.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.reverse%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20reversedItems%20=%20Array.from(this.$items.values()).reverse();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20reversedItems.forEach(function%20(item,%20i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(indexes%5Bi%5D,%20item);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Removes%20the%20first%20element%20from%20an%20array%20and%20returns%20it.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.shift%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20shiftAt%20=%20indexes.shift();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(shiftAt%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20this.$items.get(shiftAt);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$deleteAt(shiftAt);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20a%20section%20of%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20start%20The%20beginning%20of%20the%20specified%20portion%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20end%20The%20end%20of%20the%20specified%20portion%20of%20the%20array.%20This%20is%20exclusive%20of%20the%20element%20at%20the%20index%20'end'.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.slice%20=%20function%20(start,%20end)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20sliced%20=%20new%20ArraySchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20sliced.push.apply(sliced,%20Array.from(this.$items.values()).slice(start,%20end));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20sliced;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Sorts%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20compareFn%20Function%20used%20to%20determine%20the%20order%20of%20the%20elements.%20It%20is%20expected%20to%20return%20%09%09%20%20%20%20%20%20%20%20%20*%20a%20negative%20value%20if%20first%20argument%20is%20less%20than%20second%20argument,%20zero%20if%20they're%20equal%20and%20a%20positive%20%09%09%20%20%20%20%20%20%20%20%20*%20value%20otherwise.%20If%20omitted,%20the%20elements%20are%20sorted%20in%20ascending,%20ASCII%20character%20order.%20%09%09%20%20%20%20%20%20%20%20%20*%20%60%60%60ts%20%09%09%20%20%20%20%20%20%20%20%20*%20%5B11,2,22,1%5D.sort((a,%20b)%20=%3E%20a%20-%20b)%20%09%09%20%20%20%20%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.sort%20=%20function%20(compareFn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(compareFn%20===%20void%200)%20%7B%20compareFn%20=%20DEFAULT_SORT;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20sortedItems%20=%20Array.from(this.$items.values()).sort(compareFn);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20sortedItems.forEach(function%20(item,%20i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(indexes%5Bi%5D,%20item);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Removes%20elements%20from%20an%20array%20and,%20if%20necessary,%20inserts%20new%20elements%20in%20their%20place,%20returning%20the%20deleted%20elements.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20start%20The%20zero-based%20location%20in%20the%20array%20from%20which%20to%20start%20removing%20elements.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20deleteCount%20The%20number%20of%20elements%20to%20remove.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20items%20Elements%20to%20insert%20into%20the%20array%20in%20place%20of%20the%20deleted%20elements.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.splice%20=%20function%20(start,%20deleteCount)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(deleteCount%20===%20void%200)%20%7B%20deleteCount%20=%20this.length%20-%20start;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20items%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%202;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20items%5B_i%20-%202%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20removedItems%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%20start;%20i%20%3C%20start%20+%20deleteCount;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removedItems.push(this.$items.get(indexes%5Bi%5D));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$deleteAt(indexes%5Bi%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20items.length;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.setAt(start%20+%20i,%20items%5Bi%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20removedItems;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Inserts%20new%20elements%20at%20the%20start%20of%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20items%20%20Elements%20to%20insert%20at%20the%20start%20of%20the%20Array.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.unshift%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20items%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20items%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20length%20=%20this.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20addedLength%20=%20items.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20indexes%20=%20Array.from(this.$items.keys());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20previousValues%20=%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20items.forEach(function%20(item,%20i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(i,%20item);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20previousValues.forEach(function%20(previousValue,%20i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.setAt(addedLength%20+%20i,%20previousValue);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20length%20+%20addedLength;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20the%20index%20of%20the%20first%20occurrence%20of%20a%20value%20in%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20searchElement%20The%20value%20to%20locate%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20fromIndex%20The%20array%20index%20at%20which%20to%20begin%20the%20search.%20If%20fromIndex%20is%20omitted,%20the%20search%20starts%20at%20index%200.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.indexOf%20=%20function%20(searchElement,%20fromIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).indexOf(searchElement,%20fromIndex);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20the%20index%20of%20the%20last%20occurrence%20of%20a%20specified%20value%20in%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20searchElement%20The%20value%20to%20locate%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20fromIndex%20The%20array%20index%20at%20which%20to%20begin%20the%20search.%20If%20fromIndex%20is%20omitted,%20the%20search%20starts%20at%20the%20last%20index%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.lastIndexOf%20=%20function%20(searchElement,%20fromIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(fromIndex%20===%20void%200)%20%7B%20fromIndex%20=%20this.length%20-%201;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).lastIndexOf(searchElement,%20fromIndex);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Determines%20whether%20all%20the%20members%20of%20an%20array%20satisfy%20the%20specified%20test.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20The%20every%20method%20calls%20%09%09%20%20%20%20%20%20%20%20%20*%20the%20callbackfn%20function%20for%20each%20element%20in%20the%20array%20until%20the%20callbackfn%20returns%20a%20value%20%09%09%20%20%20%20%20%20%20%20%20*%20which%20is%20coercible%20to%20the%20Boolean%20value%20false,%20or%20until%20the%20end%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callbackfn%20function.%20%09%09%20%20%20%20%20%20%20%20%20*%20If%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.every%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).every(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Determines%20whether%20the%20specified%20callback%20function%20returns%20true%20for%20any%20element%20of%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20The%20some%20method%20calls%20%09%09%20%20%20%20%20%20%20%20%20*%20the%20callbackfn%20function%20for%20each%20element%20in%20the%20array%20until%20the%20callbackfn%20returns%20a%20value%20%09%09%20%20%20%20%20%20%20%20%20*%20which%20is%20coercible%20to%20the%20Boolean%20value%20true,%20or%20until%20the%20end%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callbackfn%20function.%20%09%09%20%20%20%20%20%20%20%20%20*%20If%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.some%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).some(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Performs%20the%20specified%20action%20for%20each%20element%20in%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20forEach%20calls%20the%20callbackfn%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callbackfn%20function.%20If%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.forEach%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Array.from(this.$items.values()).forEach(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Calls%20a%20defined%20callback%20function%20on%20each%20element%20of%20an%20array,%20and%20returns%20an%20array%20that%20contains%20the%20results.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20The%20map%20method%20calls%20the%20callbackfn%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callbackfn%20function.%20If%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.map%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).map(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.filter%20=%20function%20(callbackfn,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).filter(callbackfn,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Calls%20the%20specified%20callback%20function%20for%20all%20the%20elements%20in%20an%20array.%20The%20return%20value%20of%20the%20callback%20function%20is%20the%20accumulated%20result,%20and%20is%20provided%20as%20an%20argument%20in%20the%20next%20call%20to%20the%20callback%20function.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20four%20arguments.%20The%20reduce%20method%20calls%20the%20callbackfn%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20initialValue%20If%20initialValue%20is%20specified,%20it%20is%20used%20as%20the%20initial%20value%20to%20start%20the%20accumulation.%20The%20first%20call%20to%20the%20callbackfn%20function%20provides%20this%20value%20as%20an%20argument%20instead%20of%20an%20array%20value.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.reduce%20=%20function%20(callbackfn,%20initialValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.prototype.reduce.apply(Array.from(this.$items.values()),%20arguments);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Calls%20the%20specified%20callback%20function%20for%20all%20the%20elements%20in%20an%20array,%20in%20descending%20order.%20The%20return%20value%20of%20the%20callback%20function%20is%20the%20accumulated%20result,%20and%20is%20provided%20as%20an%20argument%20in%20the%20next%20call%20to%20the%20callback%20function.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20callbackfn%20A%20function%20that%20accepts%20up%20to%20four%20arguments.%20The%20reduceRight%20method%20calls%20the%20callbackfn%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20initialValue%20If%20initialValue%20is%20specified,%20it%20is%20used%20as%20the%20initial%20value%20to%20start%20the%20accumulation.%20The%20first%20call%20to%20the%20callbackfn%20function%20provides%20this%20value%20as%20an%20argument%20instead%20of%20an%20array%20value.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.reduceRight%20=%20function%20(callbackfn,%20initialValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.prototype.reduceRight.apply(Array.from(this.$items.values()),%20arguments);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20the%20value%20of%20the%20first%20element%20in%20the%20array%20where%20predicate%20is%20true,%20and%20undefined%20%09%09%20%20%20%20%20%20%20%20%20*%20otherwise.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20predicate%20find%20calls%20predicate%20once%20for%20each%20element%20of%20the%20array,%20in%20ascending%20%09%09%20%20%20%20%20%20%20%20%20*%20order,%20until%20it%20finds%20one%20where%20predicate%20returns%20true.%20If%20such%20an%20element%20is%20found,%20find%20%09%09%20%20%20%20%20%20%20%20%20*%20immediately%20returns%20that%20element%20value.%20Otherwise,%20find%20returns%20undefined.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20If%20provided,%20it%20will%20be%20used%20as%20the%20this%20value%20for%20each%20invocation%20of%20%09%09%20%20%20%20%20%20%20%20%20*%20predicate.%20If%20it%20is%20not%20provided,%20undefined%20is%20used%20instead.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.find%20=%20function%20(predicate,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).find(predicate,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20the%20index%20of%20the%20first%20element%20in%20the%20array%20where%20predicate%20is%20true,%20and%20-1%20%09%09%20%20%20%20%20%20%20%20%20*%20otherwise.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20predicate%20find%20calls%20predicate%20once%20for%20each%20element%20of%20the%20array,%20in%20ascending%20%09%09%20%20%20%20%20%20%20%20%20*%20order,%20until%20it%20finds%20one%20where%20predicate%20returns%20true.%20If%20such%20an%20element%20is%20found,%20%09%09%20%20%20%20%20%20%20%20%20*%20findIndex%20immediately%20returns%20that%20element%20index.%20Otherwise,%20findIndex%20returns%20-1.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20If%20provided,%20it%20will%20be%20used%20as%20the%20this%20value%20for%20each%20invocation%20of%20%09%09%20%20%20%20%20%20%20%20%20*%20predicate.%20If%20it%20is%20not%20provided,%20undefined%20is%20used%20instead.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.findIndex%20=%20function%20(predicate,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).findIndex(predicate,%20thisArg);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20the%20this%20object%20after%20filling%20the%20section%20identified%20by%20start%20and%20end%20with%20value%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20value%20value%20to%20fill%20array%20section%20with%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20start%20index%20to%20start%20filling%20the%20array%20at.%20If%20start%20is%20negative,%20it%20is%20treated%20as%20%09%09%20%20%20%20%20%20%20%20%20*%20length+start%20where%20length%20is%20the%20length%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20end%20index%20to%20stop%20filling%20the%20array%20at.%20If%20end%20is%20negative,%20it%20is%20treated%20as%20%09%09%20%20%20%20%20%20%20%20%20*%20length+end.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.fill%20=%20function%20(value,%20start,%20end)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ArraySchema%23fill()%20not%20implemented%22);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20the%20this%20object%20after%20copying%20a%20section%20of%20the%20array%20identified%20by%20start%20and%20end%20%09%09%20%20%20%20%20%20%20%20%20*%20to%20the%20same%20array%20starting%20at%20position%20target%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20target%20If%20target%20is%20negative,%20it%20is%20treated%20as%20length+target%20where%20length%20is%20the%20%09%09%20%20%20%20%20%20%20%20%20*%20length%20of%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20start%20If%20start%20is%20negative,%20it%20is%20treated%20as%20length+start.%20If%20end%20is%20negative,%20it%20%09%09%20%20%20%20%20%20%20%20%20*%20is%20treated%20as%20length+end.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20end%20If%20not%20specified,%20length%20of%20the%20this%20object%20is%20used%20as%20its%20default%20value.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.copyWithin%20=%20function%20(target,%20start,%20end)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ArraySchema%23copyWithin()%20not%20implemented%22);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20a%20string%20representation%20of%20an%20array.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.toString%20=%20function%20()%20%7B%20return%20this.$items.toString();%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20a%20string%20representation%20of%20an%20array.%20The%20elements%20are%20converted%20to%20string%20using%20their%20toLocalString%20methods.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.toLocaleString%20=%20function%20()%20%7B%20return%20this.$items.toLocaleString();%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20Iterator%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype%5BSymbol.iterator%5D%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values())%5BSymbol.iterator%5D();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(ArraySchema,%20Symbol.species,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20ArraySchema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20an%20iterable%20of%20key,%20value%20pairs%20for%20every%20entry%20in%20the%20array%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.entries%20=%20function%20()%20%7B%20return%20this.$items.entries();%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20an%20iterable%20of%20keys%20in%20the%20array%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.keys%20=%20function%20()%20%7B%20return%20this.$items.keys();%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20an%20iterable%20of%20values%20in%20the%20array%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.values%20=%20function%20()%20%7B%20return%20this.$items.values();%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Determines%20whether%20an%20array%20includes%20a%20certain%20element,%20returning%20true%20or%20false%20as%20appropriate.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20searchElement%20The%20element%20to%20search%20for.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20fromIndex%20The%20position%20in%20this%20array%20at%20which%20to%20begin%20searching%20for%20searchElement.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.includes%20=%20function%20(searchElement,%20fromIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).includes(searchElement,%20fromIndex);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20ES2022%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Calls%20a%20defined%20callback%20function%20on%20each%20element%20of%20an%20array.%20Then,%20flattens%20the%20result%20into%20%09%09%20%20%20%20%20%20%20%20%20*%20a%20new%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20This%20is%20identical%20to%20a%20map%20followed%20by%20flat%20with%20depth%201.%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20callback%20A%20function%20that%20accepts%20up%20to%20three%20arguments.%20The%20flatMap%20method%20calls%20the%20%09%09%20%20%20%20%20%20%20%20%20*%20callback%20function%20one%20time%20for%20each%20element%20in%20the%20array.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20thisArg%20An%20object%20to%20which%20the%20this%20keyword%20can%20refer%20in%20the%20callback%20function.%20If%20%09%09%20%20%20%20%20%20%20%20%20*%20thisArg%20is%20omitted,%20undefined%20is%20used%20as%20the%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.flatMap%20=%20function%20(callback,%20thisArg)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ArraySchema%23flatMap()%20is%20not%20supported.%22);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Returns%20a%20new%20array%20with%20all%20sub-array%20elements%20concatenated%20into%20it%20recursively%20up%20to%20the%20%09%09%20%20%20%20%20%20%20%20%20*%20specified%20depth.%20%09%09%20%20%20%20%20%20%20%20%20*%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20depth%20The%20maximum%20recursion%20depth%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.flat%20=%20function%20(depth)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22ArraySchema%23flat()%20is%20not%20supported.%22);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.findLast%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20arr%20=%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20arr.findLast.apply(arr,%20arguments);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.findLastIndex%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20arr%20=%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20arr.findLastIndex.apply(arr,%20arguments);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20ES2023%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.with%20=%20function%20(index,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20copy%20=%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20copy%5Bindex%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20copy,%20false)))();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.toReversed%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).reverse();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.toSorted%20=%20function%20(compareFn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).sort(compareFn);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.toSpliced%20=%20function%20(start,%20deleteCount)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20copy%20=%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20@ts-ignore%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20copy.toSpliced.apply(copy,%20arguments);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.setIndex%20=%20function%20(index,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.getIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(this.$indexes.get(index));%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.toArray%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.toArray().map(function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(typeof%20(value%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20value%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20Decoding%20utilities%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20ArraySchema.prototype.clone%20=%20function%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20Array.from(this.$items.values()),%20false)))();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20this.map(function%20(item)%20%7B%20return%20((item%5B'$changes'%5D)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20item.clone()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20item);%20%7D),%20false)))();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20ArraySchema;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20function%20getMapProxy(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20value%5B'$proxy'%5D%20=%20true;%20%09%09%20%20%20%20%20%20%20%20value%20=%20new%20Proxy(value,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20(obj,%20prop)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20!==%20%22symbol%22%20&&%20//%20accessing%20properties%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20(obj%5Bprop%5D)%20===%20%22undefined%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj.get(prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20obj%5Bprop%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(obj,%20prop,%20setValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(prop)%20!==%20%22symbol%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(prop.indexOf(%22$%22)%20===%20-1%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prop%20!==%20%22onAdd%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prop%20!==%20%22onRemove%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prop%20!==%20%22onChange%22))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.set(prop,%20setValue);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%5Bprop%5D%20=%20setValue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20deleteProperty:%20function%20(obj,%20prop)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.delete(prop);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20var%20MapSchema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20MapSchema(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes%20=%20new%20ChangeTree(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(initialValues%20instanceof%20Map%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialValues%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialValues.forEach(function%20(v,%20k)%20%7B%20return%20_this.set(k,%20v);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20k%20in%20initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.set(k,%20initialValues%5Bk%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.onAdd%20=%20function%20(callback,%20triggerAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(triggerAll%20===%20void%200)%20%7B%20triggerAll%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%7B%7D)),%20exports.OPERATION.ADD,%20callback,%20(triggerAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.onRemove%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%7B%7D),%20exports.OPERATION.DELETE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.onChange%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%7B%7D),%20exports.OPERATION.REPLACE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20type%5B'map'%5D%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20Iterator%20*/%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype%5BSymbol.iterator%5D%20=%20function%20()%20%7B%20return%20this.$items%5BSymbol.iterator%5D();%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(MapSchema.prototype,%20Symbol.toStringTag,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20return%20this.$items%5BSymbol.toStringTag%5D;%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(MapSchema,%20Symbol.species,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20MapSchema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.set%20=%20function%20(key,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%20undefined%20%7C%7C%20value%20===%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22MapSchema%23set('%22.concat(key,%20%22',%20%22).concat(value,%20%22):%20trying%20to%20set%20%22).concat(value,%20%22%20value%20on%20'%22).concat(key,%20%22'.%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Force%20%22key%22%20as%20string%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20See:%20https://github.com/colyseus/colyseus/issues/561%23issuecomment-1646733468%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20key%20=%20key.toString();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20get%20%22index%22%20for%20this%20value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20hasIndex%20=%20typeof%20(this.$changes.indexes%5Bkey%5D)%20!==%20%22undefined%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20(hasIndex)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$changes.indexes%5Bkey%5D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this.$refId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(hasIndex)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20exports.OPERATION.REPLACE%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20exports.OPERATION.ADD;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20isRef%20=%20(value%5B'$changes'%5D)%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(isRef)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20(encoding)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20set%20a%20unique%20id%20to%20relate%20directly%20with%20this%20key/value.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!hasIndex)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%5Bkey%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(!isRef%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.get(key)%20===%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20value%20is%20the%20same,%20avoid%20re-encoding%20it.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(isRef%20&&%20//%20if%20is%20schema,%20force%20ADD%20operation%20if%20value%20differ%20from%20previous%20one.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$items.get(key)%20!==%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20operation%20=%20exports.OPERATION.ADD;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.set(key,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(key,%20operation);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.get%20=%20function%20(key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.delete%20=%20function%20(key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20add%20a%20%22purge%22%20method%20after%20.encode()%20runs,%20to%20cleanup%20removed%20%60$indexes%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20We%20don't%20remove%20$indexes%20to%20allow%20setting%20the%20same%20key%20in%20the%20same%20patch%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20(See%20%22should%20allow%20to%20remove%20and%20set%20an%20item%20in%20the%20same%20place%22%20test)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20//%20const%20index%20=%20this.$changes.indexes%5Bkey%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20//%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(key.toString());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.clear%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20discard%20previous%20operations.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discard(true,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20previous%20indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20When%20decoding:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20enqueue%20items%20for%20DELETE%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20flag%20child%20items%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeChildRefs.call(this,%20changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.operation(%7B%20index:%200,%20op:%20exports.OPERATION.CLEAR%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20touch%20all%20structures%20until%20reach%20root%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.touchParents();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.has%20=%20function%20(key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.has(key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.forEach%20=%20function%20(callbackfn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.forEach(callbackfn);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.entries%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.keys%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.keys();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.values%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.values();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(MapSchema.prototype,%20%22size%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.setIndex%20=%20function%20(index,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.getIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(this.$indexes.get(index));%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20map%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20map%5Bkey%5D%20=%20(typeof%20(value%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20value%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20map;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20Decoding%20utilities%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20MapSchema.prototype.clone%20=%20function%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20client-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20Object.assign(new%20MapSchema(),%20this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20server-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20MapSchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.set(key,%20value%5B'clone'%5D());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.set(key,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20MapSchema;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20var%20registeredTypes%20=%20%7B%7D;%20%09%09%20%20%20%20function%20registerType(identifier,%20definition)%20%7B%20%09%09%20%20%20%20%20%20%20%20registeredTypes%5Bidentifier%5D%20=%20definition;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20getType(identifier)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20registeredTypes%5Bidentifier%5D;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20SchemaDefinition%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20SchemaDefinition()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20use%20a%20%22field%22%20structure%20combining%20all%20these%20properties%20per-field.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.fieldsByIndex%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.deprecated%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.descriptors%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20SchemaDefinition.create%20=%20function%20(parent)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20new%20SchemaDefinition();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20support%20inheritance%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.schema%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.schema%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.indexes%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.indexes%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.fieldsByIndex%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.fieldsByIndex%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.descriptors%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.deprecated%20=%20Object.assign(%7B%7D,%20parent%20&&%20parent.deprecated%20%7C%7C%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20definition;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaDefinition.prototype.addField%20=%20function%20(field,%20type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.getNextFieldIndex();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.fieldsByIndex%5Bindex%5D%20=%20field;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.indexes%5Bfield%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.schema%5Bfield%5D%20=%20(Array.isArray(type))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20%7B%20array:%20type%5B0%5D%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20type;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaDefinition.prototype.hasField%20=%20function%20(field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.indexes%5Bfield%5D%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaDefinition.prototype.addFilter%20=%20function%20(field,%20cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.filters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.filters%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.indexesWithFilters%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.filters%5Bthis.indexes%5Bfield%5D%5D%20=%20cb;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.indexesWithFilters.push(this.indexes%5Bfield%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaDefinition.prototype.addChildrenFilter%20=%20function%20(field,%20cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.indexes%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20this.schema%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(getType(Object.keys(type)%5B0%5D))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.childFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.childFilters%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.childFilters%5Bindex%5D%20=%20cb;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.warn(%22@filterChildren:%20field%20'%22.concat(field,%20%22'%20can't%20have%20children.%20Ignoring%20filter.%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaDefinition.prototype.getChildrenFilter%20=%20function%20(field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.childFilters%20&&%20this.childFilters%5Bthis.indexes%5Bfield%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SchemaDefinition.prototype.getNextFieldIndex%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Object.keys(this.schema%20%7C%7C%20%7B%7D).length;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20SchemaDefinition;%20%09%09%20%20%20%20%7D());%20%09%09%20%20%20%20function%20hasFilter(klass)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20klass._context%20&&%20klass._context.useFilters;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20var%20Context%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20Context()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.types%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.schemas%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.useFilters%20=%20false;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20Context.prototype.has%20=%20function%20(schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.schemas.has(schema);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Context.prototype.get%20=%20function%20(typeid)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.types%5Btypeid%5D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Context.prototype.add%20=%20function%20(schema,%20typeid)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeid%20===%20void%200)%20%7B%20typeid%20=%20this.schemas.size;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20FIXME:%20move%20this%20to%20somewhere%20else?%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20support%20inheritance%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20schema._definition%20=%20SchemaDefinition.create(schema._definition);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20schema._typeid%20=%20typeid;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.types%5Btypeid%5D%20=%20schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.schemas.set(schema,%20typeid);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Context.create%20=%20function%20(options)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20(definition)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!options.context)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20options.context%20=%20new%20Context();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20type(definition,%20options);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20Context;%20%09%09%20%20%20%20%7D());%20%09%09%20%20%20%20var%20globalContext%20=%20new%20Context();%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20%5BSee%20documentation%5D(https://docs.colyseus.io/state/schema/)%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20Annotate%20a%20Schema%20property%20to%20be%20serializeable.%20%09%09%20%20%20%20%20*%20%5C@type()'d%20fields%20are%20automatically%20flagged%20as%20%22dirty%22%20for%20the%20next%20patch.%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20@example%20Standard%20usage,%20with%20automatic%20change%20tracking.%20%09%09%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20*%20%5C@type(%22string%22)%20propertyName:%20string;%20%09%09%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20@example%20You%20can%20provide%20the%20%22manual%22%20option%20if%20you'd%20like%20to%20manually%20control%20your%20patches%20via%20.setDirty().%20%09%09%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20*%20%5C@type(%22string%22,%20%7B%20manual:%20true%20%7D)%20%09%09%20%20%20%20%20*%20%60%60%60%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20function%20type(type,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20function%20(target,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20context%20=%20options.context%20%7C%7C%20globalContext;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20constructor%20=%20target.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20constructor._context%20=%20context;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22%22.concat(constructor.name,%20%22:%20@type()%20reference%20provided%20for%20%5C%22%22).concat(field,%20%22%5C%22%20is%20undefined.%20Make%20sure%20you%20don't%20have%20any%20circular%20dependencies.%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/*%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20static%20schema%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!context.has(constructor))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20context.add(constructor);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20constructor._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.addField(field,%20type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20skip%20if%20descriptor%20already%20exists%20for%20this%20field%20(%60@deprecated()%60)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(definition.descriptors%5Bfield%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(definition.deprecated%5Bfield%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20do%20not%20create%20accessors%20for%20deprecated%20properties.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20trying%20to%20define%20same%20property%20multiple%20times%20across%20inheritance.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20https://github.com/colyseus/colyseus-unity3d/issues/131%23issuecomment-814308572%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22@colyseus/schema:%20Duplicate%20'%22.concat(field,%20%22'%20definition%20on%20'%22).concat(constructor.name,%20%22'.%5CnCheck%20@type()%20annotation%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20catch%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definitionAtLine%20=%20e.stack.split(%22%5Cn%22)%5B4%5D.trim();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22%22.concat(e.message,%20%22%20%22).concat(definitionAtLine));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20isArray%20=%20ArraySchema.is(type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20isMap%20=%20!isArray%20&&%20MapSchema.is(type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20me.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Allow%20abstract%20intermediary%20classes%20with%20no%20fields%20to%20be%20serialized%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20(See%20%22should%20support%20an%20inheritance%20with%20a%20Schema%20type%20without%20fields%22%20test)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(type)%20!==%20%22string%22%20&&%20!Schema.is(type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20childType%20=%20Object.values(type)%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(childType)%20!==%20%22string%22%20&&%20!context.has(childType))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20context.add(childType);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(options.manual)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20do%20not%20declare%20getter/setter%20descriptor%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%5Bfield%5D%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldCached%20=%20%22_%22.concat(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%5BfieldCached%5D%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%5Bfield%5D%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this%5BfieldCached%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%20Create%20Proxy%20for%20array%20or%20map%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20skip%20if%20value%20is%20the%20same%20as%20cached.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%20this%5BfieldCached%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20!==%20undefined%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20!==%20null)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20automaticallty%20transform%20Array%20into%20ArraySchema%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isArray%20&&%20!(value%20instanceof%20ArraySchema))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20new%20(ArraySchema.bind.apply(ArraySchema,%20__spreadArray(%5Bvoid%200%5D,%20value,%20false)))();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20automaticallty%20transform%20Map%20into%20MapSchema%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isMap%20&&%20!(value%20instanceof%20MapSchema))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20new%20MapSchema(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20try%20to%20turn%20provided%20structure%20into%20a%20Proxy%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$proxy'%5D%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isMap)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20getMapProxy(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(isArray)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20getArrayProxy(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20flag%20the%20change%20for%20encoding.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20call%20setParent()%20recursively%20for%20this%20and%20its%20child%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20structures.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20this._definition.indexes%5Bfield%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(this%5BfieldCached%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Setting%20a%20field%20to%20%60null%60%20or%20%60undefined%60%20will%20delete%20it.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this%5BfieldCached%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20true,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20%60@filter()%60%20decorator%20for%20defining%20data%20filters%20per%20client%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20function%20filter(cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20function%20(target,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20constructor%20=%20target.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20constructor._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(definition.addFilter(field,%20cb))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20constructor._context.useFilters%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20filterChildren(cb)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20function%20(target,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20constructor%20=%20target.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20constructor._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(definition.addChildrenFilter(field,%20cb))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20constructor._context.useFilters%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20%60@deprecated()%60%20flag%20a%20field%20as%20deprecated.%20%09%09%20%20%20%20%20*%20The%20previous%20%60@type()%60%20annotation%20should%20remain%20along%20with%20this%20one.%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20function%20deprecated(throws)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(throws%20===%20void%200)%20%7B%20throws%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20function%20(target,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20constructor%20=%20target.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20constructor._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20definition.deprecated%5Bfield%5D%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(throws)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20definition.descriptors%5Bfield%5D%20=%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20throw%20new%20Error(%22%22.concat(field,%20%22%20is%20deprecated.%22));%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set:%20function%20(value)%20%7B%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20defineTypes(target,%20fields,%20options)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(options%20===%20void%200)%20%7B%20options%20=%20%7B%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20(!options.context)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20options.context%20=%20target._context%20%7C%7C%20options.context%20%7C%7C%20globalContext;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20for%20(var%20field%20in%20fields)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20type(fields%5Bfield%5D,%20options)(target.prototype,%20field);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20target;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20Copyright%20(c)%202018%20Endel%20Dreyer%20%09%09%20%20%20%20%20*%20Copyright%20(c)%202014%20Ion%20Drive%20Software%20Ltd.%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20Permission%20is%20hereby%20granted,%20free%20of%20charge,%20to%20any%20person%20obtaining%20a%20copy%20%09%09%20%20%20%20%20*%20of%20this%20software%20and%20associated%20documentation%20files%20(the%20%22Software%22),%20to%20deal%20%09%09%20%20%20%20%20*%20in%20the%20Software%20without%20restriction,%20including%20without%20limitation%20the%20rights%20%09%09%20%20%20%20%20*%20to%20use,%20copy,%20modify,%20merge,%20publish,%20distribute,%20sublicense,%20and/or%20sell%20%09%09%20%20%20%20%20*%20copies%20of%20the%20Software,%20and%20to%20permit%20persons%20to%20whom%20the%20Software%20is%20%09%09%20%20%20%20%20*%20furnished%20to%20do%20so,%20subject%20to%20the%20following%20conditions:%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20The%20above%20copyright%20notice%20and%20this%20permission%20notice%20shall%20be%20included%20in%20all%20%09%09%20%20%20%20%20*%20copies%20or%20substantial%20portions%20of%20the%20Software.%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22,%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND,%20EXPRESS%20OR%20%09%09%20%20%20%20%20*%20IMPLIED,%20INCLUDING%20BUT%20NOT%20LIMITED%20TO%20THE%20WARRANTIES%20OF%20MERCHANTABILITY,%20%09%09%20%20%20%20%20*%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE%20AND%20NONINFRINGEMENT.%20IN%20NO%20EVENT%20SHALL%20THE%20%09%09%20%20%20%20%20*%20AUTHORS%20OR%20COPYRIGHT%20HOLDERS%20BE%20LIABLE%20FOR%20ANY%20CLAIM,%20DAMAGES%20OR%20OTHER%20%09%09%20%20%20%20%20*%20LIABILITY,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20TORT%20OR%20OTHERWISE,%20ARISING%20FROM,%20%09%09%20%20%20%20%20*%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20SOFTWARE%20OR%20THE%20USE%20OR%20OTHER%20DEALINGS%20IN%20THE%20%09%09%20%20%20%20%20*%20SOFTWARE%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20msgpack%20implementation%20highly%20based%20on%20notepack.io%20%09%09%20%20%20%20%20*%20https://github.com/darrachequesne/notepack%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20function%20utf8Length(str)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20c%20=%200,%20length%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20length;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20utf8Write(view,%20offset,%20str)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20c%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%20c;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200xc0%20%7C%20(c%20%3E%3E%206);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200xe0%20%7C%20(c%20%3E%3E%2012);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20%3E%3E%206%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c%20=%200x10000%20+%20(((c%20&%200x3ff)%20%3C%3C%2010)%20%7C%20(str.charCodeAt(i)%20&%200x3ff));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200xf0%20%7C%20(c%20%3E%3E%2018);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20%3E%3E%2012%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20%3E%3E%206%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20view%5Boffset++%5D%20=%200x80%20%7C%20(c%20&%200x3f);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20int8$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20uint8$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20int16$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%208)%20&%20255);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20uint16$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%208)%20&%20255);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20int32$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20bytes.push(value%20&%20255);%20%09%09%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%208)%20&%20255);%20%09%09%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%2016)%20&%20255);%20%09%09%20%20%20%20%20%20%20%20bytes.push((value%20%3E%3E%2024)%20&%20255);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20uint32$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20b4%20=%20value%20%3E%3E%2024;%20%09%09%20%20%20%20%20%20%20%20var%20b3%20=%20value%20%3E%3E%2016;%20%09%09%20%20%20%20%20%20%20%20var%20b2%20=%20value%20%3E%3E%208;%20%09%09%20%20%20%20%20%20%20%20var%20b1%20=%20value;%20%09%09%20%20%20%20%20%20%20%20bytes.push(b1%20&%20255);%20%09%09%20%20%20%20%20%20%20%20bytes.push(b2%20&%20255);%20%09%09%20%20%20%20%20%20%20%20bytes.push(b3%20&%20255);%20%09%09%20%20%20%20%20%20%20%20bytes.push(b4%20&%20255);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20int64$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20high%20=%20Math.floor(value%20/%20Math.pow(2,%2032));%20%09%09%20%20%20%20%20%20%20%20var%20low%20=%20value%20%3E%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20uint32$1(bytes,%20low);%20%09%09%20%20%20%20%20%20%20%20uint32$1(bytes,%20high);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20uint64$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20high%20=%20(value%20/%20Math.pow(2,%2032))%20%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20var%20low%20=%20value%20%3E%3E%3E%200;%20%09%09%20%20%20%20%20%20%20%20uint32$1(bytes,%20low);%20%09%09%20%20%20%20%20%20%20%20uint32$1(bytes,%20high);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20float32$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20writeFloat32(bytes,%20value);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20float64$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20writeFloat64(bytes,%20value);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20var%20_int32$1%20=%20new%20Int32Array(2);%20%09%09%20%20%20%20var%20_float32$1%20=%20new%20Float32Array(_int32$1.buffer);%20%09%09%20%20%20%20var%20_float64$1%20=%20new%20Float64Array(_int32$1.buffer);%20%09%09%20%20%20%20function%20writeFloat32(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20_float32$1%5B0%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20int32$1(bytes,%20_int32$1%5B0%5D);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20writeFloat64(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20_float64$1%5B0%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20int32$1(bytes,%20_int32$1%5B0%20%5D);%20%09%09%20%20%20%20%20%20%20%20int32$1(bytes,%20_int32$1%5B1%20%5D);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20boolean$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20uint8$1(bytes,%20value%20?%201%20:%200);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20string$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20encode%20%60null%60%20strings%20as%20empty.%20%09%09%20%20%20%20%20%20%20%20if%20(!value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20%22%22;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20length%20=%20utf8Length(value);%20%09%09%20%20%20%20%20%20%20%20var%20size%20=%200;%20%09%09%20%20%20%20%20%20%20%20//%20fixstr%20%09%09%20%20%20%20%20%20%20%20if%20(length%20%3C%200x20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(length%20%7C%200xa0);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%201;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20//%20str%208%20%09%09%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd9);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%202;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20//%20str%2016%20%09%09%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xda);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint16$1(bytes,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%203;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20//%20str%2032%20%09%09%20%20%20%20%20%20%20%20else%20if%20(length%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xdb);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint32$1(bytes,%20length);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20size%20=%205;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('String%20too%20long');%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20utf8Write(bytes,%20bytes.length,%20value);%20%09%09%20%20%20%20%20%20%20%20return%20size%20+%20length;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20number$1(bytes,%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(isNaN(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20number$1(bytes,%200);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(!isFinite(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20number$1(bytes,%20(value%20%3E%200)%20?%20Number.MAX_SAFE_INTEGER%20:%20-Number.MAX_SAFE_INTEGER);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(value%20!==%20(value%20%7C%200))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcb);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20writeFloat64(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20encode%20float%2032?%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20is%20it%20possible%20to%20differentiate%20between%20float32%20/%20float64%20here?%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20//%20float%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20bytes.push(0xca);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20writeFloat32(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20return%205;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20(value%20%3E=%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20positive%20fixnum%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x100)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcc);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x10000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcd);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint16$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3C%200x100000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xce);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint32$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xcf);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20uint64$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20negative%20fixnum%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xe0%20%7C%20(value%20+%200x20));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd0);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int8$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%202;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x8000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int16$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%203;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20%3E=%20-0x80000000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd2);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int32$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%205;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20bytes.push(0xd3);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20int64$1(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%209;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20encode%20=%20/*%23__PURE__*/Object.freeze(%7B%20%09%09%20%20%20%20%20%20%20%20__proto__:%20null,%20%09%09%20%20%20%20%20%20%20%20boolean:%20boolean$1,%20%09%09%20%20%20%20%20%20%20%20float32:%20float32$1,%20%09%09%20%20%20%20%20%20%20%20float64:%20float64$1,%20%09%09%20%20%20%20%20%20%20%20int16:%20int16$1,%20%09%09%20%20%20%20%20%20%20%20int32:%20int32$1,%20%09%09%20%20%20%20%20%20%20%20int64:%20int64$1,%20%09%09%20%20%20%20%20%20%20%20int8:%20int8$1,%20%09%09%20%20%20%20%20%20%20%20number:%20number$1,%20%09%09%20%20%20%20%20%20%20%20string:%20string$1,%20%09%09%20%20%20%20%20%20%20%20uint16:%20uint16$1,%20%09%09%20%20%20%20%20%20%20%20uint32:%20uint32$1,%20%09%09%20%20%20%20%20%20%20%20uint64:%20uint64$1,%20%09%09%20%20%20%20%20%20%20%20uint8:%20uint8$1,%20%09%09%20%20%20%20%20%20%20%20utf8Write:%20utf8Write,%20%09%09%20%20%20%20%20%20%20%20writeFloat32:%20writeFloat32,%20%09%09%20%20%20%20%20%20%20%20writeFloat64:%20writeFloat64%20%09%09%20%20%20%20%7D);%20%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20Copyright%20(c)%202018%20Endel%20Dreyer%20%09%09%20%20%20%20%20*%20Copyright%20(c)%202014%20Ion%20Drive%20Software%20Ltd.%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20Permission%20is%20hereby%20granted,%20free%20of%20charge,%20to%20any%20person%20obtaining%20a%20copy%20%09%09%20%20%20%20%20*%20of%20this%20software%20and%20associated%20documentation%20files%20(the%20%22Software%22),%20to%20deal%20%09%09%20%20%20%20%20*%20in%20the%20Software%20without%20restriction,%20including%20without%20limitation%20the%20rights%20%09%09%20%20%20%20%20*%20to%20use,%20copy,%20modify,%20merge,%20publish,%20distribute,%20sublicense,%20and/or%20sell%20%09%09%20%20%20%20%20*%20copies%20of%20the%20Software,%20and%20to%20permit%20persons%20to%20whom%20the%20Software%20is%20%09%09%20%20%20%20%20*%20furnished%20to%20do%20so,%20subject%20to%20the%20following%20conditions:%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20The%20above%20copyright%20notice%20and%20this%20permission%20notice%20shall%20be%20included%20in%20all%20%09%09%20%20%20%20%20*%20copies%20or%20substantial%20portions%20of%20the%20Software.%20%09%09%20%20%20%20%20*%20%09%09%20%20%20%20%20*%20THE%20SOFTWARE%20IS%20PROVIDED%20%22AS%20IS%22,%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND,%20EXPRESS%20OR%20%09%09%20%20%20%20%20*%20IMPLIED,%20INCLUDING%20BUT%20NOT%20LIMITED%20TO%20THE%20WARRANTIES%20OF%20MERCHANTABILITY,%20%09%09%20%20%20%20%20*%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE%20AND%20NONINFRINGEMENT.%20IN%20NO%20EVENT%20SHALL%20THE%20%09%09%20%20%20%20%20*%20AUTHORS%20OR%20COPYRIGHT%20HOLDERS%20BE%20LIABLE%20FOR%20ANY%20CLAIM,%20DAMAGES%20OR%20OTHER%20%09%09%20%20%20%20%20*%20LIABILITY,%20WHETHER%20IN%20AN%20ACTION%20OF%20CONTRACT,%20TORT%20OR%20OTHERWISE,%20ARISING%20FROM,%20%09%09%20%20%20%20%20*%20OUT%20OF%20OR%20IN%20CONNECTION%20WITH%20THE%20SOFTWARE%20OR%20THE%20USE%20OR%20OTHER%20DEALINGS%20IN%20THE%20%09%09%20%20%20%20%20*%20SOFTWARE%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20function%20utf8Read(bytes,%20offset,%20length)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20string%20=%20'',%20chr%20=%200;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%20offset,%20end%20=%20offset%20+%20length;%20i%20%3C%20end;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20byte%20=%20bytes%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200x80)%20===%200x00)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(byte);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xe0)%20===%200xc0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x1f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(bytes%5B++i%5D%20&%200x3f));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xf0)%20===%200xe0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x0f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%200));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((byte%20&%200xf8)%20===%200xf0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20=%20((byte%20&%200x07)%20%3C%3C%2018)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((bytes%5B++i%5D%20&%200x3f)%20%3C%3C%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(chr%20%3E=%200x010000)%20%7B%20//%20surrogate%20pair%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20-=%200x010000;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode((chr%20%3E%3E%3E%2010)%20+%200xD800,%20(chr%20&%200x3FF)%20+%200xDC00);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(chr);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20console.error('Invalid%20byte%20'%20+%20byte.toString(16));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20(do%20not%20throw%20error%20to%20avoid%20server/client%20from%20crashing%20due%20to%20hack%20attemps)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20throw%20new%20Error('Invalid%20byte%20'%20+%20byte.toString(16));%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20string;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20int8(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20uint8(bytes,%20it)%20%3C%3C%2024%20%3E%3E%2024;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20uint8(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20bytes%5Bit.offset++%5D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20int16(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20uint16(bytes,%20it)%20%3C%3C%2016%20%3E%3E%2016;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20uint16(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20bytes%5Bit.offset++%5D%20%7C%20bytes%5Bit.offset++%5D%20%3C%3C%208;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20int32(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20bytes%5Bit.offset++%5D%20%7C%20bytes%5Bit.offset++%5D%20%3C%3C%208%20%7C%20bytes%5Bit.offset++%5D%20%3C%3C%2016%20%7C%20bytes%5Bit.offset++%5D%20%3C%3C%2024;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20uint32(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20int32(bytes,%20it)%20%3E%3E%3E%200;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20float32(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20readFloat32(bytes,%20it);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20float64(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20readFloat64(bytes,%20it);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20int64(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20low%20=%20uint32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20var%20high%20=%20int32(bytes,%20it)%20*%20Math.pow(2,%2032);%20%09%09%20%20%20%20%20%20%20%20return%20high%20+%20low;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20uint64(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20low%20=%20uint32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20var%20high%20=%20uint32(bytes,%20it)%20*%20Math.pow(2,%2032);%20%09%09%20%20%20%20%20%20%20%20return%20high%20+%20low;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20var%20_int32%20=%20new%20Int32Array(2);%20%09%09%20%20%20%20var%20_float32%20=%20new%20Float32Array(_int32.buffer);%20%09%09%20%20%20%20var%20_float64%20=%20new%20Float64Array(_int32.buffer);%20%09%09%20%20%20%20function%20readFloat32(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20_int32%5B0%5D%20=%20int32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20return%20_float32%5B0%5D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20readFloat64(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20_int32%5B0%20%5D%20=%20int32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20_int32%5B1%20%5D%20=%20int32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20return%20_float64%5B0%5D;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20boolean(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20uint8(bytes,%20it)%20%3E%200;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20string(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20prefix%20=%20bytes%5Bit.offset++%5D;%20%09%09%20%20%20%20%20%20%20%20var%20length;%20%09%09%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200xc0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fixstr%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20prefix%20&%200x1f;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd9)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20uint8(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xda)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20uint16(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xdb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20=%20uint32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20var%20value%20=%20utf8Read(bytes,%20it.offset,%20length);%20%09%09%20%20%20%20%20%20%20%20it.offset%20+=%20length;%20%09%09%20%20%20%20%20%20%20%20return%20value;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20stringCheck(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20prefix%20=%20bytes%5Bit.offset%5D;%20%09%09%20%20%20%20%20%20%20%20return%20(%20%09%09%20%20%20%20%20%20%20%20//%20fixstr%20%09%09%20%20%20%20%20%20%20%20(prefix%20%3C%200xc0%20&&%20prefix%20%3E%200xa0)%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20prefix%20===%200xd9%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20prefix%20===%200xda%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20str%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20prefix%20===%200xdb);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20number(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20prefix%20=%20bytes%5Bit.offset++%5D;%20%09%09%20%20%20%20%20%20%20%20if%20(prefix%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20positive%20fixint%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20prefix;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xca)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20float%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20readFloat32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xcb)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20float%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20readFloat64(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xcc)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20uint8(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xcd)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20uint16(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xce)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20uint32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xcf)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20uint%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20uint64(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%208%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20int8(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd1)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2016%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20int16(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd2)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2032%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20int32(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20===%200xd3)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20int%2064%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20int64(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(prefix%20%3E%200xdf)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20negative%20fixint%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(0xff%20-%20prefix%20+%201)%20*%20-1;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20numberCheck(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20prefix%20=%20bytes%5Bit.offset%5D;%20%09%09%20%20%20%20%20%20%20%20//%20positive%20fixint%20-%200x00%20-%200x7f%20%09%09%20%20%20%20%20%20%20%20//%20float%2032%20%20%20%20%20%20%20%20-%200xca%20%09%09%20%20%20%20%20%20%20%20//%20float%2064%20%20%20%20%20%20%20%20-%200xcb%20%09%09%20%20%20%20%20%20%20%20//%20uint%208%20%20%20%20%20%20%20%20%20%20-%200xcc%20%09%09%20%20%20%20%20%20%20%20//%20uint%2016%20%20%20%20%20%20%20%20%20-%200xcd%20%09%09%20%20%20%20%20%20%20%20//%20uint%2032%20%20%20%20%20%20%20%20%20-%200xce%20%09%09%20%20%20%20%20%20%20%20//%20uint%2064%20%20%20%20%20%20%20%20%20-%200xcf%20%09%09%20%20%20%20%20%20%20%20//%20int%208%20%20%20%20%20%20%20%20%20%20%20-%200xd0%20%09%09%20%20%20%20%20%20%20%20//%20int%2016%20%20%20%20%20%20%20%20%20%20-%200xd1%20%09%09%20%20%20%20%20%20%20%20//%20int%2032%20%20%20%20%20%20%20%20%20%20-%200xd2%20%09%09%20%20%20%20%20%20%20%20//%20int%2064%20%20%20%20%20%20%20%20%20%20-%200xd3%20%09%09%20%20%20%20%20%20%20%20return%20(prefix%20%3C%200x80%20%7C%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20(prefix%20%3E=%200xca%20&&%20prefix%20%3C=%200xd3));%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20arrayCheck(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20bytes%5Bit.offset%5D%20%3C%200xa0;%20%09%09%20%20%20%20%20%20%20%20//%20const%20prefix%20=%20bytes%5Bit.offset%5D%20;%20%09%09%20%20%20%20%20%20%20%20//%20if%20(prefix%20%3C%200xa0)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20%20%20return%20prefix;%20%09%09%20%20%20%20%20%20%20%20//%20//%20array%20%09%09%20%20%20%20%20%20%20%20//%20%7D%20else%20if%20(prefix%20===%200xdc)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20%20%20it.offset%20+=%202;%20%09%09%20%20%20%20%20%20%20%20//%20%7D%20else%20if%20(0xdd)%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20%20%20it.offset%20+=%204;%20%09%09%20%20%20%20%20%20%20%20//%20%7D%20%09%09%20%20%20%20%20%20%20%20//%20return%20prefix;%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20switchStructureCheck(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20(%20%09%09%20%20%20%20%20%20%20%20//%20previous%20byte%20should%20be%20%60SWITCH_TO_STRUCTURE%60%20%09%09%20%20%20%20%20%20%20%20bytes%5Bit.offset%20-%201%5D%20===%20SWITCH_TO_STRUCTURE%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20next%20byte%20should%20be%20a%20number%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20(bytes%5Bit.offset%5D%20%3C%200x80%20%7C%7C%20(bytes%5Bit.offset%5D%20%3E=%200xca%20&&%20bytes%5Bit.offset%5D%20%3C=%200xd3)));%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20decode%20=%20/*%23__PURE__*/Object.freeze(%7B%20%09%09%20%20%20%20%20%20%20%20__proto__:%20null,%20%09%09%20%20%20%20%20%20%20%20arrayCheck:%20arrayCheck,%20%09%09%20%20%20%20%20%20%20%20boolean:%20boolean,%20%09%09%20%20%20%20%20%20%20%20float32:%20float32,%20%09%09%20%20%20%20%20%20%20%20float64:%20float64,%20%09%09%20%20%20%20%20%20%20%20int16:%20int16,%20%09%09%20%20%20%20%20%20%20%20int32:%20int32,%20%09%09%20%20%20%20%20%20%20%20int64:%20int64,%20%09%09%20%20%20%20%20%20%20%20int8:%20int8,%20%09%09%20%20%20%20%20%20%20%20number:%20number,%20%09%09%20%20%20%20%20%20%20%20numberCheck:%20numberCheck,%20%09%09%20%20%20%20%20%20%20%20readFloat32:%20readFloat32,%20%09%09%20%20%20%20%20%20%20%20readFloat64:%20readFloat64,%20%09%09%20%20%20%20%20%20%20%20string:%20string,%20%09%09%20%20%20%20%20%20%20%20stringCheck:%20stringCheck,%20%09%09%20%20%20%20%20%20%20%20switchStructureCheck:%20switchStructureCheck,%20%09%09%20%20%20%20%20%20%20%20uint16:%20uint16,%20%09%09%20%20%20%20%20%20%20%20uint32:%20uint32,%20%09%09%20%20%20%20%20%20%20%20uint64:%20uint64,%20%09%09%20%20%20%20%20%20%20%20uint8:%20uint8%20%09%09%20%20%20%20%7D);%20%20%09%09%20%20%20%20var%20CollectionSchema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20CollectionSchema(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes%20=%20new%20ChangeTree(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialValues.forEach(function%20(v)%20%7B%20return%20_this.add(v);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.onAdd%20=%20function%20(callback,%20triggerAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(triggerAll%20===%20void%200)%20%7B%20triggerAll%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D)),%20exports.OPERATION.ADD,%20callback,%20(triggerAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.onRemove%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.DELETE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.onChange%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.REPLACE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20type%5B'collection'%5D%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.add%20=%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20set%20%22index%22%20for%20reference.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.$refId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20isRef%20=%20(value%5B'$changes'%5D)%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(isRef)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%5Bindex%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.set(index,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20index;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.at%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20Array.from(this.$items.keys())%5Bindex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.entries%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.delete%20=%20function%20(item)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20entries%20=%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20entry;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20while%20(entry%20=%20entries.next())%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(entry.done)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(item%20===%20entry.value%5B1%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20index%20=%20entry.value%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.delete(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.clear%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20discard%20previous%20operations.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discard(true,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20previous%20indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20When%20decoding:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20enqueue%20items%20for%20DELETE%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20flag%20child%20items%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeChildRefs.call(this,%20changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.operation(%7B%20index:%200,%20op:%20exports.OPERATION.CLEAR%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20touch%20all%20structures%20until%20reach%20root%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.touchParents();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.has%20=%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values()).some(function%20(v)%20%7B%20return%20v%20===%20value;%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.forEach%20=%20function%20(callbackfn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.forEach(function%20(value,%20key,%20_)%20%7B%20return%20callbackfn(value,%20key,%20_this);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.values%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.values();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(CollectionSchema.prototype,%20%22size%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.setIndex%20=%20function%20(index,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.getIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(this.$indexes.get(index));%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.toArray%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20values%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20values.push((typeof%20(value%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20value%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20values;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20Decoding%20utilities%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20CollectionSchema.prototype.clone%20=%20function%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20client-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20Object.assign(new%20CollectionSchema(),%20this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20server-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20CollectionSchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.add(value%5B'clone'%5D());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.add(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20CollectionSchema;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20var%20SetSchema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20SetSchema(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes%20=%20new%20ChangeTree(this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(initialValues)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialValues.forEach(function%20(v)%20%7B%20return%20_this.add(v);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.onAdd%20=%20function%20(callback,%20triggerAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(triggerAll%20===%20void%200)%20%7B%20triggerAll%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D)),%20exports.OPERATION.ADD,%20callback,%20(triggerAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this.$items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.onRemove%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.DELETE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.onChange%20=%20function%20(callback)%20%7B%20return%20addCallback(this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%5B%5D),%20exports.OPERATION.REPLACE,%20callback);%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20type%5B'set'%5D%20!==%20undefined;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.add%20=%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20immediatelly%20return%20false%20if%20value%20already%20added.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.has(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20set%20%22index%22%20for%20reference.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20this.$refId++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20((value%5B'$changes'%5D)%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(this,%20this.$changes.root,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(_b%20=%20(_a%20=%20this.$changes.indexes%5Bindex%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.op)%20!==%20null%20&&%20_b%20!==%20void%200%20?%20_b%20:%20exports.OPERATION.ADD;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%5Bindex%5D%20=%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.set(index,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(index,%20operation);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20index;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.entries%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.delete%20=%20function%20(item)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20entries%20=%20this.$items.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20entry;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20while%20(entry%20=%20entries.next())%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(entry.done)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(item%20===%20entry.value%5B1%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20index%20=%20entry.value%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.delete(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.clear%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20discard%20previous%20operations.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discard(true,%20true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.indexes%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20previous%20indexes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20When%20decoding:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20enqueue%20items%20for%20DELETE%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20flag%20child%20items%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20removeChildRefs.call(this,%20changes);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.operation(%7B%20index:%200,%20op:%20exports.OPERATION.CLEAR%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20touch%20all%20structures%20until%20reach%20root%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.touchParents();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.has%20=%20function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20values%20=%20this.$items.values();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20has%20=%20false;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20entry;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20while%20(entry%20=%20values.next())%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(entry.done)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20===%20entry.value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20has%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20has;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.forEach%20=%20function%20(callbackfn)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.forEach(function%20(value,%20key,%20_)%20%7B%20return%20callbackfn(value,%20key,%20_this);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.values%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.values();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(SetSchema.prototype,%20%22size%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.size;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.setIndex%20=%20function%20(index,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.set(index,%20key);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.getIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.$items.get(this.$indexes.get(index));%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20this.$indexes.get(index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$items.delete(key);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$indexes.delete(index);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.toArray%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20Array.from(this.$items.values());%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20values%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value,%20key)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20values.push((typeof%20(value%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20value%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20values;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20//%20Decoding%20utilities%20%09%09%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20SetSchema.prototype.clone%20=%20function%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(isDecoding)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20client-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20Object.assign(new%20SetSchema(),%20this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20server-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%20=%20new%20SetSchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.forEach(function%20(value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.add(value%5B'clone'%5D());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned.add(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20SetSchema;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20var%20ClientState%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20ClientState()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.refIds%20=%20new%20WeakSet();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.containerIndexes%20=%20new%20WeakMap();%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20//%20containerIndexes%20=%20new%20Map%3CChangeTree,%20Set%3Cnumber%3E%3E();%20%09%09%20%20%20%20%20%20%20%20ClientState.prototype.addRefId%20=%20function%20(changeTree)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.refIds.has(changeTree))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refIds.add(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.containerIndexes.set(changeTree,%20new%20Set());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ClientState.get%20=%20function%20(client)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(client.$filterState%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20client.$filterState%20=%20new%20ClientState();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20client.$filterState;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20ClientState;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20var%20ReferenceTracker%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20function%20ReferenceTracker()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Relation%20of%20refId%20=%3E%20Schema%20structure%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20For%20direct%20access%20of%20structures%20during%20decoding%20time.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.refs%20=%20new%20Map();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.refCounts%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs%20=%20new%20Set();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.nextUniqueId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20ReferenceTracker.prototype.getNextUniqueId%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.nextUniqueId++;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20for%20decoding%20%09%09%20%20%20%20%20%20%20%20ReferenceTracker.prototype.addRef%20=%20function%20(refId,%20ref,%20incrementCount)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(incrementCount%20===%20void%200)%20%7B%20incrementCount%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.refs.set(refId,%20ref);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(incrementCount)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.refCounts%5BrefId%5D%20=%20(this.refCounts%5BrefId%5D%20%7C%7C%200)%20+%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20for%20decoding%20%09%09%20%20%20%20%20%20%20%20ReferenceTracker.prototype.removeRef%20=%20function%20(refId)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20refCount%20=%20this.refCounts%5BrefId%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(refCount%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.warn(%22trying%20to%20remove%20reference%20%22.concat(refId,%20%22%20that%20doesn't%20exist%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(refCount%20===%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.warn(%22trying%20to%20remove%20reference%20%22.concat(refId,%20%22%20with%200%20refCount%22));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.refCounts%5BrefId%5D%20=%20refCount%20-%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs.add(refId);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20ReferenceTracker.prototype.clearRefs%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.refs.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs.clear();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.refCounts%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20//%20for%20decoding%20%09%09%20%20%20%20%20%20%20%20ReferenceTracker.prototype.garbageCollectDeletedRefs%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs.forEach(function%20(refId)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Skip%20active%20references.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(_this.refCounts%5BrefId%5D%20%3E%200)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20_this.refs.get(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Ensure%20child%20schema%20instances%20have%20their%20references%20removed%20as%20well.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20fieldName%20in%20ref%5B'_definition'%5D.schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(ref%5B'_definition'%5D.schema%5BfieldName%5D)%20!==%20%22string%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5BfieldName%5D%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5BfieldName%5D%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.removeRef(ref%5BfieldName%5D%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20ref%5B'$changes'%5D.parent._definition;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20definition.schema%5Bdefinition.fieldsByIndex%5Bref%5B'$changes'%5D.parentIndex%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(Object.values(type)%5B0%5D)%20===%20%22function%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Array.from(ref.values())%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.forEach(function%20(child)%20%7B%20return%20_this.removeRef(child%5B'$changes'%5D.refId);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_this.refs.delete(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20delete%20_this.refCounts%5BrefId%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20clear%20deleted%20refs.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.deletedRefs.clear();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20return%20ReferenceTracker;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20var%20EncodeSchemaError%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20__extends(EncodeSchemaError,%20_super);%20%09%09%20%20%20%20%20%20%20%20function%20EncodeSchemaError()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20EncodeSchemaError;%20%09%09%20%20%20%20%7D(Error));%20%09%09%20%20%20%20function%20assertType(value,%20type,%20klass,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20typeofTarget;%20%09%09%20%20%20%20%20%20%20%20var%20allowNull%20=%20false;%20%09%09%20%20%20%20%20%20%20%20switch%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22number%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22int8%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22uint8%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22int16%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22uint16%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22int32%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22uint32%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22int64%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22uint64%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22float32%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22float64%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeofTarget%20=%20%22number%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isNaN(value))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(%22trying%20to%20encode%20%5C%22NaN%5C%22%20in%20%22.concat(klass.constructor.name,%20%22%23%22).concat(field));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22string%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeofTarget%20=%20%22string%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20allowNull%20=%20true;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20case%20%22boolean%22:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20boolean%20is%20always%20encoded%20as%20true/false%20based%20on%20truthiness%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20(typeof%20(value)%20!==%20typeofTarget%20&&%20(!allowNull%20%7C%7C%20(allowNull%20&&%20value%20!==%20null)))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20foundValue%20=%20%22'%22.concat(JSON.stringify(value),%20%22'%22).concat((value%20&&%20value.constructor%20&&%20%22%20(%22.concat(value.constructor.name,%20%22)%22))%20%7C%7C%20'');%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20EncodeSchemaError(%22a%20'%22.concat(typeofTarget,%20%22'%20was%20expected,%20but%20%22).concat(foundValue,%20%22%20was%20provided%20in%20%22).concat(klass.constructor.name,%20%22%23%22).concat(field));%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20assertInstanceType(value,%20type,%20klass,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20if%20(!(value%20instanceof%20type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20EncodeSchemaError(%22a%20'%22.concat(type.name,%20%22'%20was%20expected,%20but%20'%22).concat(value.constructor.name,%20%22'%20was%20provided%20in%20%22).concat(klass.constructor.name,%20%22%23%22).concat(field));%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20encodePrimitiveType(type,%20bytes,%20value,%20klass,%20field)%20%7B%20%09%09%20%20%20%20%20%20%20%20assertType(value,%20type,%20klass,%20field);%20%09%09%20%20%20%20%20%20%20%20var%20encodeFunc%20=%20encode%5Btype%5D;%20%09%09%20%20%20%20%20%20%20%20if%20(encodeFunc)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20encodeFunc(bytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20EncodeSchemaError(%22a%20'%22.concat(type,%20%22'%20was%20expected,%20but%20%22).concat(value,%20%22%20was%20provided%20in%20%22).concat(klass.constructor.name,%20%22%23%22).concat(field));%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20function%20decodePrimitiveType(type,%20bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20return%20decode%5Btype%5D(bytes,%20it);%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20Schema%20encoder%20/%20decoder%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20var%20Schema%20=%20/**%20@class%20*/%20(function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20//%20allow%20inherited%20classes%20to%20have%20a%20constructor%20%09%09%20%20%20%20%20%20%20%20function%20Schema()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20args%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20_i%20=%200;%20_i%20%3C%20arguments.length;%20_i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%5B_i%5D%20=%20arguments%5B_i%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20fix%20enumerability%20of%20fields%20for%20end-user%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperties(this,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$changes:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20new%20ChangeTree(this,%20undefined,%20new%20ReferenceTracker()),%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20$listeners:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20value:%20undefined,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20writable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$callbacks:%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20undefined,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20writable:%20true%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20descriptors%20=%20this._definition.descriptors;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(descriptors)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Object.defineProperties(this,%20descriptors);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20Assign%20initial%20values%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(args%5B0%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.assign(args%5B0%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20Schema.onError%20=%20function%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20console.error(e);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.is%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20(type%5B'_definition'%5D%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%5B'_definition'%5D.schema%20!==%20undefined);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.onChange%20=%20function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%7B%7D)),%20exports.OPERATION.REPLACE,%20callback);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.onRemove%20=%20function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20addCallback((this.$callbacks%20%7C%7C%20(this.$callbacks%20=%20%7B%7D)),%20exports.OPERATION.DELETE,%20callback);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.assign%20=%20function%20(props)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20Object.assign(this,%20props);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Object.defineProperty(Schema.prototype,%20%22_definition%22,%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20get:%20function%20()%20%7B%20return%20this.constructor._definition;%20%7D,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20enumerable:%20false,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20configurable:%20true%20%09%09%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20(Server-side):%20Flag%20a%20property%20to%20be%20encoded%20for%20the%20next%20patch.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20instance%20Schema%20instance%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20property%20string%20representing%20the%20property%20name,%20or%20number%20representing%20the%20index%20of%20the%20property.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20operation%20OPERATION%20to%20perform%20(detected%20automatically)%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.setDirty%20=%20function%20(property,%20operation)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.change(property,%20operation);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20*%20Client-side:%20listen%20for%20changes%20on%20property.%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20prop%20the%20property%20name%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20callback%20callback%20to%20be%20triggered%20on%20property%20change%20%09%09%20%20%20%20%20%20%20%20%20*%20@param%20immediate%20trigger%20immediatelly%20if%20property%20has%20been%20already%20set.%20%09%09%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.listen%20=%20function%20(prop,%20callback,%20immediate)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(immediate%20===%20void%200)%20%7B%20immediate%20=%20true;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.$callbacks)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$callbacks%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.$callbacks%5Bprop%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.$callbacks%5Bprop%5D%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$callbacks%5Bprop%5D.push(callback);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(immediate%20&&%20this%5Bprop%5D%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20callback(this%5Bprop%5D,%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20return%20un-register%20callback.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20function%20()%20%7B%20return%20spliceOne(_this.$callbacks%5Bprop%5D,%20_this.$callbacks%5Bprop%5D.indexOf(callback));%20%7D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.decode%20=%20function%20(bytes,%20it,%20ref)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(it%20===%20void%200)%20%7B%20it%20=%20%7B%20offset:%200%20%7D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20===%20void%200)%20%7B%20ref%20=%20this;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20allChanges%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20$root%20=%20this.$changes.root;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20totalBytes%20=%20bytes.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20refId%20=%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20$root.refs.set(refId,%20this);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20while%20(it.offset%20%3C%20totalBytes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20byte%20=%20bytes%5Bit.offset++%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(byte%20==%20SWITCH_TO_STRUCTURE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId%20=%20number(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20nextRef%20=%20$root.refs.get(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Trying%20to%20access%20a%20reference%20that%20haven't%20been%20decoded%20yet.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!nextRef)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%22%5C%22refId%5C%22%20not%20found:%20%22.concat(refId));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%20=%20nextRef;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTree%20=%20ref%5B'$changes'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isSchema%20=%20(ref%5B'_definition'%5D%20!==%20undefined);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(isSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20(byte%20%3E%3E%206)%20%3C%3C%206%20//%20%22compressed%22%20index%20+%20operation%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20byte;%20//%20%22uncompressed%22%20index%20+%20operation%20(array/map%20items)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation%20===%20exports.OPERATION.CLEAR)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20me!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20The%20%60.clear()%60%20method%20is%20calling%20%60$root.removeRef(refId)%60%20for%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20each%20item%20inside%20this%20collection%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref.clear(allChanges);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldIndex%20=%20(isSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20byte%20%25%20(operation%20%7C%7C%20255)%20//%20if%20%22REPLACE%22%20operation%20(0),%20use%20255%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20number(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldName%20=%20(isSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20(ref%5B'_definition'%5D.fieldsByIndex%5BfieldIndex%5D)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20%22%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20changeTree.getType(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20previousValue%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20dynamicIndex%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue%20=%20ref%5B'getByIndex'%5D(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((operation%20&%20exports.OPERATION.ADD)%20===%20exports.OPERATION.ADD)%20%7B%20//%20ADD%20or%20DELETE_AND_ADD%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dynamicIndex%20=%20(ref%20instanceof%20MapSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20string(bytes,%20it)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20fieldIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'setIndex'%5D(fieldIndex,%20dynamicIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20here%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dynamicIndex%20=%20ref%5B'getIndex'%5D(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue%20=%20ref%5B%22_%22.concat(fieldName)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Delete%20operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((operation%20&%20exports.OPERATION.DELETE)%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation%20!==%20exports.OPERATION.DELETE_AND_ADD)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'deleteByIndex'%5D(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Flag%20%60refId%60%20for%20garbage%20collection.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%20&&%20previousValue%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.removeRef(previousValue%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20null;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(fieldName%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.warn(%22@colyseus/schema:%20definition%20mismatch%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20keep%20skipping%20next%20bytes%20until%20reaches%20a%20known%20structure%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20by%20local%20decoder.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20nextIterator%20=%20%7B%20offset:%20it.offset%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(it.offset%20%3C%20totalBytes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(switchStructureCheck(bytes,%20it))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nextIterator.offset%20=%20it.offset%20+%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20($root.refs.has(number(bytes,%20nextIterator)))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20it.offset++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(operation%20===%20exports.OPERATION.DELETE)%20;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(Schema.is(type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refId_1%20=%20number(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20$root.refs.get(refId_1);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation%20!==%20exports.OPERATION.REPLACE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20childType%20=%20this.getSchemaType(bytes,%20it,%20type);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20this.createTypeInstance(childType);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value.$changes.refId%20=%20refId_1;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value.$callbacks%20=%20previousValue.$callbacks;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20value.$listeners%20=%20previousValue.$listeners;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%5B'$changes'%5D.refId%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId_1%20!==%20previousValue%5B'$changes'%5D.refId)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.removeRef(previousValue%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.addRef(refId_1,%20value,%20(value%20!==%20previousValue));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(typeof%20(type)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20primitive%20value%20(number,%20string,%20boolean,%20etc)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20decodePrimitiveType(type,%20bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20typeDef%20=%20getType(Object.keys(type)%5B0%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refId_2%20=%20number(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20valueRef%20=%20($root.refs.has(refId_2))%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20previousValue%20%7C%7C%20$root.refs.get(refId_2)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20new%20typeDef.constructor();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20=%20valueRef.clone(true);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value.$changes.refId%20=%20refId_2;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20preserve%20schema%20callbacks%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$callbacks'%5D%20=%20previousValue%5B'$callbacks'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%5B'$changes'%5D.refId%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId_2%20!==%20previousValue%5B'$changes'%5D.refId)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.removeRef(previousValue%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Trigger%20onRemove%20if%20structure%20has%20been%20replaced.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20entries%20=%20previousValue.entries();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20iter%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20((iter%20=%20entries.next())%20&&%20!iter.done)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a%20=%20iter.value,%20key%20=%20_a%5B0%5D,%20value_1%20=%20_a%5B1%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20allChanges.push(%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId:%20refId_2,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op:%20exports.OPERATION.DELETE,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field:%20key,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20undefined,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue:%20value_1,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$root.addRef(refId_2,%20value,%20(valueRef%20!==%20previousValue));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20!==%20null%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.setParent(changeTree.ref,%20changeTree.root,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5BfieldName%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ref%5B%60_$%7BfieldName%7D%60%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(ref%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20key%20=%20ref%5B'$indexes'%5D.get(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20key%20=%20dynamicIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ref.set(key,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'$items'%5D.set(key,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'$changes'%5D.allChanges.add(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(ref%20instanceof%20ArraySchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20key%20=%20ref%5B'$indexes'%5D%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log(%22SETTING%20FOR%20ArraySchema%20=%3E%22,%20%7B%20field,%20key,%20value%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ref%5Bkey%5D%20=%20value;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref.setAt(fieldIndex,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(ref%20instanceof%20CollectionSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20ref.add(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'setIndex'%5D(fieldIndex,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(ref%20instanceof%20SetSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20index%20=%20ref.add(value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(index%20!==%20false)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref%5B'setIndex'%5D(fieldIndex,%20index);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(previousValue%20!==%20value)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20allChanges.push(%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refId:%20refId,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op:%20operation,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field:%20fieldName,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dynamicIndex:%20dynamicIndex,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value:%20value,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20previousValue:%20previousValue,%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this._triggerChanges(allChanges);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20drop%20references%20of%20unused%20schemas%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20$root.garbageCollectDeletedRefs();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20allChanges;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.encode%20=%20function%20(encodeAll,%20bytes,%20useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(encodeAll%20===%20void%200)%20%7B%20encodeAll%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(bytes%20===%20void%200)%20%7B%20bytes%20=%20%5B%5D;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(useFilters%20===%20void%200)%20%7B%20useFilters%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20rootChangeTree%20=%20this.$changes;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20refIdsVisited%20=%20new%20WeakSet();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTrees%20=%20%5BrootChangeTree%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20numChangeTrees%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20numChangeTrees;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTree%20=%20changeTrees%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20changeTree.ref;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isSchema%20=%20(ref%20instanceof%20Schema);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Generate%20unique%20refId%20for%20the%20ChangeTree.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.ensureRefId();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20mark%20this%20ChangeTree%20as%20visited.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refIdsVisited.add(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20root%20%60refId%60%20is%20skipped.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(changeTree%20!==%20rootChangeTree%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(changeTree.changed%20%7C%7C%20encodeAll))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20SWITCH_TO_STRUCTURE);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20changeTree.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changes%20=%20(encodeAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20Array.from(changeTree.allChanges)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20Array.from(changeTree.changes.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20j%20=%200,%20cl%20=%20changes.length;%20j%20%3C%20cl;%20j++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20operation%20=%20(encodeAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20%7B%20op:%20exports.OPERATION.ADD,%20index:%20changes%5Bj%5D%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20changes%5Bj%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldIndex%20=%20operation.index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20field%20=%20(isSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20ref%5B'_definition'%5D.fieldsByIndex%20&&%20ref%5B'_definition'%5D.fieldsByIndex%5BfieldIndex%5D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20fieldIndex;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20cache%20begin%20index%20if%20%60useFilters%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20beginIndex%20=%20bytes.length;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20encode%20field%20index%20+%20operation%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation.op%20!==%20exports.OPERATION.TOUCH)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Compress%20%60fieldIndex%60%20+%20%60operation%60%20into%20a%20single%20byte.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20This%20adds%20a%20limitaion%20of%2064%20fields%20per%20Schema%20structure%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20(fieldIndex%20%7C%20operation.op));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20operation.op);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20custom%20operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation.op%20===%20exports.OPERATION.CLEAR)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20indexed%20operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20encode%20%22alias%22%20for%20dynamic%20fields%20(maps)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!isSchema%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(operation.op%20&%20exports.OPERATION.ADD)%20==%20exports.OPERATION.ADD%20//%20ADD%20or%20DELETE_AND_ADD%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20MapSchema%20dynamic%20key%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20dynamicIndex%20=%20changeTree.ref%5B'$indexes'%5D.get(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string$1(bytes,%20dynamicIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation.op%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20delete%20from%20filter%20cache%20data.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20(useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20delete%20changeTree.caches%5BfieldIndex%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20type%20=%20changeTree.childType%20%7C%7C%20ref._schema%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20changeTree.getType(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20const%20type%20=%20changeTree.getType(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20changeTree.getValue(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Enqueue%20ChangeTree%20to%20be%20visited%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20!refIdsVisited.has(value%5B'$changes'%5D))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTrees.push(value%5B'$changes'%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%5B'$changes'%5D.ensureRefId();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20numChangeTrees++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(operation.op%20===%20exports.OPERATION.TOUCH)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(Schema.is(type))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20assertInstanceType(value,%20type,%20ref,%20field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Encode%20refId%20for%20this%20instance.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20The%20actual%20instance%20is%20going%20to%20be%20encoded%20on%20next%20%60changeTree%60%20iteration.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20value.$changes.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Try%20to%20encode%20inherited%20TYPE_ID%20if%20it's%20an%20ADD%20operation.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((operation.op%20&%20exports.OPERATION.ADD)%20===%20exports.OPERATION.ADD)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.tryEncodeTypeId(bytes,%20type,%20value.constructor);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(typeof%20(type)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Primitive%20values%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20encodePrimitiveType(type,%20bytes,%20value,%20ref,%20field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Custom%20type%20(MapSchema,%20ArraySchema,%20etc)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20definition%20=%20getType(Object.keys(type)%5B0%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ensure%20a%20ArraySchema%20has%20been%20provided%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20assertInstanceType(ref%5B%22_%22.concat(field)%5D,%20definition.constructor,%20ref,%20field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Encode%20refId%20for%20this%20instance.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20The%20actual%20instance%20is%20going%20to%20be%20encoded%20on%20next%20%60changeTree%60%20iteration.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20value.$changes.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20cache%20begin%20/%20end%20index%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.cache(fieldIndex,%20bytes.slice(beginIndex));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!encodeAll%20&&%20!useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.discard();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20bytes;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.encodeAll%20=%20function%20(useFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this.encode(true,%20%5B%5D,%20useFilters);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.applyFilters%20=%20function%20(client,%20encodeAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(encodeAll%20===%20void%200)%20%7B%20encodeAll%20=%20false;%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20root%20=%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20refIdsDissallowed%20=%20new%20Set();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20$filterState%20=%20ClientState.get(client);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTrees%20=%20%5Bthis.$changes%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20numChangeTrees%20=%201;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20filteredBytes%20=%20%5B%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_loop_1%20=%20function%20(i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTree%20=%20changeTrees%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(refIdsDissallowed.has(changeTree.refId))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%22continue%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20changeTree.ref;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isSchema%20=%20ref%20instanceof%20Schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20SWITCH_TO_STRUCTURE);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20changeTree.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20clientHasRefId%20=%20$filterState.refIds.has(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20isEncodeAll%20=%20(encodeAll%20%7C%7C%20!clientHasRefId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log(%22REF:%22,%20ref.constructor.name);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log(%22Encode%20all?%22,%20isEncodeAll);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20include%20%60changeTree%60%20on%20list%20of%20known%20refIds%20by%20this%20client.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$filterState.addRefId(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20containerIndexes%20=%20$filterState.containerIndexes.get(changeTree);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20changes%20=%20(isEncodeAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20Array.from(changeTree.allChanges)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20Array.from(changeTree.changes.values());%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20WORKAROUND:%20tries%20to%20re-evaluate%20previously%20not%20included%20@filter()%20attributes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20see%20%22DELETE%20a%20field%20of%20Schema%22%20test%20case.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!encodeAll%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20isSchema%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref._definition.indexesWithFilters)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20indexesWithFilters%20=%20ref._definition.indexesWithFilters;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20indexesWithFilters.forEach(function%20(indexWithFilter)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!containerIndexes.has(indexWithFilter)%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTree.allChanges.has(indexWithFilter))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isEncodeAll)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changes.push(indexWithFilter);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changes.push(%7B%20op:%20exports.OPERATION.ADD,%20index:%20indexWithFilter,%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20j%20=%200,%20cl%20=%20changes.length;%20j%20%3C%20cl;%20j++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20change%20=%20(isEncodeAll)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20%7B%20op:%20exports.OPERATION.ADD,%20index:%20changes%5Bj%5D%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20changes%5Bj%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20custom%20operations%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.CLEAR)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20change.op);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldIndex%20=%20change.index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Deleting%20fields:%20encode%20the%20operation%20+%20field%20index%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20DELETE%20operations%20also%20need%20to%20go%20through%20filtering.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20cache%20the%20previous%20value%20so%20we%20can%20access%20the%20value%20(primitive%20or%20%60refId%60)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20(check%20against%20%60$filterState.refIds%60)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20change.op%20%7C%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20change.op);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20indexed%20operation%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20value%20=%20changeTree.getValue(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type%20=%20changeTree.getType(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Is%20a%20Schema!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20filter%20=%20(ref._definition.filters%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ref._definition.filters%5BfieldIndex%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(filter%20&&%20!filter.call(ref,%20client,%20value,%20root))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refIdsDissallowed.add(value%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Is%20a%20collection!%20(map,%20array,%20etc.)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20parent%20=%20changeTree.parent;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20filter%20=%20changeTree.getChildrenFilter();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(filter%20&&%20!filter.call(parent,%20client,%20ref%5B'$indexes'%5D.get(fieldIndex),%20value,%20root))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%20&&%20value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refIdsDissallowed.add(value%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20visit%20child%20ChangeTree%20on%20further%20iteration.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20changeTrees.push(value%5B'$changes'%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20numChangeTrees++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Copy%20cached%20bytes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20!==%20exports.OPERATION.TOUCH)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20me!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.ADD%20%7C%7C%20isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20use%20cached%20bytes%20directly%20if%20is%20from%20Schema%20type.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20filteredBytes.push.apply(filteredBytes,%20(_a%20=%20changeTree.caches%5BfieldIndex%5D)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20%5B%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20containerIndexes.add(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(containerIndexes.has(fieldIndex))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20use%20cached%20bytes%20if%20already%20has%20the%20field%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20filteredBytes.push.apply(filteredBytes,%20(_b%20=%20changeTree.caches%5BfieldIndex%5D)%20!==%20null%20&&%20_b%20!==%20void%200%20?%20_b%20:%20%5B%5D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20force%20ADD%20operation%20if%20field%20is%20not%20known%20by%20this%20client.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20containerIndexes.add(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20exports.OPERATION.ADD);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20MapSchema%20dynamic%20key%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20dynamicIndex%20=%20changeTree.ref%5B'$indexes'%5D.get(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string$1(filteredBytes,%20dynamicIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(value%5B'$changes'%5D)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20value%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%22encodePrimitiveType%22%20without%20type%20checking.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20the%20type%20checking%20has%20been%20done%20on%20the%20first%20.encode()%20call.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20encode%5Btype%5D(filteredBytes,%20value);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(value%5B'$changes'%5D%20&&%20!isSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20track%20ADD/REPLACE/DELETE%20instances%20on%20%60$filterState%60%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20-%20do%20NOT%20always%20encode%20dynamicIndex%20for%20MapSchema.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20(If%20client%20already%20has%20that%20key,%20only%20the%20first%20index%20is%20necessary.)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(filteredBytes,%20exports.OPERATION.ADD);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20MapSchema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20MapSchema%20dynamic%20key%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20dynamicIndex%20=%20changeTree.ref%5B'$indexes'%5D.get(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string$1(filteredBytes,%20dynamicIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(filteredBytes,%20value%5B'$changes'%5D.refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20numChangeTrees;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_loop_1(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20filteredBytes;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.clone%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20cloned%20=%20new%20(this.constructor);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20schema%20=%20this._definition.schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20field%20in%20schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(this%5Bfield%5D)%20===%20%22object%22%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20((_a%20=%20this%5Bfield%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.clone)%20===%20%22function%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20deep%20clone%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%5Bfield%5D%20=%20this%5Bfield%5D.clone();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20primitive%20values%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cloned%5Bfield%5D%20=%20this%5Bfield%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20cloned;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.toJSON%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20schema%20=%20this._definition.schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20deprecated%20=%20this._definition.deprecated;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20obj%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20field%20in%20schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!deprecated%5Bfield%5D%20&&%20this%5Bfield%5D%20!==%20null%20&&%20typeof%20(this%5Bfield%5D)%20!==%20%22undefined%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj%5Bfield%5D%20=%20(typeof%20(this%5Bfield%5D%5B'toJSON'%5D)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20this%5Bfield%5D%5B'toJSON'%5D()%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20this%5B%22_%22.concat(field)%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20obj;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.discardAllChanges%20=%20function%20()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this.$changes.discardAll();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.getByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20this%5Bthis._definition.fieldsByIndex%5Bindex%5D%5D;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.deleteByIndex%20=%20function%20(index)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20this%5Bthis._definition.fieldsByIndex%5Bindex%5D%5D%20=%20undefined;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.tryEncodeTypeId%20=%20function%20(bytes,%20type,%20targetType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(type._typeid%20!==%20targetType._typeid)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uint8$1(bytes,%20TYPE_ID);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20number$1(bytes,%20targetType._typeid);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.getSchemaType%20=%20function%20(bytes,%20it,%20defaultType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20type;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(bytes%5Bit.offset%5D%20===%20TYPE_ID)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20it.offset++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20=%20this.constructor._context.get(number(bytes,%20it));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20type%20%7C%7C%20defaultType;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype.createTypeInstance%20=%20function%20(type)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20instance%20=%20new%20type();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20//%20assign%20root%20on%20$changes%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20instance.$changes.root%20=%20this.$changes.root;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20instance;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema.prototype._triggerChanges%20=%20function%20(changes)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a,%20_b,%20_c,%20_d,%20_e,%20_f,%20_g,%20_h,%20_j;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20uniqueRefIds%20=%20new%20Set();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20$refs%20=%20this.$changes.root.refs;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_loop_2%20=%20function%20(i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20change%20=%20changes%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refId%20=%20change.refId;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20$refs.get(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20$callbacks%20=%20ref%5B'$callbacks'%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20trigger%20onRemove%20on%20child%20structure.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((change.op%20&%20exports.OPERATION.DELETE)%20===%20exports.OPERATION.DELETE%20&&%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20change.previousValue%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_b%20=%20(_a%20=%20change.previousValue%5B'$callbacks'%5D)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a%5Bexports.OPERATION.DELETE%5D)%20===%20null%20%7C%7C%20_b%20===%20void%200%20?%20void%200%20:%20_b.forEach(function%20(callback)%20%7B%20return%20callback();%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20no%20callbacks%20defined,%20skip%20this%20structure!%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!$callbacks)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%22continue%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(ref%20instanceof%20Schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!uniqueRefIds.has(refId))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20trigger%20onChange%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_c%20=%20$callbacks%20===%20null%20%7C%7C%20$callbacks%20===%20void%200%20?%20void%200%20:%20$callbacks%5Bexports.OPERATION.REPLACE%5D)%20===%20null%20%7C%7C%20_c%20===%20void%200%20?%20void%200%20:%20_c.forEach(function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20callback();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20catch%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Schema.onError(e);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20($callbacks.hasOwnProperty(change.field))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_d%20=%20$callbacks%5Bchange.field%5D)%20===%20null%20%7C%7C%20_d%20===%20void%200%20?%20void%200%20:%20_d.forEach(function%20(callback)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20callback(change.value,%20change.previousValue);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20catch%20(e)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Schema.onError(e);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20is%20a%20collection%20of%20items%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.op%20===%20exports.OPERATION.ADD%20&&%20change.previousValue%20===%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20triger%20onAdd%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_e%20=%20$callbacks%5Bexports.OPERATION.ADD%5D)%20===%20null%20%7C%7C%20_e%20===%20void%200%20?%20void%200%20:%20_e.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.value,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(change.op%20===%20exports.OPERATION.DELETE)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20FIXME:%20%60previousValue%60%20should%20always%20be%20available.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ADD%20+%20DELETE%20operations%20are%20still%20encoding%20DELETE%20operation.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.previousValue%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20triger%20onRemove%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_f%20=%20$callbacks%5Bexports.OPERATION.DELETE%5D)%20===%20null%20%7C%7C%20_f%20===%20void%200%20?%20void%200%20:%20_f.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.previousValue,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20(change.op%20===%20exports.OPERATION.DELETE_AND_ADD)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20triger%20onRemove%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.previousValue%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_g%20=%20$callbacks%5Bexports.OPERATION.DELETE%5D)%20===%20null%20%7C%7C%20_g%20===%20void%200%20?%20void%200%20:%20_g.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.previousValue,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20triger%20onAdd%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_h%20=%20$callbacks%5Bexports.OPERATION.ADD%5D)%20===%20null%20%7C%7C%20_h%20===%20void%200%20?%20void%200%20:%20_h.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.value,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20trigger%20onChange%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.value%20!==%20change.previousValue)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_j%20=%20$callbacks%5Bexports.OPERATION.REPLACE%5D)%20===%20null%20%7C%7C%20_j%20===%20void%200%20?%20void%200%20:%20_j.forEach(function%20(callback)%20%7B%20var%20_a;%20return%20callback(change.value,%20(_a%20=%20change.dynamicIndex)%20!==%20null%20&&%20_a%20!==%20void%200%20?%20_a%20:%20change.field);%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20uniqueRefIds.add(refId);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20changes.length;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_loop_2(i);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Schema._definition%20=%20SchemaDefinition.create();%20%09%09%20%20%20%20%20%20%20%20return%20Schema;%20%09%09%20%20%20%20%7D());%20%20%09%09%20%20%20%20function%20dumpChanges(schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20changeTrees%20=%20%5Bschema%5B'$changes'%5D%5D;%20%09%09%20%20%20%20%20%20%20%20var%20numChangeTrees%20=%201;%20%09%09%20%20%20%20%20%20%20%20var%20dump%20=%20%7B%7D;%20%09%09%20%20%20%20%20%20%20%20var%20currentStructure%20=%20dump;%20%09%09%20%20%20%20%20%20%20%20var%20_loop_1%20=%20function%20(i)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20changeTree%20=%20changeTrees%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20changeTree.changes.forEach(function%20(change)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20ref%20=%20changeTree.ref;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldIndex%20=%20change.index;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20field%20=%20(ref%5B'_definition'%5D)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20ref%5B'_definition'%5D.fieldsByIndex%5BfieldIndex%5D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20ref%5B'$indexes'%5D.get(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20currentStructure%5Bfield%5D%20=%20changeTree.getValue(fieldIndex);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20for%20(var%20i%20=%200;%20i%20%3C%20numChangeTrees;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_loop_1(i);%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20return%20dump;%20%09%09%20%20%20%20%7D%20%20%09%09%20%20%20%20var%20reflectionContext%20=%20%7B%20context:%20new%20Context()%20%7D;%20%09%09%20%20%20%20/**%20%09%09%20%20%20%20%20*%20Reflection%20%09%09%20%20%20%20%20*/%20%09%09%20%20%20%20var%20ReflectionField%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20__extends(ReflectionField,%20_super);%20%09%09%20%20%20%20%20%20%20%20function%20ReflectionField()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20type(%22string%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%5D,%20ReflectionField.prototype,%20%22name%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20type(%22string%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%5D,%20ReflectionField.prototype,%20%22type%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20type(%22number%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%5D,%20ReflectionField.prototype,%20%22referencedType%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20return%20ReflectionField;%20%09%09%20%20%20%20%7D(Schema));%20%09%09%20%20%20%20var%20ReflectionType%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20__extends(ReflectionType,%20_super);%20%09%09%20%20%20%20%20%20%20%20function%20ReflectionType()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_this.fields%20=%20new%20ArraySchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_this;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20type(%22number%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%5D,%20ReflectionType.prototype,%20%22id%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20type(%5BReflectionField%5D,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%5D,%20ReflectionType.prototype,%20%22fields%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20return%20ReflectionType;%20%09%09%20%20%20%20%7D(Schema));%20%09%09%20%20%20%20var%20Reflection%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20__extends(Reflection,%20_super);%20%09%09%20%20%20%20%20%20%20%20function%20Reflection()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_this%20=%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20_this.types%20=%20new%20ArraySchema();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20_this;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20Reflection.encode%20=%20function%20(instance)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20rootSchemaType%20=%20instance.constructor;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20reflection%20=%20new%20Reflection();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20reflection.rootType%20=%20rootSchemaType._typeid;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20buildType%20=%20function%20(currentType,%20schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20fieldName%20in%20schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20field%20=%20new%20ReflectionField();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field.name%20=%20fieldName;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldType%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(schema%5BfieldName%5D)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20=%20schema%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type_1%20=%20schema%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20childTypeSchema%20=%20void%200;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20TODO:%20refactor%20below.%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(Schema.is(type_1))%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20=%20%22ref%22;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20childTypeSchema%20=%20schema%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20=%20Object.keys(type_1)%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(type_1%5BfieldType%5D)%20===%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20+=%20%22:%22%20+%20type_1%5BfieldType%5D;%20//%20array:string%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20childTypeSchema%20=%20type_1%5BfieldType%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field.referencedType%20=%20(childTypeSchema)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20childTypeSchema._typeid%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20-1;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20field.type%20=%20fieldType;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20currentType.fields.push(field);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reflection.types.push(currentType);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20types%20=%20(_a%20=%20rootSchemaType._context)%20===%20null%20%7C%7C%20_a%20===%20void%200%20?%20void%200%20:%20_a.types;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20typeid%20in%20types)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20type_2%20=%20new%20ReflectionType();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type_2.id%20=%20Number(typeid);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20buildType(type_2,%20types%5Btypeid%5D._definition.schema);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20reflection.encodeAll();%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20Reflection.decode%20=%20function%20(bytes,%20it)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20context%20=%20new%20Context();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20reflection%20=%20new%20Reflection();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20reflection.decode(bytes,%20it);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20schemaTypes%20=%20reflection.types.reduce(function%20(types,%20reflectionType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20schema%20=%20/**%20@class%20*/%20(function%20(_super)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20__extends(_,%20_super);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20function%20_()%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_super%20!==%20null%20&&%20_super.apply(this,%20arguments)%20%7C%7C%20this;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20_;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D(Schema));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20typeid%20=%20reflectionType.id;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20types%5Btypeid%5D%20=%20schema;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20context.add(schema,%20typeid);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20types;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%7B%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20reflection.types.forEach(function%20(reflectionType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20schemaType%20=%20schemaTypes%5BreflectionType.id%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reflectionType.fields.forEach(function%20(field)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20_a;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(field.referencedType%20!==%20undefined)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldType%20=%20field.type;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20refType%20=%20schemaTypes%5Bfield.referencedType%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20map%20or%20array%20of%20primitive%20type%20(-1)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!refType)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20typeInfo%20=%20field.type.split(%22:%22);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fieldType%20=%20typeInfo%5B0%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20refType%20=%20typeInfo%5B1%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(fieldType%20===%20%22ref%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(refType,%20%7B%20context:%20context%20%7D)(schemaType.prototype,%20field.name);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type((_a%20=%20%7B%7D,%20_a%5BfieldType%5D%20=%20refType,%20_a),%20%7B%20context:%20context%20%7D)(schemaType.prototype,%20field.name);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type(field.type,%20%7B%20context:%20context%20%7D)(schemaType.prototype,%20field.name);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20rootType%20=%20schemaTypes%5Breflection.rootType%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20var%20rootInstance%20=%20new%20rootType();%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20/**%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20auto-initialize%20referenced%20types%20on%20root%20type%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*%20to%20allow%20registering%20listeners%20immediatelly%20on%20client-side%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20*/%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20fieldName%20in%20rootType._definition.schema)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20fieldType%20=%20rootType._definition.schema%5BfieldName%5D;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20(fieldType)%20!==%20%22string%22)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rootInstance%5BfieldName%5D%20=%20(typeof%20(fieldType)%20===%20%22function%22)%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20?%20new%20fieldType()%20//%20is%20a%20schema%20reference%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20:%20new%20(getType(Object.keys(fieldType)%5B0%5D)).constructor();%20//%20is%20a%20%22collection%22%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20return%20rootInstance;%20%09%09%20%20%20%20%20%20%20%20%7D;%20%09%09%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20type(%5BReflectionType%5D,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%5D,%20Reflection.prototype,%20%22types%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20__decorate(%5B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20type(%22number%22,%20reflectionContext)%20%09%09%20%20%20%20%20%20%20%20%5D,%20Reflection.prototype,%20%22rootType%22,%20void%200);%20%09%09%20%20%20%20%20%20%20%20return%20Reflection;%20%09%09%20%20%20%20%7D(Schema));%20%20%09%09%20%20%20%20registerType(%22map%22,%20%7B%20constructor:%20MapSchema%20%7D);%20%09%09%20%20%20%20registerType(%22array%22,%20%7B%20constructor:%20ArraySchema%20%7D);%20%09%09%20%20%20%20registerType(%22set%22,%20%7B%20constructor:%20SetSchema%20%7D);%20%09%09%20%20%20%20registerType(%22collection%22,%20%7B%20constructor:%20CollectionSchema,%20%7D);%20%20%09%09%20%20%20%20exports.ArraySchema%20=%20ArraySchema;%20%09%09%20%20%20%20exports.CollectionSchema%20=%20CollectionSchema;%20%09%09%20%20%20%20exports.Context%20=%20Context;%20%09%09%20%20%20%20exports.MapSchema%20=%20MapSchema;%20%09%09%20%20%20%20exports.Reflection%20=%20Reflection;%20%09%09%20%20%20%20exports.ReflectionField%20=%20ReflectionField;%20%09%09%20%20%20%20exports.ReflectionType%20=%20ReflectionType;%20%09%09%20%20%20%20exports.Schema%20=%20Schema;%20%09%09%20%20%20%20exports.SchemaDefinition%20=%20SchemaDefinition;%20%09%09%20%20%20%20exports.SetSchema%20=%20SetSchema;%20%09%09%20%20%20%20exports.decode%20=%20decode;%20%09%09%20%20%20%20exports.defineTypes%20=%20defineTypes;%20%09%09%20%20%20%20exports.deprecated%20=%20deprecated;%20%09%09%20%20%20%20exports.dumpChanges%20=%20dumpChanges;%20%09%09%20%20%20%20exports.encode%20=%20encode;%20%09%09%20%20%20%20exports.filter%20=%20filter;%20%09%09%20%20%20%20exports.filterChildren%20=%20filterChildren;%20%09%09%20%20%20%20exports.hasFilter%20=%20hasFilter;%20%09%09%20%20%20%20exports.registerType%20=%20registerType;%20%09%09%20%20%20%20exports.type%20=%20type;%20%20%09%09%7D));%20%20%09%7D%20(umd,%20umd.exports));%20%20%09var%20umdExports%20=%20umd.exports;%20%20%09var%20Protocol%20=%20%7B%7D;%20%20%09(function%20(exports)%20%7B%20%09%09//%20Use%20codes%20between%200~127%20for%20lesser%20throughput%20(1%20byte)%20%09%09Object.defineProperty(exports,%20%22__esModule%22,%20%7B%20value:%20true%20%7D);%20%09%09exports.utf8Length%20=%20exports.utf8Read%20=%20exports.ErrorCode%20=%20exports.Protocol%20=%20void%200;%20%09%09(function%20(Protocol)%20%7B%20%09%09%20%20%20%20//%20Room-related%20(10~19)%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22HANDSHAKE%22%5D%20=%209%5D%20=%20%22HANDSHAKE%22;%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22JOIN_ROOM%22%5D%20=%2010%5D%20=%20%22JOIN_ROOM%22;%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22ERROR%22%5D%20=%2011%5D%20=%20%22ERROR%22;%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22LEAVE_ROOM%22%5D%20=%2012%5D%20=%20%22LEAVE_ROOM%22;%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22ROOM_DATA%22%5D%20=%2013%5D%20=%20%22ROOM_DATA%22;%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22ROOM_STATE%22%5D%20=%2014%5D%20=%20%22ROOM_STATE%22;%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22ROOM_STATE_PATCH%22%5D%20=%2015%5D%20=%20%22ROOM_STATE_PATCH%22;%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22ROOM_DATA_SCHEMA%22%5D%20=%2016%5D%20=%20%22ROOM_DATA_SCHEMA%22;%20%09%09%20%20%20%20Protocol%5BProtocol%5B%22ROOM_DATA_BYTES%22%5D%20=%2017%5D%20=%20%22ROOM_DATA_BYTES%22;%20%09%09%7D)(exports.Protocol%20%7C%7C%20(exports.Protocol%20=%20%7B%7D));%20%09%09(function%20(ErrorCode)%20%7B%20%09%09%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_NO_HANDLER%22%5D%20=%204210%5D%20=%20%22MATCHMAKE_NO_HANDLER%22;%20%09%09%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_INVALID_CRITERIA%22%5D%20=%204211%5D%20=%20%22MATCHMAKE_INVALID_CRITERIA%22;%20%09%09%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_INVALID_ROOM_ID%22%5D%20=%204212%5D%20=%20%22MATCHMAKE_INVALID_ROOM_ID%22;%20%09%09%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_UNHANDLED%22%5D%20=%204213%5D%20=%20%22MATCHMAKE_UNHANDLED%22;%20%09%09%20%20%20%20ErrorCode%5BErrorCode%5B%22MATCHMAKE_EXPIRED%22%5D%20=%204214%5D%20=%20%22MATCHMAKE_EXPIRED%22;%20%09%09%20%20%20%20ErrorCode%5BErrorCode%5B%22AUTH_FAILED%22%5D%20=%204215%5D%20=%20%22AUTH_FAILED%22;%20%09%09%20%20%20%20ErrorCode%5BErrorCode%5B%22APPLICATION_ERROR%22%5D%20=%204216%5D%20=%20%22APPLICATION_ERROR%22;%20%09%09%7D)(exports.ErrorCode%20%7C%7C%20(exports.ErrorCode%20=%20%7B%7D));%20%09%09function%20utf8Read(view,%20offset)%20%7B%20%09%09%20%20%20%20const%20length%20=%20view%5Boffset++%5D;%20%09%09%20%20%20%20var%20string%20=%20'',%20chr%20=%200;%20%09%09%20%20%20%20for%20(var%20i%20=%20offset,%20end%20=%20offset%20+%20length;%20i%20%3C%20end;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20var%20byte%20=%20view%5Bi%5D;%20%09%09%20%20%20%20%20%20%20%20if%20((byte%20&%200x80)%20===%200x00)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(byte);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20((byte%20&%200xe0)%20===%200xc0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x1f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(view%5B++i%5D%20&%200x3f));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20((byte%20&%200xf0)%20===%200xe0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(((byte%20&%200x0f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%200));%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20if%20((byte%20&%200xf8)%20===%200xf0)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20chr%20=%20((byte%20&%200x07)%20%3C%3C%2018)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%2012)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%206)%20%7C%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((view%5B++i%5D%20&%200x3f)%20%3C%3C%200);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(chr%20%3E=%200x010000)%20%7B%20//%20surrogate%20pair%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chr%20-=%200x010000;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode((chr%20%3E%3E%3E%2010)%20+%200xD800,%20(chr%20&%200x3FF)%20+%200xDC00);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20string%20+=%20String.fromCharCode(chr);%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20throw%20new%20Error('Invalid%20byte%20'%20+%20byte.toString(16));%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20return%20string;%20%09%09%7D%20%09%09exports.utf8Read%20=%20utf8Read;%20%09%09//%20Faster%20for%20short%20strings%20than%20Buffer.byteLength%20%09%09function%20utf8Length(str%20=%20'')%20%7B%20%09%09%20%20%20%20let%20c%20=%200;%20%09%09%20%20%20%20let%20length%20=%200;%20%09%09%20%20%20%20for%20(let%20i%20=%200,%20l%20=%20str.length;%20i%20%3C%20l;%20i++)%20%7B%20%09%09%20%20%20%20%20%20%20%20c%20=%20str.charCodeAt(i);%20%09%09%20%20%20%20%20%20%20%20if%20(c%20%3C%200x80)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%201;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200x800)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%202;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20if%20(c%20%3C%200xd800%20%7C%7C%20c%20%3E=%200xe000)%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%203;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%20%20%20%20else%20%7B%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20i++;%20%09%09%20%20%20%20%20%20%20%20%20%20%20%20length%20+=%204;%20%09%09%20%20%20%20%20%20%20%20%7D%20%09%09%20%20%20%20%7D%20%09%09%20%20%20%20return%20length%20+%201;%20%09%09%7D%20%09%09exports.utf8Length%20=%20utf8Length;%20%09%09%20%09%7D%20(Protocol));%20%20%09class%20SchemaSerializer%20extends%20EventTarget%20%7B%20%09%20%20%20%20state;%20%09%20%20%20%20setState(rawState)%20%7B%20%09%20%20%20%20%20%20%20%20this.state.decode(rawState);%20%09%20%20%20%20%20%20%20%20this.dispatchEvent(new%20CustomEvent('patch',%20%7B%20detail:%20null%20%7D));%20%09%20%20%20%20%20%20%20%20this.dispatchEvent(new%20Event('load'));%20%09%20%20%20%20%7D%20%09%20%20%20%20getState()%20%7B%20%09%20%20%20%20%20%20%20%20return%20this.state;%20%09%20%20%20%20%7D%20%09%20%20%20%20patch(patches)%20%7B%20%09%20%20%20%20%20%20%20%20let%20res%20=%20this.state.decode(patches);%20%09%20%20%20%20%20%20%20%20for%20(let%20change%20of%20res)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(change.field%20!=%20'gameTime')%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.dispatchEvent(new%20CustomEvent('patch',%20%7B%20detail:%20res%20%7D));%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%7D%20%09%20%20%20%20teardown()%20%7B%20%09%20%20%20%20%20%20%20%20this.state?.%5B'$changes'%5D?.root.clearRefs();%20%09%20%20%20%20%7D%20%09%20%20%20%20handshake(bytes,%20it)%20%7B%20%09%20%20%20%20%20%20%20%20if%20(this.state)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20const%20reflection%20=%20new%20umdExports.Reflection();%20%09%20%20%20%20%20%20%20%20%20%20%20%20reflection.decode(bytes,%20it);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20initialize%20reflected%20state%20from%20server%20%09%20%20%20%20%20%20%20%20%20%20%20%20this.state%20=%20umdExports.Reflection.decode(bytes,%20it);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20this.dispatchEvent(new%20CustomEvent('patch',%20%7B%20detail:%20null%20%7D));%20%09%20%20%20%20%7D%20%09%7D%20%09const%20serializer%20=%20new%20SchemaSerializer();%20%09function%20onMessage(event)%20%7B%20%09%20%20%20%20const%20bytes%20=%20Array.from(new%20Uint8Array(event.data));%20%09%20%20%20%20const%20code%20=%20bytes%5B0%5D;%20%09%20%20%20%20if%20(code%20===%20colyseusExports.Protocol.JOIN_ROOM)%20%7B%20%09%20%20%20%20%20%20%20%20let%20offset%20=%201;%20%09%20%20%20%20%20%20%20%20const%20reconnectionToken%20=%20Protocol.utf8Read(bytes,%20offset);%20%09%20%20%20%20%20%20%20%20offset%20+=%20Protocol.utf8Length(reconnectionToken);%20%09%20%20%20%20%20%20%20%20const%20serializerId%20=%20Protocol.utf8Read(bytes,%20offset);%20%09%20%20%20%20%20%20%20%20offset%20+=%20Protocol.utf8Length(serializerId);%20%09%20%20%20%20%20%20%20%20console.log(reconnectionToken,%20serializerId,%20offset);%20%09%20%20%20%20%20%20%20%20if%20(bytes.length%20%3E%20offset)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20serializer.handshake(bytes,%20%7B%20offset%20%7D);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%7D%20%09%20%20%20%20else%20if%20(code%20===%20colyseusExports.Protocol.ROOM_DATA_SCHEMA)%20;%20%09%20%20%20%20else%20if%20(code%20===%20colyseusExports.Protocol.ROOM_STATE)%20%7B%20%09%20%20%20%20%20%20%20%20bytes.shift();%20//%20drop%20%60code%60%20byte%20%09%20%20%20%20%20%20%20%20serializer.setState(bytes);%20%09%20%20%20%20%7D%20%09%20%20%20%20else%20if%20(code%20===%20colyseusExports.Protocol.ROOM_STATE_PATCH)%20%7B%20%09%20%20%20%20%20%20%20%20bytes.shift();%20//%20drop%20%60code%60%20byte%20%09%20%20%20%20%20%20%20%20serializer.patch(bytes);%20%09%20%20%20%20%7D%20%09%20%20%20%20else%20if%20(code%20===%20colyseusExports.Protocol.ROOM_DATA)%20%7B%20%09%20%20%20%20%20%20%20%20const%20it%20=%20%7B%20offset:%201%20%7D;%20%09%20%20%20%20%20%20%20%20const%20type%20=%20(umdExports.decode.stringCheck(bytes,%20it))%20%09%20%20%20%20%20%20%20%20%20%20%20%20?%20umdExports.decode.string(bytes,%20it)%20%09%20%20%20%20%20%20%20%20%20%20%20%20:%20umdExports.decode.number(bytes,%20it);%20%09%20%20%20%20%20%20%20%20const%20message%20=%20(bytes.length%20%3E%20it.offset)%20%09%20%20%20%20%20%20%20%20%20%20%20%20?%20decode_1(event.data,%20it.offset)%20%09%20%20%20%20%20%20%20%20%20%20%20%20:%20undefined;%20%09%20%20%20%20%20%20%20%20return%20%7B%20type,%20message%20%7D;%20%09%20%20%20%20%7D%20%09%20%20%20%20else%20if%20(code%20===%20colyseusExports.Protocol.ROOM_DATA_BYTES)%20%7B%20%09%20%20%20%20%20%20%20%20const%20it%20=%20%7B%20offset:%201%20%7D;%20%09%20%20%20%20%20%20%20%20const%20type%20=%20(umdExports.decode.stringCheck(bytes,%20it))%20%09%20%20%20%20%20%20%20%20%20%20%20%20?%20umdExports.decode.string(bytes,%20it)%20%09%20%20%20%20%20%20%20%20%20%20%20%20:%20umdExports.decode.number(bytes,%20it);%20%09%20%20%20%20%20%20%20%20return%20%7B%20type,%20message:%20new%20Uint8Array(bytes.slice(it.offset))%20%7D;%20%09%20%20%20%20%7D%20%09%20%20%20%20return%20null;%20%09%7D%20%20%09class%20SocketManager%20extends%20EventTarget%20%7B%20%09%20%20%20%20socket%20=%20null;%20%09%20%20%20%20transportType%20=%20writable(%22unknown%22);%20%09%20%20%20%20blueboatRoomId%20=%20null;%20%09%20%20%20%20setup()%20%7B%20%09%20%20%20%20%20%20%20%20let%20manager%20=%20this;%20%09%20%20%20%20%20%20%20%20//%20override%20the%20default%20WebSocket%20%09%20%20%20%20%20%20%20%20class%20NewWebSocket%20extends%20WebSocket%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20constructor(url,%20params)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20super(url,%20params);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!manager.socket)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20manager.registerSocket(this);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20send(data)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20manager.onSend(data);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20super.send(data);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20//%20override%20XMLHttpRequest%20to%20get%20the%20room%20id%20%09%20%20%20%20%20%20%20%20let%20nativeXMLSend%20=%20XMLHttpRequest.prototype.send;%20%09%20%20%20%20%20%20%20%20XMLHttpRequest.prototype.send%20=%20function%20()%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20this.addEventListener('load',%20()%20=%3E%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.responseURL.endsWith(%22/matchmaker/join%22))%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20response%20=%20JSON.parse(this.responseText);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20manager.blueboatRoomId%20=%20response.roomId;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(%22Got%20Blueboat%20Room%20Id:%20%22%20+%20manager.blueboatRoomId);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%20%20%20%20%20%20%20%20%20%20%20%20nativeXMLSend.apply(this,%20arguments);%20%09%20%20%20%20%20%20%20%20%7D;%20%09%20%20%20%20%20%20%20%20getUnsafeWindow().WebSocket%20=%20NewWebSocket;%20%09%20%20%20%20%7D%20%09%20%20%20%20registerSocket(socket)%20%7B%20%09%20%20%20%20%20%20%20%20this.socket%20=%20socket;%20%09%20%20%20%20%20%20%20%20//%20detect%20the%20transport%20type%20%09%20%20%20%20%20%20%20%20if%20('Phaser'%20in%20getUnsafeWindow())%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20this.transportType.set(%22colyseus%22);%20%09%20%20%20%20%20%20%20%20%20%20%20%20this.addEventListener('colyseusMessage',%20(e)%20=%3E%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(e.detail.type%20!=%20%22DEVICES_STATES_CHANGES%22)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20changes%20=%20parseChangePacket(e.detail.message);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.dispatchEvent(new%20CustomEvent('deviceChanges',%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20detail:%20changes%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D));%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20%09%20%20%20%20%20%20%20%20%20%20%20%20this.transportType.set(%22blueboat%22);%20%09%20%20%20%20%20%20%20%20//%20when%20we%20get%20a%20message,%20decode%20it%20and%20dispatch%20it%20%09%20%20%20%20%20%20%20%20socket.addEventListener('message',%20(e)%20=%3E%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20let%20decoded;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(get_store_value(this.transportType)%20==%20'colyseus')%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20decoded%20=%20onMessage(e);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!decoded)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.dispatchEvent(new%20CustomEvent('colyseusMessage',%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20detail:%20decoded%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D));%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20decoded%20=%20blueboat.decode(e.data);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!decoded)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.dispatchEvent(new%20CustomEvent('blueboatMessage',%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20detail:%20decoded%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D));%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D);%20%09%20%20%20%20%7D%20%09%20%20%20%20onSend(data)%20%7B%20%09%20%20%20%20%20%20%20%20//%20if%20we're%20already%20in%20a%20room,%20get%20the%20room%20id%20from%20the%20data%20%09%20%20%20%20%20%20%20%20if%20(get_store_value(this.transportType)%20==%20%22blueboat%22%20&&%20!this.blueboatRoomId)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20let%20decoded%20=%20blueboat.decode(data);%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(decoded.roomId)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.blueboatRoomId%20=%20decoded.roomId;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(decoded.room)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.blueboatRoomId%20=%20decoded.room;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(this.blueboatRoomId)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(%22Got%20Blueboat%20Room%20Id:%20%22%20+%20this.blueboatRoomId);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%7D%20%09%20%20%20%20sendMessage(channel,%20data)%20%7B%20%09%20%20%20%20%20%20%20%20if%20(!this.socket)%20%09%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%20%20%20%20%20%20%20%20if%20(!this.blueboatRoomId%20&&%20get_store_value(this.transportType)%20==%20%22blueboat%22)%20%09%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%20%20%20%20%20%20%20%20let%20encoded;%20%09%20%20%20%20%20%20%20%20if%20(get_store_value(this.transportType)%20==%20'colyseus')%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20let%20header%20=%20%5BcolyseusExports.Protocol.ROOM_DATA%5D;%20%09%20%20%20%20%20%20%20%20%20%20%20%20let%20channelEncoded%20=%20encode_1(channel);%20%09%20%20%20%20%20%20%20%20%20%20%20%20let%20packetEncoded%20=%20encode_1(data);%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20combine%20the%20arraybuffers%20%09%20%20%20%20%20%20%20%20%20%20%20%20encoded%20=%20new%20Uint8Array(channelEncoded.byteLength%20+%20packetEncoded.byteLength%20+%20header.length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20encoded.set(header);%20%09%20%20%20%20%20%20%20%20%20%20%20%20encoded.set(new%20Uint8Array(channelEncoded),%20header.length);%20%09%20%20%20%20%20%20%20%20%20%20%20%20encoded.set(new%20Uint8Array(packetEncoded),%20header.length%20+%20channelEncoded.byteLength);%20%09%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20else%20%09%20%20%20%20%20%20%20%20%20%20%20%20encoded%20=%20blueboat.encode(channel,%20data,%20this.blueboatRoomId);%20%09%20%20%20%20%20%20%20%20this.socket.send(encoded);%20%09%20%20%20%20%7D%20%09%7D%20%09const%20socketManager%20=%20new%20SocketManager();%20%20%09const%20showHud%20=%20writable(true);%20%09const%20storesLoaded%20=%20writable(false);%20%09getUnsafeWindow().storesLoaded%20=%20storesLoaded;%20%09const%20playerId%20=%20writable(null);%20%09socketManager.addEventListener('colyseusMessage',%20((event)%20=%3E%20%7B%20%09%20%20%20%20if%20(event.detail.type%20!==%20'AUTH_ID')%20%09%20%20%20%20%20%20%20%20return;%20%09%20%20%20%20playerId.set(event.detail.message);%20%09%20%20%20%20console.log(%22%5BGC%5D%20Got%20player%20id:%20%22%20+%20event.detail.message);%20%09%7D));%20%09const%20devicesLoaded%20=%20writable(false);%20%09socketManager.addEventListener('colyseusMessage',%20(e)%20=%3E%20%7B%20%09%20%20%20%20if%20(e.detail.type%20===%20'DEVICES_STATES_CHANGES')%20%7B%20%09%20%20%20%20%20%20%20%20//%20it%20takes%20a%20sec%20for%20the%20devices%20to%20get%20applied,%20for%20some%20reason?%20%09%20%20%20%20%20%20%20%20let%20checkInterval%20=%20setInterval(()%20=%3E%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20let%20devices%20=%20getUnsafeWindow()?.stores?.phaser?.scene?.worldManager?.devices?.allDevices;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(!devices)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%20%09%20%20%20%20%20%20%20%20%20%20%20%20if%20(devices.length%20%3E=%20e.detail.message.changes.length)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20clearInterval(checkInterval);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20devicesLoaded.set(true);%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D,%20100);%20%09%20%20%20%20%7D%20%09%7D);%20%20%09/*%20src%5Chud%5CMenu.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09const%20%7B%20window:%20window_1$1%20%7D%20=%20globals;%20%20%09function%20add_css$f(target)%20%7B%20%09%09append_styles(target,%20%22svelte-4jfbq8%22,%20%22.menu.svelte-4jfbq8%7Bposition:absolute;background-color:var(--menuBackgroundColor);resize:both;overflow:hidden;min-width:150px;border-radius:5px;user-select:none;pointer-events:all;outline-width:3px;outline-style:solid;outline-color:var(--menuOutlineColor)%7D.children.svelte-4jfbq8%7Bposition:relative;height:calc(100%25%20-%2021px);overflow-x:hidden;overflow-y:auto%7D.groupContent%7Bposition:absolute;top:0;left:0;display:flex;flex-direction:column;width:100%25%7D.groupContent.svelte-4jfbq8%7Btransform:translateX(0);opacity:1;pointer-events:all%7D.menu.minimized.svelte-4jfbq8%7Boverflow:hidden;resize:horizontal;height:21px%20!important%7D.header.svelte-4jfbq8%7Bbackground-color:var(--menuHeaderBackgroundColor);position:relative;color:var(--menuHeaderTextColor);width:100%25;text-align:center;font-size:14px;height:21px%7D.minimize.svelte-4jfbq8%7Bbackground-color:transparent;border:none;align-items:center;position:absolute;right:5px;top:0;cursor:pointer%7D%22);%20%09%7D%20%20%09function%20create_fragment$E(ctx)%20%7B%20%09%09let%20div3;%20%09%09let%20div0;%20%09%09let%20t0;%20%09%09let%20t1;%20%09%09let%20button;%20%09%09let%20t2_value%20=%20(/*minimized*/%20ctx%5B2%5D%20?%20%22+%22%20:%20%22-%22)%20+%20%22%22;%20%09%09let%20t2;%20%09%09let%20t3;%20%09%09let%20div2;%20%09%09let%20div1;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%09%09const%20default_slot_template%20=%20/*%23slots*/%20ctx%5B11%5D.default;%20%09%09const%20default_slot%20=%20create_slot(default_slot_template,%20ctx,%20/*$$scope*/%20ctx%5B10%5D,%20null);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div3%20=%20element(%22div%22);%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09t0%20=%20text(/*name*/%20ctx%5B0%5D);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09button%20=%20element(%22button%22);%20%09%09%09%09t2%20=%20text(t2_value);%20%09%09%09%09t3%20=%20space();%20%09%09%09%09div2%20=%20element(%22div%22);%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09if%20(default_slot)%20default_slot.c();%20%09%09%09%09attr(button,%20%22class%22,%20%22minimize%20svelte-4jfbq8%22);%20%09%09%09%09attr(div0,%20%22class%22,%20%22header%20svelte-4jfbq8%22);%20%09%09%09%09attr(div1,%20%22class%22,%20%22groupContent%20open%20svelte-4jfbq8%22);%20%09%09%09%09attr(div2,%20%22class%22,%20%22children%20svelte-4jfbq8%22);%20%09%09%09%09attr(div3,%20%22class%22,%20%22menu%20svelte-4jfbq8%22);%20%09%09%09%09set_style(div3,%20%22left%22,%20/*$coordSpring*/%20ctx%5B3%5D.x%20+%20%22px%22);%20%09%09%09%09set_style(div3,%20%22top%22,%20/*$coordSpring*/%20ctx%5B3%5D.y%20+%20%22px%22);%20%09%09%09%09toggle_class(div3,%20%22minimized%22,%20/*minimized*/%20ctx%5B2%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div3,%20anchor);%20%09%09%09%09append(div3,%20div0);%20%09%09%09%09append(div0,%20t0);%20%09%09%09%09append(div0,%20t1);%20%09%09%09%09append(div0,%20button);%20%09%09%09%09append(button,%20t2);%20%09%09%09%09append(div3,%20t3);%20%09%09%09%09append(div3,%20div2);%20%09%09%09%09append(div2,%20div1);%20%20%09%09%09%09if%20(default_slot)%20%7B%20%09%09%09%09%09default_slot.m(div1,%20null);%20%09%09%09%09%7D%20%20%09%09%09%09/*div3_binding*/%20ctx%5B12%5D(div3);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(window_1$1,%20%22mouseup%22,%20/*stopDrag*/%20ctx%5B8%5D),%20%09%09%09%09%09%09listen(window_1$1,%20%22mousemove%22,%20/*drag*/%20ctx%5B7%5D),%20%09%09%09%09%09%09listen(window_1$1,%20%22resize%22,%20/*onResize*/%20ctx%5B5%5D),%20%09%09%09%09%09%09listen(button,%20%22click%22,%20/*toggleMinimized*/%20ctx%5B9%5D),%20%09%09%09%09%09%09listen(div3,%20%22mousedown%22,%20/*startDrag*/%20ctx%5B6%5D)%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%5B0%5D%20&%20/*name*/%201)%20set_data(t0,%20/*name*/%20ctx%5B0%5D);%20%09%09%09%09if%20((!current%20%7C%7C%20dirty%5B0%5D%20&%20/*minimized*/%204)%20&&%20t2_value%20!==%20(t2_value%20=%20(/*minimized*/%20ctx%5B2%5D%20?%20%22+%22%20:%20%22-%22)%20+%20%22%22))%20set_data(t2,%20t2_value);%20%20%09%09%09%09if%20(default_slot)%20%7B%20%09%09%09%09%09if%20(default_slot.p%20&&%20(!current%20%7C%7C%20dirty%5B0%5D%20&%20/*$$scope*/%201024))%20%7B%20%09%09%09%09%09%09update_slot_base(%20%09%09%09%09%09%09%09default_slot,%20%09%09%09%09%09%09%09default_slot_template,%20%09%09%09%09%09%09%09ctx,%20%09%09%09%09%09%09%09/*$$scope*/%20ctx%5B10%5D,%20%09%09%09%09%09%09%09!current%20%09%09%09%09%09%09%09?%20get_all_dirty_from_scope(/*$$scope*/%20ctx%5B10%5D)%20%09%09%09%09%09%09%09:%20get_slot_changes(default_slot_template,%20/*$$scope*/%20ctx%5B10%5D,%20dirty,%20null),%20%09%09%09%09%09%09%09null%20%09%09%09%09%09%09);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%5B0%5D%20&%20/*$coordSpring*/%208)%20%7B%20%09%09%09%09%09set_style(div3,%20%22left%22,%20/*$coordSpring*/%20ctx%5B3%5D.x%20+%20%22px%22);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%5B0%5D%20&%20/*$coordSpring*/%208)%20%7B%20%09%09%09%09%09set_style(div3,%20%22top%22,%20/*$coordSpring*/%20ctx%5B3%5D.y%20+%20%22px%22);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%5B0%5D%20&%20/*minimized*/%204)%20%7B%20%09%09%09%09%09toggle_class(div3,%20%22minimized%22,%20/*minimized*/%20ctx%5B2%5D);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(default_slot,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(default_slot,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div3);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(default_slot)%20default_slot.d(detaching);%20%09%09%09%09/*div3_binding*/%20ctx%5B12%5D(null);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$x($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20$coordSpring;%20%09%09let%20%7B%20$$slots:%20slots%20=%20%7B%7D,%20$$scope%20%7D%20=%20$$props;%20%09%09let%20%7B%20name%20%7D%20=%20$$props;%20%20%09%09//%20This%20whole%20file%20is%20a%20mess,%20but%20it's%20a%20mess%20that%20works*%20%09%09let%20transform%20=%20getMenuTransform(name);%20%20%09%09let%20x%20=%20transform?.x%20??%2050;%20%09%09let%20y%20=%20transform?.y%20??%2050;%20%09%09let%20width%20=%20transform?.width%20??%20200;%20%09%09let%20height%20=%20transform?.height%20??%20200;%20%09%09let%20lastWidth%20=%20width;%20%09%09let%20lastHeight%20=%20height;%20%09%09let%20coordSpring%20=%20spring(moveInbounds(x,%20y),%20%7B%20stiffness:%200.1,%20damping:%200.5%20%7D);%20%09%09component_subscribe($$self,%20coordSpring,%20value%20=%3E%20$$invalidate(3,%20$coordSpring%20=%20value));%20%09%09let%20coords%20=%20get_store_value(coordSpring);%20%09%09let%20returnX%20=%20coords.x;%20%09%09let%20returnY%20=%20coords.y;%20%20%09%09function%20onResize()%20%7B%20%09%09%09let%20coords%20=%20get_store_value(coordSpring);%20%09%09%09coordSpring.set(moveInbounds(coords.x,%20coords.y));%20%09%09%7D%20%20%09%09function%20moveInbounds(x,%20y)%20%7B%20%09%09%09if%20(x%20%3C%200)%20x%20=%200;%20%09%09%09if%20(y%20%3C%200)%20y%20=%200;%20%09%09%09if%20(x%20+%20lastWidth%20%3E%20window.innerWidth)%20x%20=%20window.innerWidth%20-%20lastWidth;%20%09%09%09if%20(y%20+%20lastHeight%20%3E%20window.innerHeight)%20y%20=%20window.innerHeight%20-%20lastHeight;%20%09%09%09return%20%7B%20x,%20y%20%7D;%20%09%09%7D%20%20%09%09let%20transitioning%20=%20false;%20%20%09%09//%20move%20out%20of%20the%20way%20when%20the%20hud%20is%20hidden%20%09%09showHud.subscribe(v%20=%3E%20%7B%20%09%09%09if%20(v)%20%7B%20%09%09%09%09coordSpring.set(moveInbounds(returnX,%20returnY));%20%09%09%09%09transitioning%20=%20false;%20%09%09%09%7D%20else%20%7B%20%09%09%09%09transitioning%20=%20true;%20%09%09%09%09let%20coords%20=%20get_store_value(coordSpring);%20%20%09%09%09%09//%20move%20over%20the%20nearest%20edge%20%09%09%09%09let%20cX%20=%20coords.x%20+%20lastWidth%20/%202;%20%20%09%09%09%09let%20cY%20=%20coords.y%20+%20lastHeight%20/%202;%20%20%09%09%09%09let%20endX%20=%20cX%20%3C%20window.innerWidth%20/%202%20%09%09%09%09?%20-lastWidth%20%09%09%09%09:%20window.innerWidth;%20%20%09%09%09%09let%20endY%20=%20cY%20%3C%20window.innerHeight%20/%202%20%09%09%09%09?%20-lastHeight%20%09%09%09%09:%20window.innerHeight;%20%20%09%09%09%09if%20(Math.abs(endX%20-%20coords.x)%20%3C%20Math.abs(endY%20-%20coords.y))%20%7B%20%09%09%09%09%09coordSpring.set(%7B%20x:%20endX,%20y:%20coords.y%20%7D);%20%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09coordSpring.set(%7B%20x:%20coords.x,%20y:%20endY%20%7D);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D);%20%20%09%09let%20element;%20%09%09let%20minimized%20=%20transform?.minimized%20??%20false;%20%09%09let%20dragState%20=%20'waiting';%20%09%09let%20startX,%20startY;%20%09%09let%20dragDistance;%20%20%09%09function%20startDrag(event)%20%7B%20%09%09%09dragState%20=%20'checking';%20%09%09%09const%20coords%20=%20get_store_value(coordSpring);%20%09%09%09startX%20=%20event.clientX%20-%20coords.x;%20%09%09%09startY%20=%20event.clientY%20-%20coords.y;%20%09%09%09dragDistance%20=%200;%20%09%09%7D%20%20%09%09function%20saveTransform()%20%7B%20%09%09%09if%20(transitioning)%20return;%20%09%09%09let%20coords%20=%20get_store_value(coordSpring);%20%20%09%09%09setMenuTransform(name,%20%7B%20%09%09%09%09x:%20coords.x,%20%09%09%09%09y:%20coords.y,%20%09%09%09%09width:%20lastWidth,%20%09%09%09%09height:%20lastHeight,%20%09%09%09%09minimized%20%09%09%09%7D);%20%09%09%7D%20%20%09%09const%20saveTransformDebounce%20=%20debounce$1(saveTransform,%20100);%20%09%09coordSpring.subscribe(()%20=%3E%20saveTransformDebounce());%20%20%09%09function%20drag(event)%20%7B%20%09%09%09if%20(dragState%20==%20'waiting')%20return;%20%09%09%09dragDistance%20+=%20Math.abs(event.movementX)%20+%20Math.abs(event.movementY);%20%20%09%09%09if%20(dragState%20==%20'checking'%20&&%20dragDistance%20%3E%20100)%20%7B%20%09%09%09%09dragState%20=%20'dragging';%20%09%09%09%09return;%20%09%09%09%7D%20%20%09%09%09if%20(dragState%20==%20'dragging')%20%7B%20%09%09%09%09let%20newX%20=%20event.clientX%20-%20startX;%20%09%09%09%09let%20newY%20=%20event.clientY%20-%20startY;%20%09%09%09%09returnX%20=%20newX;%20%09%09%09%09returnY%20=%20newY;%20%09%09%09%09coordSpring.set(moveInbounds(newX,%20newY));%20%09%09%09%09saveTransformDebounce();%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20stopDrag()%20%7B%20%09%09%09dragState%20=%20'waiting';%20%09%09%7D%20%20%09%09let%20observer%20=%20new%20ResizeObserver(entries%20=%3E%20%7B%20%09%09%09%09dragState%20=%20'waiting';%20%09%09%09%09let%20entry%20=%20entries%5B0%5D;%20%20%09%09%09%09if%20(!minimized)%20%7B%20%09%09%09%09%09lastHeight%20=%20entry.contentRect.height;%20%09%09%09%09%7D%20%20%09%09%09%09lastWidth%20=%20entry.contentRect.width;%20%09%09%09%09saveTransformDebounce();%20%09%09%09%7D);%20%20%09%09onMount(()%20=%3E%20%7B%20%09%09%09observer.observe(element);%20%09%09%09$$invalidate(1,%20element.style.height%20=%20%60$%7BMath.max(height,%2021)%7Dpx%60,%20element);%20%09%09%09$$invalidate(1,%20element.style.width%20=%20%60$%7BMath.max(width,%20150)%7Dpx%60,%20element);%20%09%09%7D);%20%20%09%09onDestroy(()%20=%3E%20%7B%20%09%09%09observer.disconnect();%20%09%09%7D);%20%20%09%09function%20toggleMinimized()%20%7B%20%09%09%09$$invalidate(2,%20minimized%20=%20!minimized);%20%09%09%09saveTransformDebounce();%20%09%09%7D%20%20%09%09function%20div3_binding($$value)%20%7B%20%09%09%09binding_callbacks%5B$$value%20?%20'unshift'%20:%20'push'%5D(()%20=%3E%20%7B%20%09%09%09%09element%20=%20$$value;%20%09%09%09%09$$invalidate(1,%20element);%20%09%09%09%7D);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('name'%20in%20$$props)%20$$invalidate(0,%20name%20=%20$$props.name);%20%09%09%09if%20('$$scope'%20in%20$$props)%20$$invalidate(10,%20$$scope%20=%20$$props.$$scope);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09name,%20%09%09%09element,%20%09%09%09minimized,%20%09%09%09$coordSpring,%20%09%09%09coordSpring,%20%09%09%09onResize,%20%09%09%09startDrag,%20%09%09%09drag,%20%09%09%09stopDrag,%20%09%09%09toggleMinimized,%20%09%09%09$$scope,%20%09%09%09slots,%20%09%09%09div3_binding%20%09%09%5D;%20%09%7D%20%20%09class%20Menu%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$x,%20create_fragment$E,%20safe_not_equal,%20%7B%20name:%200%20%7D,%20add_css$f,%20%5B-1,%20-1%5D);%20%09%09%7D%20%09%7D%20%20%09/*%20node_modules%5Csvelte-material-icons%5CKeyboardOutline.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_if_block_1$5(ctx)%20%7B%20%09%09let%20desc_1;%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09desc_1%20=%20svg_element(%22desc%22);%20%09%09%09%09t%20=%20text(/*desc*/%20ctx%5B7%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20desc_1,%20anchor);%20%09%09%09%09append(desc_1,%20t);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*desc*/%20128)%20set_data(t,%20/*desc*/%20ctx%5B7%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(desc_1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(16:165)%20%7B%23if%20title%7D%20%09function%20create_if_block$b(ctx)%20%7B%20%09%09let%20title_1;%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09title_1%20=%20svg_element(%22title%22);%20%09%09%09%09t%20=%20text(/*title*/%20ctx%5B6%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20title_1,%20anchor);%20%09%09%09%09append(title_1,%20t);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*title*/%2064)%20set_data(t,%20/*title*/%20ctx%5B6%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(title_1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$D(ctx)%20%7B%20%09%09let%20svg;%20%09%09let%20if_block0_anchor;%20%09%09let%20path;%20%09%09let%20if_block0%20=%20/*desc*/%20ctx%5B7%5D%20&&%20create_if_block_1$5(ctx);%20%09%09let%20if_block1%20=%20/*title*/%20ctx%5B6%5D%20&&%20create_if_block$b(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09svg%20=%20svg_element(%22svg%22);%20%09%09%09%09if%20(if_block0)%20if_block0.c();%20%09%09%09%09if_block0_anchor%20=%20empty();%20%09%09%09%09if%20(if_block1)%20if_block1.c();%20%09%09%09%09path%20=%20svg_element(%22path%22);%20%09%09%09%09attr(path,%20%22d%22,%20%22M4,5A2,2%200%200,0%202,7V17A2,2%200%200,0%204,19H20A2,2%200%200,0%2022,17V7A2,2%200%200,0%2020,5H4M4,7H20V17H4V7M5,8V10H7V8H5M8,8V10H10V8H8M11,8V10H13V8H11M14,8V10H16V8H14M17,8V10H19V8H17M5,11V13H7V11H5M8,11V13H10V11H8M11,11V13H13V11H11M14,11V13H16V11H14M17,11V13H19V11H17M8,14V16H16V14H8Z%22);%20%09%09%09%09attr(path,%20%22fill%22,%20/*color*/%20ctx%5B2%5D);%20%09%09%09%09attr(svg,%20%22viewBox%22,%20/*viewBox*/%20ctx%5B3%5D);%20%09%09%09%09attr(svg,%20%22width%22,%20/*width*/%20ctx%5B0%5D);%20%09%09%09%09attr(svg,%20%22height%22,%20/*height*/%20ctx%5B1%5D);%20%09%09%09%09attr(svg,%20%22class%22,%20/*className*/%20ctx%5B8%5D);%20%09%09%09%09attr(svg,%20%22aria-label%22,%20/*ariaLabel*/%20ctx%5B4%5D);%20%09%09%09%09attr(svg,%20%22aria-hidden%22,%20/*ariaHidden*/%20ctx%5B5%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20svg,%20anchor);%20%09%09%09%09if%20(if_block0)%20if_block0.m(svg,%20null);%20%09%09%09%09append(svg,%20if_block0_anchor);%20%09%09%09%09if%20(if_block1)%20if_block1.m(svg,%20null);%20%09%09%09%09append(svg,%20path);%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(/*desc*/%20ctx%5B7%5D)%20%7B%20%09%09%09%09%09if%20(if_block0)%20%7B%20%09%09%09%09%09%09if_block0.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block0%20=%20create_if_block_1$5(ctx);%20%09%09%09%09%09%09if_block0.c();%20%09%09%09%09%09%09if_block0.m(svg,%20if_block0_anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block0)%20%7B%20%09%09%09%09%09if_block0.d(1);%20%09%09%09%09%09if_block0%20=%20null;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(/*title*/%20ctx%5B6%5D)%20%7B%20%09%09%09%09%09if%20(if_block1)%20%7B%20%09%09%09%09%09%09if_block1.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block1%20=%20create_if_block$b(ctx);%20%09%09%09%09%09%09if_block1.c();%20%09%09%09%09%09%09if_block1.m(svg,%20path);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block1)%20%7B%20%09%09%09%09%09if_block1.d(1);%20%09%09%09%09%09if_block1%20=%20null;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*color*/%204)%20%7B%20%09%09%09%09%09attr(path,%20%22fill%22,%20/*color*/%20ctx%5B2%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*viewBox*/%208)%20%7B%20%09%09%09%09%09attr(svg,%20%22viewBox%22,%20/*viewBox*/%20ctx%5B3%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*width*/%201)%20%7B%20%09%09%09%09%09attr(svg,%20%22width%22,%20/*width*/%20ctx%5B0%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*height*/%202)%20%7B%20%09%09%09%09%09attr(svg,%20%22height%22,%20/*height*/%20ctx%5B1%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*className*/%20256)%20%7B%20%09%09%09%09%09attr(svg,%20%22class%22,%20/*className*/%20ctx%5B8%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*ariaLabel*/%2016)%20%7B%20%09%09%09%09%09attr(svg,%20%22aria-label%22,%20/*ariaLabel*/%20ctx%5B4%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*ariaHidden*/%2032)%20%7B%20%09%09%09%09%09attr(svg,%20%22aria-hidden%22,%20/*ariaHidden*/%20ctx%5B5%5D);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i:%20noop,%20%09%09%09o:%20noop,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(svg);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(if_block0)%20if_block0.d();%20%09%09%09%09if%20(if_block1)%20if_block1.d();%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$w($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20size%20=%20%221em%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20width%20=%20size%20%7D%20=%20$$props;%20%09%09let%20%7B%20height%20=%20size%20%7D%20=%20$$props;%20%09%09let%20%7B%20color%20=%20%22currentColor%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20viewBox%20=%20%220%200%2024%2024%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20ariaLabel%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20ariaHidden%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20title%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20desc%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20class:%20className%20=%20void%200%20%7D%20=%20$$props;%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('size'%20in%20$$props)%20$$invalidate(9,%20size%20=%20$$props.size);%20%09%09%09if%20('width'%20in%20$$props)%20$$invalidate(0,%20width%20=%20$$props.width);%20%09%09%09if%20('height'%20in%20$$props)%20$$invalidate(1,%20height%20=%20$$props.height);%20%09%09%09if%20('color'%20in%20$$props)%20$$invalidate(2,%20color%20=%20$$props.color);%20%09%09%09if%20('viewBox'%20in%20$$props)%20$$invalidate(3,%20viewBox%20=%20$$props.viewBox);%20%09%09%09if%20('ariaLabel'%20in%20$$props)%20$$invalidate(4,%20ariaLabel%20=%20$$props.ariaLabel);%20%09%09%09if%20('ariaHidden'%20in%20$$props)%20$$invalidate(5,%20ariaHidden%20=%20$$props.ariaHidden);%20%09%09%09if%20('title'%20in%20$$props)%20$$invalidate(6,%20title%20=%20$$props.title);%20%09%09%09if%20('desc'%20in%20$$props)%20$$invalidate(7,%20desc%20=%20$$props.desc);%20%09%09%09if%20('class'%20in%20$$props)%20$$invalidate(8,%20className%20=%20$$props.class);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09width,%20%09%09%09height,%20%09%09%09color,%20%09%09%09viewBox,%20%09%09%09ariaLabel,%20%09%09%09ariaHidden,%20%09%09%09title,%20%09%09%09desc,%20%09%09%09className,%20%09%09%09size%20%09%09%5D;%20%09%7D%20%20%09class%20KeyboardOutline%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%20%09%09%09init(this,%20options,%20instance$w,%20create_fragment$D,%20safe_not_equal,%20%7B%20%09%09%09%09size:%209,%20%09%09%09%09width:%200,%20%09%09%09%09height:%201,%20%09%09%09%09color:%202,%20%09%09%09%09viewBox:%203,%20%09%09%09%09ariaLabel:%204,%20%09%09%09%09ariaHidden:%205,%20%09%09%09%09title:%206,%20%09%09%09%09desc:%207,%20%09%09%09%09class:%208%20%09%09%09%7D);%20%09%09%7D%20%09%7D%20%20%09class%20KeybindManager%20%7B%20%09%20%20%20%20keysPressed%20=%20new%20Set();%20%09%20%20%20%20keybinds%20=%20new%20Map();%20%09%20%20%20%20constructor()%20%7B%20%09%20%20%20%20%20%20%20%20window.addEventListener('keydown',%20(e)%20=%3E%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20this.keysPressed.add(e.key.toLowerCase());%20%09%20%20%20%20%20%20%20%20%20%20%20%20//%20check%20if%20any%20keybinds%20are%20pressed%20%09%20%20%20%20%20%20%20%20%20%20%20%20checkKeybinds:%20for%20(const%20%5Bkeys,%20callback%5D%20of%20this.keybinds)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(keys.size%20==%200)%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(const%20key%20of%20keys)%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!this.keysPressed.has(key))%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%20checkKeybinds;%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20callback();%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%7D);%20%09%20%20%20%20%20%20%20%20window.addEventListener('keyup',%20(e)%20=%3E%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20this.keysPressed.delete(e.key.toLowerCase());%20%09%20%20%20%20%20%20%20%20%7D);%20%09%20%20%20%20%7D%20%09%20%20%20%20addKeybind(keys,%20callback)%20%7B%20%09%20%20%20%20%20%20%20%20this.keybinds.set(keys,%20callback);%20%09%20%20%20%20%7D%20%09%20%20%20%20removeKeybind(keys)%20%7B%20%09%20%20%20%20%20%20%20%20this.keybinds.delete(keys);%20%09%20%20%20%20%7D%20%09%7D%20%09const%20keybindManager%20=%20new%20KeybindManager();%20%20%09/*%20src%5Chud%5CKeybindCreator.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$e(target)%20%7B%20%09%09append_styles(target,%20%22svelte-1j00okq%22,%20%22dialog.svelte-1j00okq%7Bwidth:400px;height:300px;border-radius:15px;background-color:white;border:3px%20solid%20black;display:flex;flex-direction:column%7Dh2.svelte-1j00okq%7Bwidth:100%25;text-align:center%7Dbutton%5Bdisabled%5D.svelte-1j00okq%7Bopacity:0.5;cursor:not-allowed%7D.recordBtn.svelte-1j00okq%7Bwidth:100%25;height:50px;border:none;background-color:%23f0f0f0;cursor:pointer;border-radius:10px%7D.hotkeyDisplay.svelte-1j00okq%7Bwidth:100%25;text-align:center;height:80px;overflow-y:auto;margin-top:20px%7D.completeContainer.svelte-1j00okq%7Bdisplay:flex;justify-content:space-between;margin-top:20px%7D.confirm.svelte-1j00okq,.cancel.svelte-1j00okq%7Bwidth:40%25;border:none;border-radius:3px%7D.confirm.svelte-1j00okq%7Bbackground-color:lightgreen%7D.cancel.svelte-1j00okq%7Bbackground-color:lightcoral%7D%22);%20%09%7D%20%20%09//%20(49:8)%20%7B:else%7D%20%09function%20create_else_block_2(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Re-record%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(47:39)%20%20%09function%20create_if_block_3(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Start%20recording%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(45:8)%20%7B%23if%20recording%7D%20%09function%20create_if_block_2(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Stop%20recording%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(60:8)%20%7B:else%7D%20%09function%20create_else_block_1$1(ctx)%20%7B%20%09%09let%20t_value%20=%20Array.from(/*keysDeref*/%20ctx%5B0%5D).map(func).join('%20+%20')%20+%20%22%22;%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(t_value);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*keysDeref*/%201%20&&%20t_value%20!==%20(t_value%20=%20Array.from(/*keysDeref*/%20ctx%5B0%5D).map(func).join('%20+%20')%20+%20%22%22))%20set_data(t,%20t_value);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(54:8)%20%7B%23if%20keysDeref.size%20===%200%7D%20%09function%20create_if_block$a(ctx)%20%7B%20%09%09let%20if_block_anchor;%20%20%09%09function%20select_block_type_2(ctx,%20dirty)%20%7B%20%09%09%09if%20(/*recording*/%20ctx%5B1%5D)%20return%20create_if_block_1$4;%20%09%09%09return%20create_else_block$3;%20%09%09%7D%20%20%09%09let%20current_block_type%20=%20select_block_type_2(ctx);%20%09%09let%20if_block%20=%20current_block_type(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09if_block.c();%20%09%09%09%09if_block_anchor%20=%20empty();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09if_block.m(target,%20anchor);%20%09%09%09%09insert(target,%20if_block_anchor,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(current_block_type%20!==%20(current_block_type%20=%20select_block_type_2(ctx)))%20%7B%20%09%09%09%09%09if_block.d(1);%20%09%09%09%09%09if_block%20=%20current_block_type(ctx);%20%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09if_block.m(if_block_anchor.parentNode,%20if_block_anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(if_block_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09if_block.d(detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(57:12)%20%7B:else%7D%20%09function%20create_else_block$3(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22No%20hotkey%20set%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(55:12)%20%7B%23if%20recording%7D%20%09function%20create_if_block_1$4(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Press%20any%20keys%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$C(ctx)%20%7B%20%09%09let%20dialog_1;%20%09%09let%20h2;%20%09%09let%20t1;%20%09%09let%20button0;%20%09%09let%20t2;%20%09%09let%20div0;%20%09%09let%20t3;%20%09%09let%20div1;%20%09%09let%20button1;%20%09%09let%20t4;%20%09%09let%20button1_disabled_value;%20%09%09let%20t5;%20%09%09let%20button2;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%20%09%09function%20select_block_type(ctx,%20dirty)%20%7B%20%09%09%09if%20(/*recording*/%20ctx%5B1%5D)%20return%20create_if_block_2;%20%09%09%09if%20(/*keysDeref*/%20ctx%5B0%5D.size%20===%200)%20return%20create_if_block_3;%20%09%09%09return%20create_else_block_2;%20%09%09%7D%20%20%09%09let%20current_block_type%20=%20select_block_type(ctx);%20%09%09let%20if_block0%20=%20current_block_type(ctx);%20%20%09%09function%20select_block_type_1(ctx,%20dirty)%20%7B%20%09%09%09if%20(/*keysDeref*/%20ctx%5B0%5D.size%20===%200)%20return%20create_if_block$a;%20%09%09%09return%20create_else_block_1$1;%20%09%09%7D%20%20%09%09let%20current_block_type_1%20=%20select_block_type_1(ctx);%20%09%09let%20if_block1%20=%20current_block_type_1(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09dialog_1%20=%20element(%22dialog%22);%20%09%09%09%09h2%20=%20element(%22h2%22);%20%09%09%09%09h2.textContent%20=%20%22Create%20Hotkey%22;%20%09%09%09%09t1%20=%20space();%20%09%09%09%09button0%20=%20element(%22button%22);%20%09%09%09%09if_block0.c();%20%09%09%09%09t2%20=%20space();%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09if_block1.c();%20%09%09%09%09t3%20=%20space();%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09button1%20=%20element(%22button%22);%20%09%09%09%09t4%20=%20text(%22Confirm%22);%20%09%09%09%09t5%20=%20space();%20%09%09%09%09button2%20=%20element(%22button%22);%20%09%09%09%09button2.textContent%20=%20%22No%20hotkey%22;%20%09%09%09%09attr(h2,%20%22class%22,%20%22svelte-1j00okq%22);%20%09%09%09%09attr(button0,%20%22class%22,%20%22recordBtn%20svelte-1j00okq%22);%20%09%09%09%09attr(div0,%20%22class%22,%20%22hotkeyDisplay%20svelte-1j00okq%22);%20%09%09%09%09button1.disabled%20=%20button1_disabled_value%20=%20/*keysDeref*/%20ctx%5B0%5D.size%20===%200;%20%09%09%09%09attr(button1,%20%22class%22,%20%22confirm%20svelte-1j00okq%22);%20%09%09%09%09attr(button2,%20%22class%22,%20%22cancel%20svelte-1j00okq%22);%20%09%09%09%09attr(div1,%20%22class%22,%20%22completeContainer%20svelte-1j00okq%22);%20%09%09%09%09attr(dialog_1,%20%22class%22,%20%22svelte-1j00okq%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20dialog_1,%20anchor);%20%09%09%09%09append(dialog_1,%20h2);%20%09%09%09%09append(dialog_1,%20t1);%20%09%09%09%09append(dialog_1,%20button0);%20%09%09%09%09if_block0.m(button0,%20null);%20%09%09%09%09append(dialog_1,%20t2);%20%09%09%09%09append(dialog_1,%20div0);%20%09%09%09%09if_block1.m(div0,%20null);%20%09%09%09%09append(dialog_1,%20t3);%20%09%09%09%09append(dialog_1,%20div1);%20%09%09%09%09append(div1,%20button1);%20%09%09%09%09append(button1,%20t4);%20%09%09%09%09append(div1,%20t5);%20%09%09%09%09append(div1,%20button2);%20%09%09%09%09/*dialog_1_binding*/%20ctx%5B10%5D(dialog_1);%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(window,%20%22keydown%22,%20/*onKeydown*/%20ctx%5B3%5D),%20%09%09%09%09%09%09listen(button0,%20%22click%22,%20/*toggleRecording*/%20ctx%5B4%5D),%20%09%09%09%09%09%09listen(button0,%20%22keydown%22,%20prevent_default(/*keydown_handler*/%20ctx%5B9%5D)),%20%09%09%09%09%09%09listen(button1,%20%22click%22,%20/*confirm*/%20ctx%5B5%5D),%20%09%09%09%09%09%09listen(button2,%20%22click%22,%20/*cancel*/%20ctx%5B6%5D),%20%09%09%09%09%09%09listen(dialog_1,%20%22mousedown%22,%20stop_propagation(/*mousedown_handler*/%20ctx%5B8%5D))%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(current_block_type%20!==%20(current_block_type%20=%20select_block_type(ctx)))%20%7B%20%09%09%09%09%09if_block0.d(1);%20%09%09%09%09%09if_block0%20=%20current_block_type(ctx);%20%20%09%09%09%09%09if%20(if_block0)%20%7B%20%09%09%09%09%09%09if_block0.c();%20%09%09%09%09%09%09if_block0.m(button0,%20null);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09if%20(current_block_type_1%20===%20(current_block_type_1%20=%20select_block_type_1(ctx))%20&&%20if_block1)%20%7B%20%09%09%09%09%09if_block1.p(ctx,%20dirty);%20%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09if_block1.d(1);%20%09%09%09%09%09if_block1%20=%20current_block_type_1(ctx);%20%20%09%09%09%09%09if%20(if_block1)%20%7B%20%09%09%09%09%09%09if_block1.c();%20%09%09%09%09%09%09if_block1.m(div0,%20null);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*keysDeref*/%201%20&&%20button1_disabled_value%20!==%20(button1_disabled_value%20=%20/*keysDeref*/%20ctx%5B0%5D.size%20===%200))%20%7B%20%09%09%09%09%09button1.disabled%20=%20button1_disabled_value;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i:%20noop,%20%09%09%09o:%20noop,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(dialog_1);%20%09%09%09%09%7D%20%20%09%09%09%09if_block0.d();%20%09%09%09%09if_block1.d();%20%09%09%09%09/*dialog_1_binding*/%20ctx%5B10%5D(null);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09const%20func%20=%20key%20=%3E%20key%20===%20'%20'%20?%20'Space'%20:%20key;%20%20%09function%20instance$v($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20keys%20=%20new%20Set()%20%7D%20=%20$$props;%20%09%09let%20keysDeref%20=%20new%20Set(keys);%20%20%09%09//%20$:%20keysDeref%20=%20new%20Set(keys);%20%09%09let%20recording%20=%20false;%20%20%09%09let%20dialog;%20%09%09let%20dispatch%20=%20createEventDispatcher();%20%20%09%09function%20onKeydown(event)%20%7B%20%09%09%09if%20(!recording)%20return;%20%20%09%09%09if%20(event.key%20===%20'Escape')%20%7B%20%09%09%09%09$$invalidate(1,%20recording%20=%20false);%20%09%09%09%09return;%20%09%09%09%7D%20%20%09%09%09keysDeref.add(event.key.toLowerCase());%20%09%09%09$$invalidate(0,%20keysDeref);%20%09%09%7D%20%20%09%09function%20toggleRecording()%20%7B%20%09%09%09$$invalidate(1,%20recording%20=%20!recording);%20%20%09%09%09if%20(recording)%20%7B%20%09%09%09%09keysDeref.clear();%20%09%09%09%09$$invalidate(0,%20keysDeref);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20confirm()%20%7B%20%09%09%09dispatch('close',%20keysDeref);%20%09%09%7D%20%20%09%09function%20cancel()%20%7B%20%09%09%09dispatch('close',%20new%20Set());%20%09%09%7D%20%20%09%09onMount(()%20=%3E%20%7B%20%09%09%09dialog.showModal();%20%20%09%09%09dialog.addEventListener('close',%20()%20=%3E%20%7B%20%09%09%09%09dispatch('close',%20new%20Set());%20%09%09%09%7D);%20%09%09%7D);%20%20%09%09function%20mousedown_handler(event)%20%7B%20%09%09%09bubble.call(this,%20$$self,%20event);%20%09%09%7D%20%20%09%09function%20keydown_handler(event)%20%7B%20%09%09%09bubble.call(this,%20$$self,%20event);%20%09%09%7D%20%20%09%09function%20dialog_1_binding($$value)%20%7B%20%09%09%09binding_callbacks%5B$$value%20?%20'unshift'%20:%20'push'%5D(()%20=%3E%20%7B%20%09%09%09%09dialog%20=%20$$value;%20%09%09%09%09$$invalidate(2,%20dialog);%20%09%09%09%7D);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('keys'%20in%20$$props)%20$$invalidate(7,%20keys%20=%20$$props.keys);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09keysDeref,%20%09%09%09recording,%20%09%09%09dialog,%20%09%09%09onKeydown,%20%09%09%09toggleRecording,%20%09%09%09confirm,%20%09%09%09cancel,%20%09%09%09keys,%20%09%09%09mousedown_handler,%20%09%09%09keydown_handler,%20%09%09%09dialog_1_binding%20%09%09%5D;%20%09%7D%20%20%09class%20KeybindCreator%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$v,%20create_fragment$C,%20safe_not_equal,%20%7B%20keys:%207%20%7D,%20add_css$e);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Chud%5Ccomponents%5CHotkey.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$d(target)%20%7B%20%09%09append_styles(target,%20%22svelte-1tsrn0k%22,%20%22button.svelte-1tsrn0k%7Bbackground-color:transparent;border:none;height:30px;margin:0px;padding-right:0px%7D%22);%20%09%7D%20%20%09//%20(28:0)%20%7B%23if%20keybindCreatorOpen%7D%20%09function%20create_if_block$9(ctx)%20%7B%20%09%09let%20keybindcreator;%20%09%09let%20current;%20%09%09keybindcreator%20=%20new%20KeybindCreator(%7B%20props:%20%7B%20keys:%20/*keybind*/%20ctx%5B1%5D%20%7D%20%7D);%20%09%09keybindcreator.$on(%22close%22,%20/*onCreatorClose*/%20ctx%5B2%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(keybindcreator.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(keybindcreator,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(keybindcreator.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(keybindcreator.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(keybindcreator,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$B(ctx)%20%7B%20%09%09let%20t;%20%09%09let%20button;%20%09%09let%20keyboardoutline;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%09%09let%20if_block%20=%20/*keybindCreatorOpen*/%20ctx%5B0%5D%20&&%20create_if_block$9(ctx);%20%09%09keyboardoutline%20=%20new%20KeyboardOutline(%7B%20props:%20%7B%20width:%2030,%20height:%2030%20%7D%20%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09if%20(if_block)%20if_block.c();%20%09%09%09%09t%20=%20space();%20%09%09%09%09button%20=%20element(%22button%22);%20%09%09%09%09create_component(keyboardoutline.$$.fragment);%20%09%09%09%09attr(button,%20%22class%22,%20%22svelte-1tsrn0k%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09if%20(if_block)%20if_block.m(target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09insert(target,%20button,%20anchor);%20%09%09%09%09mount_component(keyboardoutline,%20button,%20null);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20listen(button,%20%22click%22,%20/*click_handler*/%20ctx%5B4%5D);%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(/*keybindCreatorOpen*/%20ctx%5B0%5D)%20%7B%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.p(ctx,%20dirty);%20%20%09%09%09%09%09%09if%20(dirty%20&%20/*keybindCreatorOpen*/%201)%20%7B%20%09%09%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block%20=%20create_if_block$9(ctx);%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09%09if_block.m(t.parentNode,%20t);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block)%20%7B%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09transition_out(if_block,%201,%201,%20()%20=%3E%20%7B%20%09%09%09%09%09%09if_block%20=%20null;%20%09%09%09%09%09%7D);%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(if_block);%20%09%09%09%09transition_in(keyboardoutline.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(if_block);%20%09%09%09%09transition_out(keyboardoutline.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%09detach(button);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(if_block)%20if_block.d(detaching);%20%09%09%09%09destroy_component(keyboardoutline);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09dispose();%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$u($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20hotkeyId%20%7D%20=%20$$props;%20%09%09let%20dispatch%20=%20createEventDispatcher();%20%09%09let%20keybindCreatorOpen%20=%20false;%20%09%09let%20keybind%20=%20new%20Set(getHotkey(hotkeyId)%20??%20%5B%5D);%20%20%09%09function%20onCreatorClose(result)%20%7B%20%09%09%09$$invalidate(0,%20keybindCreatorOpen%20=%20false);%20%09%09%09if%20(!result.detail)%20return;%20%20%09%09%09//%20gotta%20keep%20the%20refrence%20%09%09%09keybind.clear();%20%20%09%09%09for%20(let%20key%20of%20result.detail)%20%7B%20%09%09%09%09keybind.add(key);%20%09%09%09%7D%20%20%09%09%09setHotkey(hotkeyId,%20Array.from(keybind));%20%09%09%7D%20%20%09%09onMount(()%20=%3E%20%7B%20%09%09%09keybindManager.addKeybind(keybind,%20()%20=%3E%20%7B%20%09%09%09%09dispatch('trigger');%20%09%09%09%7D);%20%09%09%7D);%20%20%09%09const%20click_handler%20=%20()%20=%3E%20$$invalidate(0,%20keybindCreatorOpen%20=%20!keybindCreatorOpen);%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('hotkeyId'%20in%20$$props)%20$$invalidate(3,%20hotkeyId%20=%20$$props.hotkeyId);%20%09%09%7D;%20%20%09%09return%20%5BkeybindCreatorOpen,%20keybind,%20onCreatorClose,%20hotkeyId,%20click_handler%5D;%20%09%7D%20%20%09class%20Hotkey%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$u,%20create_fragment$B,%20safe_not_equal,%20%7B%20hotkeyId:%203%20%7D,%20add_css$d);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Chud%5Ccomponents%5CButton.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$c(target)%20%7B%20%09%09append_styles(target,%20%22svelte-o69qzc%22,%20%22.wrap.svelte-o69qzc%7Bdisplay:flex;flex-wrap:nowrap;align-items:center;justify-content:space-between;margin:5px%2010px%7Dbutton.svelte-o69qzc%7Bbackground-color:var(--buttonBackgroundColor);border:1px%20solid%20var(--buttonBorderColor);border-radius:5px;transition:transform%200.1s;flex-grow:1%7Dbutton.svelte-o69qzc:disabled%7Bopacity:0.5;cursor:not-allowed%7Dbutton.svelte-o69qzc:active,button.active.svelte-o69qzc%7Btransform:scale(0.95)%7D%22);%20%09%7D%20%20%09//%20(25:4)%20%7B%23if%20hotkeyId%7D%20%09function%20create_if_block$8(ctx)%20%7B%20%09%09let%20hotkey;%20%09%09let%20current;%20%09%09hotkey%20=%20new%20Hotkey(%7B%20props:%20%7B%20hotkeyId:%20/*hotkeyId*/%20ctx%5B2%5D%20%7D%20%7D);%20%09%09hotkey.$on(%22trigger%22,%20/*trigger*/%20ctx%5B6%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(hotkey.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(hotkey,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20hotkey_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*hotkeyId*/%204)%20hotkey_changes.hotkeyId%20=%20/*hotkeyId*/%20ctx%5B2%5D;%20%09%09%09%09hotkey.$set(hotkey_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(hotkey.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(hotkey.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(hotkey,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$A(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20button_1;%20%09%09let%20button_1_disabled_value;%20%09%09let%20button_1_title_value;%20%09%09let%20t;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%09%09const%20default_slot_template%20=%20/*%23slots*/%20ctx%5B8%5D.default;%20%09%09const%20default_slot%20=%20create_slot(default_slot_template,%20ctx,%20/*$$scope*/%20ctx%5B7%5D,%20null);%20%09%09let%20if_block%20=%20/*hotkeyId*/%20ctx%5B2%5D%20&&%20create_if_block$8(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09button_1%20=%20element(%22button%22);%20%09%09%09%09if%20(default_slot)%20default_slot.c();%20%09%09%09%09t%20=%20space();%20%09%09%09%09if%20(if_block)%20if_block.c();%20%09%09%09%09button_1.disabled%20=%20button_1_disabled_value%20=%20/*disabled*/%20ctx%5B0%5D%20===%20true%20%7C%7C%20/*disabled*/%20ctx%5B0%5D%20===%20undefined;%20%09%09%09%09attr(button_1,%20%22title%22,%20button_1_title_value%20=%20/*disabled*/%20ctx%5B0%5D%20?%20/*disabledMsg*/%20ctx%5B1%5D%20:%20undefined);%20%09%09%09%09attr(button_1,%20%22class%22,%20%22svelte-o69qzc%22);%20%09%09%09%09toggle_class(button_1,%20%22active%22,%20/*active*/%20ctx%5B4%5D);%20%09%09%09%09attr(div,%20%22class%22,%20%22wrap%20svelte-o69qzc%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09append(div,%20button_1);%20%20%09%09%09%09if%20(default_slot)%20%7B%20%09%09%09%09%09default_slot.m(button_1,%20null);%20%09%09%09%09%7D%20%20%09%09%09%09/*button_1_binding*/%20ctx%5B10%5D(button_1);%20%09%09%09%09append(div,%20t);%20%09%09%09%09if%20(if_block)%20if_block.m(div,%20null);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(button_1,%20%22click%22,%20/*onClick*/%20ctx%5B5%5D),%20%09%09%09%09%09%09listen(button_1,%20%22keydown%22,%20prevent_default(/*keydown_handler*/%20ctx%5B9%5D))%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(default_slot)%20%7B%20%09%09%09%09%09if%20(default_slot.p%20&&%20(!current%20%7C%7C%20dirty%20&%20/*$$scope*/%20128))%20%7B%20%09%09%09%09%09%09update_slot_base(%20%09%09%09%09%09%09%09default_slot,%20%09%09%09%09%09%09%09default_slot_template,%20%09%09%09%09%09%09%09ctx,%20%09%09%09%09%09%09%09/*$$scope*/%20ctx%5B7%5D,%20%09%09%09%09%09%09%09!current%20%09%09%09%09%09%09%09?%20get_all_dirty_from_scope(/*$$scope*/%20ctx%5B7%5D)%20%09%09%09%09%09%09%09:%20get_slot_changes(default_slot_template,%20/*$$scope*/%20ctx%5B7%5D,%20dirty,%20null),%20%09%09%09%09%09%09%09null%20%09%09%09%09%09%09);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*disabled*/%201%20&&%20button_1_disabled_value%20!==%20(button_1_disabled_value%20=%20/*disabled*/%20ctx%5B0%5D%20===%20true%20%7C%7C%20/*disabled*/%20ctx%5B0%5D%20===%20undefined))%20%7B%20%09%09%09%09%09button_1.disabled%20=%20button_1_disabled_value;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*disabled,%20disabledMsg*/%203%20&&%20button_1_title_value%20!==%20(button_1_title_value%20=%20/*disabled*/%20ctx%5B0%5D%20?%20/*disabledMsg*/%20ctx%5B1%5D%20:%20undefined))%20%7B%20%09%09%09%09%09attr(button_1,%20%22title%22,%20button_1_title_value);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*active*/%2016)%20%7B%20%09%09%09%09%09toggle_class(button_1,%20%22active%22,%20/*active*/%20ctx%5B4%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(/*hotkeyId*/%20ctx%5B2%5D)%20%7B%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.p(ctx,%20dirty);%20%20%09%09%09%09%09%09if%20(dirty%20&%20/*hotkeyId*/%204)%20%7B%20%09%09%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block%20=%20create_if_block$8(ctx);%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09%09if_block.m(div,%20null);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block)%20%7B%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09transition_out(if_block,%201,%201,%20()%20=%3E%20%7B%20%09%09%09%09%09%09if_block%20=%20null;%20%09%09%09%09%09%7D);%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(default_slot,%20local);%20%09%09%09%09transition_in(if_block);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(default_slot,%20local);%20%09%09%09%09transition_out(if_block);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(default_slot)%20default_slot.d(detaching);%20%09%09%09%09/*button_1_binding*/%20ctx%5B10%5D(null);%20%09%09%09%09if%20(if_block)%20if_block.d();%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$t($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20$$slots:%20slots%20=%20%7B%7D,%20$$scope%20%7D%20=%20$$props;%20%09%09let%20%7B%20disabled%20=%20null%20%7D%20=%20$$props;%20%09%09let%20%7B%20disabledMsg%20=%20undefined%20%7D%20=%20$$props;%20%09%09let%20%7B%20hotkeyId%20=%20undefined%20%7D%20=%20$$props;%20%09%09let%20dispatch%20=%20createEventDispatcher();%20%09%09let%20button;%20%09%09let%20active%20=%20false;%20%20%09%09function%20onClick()%20%7B%20%09%09%09dispatch(%22click%22);%20%09%09%7D%20%20%09%09function%20trigger()%20%7B%20%09%09%09dispatch(%22click%22);%20%09%09%09$$invalidate(4,%20active%20=%20true);%20%09%09%09setTimeout(()%20=%3E%20$$invalidate(4,%20active%20=%20false),%20100);%20%09%09%7D%20%20%09%09function%20keydown_handler(event)%20%7B%20%09%09%09bubble.call(this,%20$$self,%20event);%20%09%09%7D%20%20%09%09function%20button_1_binding($$value)%20%7B%20%09%09%09binding_callbacks%5B$$value%20?%20'unshift'%20:%20'push'%5D(()%20=%3E%20%7B%20%09%09%09%09button%20=%20$$value;%20%09%09%09%09$$invalidate(3,%20button);%20%09%09%09%7D);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('disabled'%20in%20$$props)%20$$invalidate(0,%20disabled%20=%20$$props.disabled);%20%09%09%09if%20('disabledMsg'%20in%20$$props)%20$$invalidate(1,%20disabledMsg%20=%20$$props.disabledMsg);%20%09%09%09if%20('hotkeyId'%20in%20$$props)%20$$invalidate(2,%20hotkeyId%20=%20$$props.hotkeyId);%20%09%09%09if%20('$$scope'%20in%20$$props)%20$$invalidate(7,%20$$scope%20=%20$$props.$$scope);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09disabled,%20%09%09%09disabledMsg,%20%09%09%09hotkeyId,%20%09%09%09button,%20%09%09%09active,%20%09%09%09onClick,%20%09%09%09trigger,%20%09%09%09$$scope,%20%09%09%09slots,%20%09%09%09keydown_handler,%20%09%09%09button_1_binding%20%09%09%5D;%20%09%7D%20%20%09class%20Button%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$t,%20create_fragment$A,%20safe_not_equal,%20%7B%20disabled:%200,%20disabledMsg:%201,%20hotkeyId:%202%20%7D,%20add_css$c);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Chud%5CGroup.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$b(target)%20%7B%20%09%09append_styles(target,%20%22svelte-151a7uw%22,%20%22.groupContent.svelte-151a7uw%7Btransform:translateX(100%25);opacity:0;pointer-events:none;display:none%7D@keyframes%20slide-in-left%7B0%25%7Btransform:translateX(-100%25);opacity:0;pointer-events:none%7D100%25%7Btransform:translateX(0%25);opacity:1;pointer-events:all%7D%7D@keyframes%20slide-out-left%7B0%25%7Btransform:translateX(0%25);opacity:1;pointer-events:all%7D100%25%7Btransform:translateX(-100%25);opacity:0;pointer-events:none%7D%7D@keyframes%20slide-in-right%7B0%25%7Btransform:translateX(100%25);opacity:0;pointer-events:none%7D100%25%7Btransform:translateX(0%25);opacity:1;pointer-events:all%7D%7D@keyframes%20slide-out-right%7B0%25%7Btransform:translateX(0%25);opacity:1;pointer-events:all%7D100%25%7Btransform:translateX(100%25);opacity:0;pointer-events:none%7D%7D%22);%20%09%7D%20%20%09//%20(40:0)%20%3CButton%20on:click=%7BopenGroup%7D%3E%20%09function%20create_default_slot_1$6(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(/*name*/%20ctx%5B0%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*name*/%201)%20set_data(t,%20/*name*/%20ctx%5B0%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(45:4)%20%3CButton%20on:click=%7BcloseGroup%7D%3E%20%09function%20create_default_slot$l(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Close%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$z(ctx)%20%7B%20%09%09let%20button0;%20%09%09let%20t0;%20%09%09let%20div;%20%09%09let%20button1;%20%09%09let%20t1;%20%09%09let%20current;%20%20%09%09button0%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_1$6%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button0.$on(%22click%22,%20/*openGroup*/%20ctx%5B2%5D);%20%20%09%09button1%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$l%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button1.$on(%22click%22,%20/*closeGroup*/%20ctx%5B3%5D);%20%09%09const%20default_slot_template%20=%20/*%23slots*/%20ctx%5B4%5D.default;%20%09%09const%20default_slot%20=%20create_slot(default_slot_template,%20ctx,%20/*$$scope*/%20ctx%5B6%5D,%20null);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(button0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09create_component(button1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09if%20(default_slot)%20default_slot.c();%20%09%09%09%09attr(div,%20%22class%22,%20%22groupContent%20svelte-151a7uw%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(button0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09mount_component(button1,%20div,%20null);%20%09%09%09%09append(div,%20t1);%20%20%09%09%09%09if%20(default_slot)%20%7B%20%09%09%09%09%09default_slot.m(div,%20null);%20%09%09%09%09%7D%20%20%09%09%09%09/*div_binding*/%20ctx%5B5%5D(div);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20button0_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20name*/%2065)%20%7B%20%09%09%09%09%09button0_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button0.$set(button0_changes);%20%09%09%09%09const%20button1_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%2064)%20%7B%20%09%09%09%09%09button1_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button1.$set(button1_changes);%20%20%09%09%09%09if%20(default_slot)%20%7B%20%09%09%09%09%09if%20(default_slot.p%20&&%20(!current%20%7C%7C%20dirty%20&%20/*$$scope*/%2064))%20%7B%20%09%09%09%09%09%09update_slot_base(%20%09%09%09%09%09%09%09default_slot,%20%09%09%09%09%09%09%09default_slot_template,%20%09%09%09%09%09%09%09ctx,%20%09%09%09%09%09%09%09/*$$scope*/%20ctx%5B6%5D,%20%09%09%09%09%09%09%09!current%20%09%09%09%09%09%09%09?%20get_all_dirty_from_scope(/*$$scope*/%20ctx%5B6%5D)%20%09%09%09%09%09%09%09:%20get_slot_changes(default_slot_template,%20/*$$scope*/%20ctx%5B6%5D,%20dirty,%20null),%20%09%09%09%09%09%09%09null%20%09%09%09%09%09%09);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button0.$$.fragment,%20local);%20%09%09%09%09transition_in(button1.$$.fragment,%20local);%20%09%09%09%09transition_in(default_slot,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button0.$$.fragment,%20local);%20%09%09%09%09transition_out(button1.$$.fragment,%20local);%20%09%09%09%09transition_out(default_slot,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(div);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(button0,%20detaching);%20%09%09%09%09destroy_component(button1);%20%09%09%09%09if%20(default_slot)%20default_slot.d(detaching);%20%09%09%09%09/*div_binding*/%20ctx%5B5%5D(null);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20slide(el,%20direction,%20side)%20%7B%20%09%09el.style.animation%20=%20%60slide-$%7Bdirection%7D-$%7Bside%7D%200.2s%20ease-in-out%20forwards%60;%20%20%09%09if%20(direction%20==%20'out')%20%7B%20%09%09%09el.classList.remove('open');%20%20%09%09%09setTimeout(%20%09%09%09%09()%20=%3E%20%7B%20%09%09%09%09%09el.style.display%20=%20'none';%20%09%09%09%09%7D,%20%09%09%09%09200%20%09%09%09);%20%09%09%7D%20else%20%7B%20%09%09%09el.style.display%20=%20'flex';%20%09%09%09el.classList.add('open');%20%09%09%7D%20%09%7D%20%20%09function%20instance$s($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20$$slots:%20slots%20=%20%7B%7D,%20$$scope%20%7D%20=%20$$props;%20%09%09let%20%7B%20name%20%7D%20=%20$$props;%20%09%09let%20groupEl;%20%09%09let%20lastGroupEl;%20%09%09let%20parentMenu;%20%20%09%09function%20openGroup()%20%7B%20%09%09%09//%20find%20the%20previously%20opened%20group%20%09%09%09lastGroupEl%20=%20parentMenu.querySelector('.groupContent.open');%20%20%09%09%09//%20slide%20it%20out%20to%20the%20left%20%09%09%09if%20(lastGroupEl)%20slide(lastGroupEl,%20'out',%20'left');%20%20%09%09%09slide(groupEl,%20'in',%20'right');%20%09%09%7D%20%20%09%09function%20closeGroup()%20%7B%20%09%09%09slide(groupEl,%20'out',%20'right');%20%09%09%09if%20(lastGroupEl)%20slide(lastGroupEl,%20'in',%20'left');%20%09%09%7D%20%20%09%09onMount(()%20=%3E%20%7B%20%09%09%09parentMenu%20=%20findMatchingParent(groupEl,%20'.menu%20.children');%20%09%09%09parentMenu.appendChild(groupEl);%20%09%09%7D);%20%20%09%09function%20div_binding($$value)%20%7B%20%09%09%09binding_callbacks%5B$$value%20?%20'unshift'%20:%20'push'%5D(()%20=%3E%20%7B%20%09%09%09%09groupEl%20=%20$$value;%20%09%09%09%09$$invalidate(1,%20groupEl);%20%09%09%09%7D);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('name'%20in%20$$props)%20$$invalidate(0,%20name%20=%20$$props.name);%20%09%09%09if%20('$$scope'%20in%20$$props)%20$$invalidate(6,%20$$scope%20=%20$$props.$$scope);%20%09%09%7D;%20%20%09%09return%20%5Bname,%20groupEl,%20openGroup,%20closeGroup,%20slots,%20div_binding,%20$$scope%5D;%20%09%7D%20%20%09class%20Group%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$s,%20create_fragment$z,%20safe_not_equal,%20%7B%20name:%200%20%7D,%20add_css$b);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Chud%5Ccomponents%5CColorPicker.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$a(target)%20%7B%20%09%09append_styles(target,%20%22svelte-qar3ci%22,%20%22.colorPicker.svelte-qar3ci%7Bwidth:100%25;display:flex;flex-direction:column;align-items:center%7D.inputs.svelte-qar3ci%7Bdisplay:flex;align-items:center;justify-content:space-around;width:100%25;max-width:100%25%7D.opacityBlock.svelte-qar3ci%7Bdisplay:flex;flex-direction:column;align-items:center%7D.alphaInput.svelte-qar3ci%7Bflex-shrink:1;min-width:0;width:100%25%7D.colorInput.svelte-qar3ci%7Bflex-shrink:0%7D.preview.svelte-qar3ci%7Bwidth:50px;height:50px;border-radius:10px;flex-shrink:0;border:2px%20solid%20black%7D%22);%20%09%7D%20%20%09//%20(36:8)%20%7B%23if%20allowOpacity%7D%20%09function%20create_if_block$7(ctx)%20%7B%20%09%09let%20div1;%20%09%09let%20div0;%20%09%09let%20t1;%20%09%09let%20input;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09div0.textContent%20=%20%22Opacity%22;%20%09%09%09%09t1%20=%20space();%20%09%09%09%09input%20=%20element(%22input%22);%20%09%09%09%09attr(input,%20%22type%22,%20%22range%22);%20%09%09%09%09attr(input,%20%22min%22,%20/*minOpactiy*/%20ctx%5B2%5D);%20%09%09%09%09attr(input,%20%22max%22,%20%221%22);%20%09%09%09%09attr(input,%20%22step%22,%20%220.01%22);%20%09%09%09%09attr(input,%20%22class%22,%20%22alphaInput%20svelte-qar3ci%22);%20%09%09%09%09attr(div1,%20%22class%22,%20%22opacityBlock%20svelte-qar3ci%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div1,%20anchor);%20%09%09%09%09append(div1,%20div0);%20%09%09%09%09append(div1,%20t1);%20%09%09%09%09append(div1,%20input);%20%09%09%09%09set_input_value(input,%20/*alphaVal*/%20ctx%5B4%5D);%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(input,%20%22change%22,%20/*input_change_input_handler*/%20ctx%5B11%5D),%20%09%09%09%09%09%09listen(input,%20%22input%22,%20/*input_change_input_handler*/%20ctx%5B11%5D),%20%09%09%09%09%09%09listen(input,%20%22input%22,%20/*onChange*/%20ctx%5B6%5D),%20%09%09%09%09%09%09listen(input,%20%22mousedown%22,%20stop_propagation(/*mousedown_handler*/%20ctx%5B10%5D))%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*minOpactiy*/%204)%20%7B%20%09%09%09%09%09attr(input,%20%22min%22,%20/*minOpactiy*/%20ctx%5B2%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*alphaVal*/%2016)%20%7B%20%09%09%09%09%09set_input_value(input,%20/*alphaVal*/%20ctx%5B4%5D);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div1);%20%09%09%09%09%7D%20%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$y(ctx)%20%7B%20%09%09let%20div3;%20%09%09let%20div0;%20%09%09let%20t0;%20%09%09let%20t1;%20%09%09let%20div2;%20%09%09let%20t2;%20%09%09let%20input;%20%09%09let%20t3;%20%09%09let%20div1;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%09%09let%20if_block%20=%20/*allowOpacity*/%20ctx%5B1%5D%20&&%20create_if_block$7(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div3%20=%20element(%22div%22);%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09t0%20=%20text(/*text*/%20ctx%5B0%5D);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09div2%20=%20element(%22div%22);%20%09%09%09%09if%20(if_block)%20if_block.c();%20%09%09%09%09t2%20=%20space();%20%09%09%09%09input%20=%20element(%22input%22);%20%09%09%09%09t3%20=%20space();%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09attr(input,%20%22type%22,%20%22color%22);%20%09%09%09%09attr(input,%20%22class%22,%20%22colorInput%20svelte-qar3ci%22);%20%09%09%09%09attr(div1,%20%22class%22,%20%22preview%20svelte-qar3ci%22);%20%09%09%09%09set_style(div1,%20%22background-color%22,%20/*displayColor*/%20ctx%5B5%5D);%20%09%09%09%09attr(div2,%20%22class%22,%20%22inputs%20svelte-qar3ci%22);%20%09%09%09%09attr(div3,%20%22class%22,%20%22colorPicker%20svelte-qar3ci%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div3,%20anchor);%20%09%09%09%09append(div3,%20div0);%20%09%09%09%09append(div0,%20t0);%20%09%09%09%09append(div3,%20t1);%20%09%09%09%09append(div3,%20div2);%20%09%09%09%09if%20(if_block)%20if_block.m(div2,%20null);%20%09%09%09%09append(div2,%20t2);%20%09%09%09%09append(div2,%20input);%20%09%09%09%09set_input_value(input,%20/*colorVal*/%20ctx%5B3%5D);%20%09%09%09%09append(div2,%20t3);%20%09%09%09%09append(div2,%20div1);%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(input,%20%22input%22,%20/*input_input_handler*/%20ctx%5B12%5D),%20%09%09%09%09%09%09listen(input,%20%22input%22,%20/*onChange*/%20ctx%5B6%5D),%20%09%09%09%09%09%09listen(input,%20%22mousedown%22,%20stop_propagation(/*mousedown_handler_1*/%20ctx%5B9%5D))%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*text*/%201)%20set_data(t0,%20/*text*/%20ctx%5B0%5D);%20%20%09%09%09%09if%20(/*allowOpacity*/%20ctx%5B1%5D)%20%7B%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block%20=%20create_if_block$7(ctx);%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09if_block.m(div2,%20t2);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block)%20%7B%20%09%09%09%09%09if_block.d(1);%20%09%09%09%09%09if_block%20=%20null;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*colorVal*/%208)%20%7B%20%09%09%09%09%09set_input_value(input,%20/*colorVal*/%20ctx%5B3%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*displayColor*/%2032)%20%7B%20%09%09%09%09%09set_style(div1,%20%22background-color%22,%20/*displayColor*/%20ctx%5B5%5D);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i:%20noop,%20%09%09%09o:%20noop,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div3);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(if_block)%20if_block.d();%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$r($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20text%20%7D%20=%20$$props;%20%09%09let%20%7B%20color%20=%20undefined%20%7D%20=%20$$props;%20%09%09let%20%7B%20bindValue%20=%20undefined%20%7D%20=%20$$props;%20%09%09let%20%7B%20allowOpacity%20=%20true%20%7D%20=%20$$props;%20%09%09let%20%7B%20minOpactiy%20=%200%20%7D%20=%20$$props;%20%09%09let%20useColor%20=%20color%20??%20getCssVar(bindValue)%20??%20'rgba(255,%20255,%20255,%201)';%20%09%09let%20channels%20=%20parseRGBA(useColor);%20%09%09let%20colorVal%20=%20rgbToHex(channels.r,%20channels.g,%20channels.b);%20%09%09let%20alphaVal%20=%20channels.a;%20%09%09let%20displayColor%20=%20useColor;%20%20%09%09function%20setVar(color)%20%7B%20%09%09%09setCssVar(bindValue,%20color);%20%09%09%7D%20%20%09%09const%20setVarDebounce%20=%20debounce$1(setVar,%20100);%20%20%09%09function%20onChange()%20%7B%20%09%09%09let%20hexChannels%20=%20parseHex(colorVal);%20%09%09%09let%20newColor%20=%20%60rgba($%7BhexChannels.r%7D,%20$%7BhexChannels.g%7D,%20$%7BhexChannels.b%7D,%20$%7BalphaVal%7D)%60;%20%20%09%09%09if%20(bindValue)%20%7B%20%09%09%09%09setVarDebounce(newColor);%20%09%09%09%09document.documentElement.style.setProperty(%60--$%7BbindValue%7D%60,%20newColor);%20%09%09%09%7D%20%20%09%09%09$$invalidate(5,%20displayColor%20=%20newColor);%20%09%09%09if%20(color)%20$$invalidate(7,%20color%20=%20newColor);%20%09%09%7D%20%20%09%09function%20mousedown_handler_1(event)%20%7B%20%09%09%09bubble.call(this,%20$$self,%20event);%20%09%09%7D%20%20%09%09function%20mousedown_handler(event)%20%7B%20%09%09%09bubble.call(this,%20$$self,%20event);%20%09%09%7D%20%20%09%09function%20input_change_input_handler()%20%7B%20%09%09%09alphaVal%20=%20to_number(this.value);%20%09%09%09$$invalidate(4,%20alphaVal);%20%09%09%7D%20%20%09%09function%20input_input_handler()%20%7B%20%09%09%09colorVal%20=%20this.value;%20%09%09%09$$invalidate(3,%20colorVal);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('text'%20in%20$$props)%20$$invalidate(0,%20text%20=%20$$props.text);%20%09%09%09if%20('color'%20in%20$$props)%20$$invalidate(7,%20color%20=%20$$props.color);%20%09%09%09if%20('bindValue'%20in%20$$props)%20$$invalidate(8,%20bindValue%20=%20$$props.bindValue);%20%09%09%09if%20('allowOpacity'%20in%20$$props)%20$$invalidate(1,%20allowOpacity%20=%20$$props.allowOpacity);%20%09%09%09if%20('minOpactiy'%20in%20$$props)%20$$invalidate(2,%20minOpactiy%20=%20$$props.minOpactiy);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09text,%20%09%09%09allowOpacity,%20%09%09%09minOpactiy,%20%09%09%09colorVal,%20%09%09%09alphaVal,%20%09%09%09displayColor,%20%09%09%09onChange,%20%09%09%09color,%20%09%09%09bindValue,%20%09%09%09mousedown_handler_1,%20%09%09%09mousedown_handler,%20%09%09%09input_change_input_handler,%20%09%09%09input_input_handler%20%09%09%5D;%20%09%7D%20%20%09class%20ColorPicker%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%20%09%09%09init(%20%09%09%09%09this,%20%09%09%09%09options,%20%09%09%09%09instance$r,%20%09%09%09%09create_fragment$y,%20%09%09%09%09safe_not_equal,%20%09%09%09%09%7B%20%09%09%09%09%09text:%200,%20%09%09%09%09%09color:%207,%20%09%09%09%09%09bindValue:%208,%20%09%09%09%09%09allowOpacity:%201,%20%09%09%09%09%09minOpactiy:%202%20%09%09%09%09%7D,%20%09%09%09%09add_css$a%20%09%09%09);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Chud%5CResetStyles.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$k(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Reset%20All%20Styles%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$x(ctx)%20%7B%20%09%09let%20button;%20%09%09let%20current;%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$k%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20/*resetStyles*/%20ctx%5B0%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%202)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$q($$self)%20%7B%20%09%09function%20resetStyles()%20%7B%20%09%09%09let%20res%20=%20confirm(%22Are%20you%20sure%20you%20want%20to%20reset%20all%20styles?%22);%20%09%09%09if%20(!res)%20return;%20%20%09%09%09for%20(let%20key%20in%20defaultCss)%20%7B%20%09%09%09%09document.documentElement.style.setProperty(%60--$%7Bkey%7D%60,%20defaultCss%5Bkey%5D);%20%09%09%09%7D%20%20%09%09%09setCssVars(defaultCss);%20%09%09%7D%20%20%09%09return%20%5BresetStyles%5D;%20%09%7D%20%20%09class%20ResetStyles%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$q,%20create_fragment$x,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Chud%5Ccomponents%5CToggleButton.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_else_block$2(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(/*offText*/%20ctx%5B2%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*offText*/%204)%20set_data(t,%20/*offText*/%20ctx%5B2%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(17:4)%20%7B%23if%20enabled%7D%20%09function%20create_if_block$6(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(/*onText*/%20ctx%5B1%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*onText*/%202)%20set_data(t,%20/*onText*/%20ctx%5B1%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(16:0)%20%3CButton%20on:click=%7BonClick%7D%20%7Bdisabled%7D%20%7BdisabledMsg%7D%20%7BhotkeyId%7D%3E%20%09function%20create_default_slot$j(ctx)%20%7B%20%09%09let%20if_block_anchor;%20%20%09%09function%20select_block_type(ctx,%20dirty)%20%7B%20%09%09%09if%20(/*enabled*/%20ctx%5B0%5D)%20return%20create_if_block$6;%20%09%09%09return%20create_else_block$2;%20%09%09%7D%20%20%09%09let%20current_block_type%20=%20select_block_type(ctx);%20%09%09let%20if_block%20=%20current_block_type(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09if_block.c();%20%09%09%09%09if_block_anchor%20=%20empty();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09if_block.m(target,%20anchor);%20%09%09%09%09insert(target,%20if_block_anchor,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(current_block_type%20===%20(current_block_type%20=%20select_block_type(ctx))%20&&%20if_block)%20%7B%20%09%09%09%09%09if_block.p(ctx,%20dirty);%20%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09if_block.d(1);%20%09%09%09%09%09if_block%20=%20current_block_type(ctx);%20%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09if_block.m(if_block_anchor.parentNode,%20if_block_anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(if_block_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09if_block.d(detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$w(ctx)%20%7B%20%09%09let%20button;%20%09%09let%20current;%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09disabled:%20/*disabled*/%20ctx%5B3%5D,%20%09%09%09%09%09disabledMsg:%20/*disabledMsg*/%20ctx%5B4%5D,%20%09%09%09%09%09hotkeyId:%20/*hotkeyId*/%20ctx%5B5%5D,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$j%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20/*onClick*/%20ctx%5B6%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*disabled*/%208)%20button_changes.disabled%20=%20/*disabled*/%20ctx%5B3%5D;%20%09%09%09%09if%20(dirty%20&%20/*disabledMsg*/%2016)%20button_changes.disabledMsg%20=%20/*disabledMsg*/%20ctx%5B4%5D;%20%09%09%09%09if%20(dirty%20&%20/*hotkeyId*/%2032)%20button_changes.hotkeyId%20=%20/*hotkeyId*/%20ctx%5B5%5D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20onText,%20enabled,%20offText*/%20263)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$p($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20onText%20%7D%20=%20$$props;%20%09%09let%20%7B%20offText%20%7D%20=%20$$props;%20%09%09let%20%7B%20enabled%20=%20false%20%7D%20=%20$$props;%20%09%09let%20%7B%20disabled%20=%20null%20%7D%20=%20$$props;%20%09%09let%20%7B%20disabledMsg%20=%20undefined%20%7D%20=%20$$props;%20%09%09let%20%7B%20hotkeyId%20=%20undefined%20%7D%20=%20$$props;%20%09%09let%20dispatch%20=%20createEventDispatcher();%20%20%09%09function%20onClick()%20%7B%20%09%09%09$$invalidate(0,%20enabled%20=%20!enabled);%20%09%09%09dispatch(%22click%22,%20enabled);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('onText'%20in%20$$props)%20$$invalidate(1,%20onText%20=%20$$props.onText);%20%09%09%09if%20('offText'%20in%20$$props)%20$$invalidate(2,%20offText%20=%20$$props.offText);%20%09%09%09if%20('enabled'%20in%20$$props)%20$$invalidate(0,%20enabled%20=%20$$props.enabled);%20%09%09%09if%20('disabled'%20in%20$$props)%20$$invalidate(3,%20disabled%20=%20$$props.disabled);%20%09%09%09if%20('disabledMsg'%20in%20$$props)%20$$invalidate(4,%20disabledMsg%20=%20$$props.disabledMsg);%20%09%09%09if%20('hotkeyId'%20in%20$$props)%20$$invalidate(5,%20hotkeyId%20=%20$$props.hotkeyId);%20%09%09%7D;%20%20%09%09return%20%5Benabled,%20onText,%20offText,%20disabled,%20disabledMsg,%20hotkeyId,%20onClick%5D;%20%09%7D%20%20%09class%20ToggleButton%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%20%09%09%09init(this,%20options,%20instance$p,%20create_fragment$w,%20safe_not_equal,%20%7B%20%09%09%09%09onText:%201,%20%09%09%09%09offText:%202,%20%09%09%09%09enabled:%200,%20%09%09%09%09disabled:%203,%20%09%09%09%09disabledMsg:%204,%20%09%09%09%09hotkeyId:%205%20%09%09%09%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5CAutoAnswer.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_fragment$v(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20current;%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09disabled:%20!/*enabled*/%20ctx%5B0%5D,%20%09%09%09%09%09disabledMsg:%20%22Questions%20haven't%20loaded%20yet%22,%20%09%09%09%09%09onText:%20%22Stop%20auto%20answering%22,%20%09%09%09%09%09offText:%20%22Start%20auto%20answering%22,%20%09%09%09%09%09enabled:%20false,%20%09%09%09%09%09hotkeyId:%20%22autoAnswer%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09togglebutton.$on(%22click%22,%20/*toggleAutoAnswer*/%20ctx%5B2%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*enabled*/%201)%20togglebutton_changes.disabled%20=%20!/*enabled*/%20ctx%5B0%5D;%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$o($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20enabled;%20%09%09let%20$playerId;%20%09%09let%20$transportType;%20%09%09component_subscribe($$self,%20playerId,%20$$value%20=%3E%20$$invalidate(10,%20$playerId%20=%20$$value));%20%09%09let%20%7B%20transportType%20%7D%20=%20socketManager;%20%09%09component_subscribe($$self,%20transportType,%20value%20=%3E%20$$invalidate(8,%20$transportType%20=%20value));%20%09%09let%20questions%20=%20%5B%5D;%20%09%09let%20answerDeviceId%20=%20null;%20%09%09let%20currentQuestionId%20=%20null;%20%09%09let%20questionIdList%20=%20%5B%5D;%20%09%09let%20currentQuestionIndex%20=%20-1;%20%20%09%09function%20answerQuestion()%20%7B%20%09%09%09if%20($transportType%20===%20'colyseus')%20%7B%20%09%09%09%09if%20(currentQuestionId%20==%20null)%20return;%20%20%09%09%09%09//%20find%20the%20correct%20question%20%09%09%09%09let%20question%20=%20questions.find(q%20=%3E%20q._id%20==%20currentQuestionId);%20%20%09%09%09%09if%20(!question)%20return;%20%20%09%09%09%09let%20packet%20=%20%7B%20%09%09%09%09%09key:%20'answered',%20%09%09%09%09%09deviceId:%20answerDeviceId,%20%09%09%09%09%09data:%20%7B%7D%20%09%09%09%09%7D;%20%20%09%09%09%09//%20create%20a%20packet%20to%20send%20to%20the%20server%20%09%09%09%09if%20(question.type%20==%20'text')%20%7B%20%09%09%09%09%09packet.data.answer%20=%20question.answers%5B0%5D.text;%20%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09let%20correctAnswerId%20=%20question.answers.find(a%20=%3E%20a.correct)._id;%20%09%09%09%09%09packet.data.answer%20=%20correctAnswerId;%20%09%09%09%09%7D%20%20%09%09%09%09socketManager.sendMessage(%22MESSAGE_FOR_DEVICE%22,%20packet);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09let%20questionId%20=%20questionIdList%5BcurrentQuestionIndex%5D;%20%09%09%09%09let%20question%20=%20questions.find(q%20=%3E%20q._id%20==%20questionId);%20%09%09%09%09if%20(!question)%20return;%20%09%09%09%09let%20answer;%20%20%09%09%09%09if%20(question.type%20==%20'mc')%20%7B%20%09%09%09%09%09answer%20=%20question.answers.find(a%20=%3E%20a.correct)._id;%20%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09answer%20=%20question.answers%5B0%5D.text;%20%09%09%09%09%7D%20%20%09%09%09%09socketManager.sendMessage(%22QUESTION_ANSWERED%22,%20%7B%20answer,%20questionId%20%7D);%20%09%09%09%7D%20%09%09%7D%20%20%09%09let%20answerInterval;%20//%20should%20probably%20be%20a%20number%20but%20I%20don't%20care%20%20%09%09function%20toggleAutoAnswer(event)%20%7B%20%09%09%09if%20(event.detail)%20%7B%20%09%09%09%09answerInterval%20=%20setInterval(answerQuestion,%201000);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09clearInterval(answerInterval);%20%09%09%09%7D%20%09%09%7D%20%20%09%09socketManager.addEventListener(%22deviceChanges%22,%20event%20=%3E%20%7B%20%09%09%09for%20(let%20%7B%20id,%20data%20%7D%20of%20event.detail)%20%7B%20%09%09%09%09for%20(let%20key%20in%20data)%20%7B%20%09%09%09%09%09if%20(key%20==%20%22GLOBAL_questions%22)%20%7B%20%09%09%09%09%09%09$$invalidate(3,%20questions%20=%20JSON.parse(data%5Bkey%5D));%20%09%09%09%09%09%09console.log(%22Got%20questions%22,%20questions);%20%09%09%09%09%09%09$$invalidate(4,%20answerDeviceId%20=%20id);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09if%20(key%20==%20%60PLAYER_$%7B$playerId%7D_currentQuestionId%60)%20%7B%20%09%09%09%09%09%09$$invalidate(5,%20currentQuestionId%20=%20data%5Bkey%5D);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D);%20%20%09%09socketManager.addEventListener(%22blueboatMessage%22,%20event%20=%3E%20%7B%20%09%09%09if%20(event.detail?.key%20!=%20%22STATE_UPDATE%22)%20return;%20%20%09%09%09switch%20(event.detail.data.type)%20%7B%20%09%09%09%09case%20%22GAME_QUESTIONS%22:%20%09%09%09%09%09$$invalidate(3,%20questions%20=%20event.detail.data.value);%20%09%09%09%09%09break;%20%09%09%09%09case%20%22PLAYER_QUESTION_LIST%22:%20%09%09%09%09%09$$invalidate(6,%20questionIdList%20=%20event.detail.data.value.questionList);%20%09%09%09%09%09$$invalidate(7,%20currentQuestionIndex%20=%20event.detail.data.value.questionIndex);%20%09%09%09%09%09break;%20%09%09%09%09case%20%22PLAYER_QUESTION_LIST_INDEX%22:%20%09%09%09%09%09$$invalidate(7,%20currentQuestionIndex%20=%20event.detail.data.value);%20%09%09%09%09%09break;%20%09%09%09%7D%20%09%09%7D);%20%20%09%09$$self.$$.update%20=%20()%20=%3E%20%7B%20%09%09%09if%20($$self.$$.dirty%20&%20/*$transportType,%20questions,%20currentQuestionId,%20answerDeviceId,%20questionIdList,%20currentQuestionIndex*/%20504)%20%7B%20%09%09%09%09$$invalidate(0,%20enabled%20=%20$transportType%20==%20%22colyseus%22%20%09%09%09%09?%20questions.length%20%3E%200%20&&%20currentQuestionId%20!=%20null%20&&%20answerDeviceId%20!=%20null%20%09%09%09%09:%20questionIdList.length%20%3E%200%20&&%20questions.length%20%3E%200%20&&%20currentQuestionIndex%20!=%20-1);%20%09%09%09%7D%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09enabled,%20%09%09%09transportType,%20%09%09%09toggleAutoAnswer,%20%09%09%09questions,%20%09%09%09answerDeviceId,%20%09%09%09currentQuestionId,%20%09%09%09questionIdList,%20%09%09%09currentQuestionIndex,%20%09%09%09$transportType%20%09%09%5D;%20%09%7D%20%20%09class%20AutoAnswer%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$o,%20create_fragment$v,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5C2d%5CInstantUse.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_fragment$u(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20updating_enabled;%20%09%09let%20current;%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09/*togglebutton_enabled_binding*/%20ctx%5B1%5D(value);%20%09%09%7D%20%20%09%09let%20togglebutton_props%20=%20%7B%20%09%09%09onText:%20%22Stop%20instant%20use%22,%20%09%09%09offText:%20%22Enable%20instant%20use%22,%20%09%09%09hotkeyId:%20%22instantUse%22%20%09%09%7D;%20%20%09%09if%20(/*enabled*/%20ctx%5B0%5D%20!==%20void%200)%20%7B%20%09%09%09togglebutton_props.enabled%20=%20/*enabled*/%20ctx%5B0%5D;%20%09%09%7D%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20props:%20togglebutton_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(togglebutton,%20'enabled',%20togglebutton_enabled_binding));%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_enabled%20&&%20dirty%20&%20/*enabled*/%201)%20%7B%20%09%09%09%09%09updating_enabled%20=%20true;%20%09%09%09%09%09togglebutton_changes.enabled%20=%20/*enabled*/%20ctx%5B0%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_enabled%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$n($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20enabled%20=%20true;%20%09%09keybindManager.addKeybind(new%20Set(%5B%22enter%22%5D),%20useNearest);%20%20%09%09function%20useNearest()%20%7B%20%09%09%09if%20(!enabled)%20return;%20%09%09%09let%20win%20=%20getUnsafeWindow();%20%09%09%09let%20devices%20=%20win?.stores?.phaser?.scene?.worldManager?.devices?.devicesInView;%20%09%09%09let%20body%20=%20win?.stores?.phaser?.mainCharacter?.body;%20%09%09%09if%20(!devices%20%7C%7C%20!body)%20return;%20%09%09%09let%20closest%20=%20null;%20%09%09%09let%20closestDistance%20=%20Infinity;%20%20%09%09%09//%20Find%20the%20closest%20device%20with%20interactive%20zones%20%09%09%09for%20(let%20device%20of%20devices)%20%7B%20%09%09%09%09if%20(device.interactiveZones.zones.length%20==%200)%20continue;%20%09%09%09%09let%20distance%20=%20Math.sqrt(Math.pow(device.x%20-%20body.x,%202)%20+%20Math.pow(device.y%20-%20body.y,%202));%20%20%09%09%09%09if%20(distance%20%3C%20closestDistance)%20%7B%20%09%09%09%09%09closest%20=%20device;%20%09%09%09%09%09closestDistance%20=%20distance;%20%09%09%09%09%7D%20%09%09%09%7D%20%20%09%09%09if%20(!closest)%20return;%20%09%09%09closest?.interactiveZones?.onInteraction?.();%20%09%09%7D%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09enabled%20=%20value;%20%09%09%09$$invalidate(0,%20enabled);%20%09%09%7D%20%20%09%09return%20%5Benabled,%20togglebutton_enabled_binding%5D;%20%09%7D%20%20%09class%20InstantUse%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$n,%20create_fragment$u,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09const%20knownSkins%20=%20%5B%22dayOne%22,%20%22echoAgent%22,%20%22stripeDoubleGreen%22,%20%22mustache%22,%20%22vortexAgent%22,%20%22grayGradient%22,%20%22redNinja%22,%20%22sprinklesRed%22,%20%22redDeliciousApple%22,%20%22sunny%22,%20%22fadedBlueGradient%22,%20%22glassHalfFull%22,%20%22whiteAndBlueVerticalStripes%22,%20%22polkaDotBlueAndYellow%22,%20%22pinkPaste%22,%20%22volcanoCracks%22,%20%22mustachePink%22,%20%22mountainAndSun%22,%20%22camoTan%22,%20%22redDinoCostume%22,%20%22stripeDoubleRed%22,%20%22coolRedBlueGradient%22,%20%22pencilPack%22,%20%22glyphsYellowBrown%22,%20%22camoBlue%22,%20%22purplePaste%22,%20%22galaxy%22,%20%22luchador%22,%20%22fox%22,%20%22pumpkin%22,%20%22rockyWest%22,%20%22mummy%22,%20%22ghostCostume%22,%20%22fifthBirthday%22,%20%22corn%22,%20%22feast%22,%20%22pumpkinPie%22,%20%22frostBuddy%22,%20%22polkaDotWhiteAndRed%22,%20%22festiveOnesieBlue%22,%20%22festiveOnesieRed%22,%20%22festiveOnesieGreen%22,%20%22festiveOnesieTan%22,%20%22gift%22,%20%22hotChocolate%22,%20%22snowman%22,%20%22snowglobe%22,%20%22mustacheSanta%22,%20%22firework%22,%20%22polkaDotFestiveReverse%22,%20%22polkaDotFestive%22,%20%22puzzleYellowPurple%22,%20%22puzzleGreenBlue%22,%20%22puzzleOrangeBlue%22,%20%22puzzleGrayWhite%22,%20%22puzzleRedGreen%22,%20%22roses%22,%20%22heart%22,%20%22hamster%22,%20%22leprechaun%22,%20%22cellGold%22,%20%22pirate%22,%20%22constellationPurpleYellow%22,%20%22constellationBlackGreen%22,%20%22constellationBlackWhite%22,%20%22constellationPinkGreen%22,%20%22constellationYellowPink%22,%20%22detective%22,%20%22sketch%22,%20%22astroHelmet%22,%20%22mustacheBrown%22,%20%22yinYang%22,%20%22fisher%22,%20%22coffee%22,%20%22partyPineapple%22,%20%22construction%22,%20%22graduate%22,%20%22graduateBlue%22,%20%22stripeDoublePurple%22,%20%22bananaSplit%22,%20%22rainbowWave%22,%20%22rockstar%22,%20%22mountain%22,%20%22tent%22,%20%22goat%22,%20%22daisy%22,%20%22climber%22,%20%22cookie%22,%20%22zebra%22,%20%22diamondRainbow%22,%20%22circuitGreen%22,%20%22circuitBlue%22,%20%22circuitGray%22,%20%22clock%22,%20%22squiggles%22,%20%22autumnTree%22,%20%22crashTestDummy%22,%20%22stripeDoubleYellow%22,%20%22witch%22,%20%22skeleton%22,%20%22spiderWeb%22,%20%22trickTreat%22,%20%22calacaOne%22,%20%22turkey%22,%20%22farmer%22,%20%22knight%22,%20%22yellowCracksPurple%22,%20%22arcticFox%22,%20%22whistle%22,%20%22penguinBlue%22,%20%22goldenHotChocolate%22,%20%22blastball%22,%20%22blastballGimchester%22,%20%22blastballKitcelona%22,%20%22pufferJacket%22,%20%22christmasTree%22,%20%22rudolph%22,%20%22snowball%22,%20%22santaClaus%22,%20%22causticWaterBlue%22,%20%22causticWaterRed%22,%20%22causticWaterGreen%22,%20%22causticWaterCaribe%22,%20%22causticWaterOcean%22,%20%22causticWaterPurple%22,%20%22taco%22,%20%22gimKing%22,%20%22sketchBlue%22,%20%22clown%22,%20%22camoGreen%22,%20%22cellBlue%22,%20%22burger%22,%20%22sprinklesChocolate%22,%20%22glyphsOrangeBlue%22,%20%22frozenMummy%22,%20%22evilPlantGreen%22,%20%22evilPlantPink%22,%20%22gamerGreen%22,%20%22gamerPink%22,%20%22gamerPurple%22,%20%22gamerYellow%22,%20%22sentryRobot%22,%20%228bit%22,%20%22redDino%22,%20%22calacaTwo%22,%20%22calacaThree%22,%20%22yarn%22,%20%22racoon%22,%20%22pilot%22,%20%22shark%22,%20%22redPanda%22,%20%22marshmallow%22,%20%22discoBall%22,%20%22incognito%22,%20%22dragon%22,%20%22golden%22,%20%22valenTime%22,%20%22referee%22,%20%22pilot%22,%20%22sprinklesChocolate%22,%20%22miningCart%22,%20%22rainCloud%22,%20%22watermelon%22,%20%22terrainBlock%22,%20%22floatingTube%22,%20%22miner%22,%20%22sproutingFlower%22,%20%22luckyClover%22,%20%22shark%22,%20%22axolotlPink%22,%20%22axolotlBlue%22,%20%22axolotlYellow%22,%20%22astroCaptain%22,%20%22tuxedo%22,%20%22blacksmith%22%5D;%20%09const%20knownTrails%20=%20%5B%22origin_token%22,%20%22fire_notes%22,%20%22banana_peel%22,%20%22rainbow_dots%22,%20%22dust_particles%22,%20%22bubble%22,%20%22flowers%22,%20%22metal_spring%22,%20%22candy%22,%20%22day_of_the_dead%22,%20%22autumn_leaves%22,%20%22corn%22,%20%22hearts%22,%20%22stars%22,%20%22yin_yang%22,%20%22puzzle_pieces%22,%20%22taco%22,%20%22blastball_phrases%22,%20%22penguin_footprints%22,%20%22blastball%22,%20%22cupid_arrow%22,%20%22birds%22,%20%22mining_terrains%22,%20%22beachball%22,%20%22clovers%22,%20%22easter_eggs%22%5D;%20%20%09/*%20src%5Chud%5Ccomponents%5CInputWithSelect.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$9(target)%20%7B%20%09%09append_styles(target,%20%22svelte-bgasye%22,%20%22.container.svelte-bgasye%7Bdisplay:flex;padding:5px%2010px;width:100%25;justify-items:center;align-self:center%7Dinput.svelte-bgasye%7Bflex-grow:1;color:black%7Dselect.svelte-bgasye%7Bwidth:20px;color:black%7D%22);%20%09%7D%20%20%09function%20get_each_context$4(ctx,%20list,%20i)%20%7B%20%09%09const%20child_ctx%20=%20ctx.slice();%20%09%09child_ctx%5B4%5D%20=%20list%5Bi%5D;%20%09%09return%20child_ctx;%20%09%7D%20%20%09//%20(11:8)%20%7B%23each%20selectOptions%20as%20option%7D%20%09function%20create_each_block$4(ctx)%20%7B%20%09%09let%20option_1;%20%09%09let%20t_value%20=%20/*option*/%20ctx%5B4%5D%20+%20%22%22;%20%09%09let%20t;%20%09%09let%20option_1_value_value;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09option_1%20=%20element(%22option%22);%20%09%09%09%09t%20=%20text(t_value);%20%09%09%09%09option_1.__value%20=%20option_1_value_value%20=%20/*option*/%20ctx%5B4%5D;%20%09%09%09%09set_input_value(option_1,%20option_1.__value);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20option_1,%20anchor);%20%09%09%09%09append(option_1,%20t);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*selectOptions*/%202%20&&%20t_value%20!==%20(t_value%20=%20/*option*/%20ctx%5B4%5D%20+%20%22%22))%20set_data(t,%20t_value);%20%20%09%09%09%09if%20(dirty%20&%20/*selectOptions*/%202%20&&%20option_1_value_value%20!==%20(option_1_value_value%20=%20/*option*/%20ctx%5B4%5D))%20%7B%20%09%09%09%09%09option_1.__value%20=%20option_1_value_value;%20%09%09%09%09%09set_input_value(option_1,%20option_1.__value);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(option_1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$t(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20input;%20%09%09let%20t;%20%09%09let%20select;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%09%09let%20each_value%20=%20ensure_array_like(/*selectOptions*/%20ctx%5B1%5D);%20%09%09let%20each_blocks%20=%20%5B%5D;%20%20%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20create_each_block$4(get_each_context$4(ctx,%20each_value,%20i));%20%09%09%7D%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09input%20=%20element(%22input%22);%20%09%09%09%09t%20=%20space();%20%09%09%09%09select%20=%20element(%22select%22);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%7D%20%20%09%09%09%09attr(input,%20%22spellcheck%22,%20%22false%22);%20%09%09%09%09attr(input,%20%22class%22,%20%22svelte-bgasye%22);%20%09%09%09%09attr(select,%20%22class%22,%20%22svelte-bgasye%22);%20%09%09%09%09attr(div,%20%22class%22,%20%22container%20svelte-bgasye%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09append(div,%20input);%20%09%09%09%09set_input_value(input,%20/*value*/%20ctx%5B0%5D);%20%09%09%09%09append(div,%20t);%20%09%09%09%09append(div,%20select);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.m(select,%20null);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(input,%20%22input%22,%20/*input_input_handler*/%20ctx%5B3%5D),%20%09%09%09%09%09%09listen(select,%20%22change%22,%20/*updateValue*/%20ctx%5B2%5D)%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*value*/%201%20&&%20input.value%20!==%20/*value*/%20ctx%5B0%5D)%20%7B%20%09%09%09%09%09set_input_value(input,%20/*value*/%20ctx%5B0%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*selectOptions*/%202)%20%7B%20%09%09%09%09%09each_value%20=%20ensure_array_like(/*selectOptions*/%20ctx%5B1%5D);%20%09%09%09%09%09let%20i;%20%20%09%09%09%09%09for%20(i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09const%20child_ctx%20=%20get_each_context$4(ctx,%20each_value,%20i);%20%20%09%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.p(child_ctx,%20dirty);%20%09%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D%20=%20create_each_block$4(child_ctx);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.m(select,%20null);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%20%09%09%09%09%09for%20(;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.d(1);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09each_blocks.length%20=%20each_value.length;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i:%20noop,%20%09%09%09o:%20noop,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_each(each_blocks,%20detaching);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$m($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20selectOptions%20=%20%5B%5D%20%7D%20=%20$$props;%20%09%09let%20%7B%20value%20=%20%22%22%20%7D%20=%20$$props;%20%20%09%09function%20updateValue(e)%20%7B%20%09%09%09$$invalidate(0,%20value%20=%20e.target.value);%20%09%09%7D%20%20%09%09function%20input_input_handler()%20%7B%20%09%09%09value%20=%20this.value;%20%09%09%09$$invalidate(0,%20value);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('selectOptions'%20in%20$$props)%20$$invalidate(1,%20selectOptions%20=%20$$props.selectOptions);%20%09%09%09if%20('value'%20in%20$$props)%20$$invalidate(0,%20value%20=%20$$props.value);%20%09%09%7D;%20%20%09%09return%20%5Bvalue,%20selectOptions,%20updateValue,%20input_input_handler%5D;%20%09%7D%20%20%09class%20InputWithSelect%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$m,%20create_fragment$t,%20safe_not_equal,%20%7B%20selectOptions:%201,%20value:%200%20%7D,%20add_css$9);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Ccustomization%5CCosmeticPicker.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$8(target)%20%7B%20%09%09append_styles(target,%20%22svelte-1ychv30%22,%20%22.disclaimer.svelte-1ychv30%7Bmargin-left:5px;margin-right:5px;text-align:center%7D.description.svelte-1ychv30%7Bwidth:100%25;text-align:center%7D%22);%20%09%7D%20%20%09//%20(54:4)%20%3CButton%20disabled=%7B!gotSkinId%7D%20disabledMsg=%22Character%20hasn't%20loaded%22%20on:click=%7Bapply%7D%3E%20%09function%20create_default_slot_1$5(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Apply%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(42:0)%20%3CGroup%20name=%22Cosmetic%20Picker%22%3E%20%09function%20create_default_slot$i(ctx)%20%7B%20%09%09let%20div0;%20%09%09let%20t1;%20%09%09let%20div1;%20%09%09let%20t3;%20%09%09let%20inputwithselect0;%20%09%09let%20updating_value;%20%09%09let%20t4;%20%09%09let%20div2;%20%09%09let%20t6;%20%09%09let%20inputwithselect1;%20%09%09let%20updating_value_1;%20%09%09let%20t7;%20%09%09let%20button;%20%09%09let%20current;%20%20%09%09function%20inputwithselect0_value_binding(value)%20%7B%20%09%09%09/*inputwithselect0_value_binding*/%20ctx%5B4%5D(value);%20%09%09%7D%20%20%09%09let%20inputwithselect0_props%20=%20%7B%20selectOptions:%20knownSkins%20%7D;%20%20%09%09if%20(/*skinId*/%20ctx%5B0%5D%20!==%20void%200)%20%7B%20%09%09%09inputwithselect0_props.value%20=%20/*skinId*/%20ctx%5B0%5D;%20%09%09%7D%20%20%09%09inputwithselect0%20=%20new%20InputWithSelect(%7B%20props:%20inputwithselect0_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(inputwithselect0,%20'value',%20inputwithselect0_value_binding));%20%20%09%09function%20inputwithselect1_value_binding(value)%20%7B%20%09%09%09/*inputwithselect1_value_binding*/%20ctx%5B5%5D(value);%20%09%09%7D%20%20%09%09let%20inputwithselect1_props%20=%20%7B%20selectOptions:%20knownTrails%20%7D;%20%20%09%09if%20(/*trailId*/%20ctx%5B1%5D%20!==%20void%200)%20%7B%20%09%09%09inputwithselect1_props.value%20=%20/*trailId*/%20ctx%5B1%5D;%20%09%09%7D%20%20%09%09inputwithselect1%20=%20new%20InputWithSelect(%7B%20props:%20inputwithselect1_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(inputwithselect1,%20'value',%20inputwithselect1_value_binding));%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09disabled:%20!/*gotSkinId*/%20ctx%5B2%5D,%20%09%09%09%09%09disabledMsg:%20%22Character%20hasn't%20loaded%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_1$5%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20/*apply*/%20ctx%5B3%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09div0.textContent%20=%20%22These%20only%20work%20client-side.%20Nobody%20else%20can%20see%20these%20cosmetics.%22;%20%09%09%09%09t1%20=%20space();%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09div1.textContent%20=%20%22Skin%20ID%22;%20%09%09%09%09t3%20=%20space();%20%09%09%09%09create_component(inputwithselect0.$$.fragment);%20%09%09%09%09t4%20=%20space();%20%09%09%09%09div2%20=%20element(%22div%22);%20%09%09%09%09div2.textContent%20=%20%22Trail%20ID%22;%20%09%09%09%09t6%20=%20space();%20%09%09%09%09create_component(inputwithselect1.$$.fragment);%20%09%09%09%09t7%20=%20space();%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%09attr(div0,%20%22class%22,%20%22disclaimer%20svelte-1ychv30%22);%20%09%09%09%09attr(div1,%20%22class%22,%20%22description%20svelte-1ychv30%22);%20%09%09%09%09attr(div2,%20%22class%22,%20%22description%20svelte-1ychv30%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div0,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09insert(target,%20div1,%20anchor);%20%09%09%09%09insert(target,%20t3,%20anchor);%20%09%09%09%09mount_component(inputwithselect0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t4,%20anchor);%20%09%09%09%09insert(target,%20div2,%20anchor);%20%09%09%09%09insert(target,%20t6,%20anchor);%20%09%09%09%09mount_component(inputwithselect1,%20target,%20anchor);%20%09%09%09%09insert(target,%20t7,%20anchor);%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20inputwithselect0_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_value%20&&%20dirty%20&%20/*skinId*/%201)%20%7B%20%09%09%09%09%09updating_value%20=%20true;%20%09%09%09%09%09inputwithselect0_changes.value%20=%20/*skinId*/%20ctx%5B0%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_value%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09inputwithselect0.$set(inputwithselect0_changes);%20%09%09%09%09const%20inputwithselect1_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_value_1%20&&%20dirty%20&%20/*trailId*/%202)%20%7B%20%09%09%09%09%09updating_value_1%20=%20true;%20%09%09%09%09%09inputwithselect1_changes.value%20=%20/*trailId*/%20ctx%5B1%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_value_1%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09inputwithselect1.$set(inputwithselect1_changes);%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*gotSkinId*/%204)%20button_changes.disabled%20=%20!/*gotSkinId*/%20ctx%5B2%5D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%20256)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(inputwithselect0.$$.fragment,%20local);%20%09%09%09%09transition_in(inputwithselect1.$$.fragment,%20local);%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(inputwithselect0.$$.fragment,%20local);%20%09%09%09%09transition_out(inputwithselect1.$$.fragment,%20local);%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(div1);%20%09%09%09%09%09detach(t3);%20%09%09%09%09%09detach(t4);%20%09%09%09%09%09detach(div2);%20%09%09%09%09%09detach(t6);%20%09%09%09%09%09detach(t7);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(inputwithselect0,%20detaching);%20%09%09%09%09destroy_component(inputwithselect1,%20detaching);%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$s(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Cosmetic%20Picker%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$i%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20gotSkinId,%20trailId,%20skinId*/%20263)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$l($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20$playerId;%20%09%09component_subscribe($$self,%20playerId,%20$$value%20=%3E%20$$invalidate(6,%20$playerId%20=%20$$value));%20%09%09let%20skinId%20=%20'';%20%09%09let%20trailId%20=%20'';%20%09%09let%20gotSkinId%20=%20false;%20%20%09%09let%20checkInterval%20=%20setInterval(%20%09%09%09()%20=%3E%20%7B%20%09%09%09%09let%20char%20=%20getUnsafeWindow()?.stores?.phaser?.scene?.characterManager?.characters?.get($playerId);%20%20%09%09%09%09if%20(char)%20%7B%20%09%09%09%09%09$$invalidate(0,%20skinId%20=%20char.skin.skinId);%20%09%09%09%09%09$$invalidate(1,%20trailId%20=%20char.characterTrail.currentAppearanceId);%20%09%09%09%09%09$$invalidate(2,%20gotSkinId%20=%20true);%20%09%09%09%09%09clearInterval(checkInterval);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09500%20%09%09);%20%20%09%09function%20apply()%20%7B%20%09%09%09let%20char%20=%20getUnsafeWindow()?.stores?.phaser?.scene?.characterManager?.characters?.get($playerId);%20%09%09%09if%20(!char)%20return;%20%20%09%09%09if%20(skinId%20!=%20%22%22)%20%7B%20%09%09%09%09let%20setSkinId%20=%20skinId;%20%09%09%09%09if%20(!setSkinId.startsWith('character_'))%20setSkinId%20=%20'character_'%20+%20setSkinId;%20%09%09%09%09char.skin.updateSkin(%7B%20id:%20setSkinId%20%7D);%20%09%09%09%7D%20%20%09%09%09if%20(trailId%20!=%20%22%22)%20%7B%20%09%09%09%09let%20setTrailId%20=%20trailId;%20%09%09%09%09if%20(!setTrailId.startsWith('trail_'))%20setTrailId%20=%20'trail_'%20+%20setTrailId;%20%09%09%09%09char.characterTrail.updateAppearance(setTrailId);%20%09%09%09%7D%20%09%09%7D%20%20%09%09onDestroy(()%20=%3E%20%7B%20%09%09%09clearInterval(checkInterval);%20%09%09%7D);%20%20%09%09function%20inputwithselect0_value_binding(value)%20%7B%20%09%09%09skinId%20=%20value;%20%09%09%09$$invalidate(0,%20skinId);%20%09%09%7D%20%20%09%09function%20inputwithselect1_value_binding(value)%20%7B%20%09%09%09trailId%20=%20value;%20%09%09%09$$invalidate(1,%20trailId);%20%09%09%7D%20%20%09%09return%20%5B%20%09%09%09skinId,%20%09%09%09trailId,%20%09%09%09gotSkinId,%20%09%09%09apply,%20%09%09%09inputwithselect0_value_binding,%20%09%09%09inputwithselect1_value_binding%20%09%09%5D;%20%09%7D%20%20%09class%20CosmeticPicker%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$l,%20create_fragment$s,%20safe_not_equal,%20%7B%7D,%20add_css$8);%20%09%09%7D%20%09%7D%20%20%09const%20defaultThemes%20=%20%5B%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(48,%2063,%20159,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(119,%2019,%2034,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(168,%2092,%2021,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(13,%20107,%2051,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(7,%2098,%20150,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(108,%2047,%200,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(158,%20104,%2042,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(181,%2071,%2048,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(138,%20151,%2072,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(241,%20185,%2048,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(0,%2010,%2018,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(38,%2050,%2056,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(55,%2071,%2079,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(69,%2090,%20100,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(84,%20110,%20122,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(13,%200,%2025,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(34,%200,%2068,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(51,%200,%20102,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(62,%200,%20124,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(79,%2023,%20135,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(0,%200,%2099,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(40,%2053,%20147,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(7,%2098,%20150,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(2,%20119,%20189,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(21,%20101,%20192,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(76,%2061,%2051,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(56,%2086,%2069,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(66,%2092,%2073,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(65,%2086,%2065,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(76,%2099,%2073,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(127,%20116,%20150,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(244,%20111,%2090,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(237,%20113,%2045,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(122,%2089,%20106,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(232,%20171,%2060,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(255,%20191,%20209,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(67,%2067,%2067,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(255,%20166,%20158,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(91,%2091,%2091,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(252,%20246,%20191,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(91,%2091,%2091,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(208,%20244,%20222,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(91,%2091,%2091,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(147,%20225,%20216,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(91,%2091,%2091,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(156,%200,%2034,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(0,%2029,%2059,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(255,%20174,%2082,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(254,%2089,%2099,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(167,%2028,%20148,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20255,%20255,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D,%20%09%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20question:%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(0,%200,%200,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(255,%20205,%2043,%201)%22%20%09%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20palette:%20%5B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(255,%20205,%2043,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(0,%200,%200,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(255,%20199,%2033,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(0,%200,%200,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(255,%20209,%2071,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(0,%200,%200,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7B%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background:%20%22rgba(255,%20205,%2056,%201)%22,%20%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text:%20%22rgba(0,%200,%200,%201)%22%20%09%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%09%20%20%20%20%20%20%20%20%5D%20%09%20%20%20%20%7D%20%09%5D;%20%20%09/*%20node_modules%5Csvelte-material-icons%5CDelete.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_if_block_1$3(ctx)%20%7B%20%09%09let%20desc_1;%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09desc_1%20=%20svg_element(%22desc%22);%20%09%09%09%09t%20=%20text(/*desc*/%20ctx%5B7%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20desc_1,%20anchor);%20%09%09%09%09append(desc_1,%20t);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*desc*/%20128)%20set_data(t,%20/*desc*/%20ctx%5B7%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(desc_1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(16:165)%20%7B%23if%20title%7D%20%09function%20create_if_block$5(ctx)%20%7B%20%09%09let%20title_1;%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09title_1%20=%20svg_element(%22title%22);%20%09%09%09%09t%20=%20text(/*title*/%20ctx%5B6%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20title_1,%20anchor);%20%09%09%09%09append(title_1,%20t);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*title*/%2064)%20set_data(t,%20/*title*/%20ctx%5B6%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(title_1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$r(ctx)%20%7B%20%09%09let%20svg;%20%09%09let%20if_block0_anchor;%20%09%09let%20path;%20%09%09let%20if_block0%20=%20/*desc*/%20ctx%5B7%5D%20&&%20create_if_block_1$3(ctx);%20%09%09let%20if_block1%20=%20/*title*/%20ctx%5B6%5D%20&&%20create_if_block$5(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09svg%20=%20svg_element(%22svg%22);%20%09%09%09%09if%20(if_block0)%20if_block0.c();%20%09%09%09%09if_block0_anchor%20=%20empty();%20%09%09%09%09if%20(if_block1)%20if_block1.c();%20%09%09%09%09path%20=%20svg_element(%22path%22);%20%09%09%09%09attr(path,%20%22d%22,%20%22M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2%200%200,0%208,21H16A2,2%200%200,0%2018,19V7H6V19Z%22);%20%09%09%09%09attr(path,%20%22fill%22,%20/*color*/%20ctx%5B2%5D);%20%09%09%09%09attr(svg,%20%22viewBox%22,%20/*viewBox*/%20ctx%5B3%5D);%20%09%09%09%09attr(svg,%20%22width%22,%20/*width*/%20ctx%5B0%5D);%20%09%09%09%09attr(svg,%20%22height%22,%20/*height*/%20ctx%5B1%5D);%20%09%09%09%09attr(svg,%20%22class%22,%20/*className*/%20ctx%5B8%5D);%20%09%09%09%09attr(svg,%20%22aria-label%22,%20/*ariaLabel*/%20ctx%5B4%5D);%20%09%09%09%09attr(svg,%20%22aria-hidden%22,%20/*ariaHidden*/%20ctx%5B5%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20svg,%20anchor);%20%09%09%09%09if%20(if_block0)%20if_block0.m(svg,%20null);%20%09%09%09%09append(svg,%20if_block0_anchor);%20%09%09%09%09if%20(if_block1)%20if_block1.m(svg,%20null);%20%09%09%09%09append(svg,%20path);%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(/*desc*/%20ctx%5B7%5D)%20%7B%20%09%09%09%09%09if%20(if_block0)%20%7B%20%09%09%09%09%09%09if_block0.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block0%20=%20create_if_block_1$3(ctx);%20%09%09%09%09%09%09if_block0.c();%20%09%09%09%09%09%09if_block0.m(svg,%20if_block0_anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block0)%20%7B%20%09%09%09%09%09if_block0.d(1);%20%09%09%09%09%09if_block0%20=%20null;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(/*title*/%20ctx%5B6%5D)%20%7B%20%09%09%09%09%09if%20(if_block1)%20%7B%20%09%09%09%09%09%09if_block1.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block1%20=%20create_if_block$5(ctx);%20%09%09%09%09%09%09if_block1.c();%20%09%09%09%09%09%09if_block1.m(svg,%20path);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block1)%20%7B%20%09%09%09%09%09if_block1.d(1);%20%09%09%09%09%09if_block1%20=%20null;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*color*/%204)%20%7B%20%09%09%09%09%09attr(path,%20%22fill%22,%20/*color*/%20ctx%5B2%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*viewBox*/%208)%20%7B%20%09%09%09%09%09attr(svg,%20%22viewBox%22,%20/*viewBox*/%20ctx%5B3%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*width*/%201)%20%7B%20%09%09%09%09%09attr(svg,%20%22width%22,%20/*width*/%20ctx%5B0%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*height*/%202)%20%7B%20%09%09%09%09%09attr(svg,%20%22height%22,%20/*height*/%20ctx%5B1%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*className*/%20256)%20%7B%20%09%09%09%09%09attr(svg,%20%22class%22,%20/*className*/%20ctx%5B8%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*ariaLabel*/%2016)%20%7B%20%09%09%09%09%09attr(svg,%20%22aria-label%22,%20/*ariaLabel*/%20ctx%5B4%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*ariaHidden*/%2032)%20%7B%20%09%09%09%09%09attr(svg,%20%22aria-hidden%22,%20/*ariaHidden*/%20ctx%5B5%5D);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i:%20noop,%20%09%09%09o:%20noop,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(svg);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(if_block0)%20if_block0.d();%20%09%09%09%09if%20(if_block1)%20if_block1.d();%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$k($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20size%20=%20%221em%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20width%20=%20size%20%7D%20=%20$$props;%20%09%09let%20%7B%20height%20=%20size%20%7D%20=%20$$props;%20%09%09let%20%7B%20color%20=%20%22currentColor%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20viewBox%20=%20%220%200%2024%2024%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20ariaLabel%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20ariaHidden%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20title%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20desc%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20class:%20className%20=%20void%200%20%7D%20=%20$$props;%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('size'%20in%20$$props)%20$$invalidate(9,%20size%20=%20$$props.size);%20%09%09%09if%20('width'%20in%20$$props)%20$$invalidate(0,%20width%20=%20$$props.width);%20%09%09%09if%20('height'%20in%20$$props)%20$$invalidate(1,%20height%20=%20$$props.height);%20%09%09%09if%20('color'%20in%20$$props)%20$$invalidate(2,%20color%20=%20$$props.color);%20%09%09%09if%20('viewBox'%20in%20$$props)%20$$invalidate(3,%20viewBox%20=%20$$props.viewBox);%20%09%09%09if%20('ariaLabel'%20in%20$$props)%20$$invalidate(4,%20ariaLabel%20=%20$$props.ariaLabel);%20%09%09%09if%20('ariaHidden'%20in%20$$props)%20$$invalidate(5,%20ariaHidden%20=%20$$props.ariaHidden);%20%09%09%09if%20('title'%20in%20$$props)%20$$invalidate(6,%20title%20=%20$$props.title);%20%09%09%09if%20('desc'%20in%20$$props)%20$$invalidate(7,%20desc%20=%20$$props.desc);%20%09%09%09if%20('class'%20in%20$$props)%20$$invalidate(8,%20className%20=%20$$props.class);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09width,%20%09%09%09height,%20%09%09%09color,%20%09%09%09viewBox,%20%09%09%09ariaLabel,%20%09%09%09ariaHidden,%20%09%09%09title,%20%09%09%09desc,%20%09%09%09className,%20%09%09%09size%20%09%09%5D;%20%09%7D%20%20%09class%20Delete%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%20%09%09%09init(this,%20options,%20instance$k,%20create_fragment$r,%20safe_not_equal,%20%7B%20%09%09%09%09size:%209,%20%09%09%09%09width:%200,%20%09%09%09%09height:%201,%20%09%09%09%09color:%202,%20%09%09%09%09viewBox:%203,%20%09%09%09%09ariaLabel:%204,%20%09%09%09%09ariaHidden:%205,%20%09%09%09%09title:%206,%20%09%09%09%09desc:%207,%20%09%09%09%09class:%208%20%09%09%09%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20node_modules%5Csvelte-material-icons%5CPlusCircleOutline.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_if_block_1$2(ctx)%20%7B%20%09%09let%20desc_1;%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09desc_1%20=%20svg_element(%22desc%22);%20%09%09%09%09t%20=%20text(/*desc*/%20ctx%5B7%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20desc_1,%20anchor);%20%09%09%09%09append(desc_1,%20t);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*desc*/%20128)%20set_data(t,%20/*desc*/%20ctx%5B7%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(desc_1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(16:165)%20%7B%23if%20title%7D%20%09function%20create_if_block$4(ctx)%20%7B%20%09%09let%20title_1;%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09title_1%20=%20svg_element(%22title%22);%20%09%09%09%09t%20=%20text(/*title*/%20ctx%5B6%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20title_1,%20anchor);%20%09%09%09%09append(title_1,%20t);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*title*/%2064)%20set_data(t,%20/*title*/%20ctx%5B6%5D);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(title_1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$q(ctx)%20%7B%20%09%09let%20svg;%20%09%09let%20if_block0_anchor;%20%09%09let%20path;%20%09%09let%20if_block0%20=%20/*desc*/%20ctx%5B7%5D%20&&%20create_if_block_1$2(ctx);%20%09%09let%20if_block1%20=%20/*title*/%20ctx%5B6%5D%20&&%20create_if_block$4(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09svg%20=%20svg_element(%22svg%22);%20%09%09%09%09if%20(if_block0)%20if_block0.c();%20%09%09%09%09if_block0_anchor%20=%20empty();%20%09%09%09%09if%20(if_block1)%20if_block1.c();%20%09%09%09%09path%20=%20svg_element(%22path%22);%20%09%09%09%09attr(path,%20%22d%22,%20%22M12,20C7.59,20%204,16.41%204,12C4,7.59%207.59,4%2012,4C16.41,4%2020,7.59%2020,12C20,16.41%2016.41,20%2012,20M12,2A10,10%200%200,0%202,12A10,10%200%200,0%2012,22A10,10%200%200,0%2022,12A10,10%200%200,0%2012,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z%22);%20%09%09%09%09attr(path,%20%22fill%22,%20/*color*/%20ctx%5B2%5D);%20%09%09%09%09attr(svg,%20%22viewBox%22,%20/*viewBox*/%20ctx%5B3%5D);%20%09%09%09%09attr(svg,%20%22width%22,%20/*width*/%20ctx%5B0%5D);%20%09%09%09%09attr(svg,%20%22height%22,%20/*height*/%20ctx%5B1%5D);%20%09%09%09%09attr(svg,%20%22class%22,%20/*className*/%20ctx%5B8%5D);%20%09%09%09%09attr(svg,%20%22aria-label%22,%20/*ariaLabel*/%20ctx%5B4%5D);%20%09%09%09%09attr(svg,%20%22aria-hidden%22,%20/*ariaHidden*/%20ctx%5B5%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20svg,%20anchor);%20%09%09%09%09if%20(if_block0)%20if_block0.m(svg,%20null);%20%09%09%09%09append(svg,%20if_block0_anchor);%20%09%09%09%09if%20(if_block1)%20if_block1.m(svg,%20null);%20%09%09%09%09append(svg,%20path);%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(/*desc*/%20ctx%5B7%5D)%20%7B%20%09%09%09%09%09if%20(if_block0)%20%7B%20%09%09%09%09%09%09if_block0.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block0%20=%20create_if_block_1$2(ctx);%20%09%09%09%09%09%09if_block0.c();%20%09%09%09%09%09%09if_block0.m(svg,%20if_block0_anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block0)%20%7B%20%09%09%09%09%09if_block0.d(1);%20%09%09%09%09%09if_block0%20=%20null;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(/*title*/%20ctx%5B6%5D)%20%7B%20%09%09%09%09%09if%20(if_block1)%20%7B%20%09%09%09%09%09%09if_block1.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block1%20=%20create_if_block$4(ctx);%20%09%09%09%09%09%09if_block1.c();%20%09%09%09%09%09%09if_block1.m(svg,%20path);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block1)%20%7B%20%09%09%09%09%09if_block1.d(1);%20%09%09%09%09%09if_block1%20=%20null;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*color*/%204)%20%7B%20%09%09%09%09%09attr(path,%20%22fill%22,%20/*color*/%20ctx%5B2%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*viewBox*/%208)%20%7B%20%09%09%09%09%09attr(svg,%20%22viewBox%22,%20/*viewBox*/%20ctx%5B3%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*width*/%201)%20%7B%20%09%09%09%09%09attr(svg,%20%22width%22,%20/*width*/%20ctx%5B0%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*height*/%202)%20%7B%20%09%09%09%09%09attr(svg,%20%22height%22,%20/*height*/%20ctx%5B1%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*className*/%20256)%20%7B%20%09%09%09%09%09attr(svg,%20%22class%22,%20/*className*/%20ctx%5B8%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*ariaLabel*/%2016)%20%7B%20%09%09%09%09%09attr(svg,%20%22aria-label%22,%20/*ariaLabel*/%20ctx%5B4%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*ariaHidden*/%2032)%20%7B%20%09%09%09%09%09attr(svg,%20%22aria-hidden%22,%20/*ariaHidden*/%20ctx%5B5%5D);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i:%20noop,%20%09%09%09o:%20noop,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(svg);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(if_block0)%20if_block0.d();%20%09%09%09%09if%20(if_block1)%20if_block1.d();%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$j($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20size%20=%20%221em%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20width%20=%20size%20%7D%20=%20$$props;%20%09%09let%20%7B%20height%20=%20size%20%7D%20=%20$$props;%20%09%09let%20%7B%20color%20=%20%22currentColor%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20viewBox%20=%20%220%200%2024%2024%22%20%7D%20=%20$$props;%20%09%09let%20%7B%20ariaLabel%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20ariaHidden%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20title%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20desc%20=%20void%200%20%7D%20=%20$$props;%20%09%09let%20%7B%20class:%20className%20=%20void%200%20%7D%20=%20$$props;%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('size'%20in%20$$props)%20$$invalidate(9,%20size%20=%20$$props.size);%20%09%09%09if%20('width'%20in%20$$props)%20$$invalidate(0,%20width%20=%20$$props.width);%20%09%09%09if%20('height'%20in%20$$props)%20$$invalidate(1,%20height%20=%20$$props.height);%20%09%09%09if%20('color'%20in%20$$props)%20$$invalidate(2,%20color%20=%20$$props.color);%20%09%09%09if%20('viewBox'%20in%20$$props)%20$$invalidate(3,%20viewBox%20=%20$$props.viewBox);%20%09%09%09if%20('ariaLabel'%20in%20$$props)%20$$invalidate(4,%20ariaLabel%20=%20$$props.ariaLabel);%20%09%09%09if%20('ariaHidden'%20in%20$$props)%20$$invalidate(5,%20ariaHidden%20=%20$$props.ariaHidden);%20%09%09%09if%20('title'%20in%20$$props)%20$$invalidate(6,%20title%20=%20$$props.title);%20%09%09%09if%20('desc'%20in%20$$props)%20$$invalidate(7,%20desc%20=%20$$props.desc);%20%09%09%09if%20('class'%20in%20$$props)%20$$invalidate(8,%20className%20=%20$$props.class);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09width,%20%09%09%09height,%20%09%09%09color,%20%09%09%09viewBox,%20%09%09%09ariaLabel,%20%09%09%09ariaHidden,%20%09%09%09title,%20%09%09%09desc,%20%09%09%09className,%20%09%09%09size%20%09%09%5D;%20%09%7D%20%20%09class%20PlusCircleOutline%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%20%09%09%09init(this,%20options,%20instance$j,%20create_fragment$q,%20safe_not_equal,%20%7B%20%09%09%09%09size:%209,%20%09%09%09%09width:%200,%20%09%09%09%09height:%201,%20%09%09%09%09color:%202,%20%09%09%09%09viewBox:%203,%20%09%09%09%09ariaLabel:%204,%20%09%09%09%09ariaHidden:%205,%20%09%09%09%09title:%206,%20%09%09%09%09desc:%207,%20%09%09%09%09class:%208%20%09%09%09%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Ccustomization%5CcustomTheme%5CCreateTheme.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$7(target)%20%7B%20%09%09append_styles(target,%20%22svelte-v66qr8%22,%20%22.buttons.svelte-v66qr8%7Bdisplay:flex;flex-direction:row;width:100%25%7D.submit.svelte-v66qr8,.cancel.svelte-v66qr8%7Bpadding:10px;margin:10px;font-size:20px;border:none;border-radius:5px;flex-grow:1%7D.submit.svelte-v66qr8%7Bbackground-color:green%7D.cancel.svelte-v66qr8%7Bbackground-color:red%7Ddialog.svelte-v66qr8%7Bwidth:80%25;height:80%25;display:flex%7D.pickers.svelte-v66qr8%7Bwidth:200px;overflow-y:auto;overflow-x:hidden%7D.wrap.svelte-v66qr8%7Bdisplay:flex;flex-direction:column;height:100%25;flex-grow:1%7D.question.svelte-v66qr8%7Bwidth:100%25;height:30%25;font-family:'Product%20Sans',%20sans-serif;display:flex;align-items:center;justify-content:center;font-size:50px%7D.options.svelte-v66qr8%7Bflex-grow:1;display:grid;grid-template-columns:repeat(2,%201fr);width:100%25%7D.option.svelte-v66qr8%7Bbackground-color:blue;display:flex;align-items:center;justify-content:center;font-family:'Product%20Sans',%20sans-serif;font-size:25px;border:6px%20solid%20rgba(0,%200,%200,%200.3)%7D%22);%20%09%7D%20%20%09function%20get_each_context$3(ctx,%20list,%20i)%20%7B%20%09%09const%20child_ctx%20=%20ctx.slice();%20%09%09child_ctx%5B16%5D%20=%20list%5Bi%5D;%20%09%09child_ctx%5B18%5D%20=%20i;%20%09%09return%20child_ctx;%20%09%7D%20%20%09//%20(39:12)%20%7B%23each%20%7B%20length:%204%20%7D%20as%20_,%20i%7D%20%09function%20create_each_block$3(ctx)%20%7B%20%09%09let%20div1;%20%09%09let%20div0;%20%09%09let%20t2;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09div0.textContent%20=%20%60Option%20$%7B/*i*/%20ctx%5B18%5D%20+%201%7D%60;%20%09%09%09%09t2%20=%20space();%20%09%09%09%09attr(div1,%20%22class%22,%20%22option%20svelte-v66qr8%22);%20%09%09%09%09set_style(div1,%20%22background-color%22,%20/*theme*/%20ctx%5B1%5D.palette%5B/*i*/%20ctx%5B18%5D%5D.background);%20%09%09%09%09set_style(div1,%20%22color%22,%20/*theme*/%20ctx%5B1%5D.palette%5B/*i*/%20ctx%5B18%5D%5D.text);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div1,%20anchor);%20%09%09%09%09append(div1,%20div0);%20%09%09%09%09append(div1,%20t2);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09set_style(div1,%20%22background-color%22,%20/*theme*/%20ctx%5B1%5D.palette%5B/*i*/%20ctx%5B18%5D%5D.background);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09set_style(div1,%20%22color%22,%20/*theme*/%20ctx%5B1%5D.palette%5B/*i*/%20ctx%5B18%5D%5D.text);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$p(ctx)%20%7B%20%09%09let%20dialog_1;%20%09%09let%20div0;%20%09%09let%20colorpicker0;%20%09%09let%20updating_color;%20%09%09let%20t0;%20%09%09let%20colorpicker1;%20%09%09let%20updating_color_1;%20%09%09let%20t1;%20%09%09let%20colorpicker2;%20%09%09let%20updating_color_2;%20%09%09let%20t2;%20%09%09let%20colorpicker3;%20%09%09let%20updating_color_3;%20%09%09let%20t3;%20%09%09let%20colorpicker4;%20%09%09let%20updating_color_4;%20%09%09let%20t4;%20%09%09let%20colorpicker5;%20%09%09let%20updating_color_5;%20%09%09let%20t5;%20%09%09let%20colorpicker6;%20%09%09let%20updating_color_6;%20%09%09let%20t6;%20%09%09let%20colorpicker7;%20%09%09let%20updating_color_7;%20%09%09let%20t7;%20%09%09let%20colorpicker8;%20%09%09let%20updating_color_8;%20%09%09let%20t8;%20%09%09let%20colorpicker9;%20%09%09let%20updating_color_9;%20%09%09let%20t9;%20%09%09let%20div5;%20%09%09let%20div2;%20%09%09let%20div1;%20%09%09let%20t11;%20%09%09let%20div3;%20%09%09let%20t12;%20%09%09let%20div4;%20%09%09let%20button0;%20%09%09let%20t14;%20%09%09let%20button1;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%20%09%09function%20colorpicker0_color_binding(value)%20%7B%20%09%09%09/*colorpicker0_color_binding*/%20ctx%5B4%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker0_props%20=%20%7B%20%09%09%09text:%20%22Question%20Background%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.question.background%20!==%20void%200)%20%7B%20%09%09%09colorpicker0_props.color%20=%20/*theme*/%20ctx%5B1%5D.question.background;%20%09%09%7D%20%20%09%09colorpicker0%20=%20new%20ColorPicker(%7B%20props:%20colorpicker0_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker0,%20'color',%20colorpicker0_color_binding));%20%20%09%09function%20colorpicker1_color_binding(value)%20%7B%20%09%09%09/*colorpicker1_color_binding*/%20ctx%5B5%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker1_props%20=%20%7B%20%09%09%09text:%20%22Question%20Text%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.question.text%20!==%20void%200)%20%7B%20%09%09%09colorpicker1_props.color%20=%20/*theme*/%20ctx%5B1%5D.question.text;%20%09%09%7D%20%20%09%09colorpicker1%20=%20new%20ColorPicker(%7B%20props:%20colorpicker1_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker1,%20'color',%20colorpicker1_color_binding));%20%20%09%09function%20colorpicker2_color_binding(value)%20%7B%20%09%09%09/*colorpicker2_color_binding*/%20ctx%5B6%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker2_props%20=%20%7B%20%09%09%09text:%20%22Option%201%20Background%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.palette%5B0%5D.background%20!==%20void%200)%20%7B%20%09%09%09colorpicker2_props.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B0%5D.background;%20%09%09%7D%20%20%09%09colorpicker2%20=%20new%20ColorPicker(%7B%20props:%20colorpicker2_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker2,%20'color',%20colorpicker2_color_binding));%20%20%09%09function%20colorpicker3_color_binding(value)%20%7B%20%09%09%09/*colorpicker3_color_binding*/%20ctx%5B7%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker3_props%20=%20%7B%20%09%09%09text:%20%22Option%201%20Text%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.palette%5B0%5D.text%20!==%20void%200)%20%7B%20%09%09%09colorpicker3_props.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B0%5D.text;%20%09%09%7D%20%20%09%09colorpicker3%20=%20new%20ColorPicker(%7B%20props:%20colorpicker3_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker3,%20'color',%20colorpicker3_color_binding));%20%20%09%09function%20colorpicker4_color_binding(value)%20%7B%20%09%09%09/*colorpicker4_color_binding*/%20ctx%5B8%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker4_props%20=%20%7B%20%09%09%09text:%20%22Option%202%20Background%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.palette%5B1%5D.background%20!==%20void%200)%20%7B%20%09%09%09colorpicker4_props.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B1%5D.background;%20%09%09%7D%20%20%09%09colorpicker4%20=%20new%20ColorPicker(%7B%20props:%20colorpicker4_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker4,%20'color',%20colorpicker4_color_binding));%20%20%09%09function%20colorpicker5_color_binding(value)%20%7B%20%09%09%09/*colorpicker5_color_binding*/%20ctx%5B9%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker5_props%20=%20%7B%20%09%09%09text:%20%22Option%202%20Text%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.palette%5B1%5D.text%20!==%20void%200)%20%7B%20%09%09%09colorpicker5_props.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B1%5D.text;%20%09%09%7D%20%20%09%09colorpicker5%20=%20new%20ColorPicker(%7B%20props:%20colorpicker5_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker5,%20'color',%20colorpicker5_color_binding));%20%20%09%09function%20colorpicker6_color_binding(value)%20%7B%20%09%09%09/*colorpicker6_color_binding*/%20ctx%5B10%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker6_props%20=%20%7B%20%09%09%09text:%20%22Option%203%20Background%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.palette%5B2%5D.background%20!==%20void%200)%20%7B%20%09%09%09colorpicker6_props.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B2%5D.background;%20%09%09%7D%20%20%09%09colorpicker6%20=%20new%20ColorPicker(%7B%20props:%20colorpicker6_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker6,%20'color',%20colorpicker6_color_binding));%20%20%09%09function%20colorpicker7_color_binding(value)%20%7B%20%09%09%09/*colorpicker7_color_binding*/%20ctx%5B11%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker7_props%20=%20%7B%20%09%09%09text:%20%22Option%203%20Text%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.palette%5B2%5D.text%20!==%20void%200)%20%7B%20%09%09%09colorpicker7_props.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B2%5D.text;%20%09%09%7D%20%20%09%09colorpicker7%20=%20new%20ColorPicker(%7B%20props:%20colorpicker7_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker7,%20'color',%20colorpicker7_color_binding));%20%20%09%09function%20colorpicker8_color_binding(value)%20%7B%20%09%09%09/*colorpicker8_color_binding*/%20ctx%5B12%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker8_props%20=%20%7B%20%09%09%09text:%20%22Option%204%20Background%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.palette%5B3%5D.background%20!==%20void%200)%20%7B%20%09%09%09colorpicker8_props.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B3%5D.background;%20%09%09%7D%20%20%09%09colorpicker8%20=%20new%20ColorPicker(%7B%20props:%20colorpicker8_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker8,%20'color',%20colorpicker8_color_binding));%20%20%09%09function%20colorpicker9_color_binding(value)%20%7B%20%09%09%09/*colorpicker9_color_binding*/%20ctx%5B13%5D(value);%20%09%09%7D%20%20%09%09let%20colorpicker9_props%20=%20%7B%20%09%09%09text:%20%22Option%204%20Text%22,%20%09%09%09allowOpacity:%20false%20%09%09%7D;%20%20%09%09if%20(/*theme*/%20ctx%5B1%5D.palette%5B3%5D.text%20!==%20void%200)%20%7B%20%09%09%09colorpicker9_props.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B3%5D.text;%20%09%09%7D%20%20%09%09colorpicker9%20=%20new%20ColorPicker(%7B%20props:%20colorpicker9_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(colorpicker9,%20'color',%20colorpicker9_color_binding));%20%09%09let%20each_value%20=%20ensure_array_like(%7B%20length:%204%20%7D);%20%09%09let%20each_blocks%20=%20%5B%5D;%20%20%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20create_each_block$3(get_each_context$3(ctx,%20each_value,%20i));%20%09%09%7D%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09dialog_1%20=%20element(%22dialog%22);%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09create_component(colorpicker0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(colorpicker1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(colorpicker2.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(colorpicker3.$$.fragment);%20%09%09%09%09t3%20=%20space();%20%09%09%09%09create_component(colorpicker4.$$.fragment);%20%09%09%09%09t4%20=%20space();%20%09%09%09%09create_component(colorpicker5.$$.fragment);%20%09%09%09%09t5%20=%20space();%20%09%09%09%09create_component(colorpicker6.$$.fragment);%20%09%09%09%09t6%20=%20space();%20%09%09%09%09create_component(colorpicker7.$$.fragment);%20%09%09%09%09t7%20=%20space();%20%09%09%09%09create_component(colorpicker8.$$.fragment);%20%09%09%09%09t8%20=%20space();%20%09%09%09%09create_component(colorpicker9.$$.fragment);%20%09%09%09%09t9%20=%20space();%20%09%09%09%09div5%20=%20element(%22div%22);%20%09%09%09%09div2%20=%20element(%22div%22);%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09div1.textContent%20=%20%22Example%20Question%20Text%22;%20%09%09%09%09t11%20=%20space();%20%09%09%09%09div3%20=%20element(%22div%22);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%7D%20%20%09%09%09%09t12%20=%20space();%20%09%09%09%09div4%20=%20element(%22div%22);%20%09%09%09%09button0%20=%20element(%22button%22);%20%09%09%09%09button0.textContent%20=%20%22Create%22;%20%09%09%09%09t14%20=%20space();%20%09%09%09%09button1%20=%20element(%22button%22);%20%09%09%09%09button1.textContent%20=%20%22Cancel%22;%20%09%09%09%09attr(div0,%20%22class%22,%20%22pickers%20svelte-v66qr8%22);%20%09%09%09%09attr(div2,%20%22class%22,%20%22question%20svelte-v66qr8%22);%20%09%09%09%09set_style(div2,%20%22background-color%22,%20/*theme*/%20ctx%5B1%5D.question.background);%20%09%09%09%09set_style(div2,%20%22color%22,%20/*theme*/%20ctx%5B1%5D.question.text);%20%09%09%09%09attr(div3,%20%22class%22,%20%22options%20svelte-v66qr8%22);%20%09%09%09%09attr(button0,%20%22class%22,%20%22submit%20svelte-v66qr8%22);%20%09%09%09%09attr(button1,%20%22class%22,%20%22cancel%20svelte-v66qr8%22);%20%09%09%09%09attr(div4,%20%22class%22,%20%22buttons%20svelte-v66qr8%22);%20%09%09%09%09attr(div5,%20%22class%22,%20%22wrap%20svelte-v66qr8%22);%20%09%09%09%09attr(dialog_1,%20%22class%22,%20%22svelte-v66qr8%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20dialog_1,%20anchor);%20%09%09%09%09append(dialog_1,%20div0);%20%09%09%09%09mount_component(colorpicker0,%20div0,%20null);%20%09%09%09%09append(div0,%20t0);%20%09%09%09%09mount_component(colorpicker1,%20div0,%20null);%20%09%09%09%09append(div0,%20t1);%20%09%09%09%09mount_component(colorpicker2,%20div0,%20null);%20%09%09%09%09append(div0,%20t2);%20%09%09%09%09mount_component(colorpicker3,%20div0,%20null);%20%09%09%09%09append(div0,%20t3);%20%09%09%09%09mount_component(colorpicker4,%20div0,%20null);%20%09%09%09%09append(div0,%20t4);%20%09%09%09%09mount_component(colorpicker5,%20div0,%20null);%20%09%09%09%09append(div0,%20t5);%20%09%09%09%09mount_component(colorpicker6,%20div0,%20null);%20%09%09%09%09append(div0,%20t6);%20%09%09%09%09mount_component(colorpicker7,%20div0,%20null);%20%09%09%09%09append(div0,%20t7);%20%09%09%09%09mount_component(colorpicker8,%20div0,%20null);%20%09%09%09%09append(div0,%20t8);%20%09%09%09%09mount_component(colorpicker9,%20div0,%20null);%20%09%09%09%09append(dialog_1,%20t9);%20%09%09%09%09append(dialog_1,%20div5);%20%09%09%09%09append(div5,%20div2);%20%09%09%09%09append(div2,%20div1);%20%09%09%09%09append(div5,%20t11);%20%09%09%09%09append(div5,%20div3);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.m(div3,%20null);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09append(div5,%20t12);%20%09%09%09%09append(div5,%20div4);%20%09%09%09%09append(div4,%20button0);%20%09%09%09%09append(div4,%20t14);%20%09%09%09%09append(div4,%20button1);%20%09%09%09%09/*dialog_1_binding*/%20ctx%5B14%5D(dialog_1);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(button0,%20%22click%22,%20/*submit*/%20ctx%5B2%5D),%20%09%09%09%09%09%09listen(button1,%20%22click%22,%20/*cancel*/%20ctx%5B3%5D),%20%09%09%09%09%09%09listen(dialog_1,%20%22close%22,%20/*cancel*/%20ctx%5B3%5D)%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20colorpicker0_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color%20=%20true;%20%09%09%09%09%09colorpicker0_changes.color%20=%20/*theme*/%20ctx%5B1%5D.question.background;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker0.$set(colorpicker0_changes);%20%09%09%09%09const%20colorpicker1_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_1%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_1%20=%20true;%20%09%09%09%09%09colorpicker1_changes.color%20=%20/*theme*/%20ctx%5B1%5D.question.text;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_1%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker1.$set(colorpicker1_changes);%20%09%09%09%09const%20colorpicker2_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_2%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_2%20=%20true;%20%09%09%09%09%09colorpicker2_changes.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B0%5D.background;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_2%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker2.$set(colorpicker2_changes);%20%09%09%09%09const%20colorpicker3_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_3%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_3%20=%20true;%20%09%09%09%09%09colorpicker3_changes.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B0%5D.text;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_3%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker3.$set(colorpicker3_changes);%20%09%09%09%09const%20colorpicker4_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_4%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_4%20=%20true;%20%09%09%09%09%09colorpicker4_changes.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B1%5D.background;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_4%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker4.$set(colorpicker4_changes);%20%09%09%09%09const%20colorpicker5_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_5%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_5%20=%20true;%20%09%09%09%09%09colorpicker5_changes.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B1%5D.text;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_5%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker5.$set(colorpicker5_changes);%20%09%09%09%09const%20colorpicker6_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_6%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_6%20=%20true;%20%09%09%09%09%09colorpicker6_changes.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B2%5D.background;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_6%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker6.$set(colorpicker6_changes);%20%09%09%09%09const%20colorpicker7_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_7%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_7%20=%20true;%20%09%09%09%09%09colorpicker7_changes.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B2%5D.text;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_7%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker7.$set(colorpicker7_changes);%20%09%09%09%09const%20colorpicker8_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_8%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_8%20=%20true;%20%09%09%09%09%09colorpicker8_changes.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B3%5D.background;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_8%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker8.$set(colorpicker8_changes);%20%09%09%09%09const%20colorpicker9_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_color_9%20&&%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09updating_color_9%20=%20true;%20%09%09%09%09%09colorpicker9_changes.color%20=%20/*theme*/%20ctx%5B1%5D.palette%5B3%5D.text;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_color_9%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09colorpicker9.$set(colorpicker9_changes);%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09set_style(div2,%20%22background-color%22,%20/*theme*/%20ctx%5B1%5D.question.background);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09set_style(div2,%20%22color%22,%20/*theme*/%20ctx%5B1%5D.question.text);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*theme*/%202)%20%7B%20%09%09%09%09%09each_value%20=%20ensure_array_like(%7B%20length:%204%20%7D);%20%09%09%09%09%09let%20i;%20%20%09%09%09%09%09for%20(i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09const%20child_ctx%20=%20get_each_context$3(ctx,%20each_value,%20i);%20%20%09%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.p(child_ctx,%20dirty);%20%09%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D%20=%20create_each_block$3(child_ctx);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.m(div3,%20null);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%20%09%09%09%09%09for%20(;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.d(1);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09each_blocks.length%20=%20each_value.length;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(colorpicker0.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker1.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker2.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker3.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker4.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker5.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker6.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker7.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker8.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker9.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(colorpicker0.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker1.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker2.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker3.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker4.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker5.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker6.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker7.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker8.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker9.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(dialog_1);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(colorpicker0);%20%09%09%09%09destroy_component(colorpicker1);%20%09%09%09%09destroy_component(colorpicker2);%20%09%09%09%09destroy_component(colorpicker3);%20%09%09%09%09destroy_component(colorpicker4);%20%09%09%09%09destroy_component(colorpicker5);%20%09%09%09%09destroy_component(colorpicker6);%20%09%09%09%09destroy_component(colorpicker7);%20%09%09%09%09destroy_component(colorpicker8);%20%09%09%09%09destroy_component(colorpicker9);%20%09%09%09%09destroy_each(each_blocks,%20detaching);%20%09%09%09%09/*dialog_1_binding*/%20ctx%5B14%5D(null);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$i($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20dialog;%20%09%09let%20theme%20=%20structuredClone(%7B%20...defaultThemes%5B0%5D,%20custom:%20true%20%7D);%20%09%09let%20dispatch%20=%20createEventDispatcher();%20%20%09%09onMount(()%20=%3E%20%7B%20%09%09%09document.body.appendChild(dialog);%20%09%09%09dialog.showModal();%20%09%09%7D);%20%20%09%09function%20submit()%20%7B%20%09%09%09dispatch('submit',%20theme);%20%09%09%7D%20%20%09%09function%20cancel()%20%7B%20%09%09%09dispatch('submit',%20null);%20%09%09%7D%20%20%09%09function%20colorpicker0_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.question.background,%20value))%20%7B%20%09%09%09%09theme.question.background%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker1_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.question.text,%20value))%20%7B%20%09%09%09%09theme.question.text%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker2_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.palette%5B0%5D.background,%20value))%20%7B%20%09%09%09%09theme.palette%5B0%5D.background%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker3_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.palette%5B0%5D.text,%20value))%20%7B%20%09%09%09%09theme.palette%5B0%5D.text%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker4_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.palette%5B1%5D.background,%20value))%20%7B%20%09%09%09%09theme.palette%5B1%5D.background%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker5_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.palette%5B1%5D.text,%20value))%20%7B%20%09%09%09%09theme.palette%5B1%5D.text%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker6_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.palette%5B2%5D.background,%20value))%20%7B%20%09%09%09%09theme.palette%5B2%5D.background%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker7_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.palette%5B2%5D.text,%20value))%20%7B%20%09%09%09%09theme.palette%5B2%5D.text%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker8_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.palette%5B3%5D.background,%20value))%20%7B%20%09%09%09%09theme.palette%5B3%5D.background%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20colorpicker9_color_binding(value)%20%7B%20%09%09%09if%20($$self.$$.not_equal(theme.palette%5B3%5D.text,%20value))%20%7B%20%09%09%09%09theme.palette%5B3%5D.text%20=%20value;%20%09%09%09%09$$invalidate(1,%20theme);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20dialog_1_binding($$value)%20%7B%20%09%09%09binding_callbacks%5B$$value%20?%20'unshift'%20:%20'push'%5D(()%20=%3E%20%7B%20%09%09%09%09dialog%20=%20$$value;%20%09%09%09%09$$invalidate(0,%20dialog);%20%09%09%09%7D);%20%09%09%7D%20%20%09%09return%20%5B%20%09%09%09dialog,%20%09%09%09theme,%20%09%09%09submit,%20%09%09%09cancel,%20%09%09%09colorpicker0_color_binding,%20%09%09%09colorpicker1_color_binding,%20%09%09%09colorpicker2_color_binding,%20%09%09%09colorpicker3_color_binding,%20%09%09%09colorpicker4_color_binding,%20%09%09%09colorpicker5_color_binding,%20%09%09%09colorpicker6_color_binding,%20%09%09%09colorpicker7_color_binding,%20%09%09%09colorpicker8_color_binding,%20%09%09%09colorpicker9_color_binding,%20%09%09%09dialog_1_binding%20%09%09%5D;%20%09%7D%20%20%09class%20CreateTheme%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$i,%20create_fragment$p,%20safe_not_equal,%20%7B%7D,%20add_css$7);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Ccustomization%5CcustomTheme%5CCustomTheme.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$6(target)%20%7B%20%09%09append_styles(target,%20%22svelte-1yznqq%22,%20%22.createTheme.svelte-1yznqq.svelte-1yznqq%7Bdisplay:flex;align-items:center;justify-content:center;gap:5px%7D.title.svelte-1yznqq.svelte-1yznqq%7Bposition:relative;width:100%25;text-align:center;display:flex;justify-content:center%7D.title.svelte-1yznqq%3Ediv.svelte-1yznqq%7Bposition:absolute;right:0;top:0%7D.theme.svelte-1yznqq.svelte-1yznqq%7Bdisplay:flex;flex-direction:column;align-items:center;margin:10px%7D.theme.selected.svelte-1yznqq.svelte-1yznqq%7Bborder:5px%20solid%20black;outline:3px%20solid%20white%7D.options.svelte-1yznqq.svelte-1yznqq%7Bdisplay:flex;flex-direction:row;align-items:center;width:100%25%7D.option.svelte-1yznqq.svelte-1yznqq%7Bflex-grow:1;text-align:center;margin:5px%7D.themeEnabled.svelte-1yznqq.svelte-1yznqq%7Bdisplay:flex;align-items:center;justify-content:center;margin-left:10px;margin-right:10px%7D.themeEnabled.svelte-1yznqq%3Ediv.svelte-1yznqq%7Bmargin-right:10px%7D.themeEnabled.svelte-1yznqq%3Einput.svelte-1yznqq%7Bwidth:20px;height:20px%7D%22);%20%09%7D%20%20%09function%20get_each_context$2(ctx,%20list,%20i)%20%7B%20%09%09const%20child_ctx%20=%20ctx.slice();%20%09%09child_ctx%5B20%5D%20=%20list%5Bi%5D;%20%09%09child_ctx%5B22%5D%20=%20i;%20%09%09return%20child_ctx;%20%09%7D%20%20%09function%20get_each_context_1$1(ctx,%20list,%20i)%20%7B%20%09%09const%20child_ctx%20=%20ctx.slice();%20%09%09child_ctx%5B23%5D%20=%20list%5Bi%5D;%20%09%09child_ctx%5B25%5D%20=%20i;%20%09%09return%20child_ctx;%20%09%7D%20%20%09//%20(124:0)%20%7B%23if%20createOpen%7D%20%09function%20create_if_block_1$1(ctx)%20%7B%20%09%09let%20createtheme;%20%09%09let%20current;%20%09%09createtheme%20=%20new%20CreateTheme(%7B%7D);%20%09%09createtheme.$on(%22submit%22,%20/*onSubmit*/%20ctx%5B7%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(createtheme.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(createtheme,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(createtheme.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(createtheme.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(createtheme,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(133:4)%20%3CButton%20on:click=%7B()%20=%3E%20createOpen%20=%20true%7D%3E%20%09function%20create_default_slot_1$4(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20t;%20%09%09let%20pluscircleoutline;%20%09%09let%20current;%20%09%09pluscircleoutline%20=%20new%20PlusCircleOutline(%7B%20props:%20%7B%20width:%2030,%20height:%2030%20%7D%20%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09t%20=%20text(%22New%20Theme%5Cr%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%22);%20%09%09%09%09create_component(pluscircleoutline.$$.fragment);%20%09%09%09%09attr(div,%20%22class%22,%20%22createTheme%20svelte-1yznqq%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09append(div,%20t);%20%09%09%09%09mount_component(pluscircleoutline,%20div,%20null);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(pluscircleoutline.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(pluscircleoutline.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(pluscircleoutline);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(145:16)%20%7B%23if%20theme.custom%7D%20%09function%20create_if_block$3(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20delete_1;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%09%09delete_1%20=%20new%20Delete(%7B%20props:%20%7B%20width:%2025,%20height:%2025%20%7D%20%7D);%20%20%09%09function%20click_handler_1()%20%7B%20%09%09%09return%20/*click_handler_1*/%20ctx%5B11%5D(/*theme*/%20ctx%5B20%5D);%20%09%09%7D%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09create_component(delete_1.$$.fragment);%20%09%09%09%09attr(div,%20%22class%22,%20%22svelte-1yznqq%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09mount_component(delete_1,%20div,%20null);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20listen(div,%20%22click%22,%20stop_propagation(click_handler_1));%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(new_ctx,%20dirty)%20%7B%20%09%09%09%09ctx%20=%20new_ctx;%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(delete_1.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(delete_1.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(delete_1);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09dispose();%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(152:16)%20%7B%23each%20theme.palette%20as%20color,%20j%7D%20%09function%20create_each_block_1$1(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20t0_value%20=%20/*j*/%20ctx%5B25%5D%20+%201%20+%20%22%22;%20%09%09let%20t0;%20%09%09let%20t1;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09t0%20=%20text(t0_value);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09attr(div,%20%22class%22,%20%22option%20svelte-1yznqq%22);%20%09%09%09%09set_style(div,%20%22background-color%22,%20/*color*/%20ctx%5B23%5D.background);%20%09%09%09%09set_style(div,%20%22color%22,%20/*color*/%20ctx%5B23%5D.text);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09append(div,%20t0);%20%09%09%09%09append(div,%20t1);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*themes*/%201)%20%7B%20%09%09%09%09%09set_style(div,%20%22background-color%22,%20/*color*/%20ctx%5B23%5D.background);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*themes*/%201)%20%7B%20%09%09%09%09%09set_style(div,%20%22color%22,%20/*color*/%20ctx%5B23%5D.text);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(139:4)%20%7B%23each%20themes%20as%20theme,%20i%7D%20%09function%20create_each_block$2(ctx)%20%7B%20%09%09let%20div2;%20%09%09let%20div0;%20%09%09let%20t0;%20%09%09let%20t1_value%20=%20/*i*/%20ctx%5B22%5D%20+%201%20+%20%22%22;%20%09%09let%20t1;%20%09%09let%20t2;%20%09%09let%20t3;%20%09%09let%20div1;%20%09%09let%20t4;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%09%09let%20if_block%20=%20/*theme*/%20ctx%5B20%5D.custom%20&&%20create_if_block$3(ctx);%20%09%09let%20each_value_1%20=%20ensure_array_like(/*theme*/%20ctx%5B20%5D.palette);%20%09%09let%20each_blocks%20=%20%5B%5D;%20%20%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value_1.length;%20i%20+=%201)%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20create_each_block_1$1(get_each_context_1$1(ctx,%20each_value_1,%20i));%20%09%09%7D%20%20%09%09function%20click_handler_2()%20%7B%20%09%09%09return%20/*click_handler_2*/%20ctx%5B12%5D(/*theme*/%20ctx%5B20%5D);%20%09%09%7D%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div2%20=%20element(%22div%22);%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09t0%20=%20text(%22Theme%20%22);%20%09%09%09%09t1%20=%20text(t1_value);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09if%20(if_block)%20if_block.c();%20%09%09%09%09t3%20=%20space();%20%09%09%09%09div1%20=%20element(%22div%22);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%7D%20%20%09%09%09%09t4%20=%20space();%20%09%09%09%09attr(div0,%20%22class%22,%20%22title%20svelte-1yznqq%22);%20%09%09%09%09attr(div1,%20%22class%22,%20%22options%20svelte-1yznqq%22);%20%09%09%09%09attr(div2,%20%22class%22,%20%22theme%20svelte-1yznqq%22);%20%09%09%09%09set_style(div2,%20%22background-color%22,%20/*theme*/%20ctx%5B20%5D.question.background);%20%09%09%09%09set_style(div2,%20%22color%22,%20/*theme*/%20ctx%5B20%5D.question.text);%20%09%09%09%09toggle_class(div2,%20%22selected%22,%20/*selectedTheme*/%20ctx%5B1%5D%20===%20/*theme*/%20ctx%5B20%5D);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div2,%20anchor);%20%09%09%09%09append(div2,%20div0);%20%09%09%09%09append(div0,%20t0);%20%09%09%09%09append(div0,%20t1);%20%09%09%09%09append(div0,%20t2);%20%09%09%09%09if%20(if_block)%20if_block.m(div0,%20null);%20%09%09%09%09append(div2,%20t3);%20%09%09%09%09append(div2,%20div1);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.m(div1,%20null);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09append(div2,%20t4);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20listen(div2,%20%22click%22,%20click_handler_2);%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(new_ctx,%20dirty)%20%7B%20%09%09%09%09ctx%20=%20new_ctx;%20%20%09%09%09%09if%20(/*theme*/%20ctx%5B20%5D.custom)%20%7B%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.p(ctx,%20dirty);%20%20%09%09%09%09%09%09if%20(dirty%20&%20/*themes*/%201)%20%7B%20%09%09%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block%20=%20create_if_block$3(ctx);%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09%09if_block.m(div0,%20null);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block)%20%7B%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09transition_out(if_block,%201,%201,%20()%20=%3E%20%7B%20%09%09%09%09%09%09if_block%20=%20null;%20%09%09%09%09%09%7D);%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*themes*/%201)%20%7B%20%09%09%09%09%09each_value_1%20=%20ensure_array_like(/*theme*/%20ctx%5B20%5D.palette);%20%09%09%09%09%09let%20i;%20%20%09%09%09%09%09for%20(i%20=%200;%20i%20%3C%20each_value_1.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09const%20child_ctx%20=%20get_each_context_1$1(ctx,%20each_value_1,%20i);%20%20%09%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.p(child_ctx,%20dirty);%20%09%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D%20=%20create_each_block_1$1(child_ctx);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.m(div1,%20null);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%20%09%09%09%09%09for%20(;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.d(1);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09each_blocks.length%20=%20each_value_1.length;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*themes*/%201)%20%7B%20%09%09%09%09%09set_style(div2,%20%22background-color%22,%20/*theme*/%20ctx%5B20%5D.question.background);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*themes*/%201)%20%7B%20%09%09%09%09%09set_style(div2,%20%22color%22,%20/*theme*/%20ctx%5B20%5D.question.text);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*selectedTheme,%20themes*/%203)%20%7B%20%09%09%09%09%09toggle_class(div2,%20%22selected%22,%20/*selectedTheme*/%20ctx%5B1%5D%20===%20/*theme*/%20ctx%5B20%5D);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(if_block);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(if_block);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div2);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(if_block)%20if_block.d();%20%09%09%09%09destroy_each(each_blocks,%20detaching);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09dispose();%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(128:0)%20%3CGroup%20name=%22Custom%20Theme%22%3E%20%09function%20create_default_slot$h(ctx)%20%7B%20%09%09let%20div1;%20%09%09let%20div0;%20%09%09let%20t1;%20%09%09let%20input;%20%09%09let%20t2;%20%09%09let%20button;%20%09%09let%20t3;%20%09%09let%20each_1_anchor;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_1$4%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20/*click_handler*/%20ctx%5B10%5D);%20%09%09let%20each_value%20=%20ensure_array_like(/*themes*/%20ctx%5B0%5D);%20%09%09let%20each_blocks%20=%20%5B%5D;%20%20%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20create_each_block$2(get_each_context$2(ctx,%20each_value,%20i));%20%09%09%7D%20%20%09%09const%20out%20=%20i%20=%3E%20transition_out(each_blocks%5Bi%5D,%201,%201,%20()%20=%3E%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20null;%20%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09div0.textContent%20=%20%22Use%20Custom%20Theme?%22;%20%09%09%09%09t1%20=%20space();%20%09%09%09%09input%20=%20element(%22input%22);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%09t3%20=%20space();%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%7D%20%20%09%09%09%09each_1_anchor%20=%20empty();%20%09%09%09%09attr(div0,%20%22class%22,%20%22svelte-1yznqq%22);%20%09%09%09%09attr(input,%20%22type%22,%20%22checkbox%22);%20%09%09%09%09attr(input,%20%22class%22,%20%22svelte-1yznqq%22);%20%09%09%09%09attr(div1,%20%22class%22,%20%22themeEnabled%20svelte-1yznqq%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div1,%20anchor);%20%09%09%09%09append(div1,%20div0);%20%09%09%09%09append(div1,%20t1);%20%09%09%09%09append(div1,%20input);%20%09%09%09%09input.checked%20=%20/*themeEnabled*/%20ctx%5B2%5D;%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09insert(target,%20t3,%20anchor);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.m(target,%20anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09insert(target,%20each_1_anchor,%20anchor);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(input,%20%22change%22,%20/*input_change_handler*/%20ctx%5B9%5D),%20%09%09%09%09%09%09listen(input,%20%22change%22,%20/*updateEnabled*/%20ctx%5B5%5D)%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*themeEnabled*/%204)%20%7B%20%09%09%09%09%09input.checked%20=%20/*themeEnabled*/%20ctx%5B2%5D;%20%09%09%09%09%7D%20%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%2067108864)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%20%09%09%09%09if%20(dirty%20&%20/*themes,%20selectedTheme,%20setTheme,%20deleteTheme*/%20323)%20%7B%20%09%09%09%09%09each_value%20=%20ensure_array_like(/*themes*/%20ctx%5B0%5D);%20%09%09%09%09%09let%20i;%20%20%09%09%09%09%09for%20(i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09const%20child_ctx%20=%20get_each_context$2(ctx,%20each_value,%20i);%20%20%09%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.p(child_ctx,%20dirty);%20%09%09%09%09%09%09%09transition_in(each_blocks%5Bi%5D,%201);%20%09%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D%20=%20create_each_block$2(child_ctx);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%09%09%09transition_in(each_blocks%5Bi%5D,%201);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.m(each_1_anchor.parentNode,%20each_1_anchor);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09for%20(i%20=%20each_value.length;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09out(i);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09transition_in(each_blocks%5Bi%5D);%20%09%09%09%09%7D%20%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09each_blocks%20=%20each_blocks.filter(Boolean);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09transition_out(each_blocks%5Bi%5D);%20%09%09%09%09%7D%20%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%09detach(t3);%20%09%09%09%09%09detach(each_1_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%09destroy_each(each_blocks,%20detaching);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$o(ctx)%20%7B%20%09%09let%20t;%20%09%09let%20group;%20%09%09let%20current;%20%09%09let%20if_block%20=%20/*createOpen*/%20ctx%5B3%5D%20&&%20create_if_block_1$1(ctx);%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Custom%20Theme%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$h%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09if%20(if_block)%20if_block.c();%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09if%20(if_block)%20if_block.m(target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(/*createOpen*/%20ctx%5B3%5D)%20%7B%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.p(ctx,%20dirty);%20%20%09%09%09%09%09%09if%20(dirty%20&%20/*createOpen*/%208)%20%7B%20%09%09%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block%20=%20create_if_block_1$1(ctx);%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09%09if_block.m(t.parentNode,%20t);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block)%20%7B%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09transition_out(if_block,%201,%201,%20()%20=%3E%20%7B%20%09%09%09%09%09%09if_block%20=%20null;%20%09%09%09%09%09%7D);%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%7D%20%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20themes,%20selectedTheme,%20createOpen,%20themeEnabled*/%2067108879)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(if_block);%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(if_block);%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(if_block)%20if_block.d(detaching);%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09const%20selector%20=%20'%5Bstyle%5E=%22opacity:%22%5D%5Bstyle*=%22transform:%20translateY(0%25)%22%5D';%20%20%09function%20instance$h($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20$transportType;%20%09%09let%20%7B%20transportType%20%7D%20=%20socketManager;%20%09%09component_subscribe($$self,%20transportType,%20value%20=%3E%20$$invalidate(14,%20$transportType%20=%20value));%20%09%09let%20themesString%20=%20getValue('customThemes');%20%09%09let%20themes%20=%20%5B%5D;%20%20%09%09if%20(themesString)%20%7B%20%09%09%09themes%20=%20JSON.parse(themesString);%20%09%09%7D%20else%20%7B%20%09%09%09themes%20=%20defaultThemes.map(theme%20=%3E%20(%7B%20...theme,%20custom:%20false%20%7D));%20%09%09%7D%20%20%09%09let%20questionElement%20=%20null;%20%20%09%09let%20observer%20=%20new%20MutationObserver(mutations%20=%3E%20%7B%20%09%09%09%09for%20(let%20mutation%20of%20mutations)%20%7B%20%09%09%09%09%09for%20(let%20node%20of%20mutation.addedNodes)%20%7B%20%09%09%09%09%09%09if%20(!(node%20instanceof%20HTMLElement))%20continue;%20%09%09%09%09%09%09let%20found;%20%20%09%09%09%09%09%09if%20($transportType%20===%20'colyseus')%20%7B%20%09%09%09%09%09%09%09found%20=%20node.querySelector(selector);%20%09%09%09%09%09%09%7D%20else%20if%20($transportType%20===%20'blueboat')%20%7B%20%09%09%09%09%09%09%09if%20(node.matches(selector))%20%7B%20%09%09%09%09%09%09%09%09found%20=%20node;%20%09%09%09%09%09%09%09%7D%20%09%09%09%09%09%09%7D%20%20%09%09%09%09%09%09if%20(!found)%20continue;%20%09%09%09%09%09%09questionElement%20=%20found;%20%09%09%09%09%09%09applyTheme();%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09const%20attachObserver%20=%20()%20=%3E%20%7B%20%09%09%09observer.observe(document.body,%20%7B%20childList:%20true,%20subtree:%20true%20%7D);%20%09%09%7D;%20%20%09%09if%20(!document.body)%20%7B%20%09%09%09window.addEventListener('DOMContentLoaded',%20attachObserver);%20%09%09%7D%20else%20%7B%20%09%09%09attachObserver();%20%09%09%7D%20%20%09%09let%20selectedTheme%20=%20themes%5BparseInt(getValue('selectedTheme',%20'0'))%5D;%20%09%09let%20themeEnabled%20=%20getValue('themeEnabled')%20===%20'true';%20%20%09%09function%20updateEnabled()%20%7B%20%09%09%09if%20(themeEnabled)%20%7B%20%09%09%09%09setValue('themeEnabled',%20'true');%20%09%09%09%09setTheme(selectedTheme);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09setValue('themeEnabled',%20'false');%20%09%09%09%09removeTheme();%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20setTheme(theme)%20%7B%20%09%09%09$$invalidate(1,%20selectedTheme%20=%20theme);%20%09%09%09setValue('selectedTheme',%20themes.indexOf(theme).toString());%20%09%09%09if%20(themeEnabled)%20applyTheme();%20%09%09%7D%20%20%09%09function%20applyTheme()%20%7B%20%09%09%09if%20(!questionElement%20%7C%7C%20!themeEnabled)%20return;%20%09%09%09let%20questionDisplay%20=%20questionElement.firstChild.firstChild.firstChild.firstChild;%20%09%09%09questionDisplay.style.background%20=%20selectedTheme.question.background;%20%09%09%09questionDisplay.style.color%20=%20selectedTheme.question.text;%20%20%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20questionElement.children%5B1%5D.children.length;%20i++)%20%7B%20%09%09%09%09let%20option%20=%20questionElement.children%5B1%5D.children%5Bi%5D;%20%09%09%09%09let%20optionDisplay%20=%20option.firstChild;%20%09%09%09%09optionDisplay.style.background%20=%20selectedTheme.palette%5Bi%5D.background;%20%09%09%09%09optionDisplay.style.color%20=%20selectedTheme.palette%5Bi%5D.text;%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20removeTheme()%20%7B%20%09%09%09if%20(!questionElement)%20return;%20%09%09%09let%20questionDisplay%20=%20questionElement.firstChild.firstChild.firstChild.firstChild;%20%09%09%09questionDisplay.style.background%20=%20'';%20%09%09%09questionDisplay.style.color%20=%20'';%20%20%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20questionElement.children%5B1%5D.children.length;%20i++)%20%7B%20%09%09%09%09let%20option%20=%20questionElement.children%5B1%5D.children%5Bi%5D;%20%09%09%09%09let%20optionDisplay%20=%20option.firstChild;%20%09%09%09%09optionDisplay.style.background%20=%20'';%20%09%09%09%09optionDisplay.style.color%20=%20'';%20%09%09%09%7D%20%09%09%7D%20%20%09%09let%20createOpen%20=%20false;%20%20%09%09function%20onSubmit(message)%20%7B%20%09%09%09$$invalidate(3,%20createOpen%20=%20false);%20%09%09%09if%20(!message.detail)%20return;%20%09%09%09$$invalidate(1,%20selectedTheme%20=%20message.detail);%20%09%09%09$$invalidate(0,%20themes%20=%20%5Bmessage.detail,%20...themes%5D);%20%09%09%09setValue('selectedTheme',%20'0');%20%09%09%09setValue('customThemes',%20JSON.stringify(themes));%20%09%09%09applyTheme();%20%09%09%7D%20%20%09%09function%20deleteTheme(theme)%20%7B%20%09%09%09let%20res%20=%20confirm('Are%20you%20sure%20you%20want%20to%20delete%20this%20theme?');%20%09%09%09if%20(!res)%20return;%20%09%09%09let%20index%20=%20themes.indexOf(theme);%20%09%09%09themes.splice(index,%201);%20%09%09%09setValue('customThemes',%20JSON.stringify(themes));%20%20%09%09%09if%20(theme%20===%20selectedTheme)%20%7B%20%09%09%09%09$$invalidate(1,%20selectedTheme%20=%20themes%5B0%5D);%20%09%09%09%09setValue('selectedTheme',%20'0');%20%09%09%09%09applyTheme();%20%09%09%09%7D%20%20%09%09%09$$invalidate(0,%20themes);%20//%20rerender%20%09%09%7D%20%20%09%09function%20input_change_handler()%20%7B%20%09%09%09themeEnabled%20=%20this.checked;%20%09%09%09$$invalidate(2,%20themeEnabled);%20%09%09%7D%20%20%09%09const%20click_handler%20=%20()%20=%3E%20$$invalidate(3,%20createOpen%20=%20true);%20%09%09const%20click_handler_1%20=%20theme%20=%3E%20deleteTheme(theme);%20%09%09const%20click_handler_2%20=%20theme%20=%3E%20setTheme(theme);%20%20%09%09return%20%5B%20%09%09%09themes,%20%09%09%09selectedTheme,%20%09%09%09themeEnabled,%20%09%09%09createOpen,%20%09%09%09transportType,%20%09%09%09updateEnabled,%20%09%09%09setTheme,%20%09%09%09onSubmit,%20%09%09%09deleteTheme,%20%09%09%09input_change_handler,%20%09%09%09click_handler,%20%09%09%09click_handler_1,%20%09%09%09click_handler_2%20%09%09%5D;%20%09%7D%20%20%09class%20CustomTheme%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$h,%20create_fragment$o,%20safe_not_equal,%20%7B%7D,%20add_css$6);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5C2d%5CPlayerHighlighter.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09const%20%7B%20window:%20window_1%20%7D%20=%20globals;%20%20%09function%20add_css$5(target)%20%7B%20%09%09append_styles(target,%20%22svelte-gt58ph%22,%20%22canvas.svelte-gt58ph%7Bposition:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;pointer-events:none%7D%22);%20%09%7D%20%20%09//%20(71:0)%20%3CGroup%20name=%22Player%20Highlighter%22%3E%20%09function%20create_default_slot$g(ctx)%20%7B%20%09%09let%20togglebutton0;%20%09%09let%20updating_enabled;%20%09%09let%20t;%20%09%09let%20togglebutton1;%20%09%09let%20updating_enabled_1;%20%09%09let%20current;%20%20%09%09function%20togglebutton0_enabled_binding(value)%20%7B%20%09%09%09/*togglebutton0_enabled_binding*/%20ctx%5B6%5D(value);%20%09%09%7D%20%20%09%09let%20togglebutton0_props%20=%20%7B%20%09%09%09onText:%20%22Stop%20highlighting%20teammates%22,%20%09%09%09offText:%20%22Highlight%20Teammates%22,%20%09%09%09hotkeyId:%20%22highlightTeammates%22%20%09%09%7D;%20%20%09%09if%20(/*highlightTeammates*/%20ctx%5B1%5D%20!==%20void%200)%20%7B%20%09%09%09togglebutton0_props.enabled%20=%20/*highlightTeammates*/%20ctx%5B1%5D;%20%09%09%7D%20%20%09%09togglebutton0%20=%20new%20ToggleButton(%7B%20props:%20togglebutton0_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(togglebutton0,%20'enabled',%20togglebutton0_enabled_binding));%20%09%09togglebutton0.$on(%22click%22,%20/*render*/%20ctx%5B4%5D);%20%20%09%09function%20togglebutton1_enabled_binding(value)%20%7B%20%09%09%09/*togglebutton1_enabled_binding*/%20ctx%5B7%5D(value);%20%09%09%7D%20%20%09%09let%20togglebutton1_props%20=%20%7B%20%09%09%09onText:%20%22Stop%20highlighting%20enemies%22,%20%09%09%09offText:%20%22Highlight%20Enemies%22,%20%09%09%09hotkeyId:%20%22highlightEnemies%22%20%09%09%7D;%20%20%09%09if%20(/*highlightEnemies*/%20ctx%5B2%5D%20!==%20void%200)%20%7B%20%09%09%09togglebutton1_props.enabled%20=%20/*highlightEnemies*/%20ctx%5B2%5D;%20%09%09%7D%20%20%09%09togglebutton1%20=%20new%20ToggleButton(%7B%20props:%20togglebutton1_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(togglebutton1,%20'enabled',%20togglebutton1_enabled_binding));%20%09%09togglebutton1.$on(%22click%22,%20/*render*/%20ctx%5B4%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton0.$$.fragment);%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(togglebutton1.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(togglebutton1,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20togglebutton0_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_enabled%20&&%20dirty%20&%20/*highlightTeammates*/%202)%20%7B%20%09%09%09%09%09updating_enabled%20=%20true;%20%09%09%09%09%09togglebutton0_changes.enabled%20=%20/*highlightTeammates*/%20ctx%5B1%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_enabled%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09togglebutton0.$set(togglebutton0_changes);%20%09%09%09%09const%20togglebutton1_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_enabled_1%20&&%20dirty%20&%20/*highlightEnemies*/%204)%20%7B%20%09%09%09%09%09updating_enabled_1%20=%20true;%20%09%09%09%09%09togglebutton1_changes.enabled%20=%20/*highlightEnemies*/%20ctx%5B2%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_enabled_1%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09togglebutton1.$set(togglebutton1_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton0.$$.fragment,%20local);%20%09%09%09%09transition_in(togglebutton1.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton0.$$.fragment,%20local);%20%09%09%09%09transition_out(togglebutton1.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(togglebutton0,%20detaching);%20%09%09%09%09destroy_component(togglebutton1,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$n(ctx)%20%7B%20%09%09let%20canvas_1;%20%09%09let%20t;%20%09%09let%20group;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Player%20Highlighter%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$g%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09canvas_1%20=%20element(%22canvas%22);%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%09attr(canvas_1,%20%22width%22,%20window.innerWidth);%20%09%09%09%09attr(canvas_1,%20%22height%22,%20window.innerHeight);%20%09%09%09%09attr(canvas_1,%20%22class%22,%20%22svelte-gt58ph%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20canvas_1,%20anchor);%20%09%09%09%09/*canvas_1_binding*/%20ctx%5B5%5D(canvas_1);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20listen(window_1,%20%22resize%22,%20/*onResize*/%20ctx%5B3%5D);%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20highlightEnemies,%20highlightTeammates*/%201030)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(canvas_1);%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09/*canvas_1_binding*/%20ctx%5B5%5D(null);%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09dispose();%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$g($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20ctx;%20%09%09let%20$playerId;%20%09%09component_subscribe($$self,%20playerId,%20$$value%20=%3E%20$$invalidate(9,%20$playerId%20=%20$$value));%20%09%09let%20canvas;%20%20%09%09function%20onResize()%20%7B%20%09%09%09$$invalidate(0,%20canvas.width%20=%20window.innerWidth,%20canvas);%20%09%09%09$$invalidate(0,%20canvas.height%20=%20window.innerHeight,%20canvas);%20%09%09%7D%20%20%09%09let%20highlightTeammates%20=%20false;%20%09%09let%20highlightEnemies%20=%20false;%20%20%09%09function%20render()%20%7B%20%09%09%09if%20(!serializer?.state?.characters%20%7C%7C%20!ctx)%20return;%20%09%09%09ctx.clearRect(0,%200,%20canvas.width,%20canvas.height);%20%09%09%09if%20(!highlightTeammates%20&&%20!highlightEnemies)%20return;%20%09%09%09let%20camera%20=%20getUnsafeWindow()?.stores?.phaser?.scene?.cameras?.cameras%5B0%5D;%20%09%09%09let%20player%20=%20serializer.state.characters.$items.get($playerId);%20%09%09%09if%20(!player%20%7C%7C%20!camera)%20return;%20%09%09%09let%20camX%20=%20camera.midPoint.x;%20%09%09%09let%20camY%20=%20camera.midPoint.y;%20%20%09%09%09for%20(let%20%5Bid,%20character%5D%20of%20serializer.state.characters.$items)%20%7B%20%09%09%09%09if%20(id%20===%20$playerId)%20continue;%20%09%09%09%09let%20isTeammate%20=%20player.teamId%20===%20character.teamId;%20%09%09%09%09if%20(isTeammate%20&&%20!highlightTeammates)%20continue;%20%09%09%09%09if%20(!isTeammate%20&&%20!highlightEnemies)%20continue;%20%20%09%09%09%09//%20get%20the%20angle%20between%20the%20player%20and%20the%20character%20%09%09%09%09let%20angle%20=%20Math.atan2(character.y%20-%20camY,%20character.x%20-%20camX);%20%20%09%09%09%09let%20distance%20=%20Math.sqrt(Math.pow(character.x%20-%20camX,%202)%20+%20Math.pow(character.y%20-%20camY,%202))%20*%20camera.zoom;%20%09%09%09%09let%20arrowDist%20=%20Math.min(250,%20distance);%20%09%09%09%09let%20arrowTipX%20=%20Math.cos(angle)%20*%20arrowDist%20+%20canvas.width%20/%202;%20%09%09%09%09let%20arrowTipY%20=%20Math.sin(angle)%20*%20arrowDist%20+%20canvas.height%20/%202;%20%09%09%09%09let%20leftAngle%20=%20angle%20+%20Math.PI%20/%204%20*%203;%20%09%09%09%09let%20rightAngle%20=%20angle%20-%20Math.PI%20/%204%20*%203;%20%20%09%09%09%09//%20draw%20an%20arrow%20pointing%20to%20the%20character%20%09%09%09%09ctx.beginPath();%20%20%09%09%09%09ctx.moveTo(arrowTipX,%20arrowTipY);%20%09%09%09%09ctx.lineTo(arrowTipX%20+%20Math.cos(leftAngle)%20*%2050,%20arrowTipY%20+%20Math.sin(leftAngle)%20*%2050);%20%09%09%09%09ctx.moveTo(arrowTipX,%20arrowTipY);%20%09%09%09%09ctx.lineTo(arrowTipX%20+%20Math.cos(rightAngle)%20*%2050,%20arrowTipY%20+%20Math.sin(rightAngle)%20*%2050);%20%09%09%09%09ctx.lineWidth%20=%203;%20%09%09%09%09ctx.strokeStyle%20=%20isTeammate%20?%20%22green%22%20:%20%22red%22;%20%09%09%09%09ctx.stroke();%20%20%09%09%09%09//%20draw%20the%20character's%20name%20and%20distance%20%09%09%09%09ctx.fillStyle%20=%20%22black%22;%20%20%09%09%09%09ctx.font%20=%20%2220px%20Verdana%22;%20%09%09%09%09ctx.textAlign%20=%20%22center%22;%20%09%09%09%09ctx.textBaseline%20=%20%22middle%22;%20%09%09%09%09ctx.fillText(%60$%7Bcharacter.name%7D%20($%7BMath.floor(distance)%7D)%60,%20arrowTipX,%20arrowTipY);%20%09%09%09%7D%20%09%09%7D%20%20%09%09onMount(()%20=%3E%20%7B%20%09%09%09document.body.appendChild(canvas);%20%09%09%7D);%20%20%09%09setInterval(render,%201000%20/%2030);%20%20%09%09function%20canvas_1_binding($$value)%20%7B%20%09%09%09binding_callbacks%5B$$value%20?%20'unshift'%20:%20'push'%5D(()%20=%3E%20%7B%20%09%09%09%09canvas%20=%20$$value;%20%09%09%09%09$$invalidate(0,%20canvas);%20%09%09%09%7D);%20%09%09%7D%20%20%09%09function%20togglebutton0_enabled_binding(value)%20%7B%20%09%09%09highlightTeammates%20=%20value;%20%09%09%09$$invalidate(1,%20highlightTeammates);%20%09%09%7D%20%20%09%09function%20togglebutton1_enabled_binding(value)%20%7B%20%09%09%09highlightEnemies%20=%20value;%20%09%09%09$$invalidate(2,%20highlightEnemies);%20%09%09%7D%20%20%09%09$$self.$$.update%20=%20()%20=%3E%20%7B%20%09%09%09if%20($$self.$$.dirty%20&%20/*canvas*/%201)%20%7B%20%09%09%09%09ctx%20=%20canvas?.getContext(%222d%22);%20%09%09%09%7D%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09canvas,%20%09%09%09highlightTeammates,%20%09%09%09highlightEnemies,%20%09%09%09onResize,%20%09%09%09render,%20%09%09%09canvas_1_binding,%20%09%09%09togglebutton0_enabled_binding,%20%09%09%09togglebutton1_enabled_binding%20%09%09%5D;%20%09%7D%20%20%09class%20PlayerHighlighter%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$g,%20create_fragment$n,%20safe_not_equal,%20%7B%7D,%20add_css$5);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Chud%5Ccomponents%5CSlider.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$4(target)%20%7B%20%09%09append_styles(target,%20%22svelte-vkb13i%22,%20%22.sliderWrap.svelte-vkb13i%7Bdisplay:flex;flex-direction:column;align-items:center;margin:5px%2010px%7D.sliderWrap.disabled.svelte-vkb13i%7Bopacity:0.5%7Dinput.svelte-vkb13i%7Bflex-grow:1;width:100%25%7Dinput%5Bdisabled%5D.svelte-vkb13i%7Bcursor:not-allowed%7D%22);%20%09%7D%20%20%09function%20create_fragment$m(ctx)%20%7B%20%09%09let%20div1;%20%09%09let%20div0;%20%09%09let%20t0;%20%09%09let%20t1;%20%09%09let%20input_1;%20%09%09let%20input_1_title_value;%20%09%09let%20input_1_disabled_value;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div1%20=%20element(%22div%22);%20%09%09%09%09div0%20=%20element(%22div%22);%20%09%09%09%09t0%20=%20text(/*title*/%20ctx%5B1%5D);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09input_1%20=%20element(%22input%22);%20%09%09%09%09attr(input_1,%20%22type%22,%20%22range%22);%20%09%09%09%09attr(input_1,%20%22min%22,%20/*min*/%20ctx%5B2%5D);%20%09%09%09%09attr(input_1,%20%22max%22,%20/*max*/%20ctx%5B3%5D);%20%09%09%09%09attr(input_1,%20%22step%22,%20/*step*/%20ctx%5B4%5D);%20%09%09%09%09attr(input_1,%20%22title%22,%20input_1_title_value%20=%20/*disabled*/%20ctx%5B5%5D%20?%20/*disabledMsg*/%20ctx%5B6%5D%20:%20undefined);%20%09%09%09%09input_1.disabled%20=%20input_1_disabled_value%20=%20/*disabled*/%20ctx%5B5%5D%20===%20true%20%7C%7C%20/*disabled*/%20ctx%5B5%5D%20===%20undefined;%20%09%09%09%09attr(input_1,%20%22class%22,%20%22svelte-vkb13i%22);%20%09%09%09%09attr(div1,%20%22class%22,%20%22sliderWrap%20svelte-vkb13i%22);%20%09%09%09%09toggle_class(div1,%20%22disabled%22,%20/*disabled*/%20ctx%5B5%5D%20===%20true%20%7C%7C%20/*disabled*/%20ctx%5B5%5D%20===%20undefined);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div1,%20anchor);%20%09%09%09%09append(div1,%20div0);%20%09%09%09%09append(div0,%20t0);%20%09%09%09%09append(div1,%20t1);%20%09%09%09%09append(div1,%20input_1);%20%09%09%09%09set_input_value(input_1,%20/*value*/%20ctx%5B0%5D);%20%09%09%09%09/*input_1_binding*/%20ctx%5B12%5D(input_1);%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(input_1,%20%22change%22,%20/*input_1_change_input_handler*/%20ctx%5B11%5D),%20%09%09%09%09%09%09listen(input_1,%20%22input%22,%20/*input_1_change_input_handler*/%20ctx%5B11%5D),%20%09%09%09%09%09%09listen(input_1,%20%22mousedown%22,%20stop_propagation(/*mousedown_handler*/%20ctx%5B9%5D)),%20%09%09%09%09%09%09listen(input_1,%20%22keydown%22,%20prevent_default(/*keydown_handler*/%20ctx%5B10%5D)),%20%09%09%09%09%09%09listen(input_1,%20%22input%22,%20/*onInput*/%20ctx%5B8%5D)%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*title*/%202)%20set_data(t0,%20/*title*/%20ctx%5B1%5D);%20%20%09%09%09%09if%20(dirty%20&%20/*min*/%204)%20%7B%20%09%09%09%09%09attr(input_1,%20%22min%22,%20/*min*/%20ctx%5B2%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*max*/%208)%20%7B%20%09%09%09%09%09attr(input_1,%20%22max%22,%20/*max*/%20ctx%5B3%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*step*/%2016)%20%7B%20%09%09%09%09%09attr(input_1,%20%22step%22,%20/*step*/%20ctx%5B4%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*disabled,%20disabledMsg*/%2096%20&&%20input_1_title_value%20!==%20(input_1_title_value%20=%20/*disabled*/%20ctx%5B5%5D%20?%20/*disabledMsg*/%20ctx%5B6%5D%20:%20undefined))%20%7B%20%09%09%09%09%09attr(input_1,%20%22title%22,%20input_1_title_value);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*disabled*/%2032%20&&%20input_1_disabled_value%20!==%20(input_1_disabled_value%20=%20/*disabled*/%20ctx%5B5%5D%20===%20true%20%7C%7C%20/*disabled*/%20ctx%5B5%5D%20===%20undefined))%20%7B%20%09%09%09%09%09input_1.disabled%20=%20input_1_disabled_value;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*value*/%201)%20%7B%20%09%09%09%09%09set_input_value(input_1,%20/*value*/%20ctx%5B0%5D);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(dirty%20&%20/*disabled,%20undefined*/%2032)%20%7B%20%09%09%09%09%09toggle_class(div1,%20%22disabled%22,%20/*disabled*/%20ctx%5B5%5D%20===%20true%20%7C%7C%20/*disabled*/%20ctx%5B5%5D%20===%20undefined);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i:%20noop,%20%09%09%09o:%20noop,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div1);%20%09%09%09%09%7D%20%20%09%09%09%09/*input_1_binding*/%20ctx%5B12%5D(null);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$f($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20%7B%20title%20%7D%20=%20$$props;%20%09%09let%20%7B%20min%20%7D%20=%20$$props;%20%09%09let%20%7B%20max%20%7D%20=%20$$props;%20%09%09let%20%7B%20value%20=%20(min%20+%20max)%20/%202%20%7D%20=%20$$props;%20%09%09let%20%7B%20step%20=%201%20%7D%20=%20$$props;%20%09%09let%20%7B%20disabled%20=%20null%20%7D%20=%20$$props;%20%09%09let%20%7B%20disabledMsg%20=%20undefined%20%7D%20=%20$$props;%20%09%09let%20dispatch%20=%20createEventDispatcher();%20%09%09let%20input;%20%20%09%09function%20onInput()%20%7B%20%09%09%09dispatch(%22input%22,%20parseFloat(input.value));%20%09%09%7D%20%20%09%09function%20mousedown_handler(event)%20%7B%20%09%09%09bubble.call(this,%20$$self,%20event);%20%09%09%7D%20%20%09%09function%20keydown_handler(event)%20%7B%20%09%09%09bubble.call(this,%20$$self,%20event);%20%09%09%7D%20%20%09%09function%20input_1_change_input_handler()%20%7B%20%09%09%09value%20=%20to_number(this.value);%20%09%09%09$$invalidate(0,%20value);%20%09%09%7D%20%20%09%09function%20input_1_binding($$value)%20%7B%20%09%09%09binding_callbacks%5B$$value%20?%20'unshift'%20:%20'push'%5D(()%20=%3E%20%7B%20%09%09%09%09input%20=%20$$value;%20%09%09%09%09$$invalidate(7,%20input);%20%09%09%09%7D);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('title'%20in%20$$props)%20$$invalidate(1,%20title%20=%20$$props.title);%20%09%09%09if%20('min'%20in%20$$props)%20$$invalidate(2,%20min%20=%20$$props.min);%20%09%09%09if%20('max'%20in%20$$props)%20$$invalidate(3,%20max%20=%20$$props.max);%20%09%09%09if%20('value'%20in%20$$props)%20$$invalidate(0,%20value%20=%20$$props.value);%20%09%09%09if%20('step'%20in%20$$props)%20$$invalidate(4,%20step%20=%20$$props.step);%20%09%09%09if%20('disabled'%20in%20$$props)%20$$invalidate(5,%20disabled%20=%20$$props.disabled);%20%09%09%09if%20('disabledMsg'%20in%20$$props)%20$$invalidate(6,%20disabledMsg%20=%20$$props.disabledMsg);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09value,%20%09%09%09title,%20%09%09%09min,%20%09%09%09max,%20%09%09%09step,%20%09%09%09disabled,%20%09%09%09disabledMsg,%20%09%09%09input,%20%09%09%09onInput,%20%09%09%09mousedown_handler,%20%09%09%09keydown_handler,%20%09%09%09input_1_change_input_handler,%20%09%09%09input_1_binding%20%09%09%5D;%20%09%7D%20%20%09class%20Slider%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%20%09%09%09init(%20%09%09%09%09this,%20%09%09%09%09options,%20%09%09%09%09instance$f,%20%09%09%09%09create_fragment$m,%20%09%09%09%09safe_not_equal,%20%09%09%09%09%7B%20%09%09%09%09%09title:%201,%20%09%09%09%09%09min:%202,%20%09%09%09%09%09max:%203,%20%09%09%09%09%09value:%200,%20%09%09%09%09%09step:%204,%20%09%09%09%09%09disabled:%205,%20%09%09%09%09%09disabledMsg:%206%20%09%09%09%09%7D,%20%09%09%09%09add_css$4%20%09%09%09);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5C2d%5CFreecam.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$3(target)%20%7B%20%09%09append_styles(target,%20%22svelte-oqtmhy%22,%20%22select.svelte-oqtmhy%7Bwidth:calc(100%25%20-%2010px);padding:5px;margin-left:5px;margin-right:5px;color:black%7Dselect%5Bdisabled%5D.svelte-oqtmhy%7Bcursor:not-allowed%7D%22);%20%09%7D%20%20%09function%20get_each_context$1(ctx,%20list,%20i)%20%7B%20%09%09const%20child_ctx%20=%20ctx.slice();%20%09%09child_ctx%5B20%5D%20=%20list%5Bi%5D;%20%09%09return%20child_ctx;%20%09%7D%20%20%09//%20(133:8)%20%7B:else%7D%20%09function%20create_else_block$1(ctx)%20%7B%20%09%09let%20t0_value%20=%20(/*freecamming*/%20ctx%5B1%5D%20?%20%22Stop%22%20:%20%22Start%22)%20+%20%22%22;%20%09%09let%20t0;%20%09%09let%20t1;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t0%20=%20text(t0_value);%20%09%09%09%09t1%20=%20text(%22%20Freecam%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*freecamming*/%202%20&&%20t0_value%20!==%20(t0_value%20=%20(/*freecamming*/%20ctx%5B1%5D%20?%20%22Stop%22%20:%20%22Start%22)%20+%20%22%22))%20set_data(t0,%20t0_value);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(131:8)%20%7B%23if%20spectating%7D%20%09function%20create_if_block$2(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Stop%20Spectating%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(129:4)%20%3CButton%20disabled=%7B!$storesLoaded%7D%20disabledMsg=%22Camera%20hasn't%20loaded%22%20%20%20%20%20%20on:click=%7BonBtnClick%7D%3E%20%09function%20create_default_slot_1$3(ctx)%20%7B%20%09%09let%20if_block_anchor;%20%20%09%09function%20select_block_type(ctx,%20dirty)%20%7B%20%09%09%09if%20(/*spectating*/%20ctx%5B4%5D)%20return%20create_if_block$2;%20%09%09%09return%20create_else_block$1;%20%09%09%7D%20%20%09%09let%20current_block_type%20=%20select_block_type(ctx);%20%09%09let%20if_block%20=%20current_block_type(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09if_block.c();%20%09%09%09%09if_block_anchor%20=%20empty();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09if_block.m(target,%20anchor);%20%09%09%09%09insert(target,%20if_block_anchor,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(current_block_type%20===%20(current_block_type%20=%20select_block_type(ctx))%20&&%20if_block)%20%7B%20%09%09%09%09%09if_block.p(ctx,%20dirty);%20%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09if_block.d(1);%20%09%09%09%09%09if_block%20=%20current_block_type(ctx);%20%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09if_block.m(if_block_anchor.parentNode,%20if_block_anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(if_block_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09if_block.d(detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(143:8)%20%7B%23each%20specCharacters%20as%20char%7D%20%09function%20create_each_block$1(ctx)%20%7B%20%09%09let%20option;%20%09%09let%20t_value%20=%20/*char*/%20ctx%5B20%5D.name%20+%20%22%22;%20%09%09let%20t;%20%09%09let%20option_value_value;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09option%20=%20element(%22option%22);%20%09%09%09%09t%20=%20text(t_value);%20%09%09%09%09option.__value%20=%20option_value_value%20=%20/*char*/%20ctx%5B20%5D.id;%20%09%09%09%09set_input_value(option,%20option.__value);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20option,%20anchor);%20%09%09%09%09append(option,%20t);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*specCharacters*/%208%20&&%20t_value%20!==%20(t_value%20=%20/*char*/%20ctx%5B20%5D.name%20+%20%22%22))%20set_data(t,%20t_value);%20%20%09%09%09%09if%20(dirty%20&%20/*specCharacters*/%208%20&&%20option_value_value%20!==%20(option_value_value%20=%20/*char*/%20ctx%5B20%5D.id))%20%7B%20%09%09%09%09%09option.__value%20=%20option_value_value;%20%09%09%09%09%09set_input_value(option,%20option.__value);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(option);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(128:0)%20%3CGroup%20name=%22Freecam%22%3E%20%09function%20create_default_slot$f(ctx)%20%7B%20%09%09let%20button;%20%09%09let%20t0;%20%09%09let%20slider;%20%09%09let%20t1;%20%09%09let%20select_1;%20%09%09let%20option;%20%09%09let%20select_1_disabled_value;%20%09%09let%20select_1_title_value;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09disabled:%20!/*$storesLoaded*/%20ctx%5B5%5D,%20%09%09%09%09%09disabledMsg:%20%22Camera%20hasn't%20loaded%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_1$3%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20/*onBtnClick*/%20ctx%5B9%5D);%20%20%09%09slider%20=%20new%20Slider(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09title:%20%22Camera%20Zoom%22,%20%09%09%09%09%09min:%200.1,%20%09%09%09%09%09max:%205,%20%09%09%09%09%09step:%200.1,%20%09%09%09%09%09disabled:%20!/*$storesLoaded*/%20ctx%5B5%5D,%20%09%09%09%09%09value:%20/*zoomValue*/%20ctx%5B2%5D,%20%09%09%09%09%09disabledMsg:%20%22Camera%20hasn't%20loaded%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09slider.$on(%22input%22,%20/*setZoom*/%20ctx%5B8%5D);%20%09%09let%20each_value%20=%20ensure_array_like(/*specCharacters*/%20ctx%5B3%5D);%20%09%09let%20each_blocks%20=%20%5B%5D;%20%20%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20create_each_block$1(get_each_context$1(ctx,%20each_value,%20i));%20%09%09%7D%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(slider.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09select_1%20=%20element(%22select%22);%20%09%09%09%09option%20=%20element(%22option%22);%20%09%09%09%09option.textContent%20=%20%22Pick%20a%20player%20to%20spectate%22;%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%7D%20%20%09%09%09%09option.__value%20=%20%22%22;%20%09%09%09%09set_input_value(option,%20option.__value);%20%09%09%09%09option.selected%20=%20true;%20%09%09%09%09select_1.disabled%20=%20select_1_disabled_value%20=%20/*specCharacters*/%20ctx%5B3%5D.length%20===%200;%20%20%09%09%09%09attr(select_1,%20%22title%22,%20select_1_title_value%20=%20/*specCharacters*/%20ctx%5B3%5D.length%20===%200%20%09%09%09%09?%20%22No%20characters%20to%20spectate%22%20%09%09%09%09:%20undefined);%20%20%09%09%09%09attr(select_1,%20%22class%22,%20%22svelte-oqtmhy%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(slider,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09insert(target,%20select_1,%20anchor);%20%09%09%09%09append(select_1,%20option);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.m(select_1,%20null);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09/*select_1_binding*/%20ctx%5B12%5D(select_1);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(select_1,%20%22change%22,%20/*selectPlayer*/%20ctx%5B10%5D),%20%09%09%09%09%09%09listen(select_1,%20%22keydown%22,%20prevent_default(/*keydown_handler*/%20ctx%5B11%5D))%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*$storesLoaded*/%2032)%20button_changes.disabled%20=%20!/*$storesLoaded*/%20ctx%5B5%5D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20spectating,%20freecamming*/%208388626)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%09const%20slider_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*$storesLoaded*/%2032)%20slider_changes.disabled%20=%20!/*$storesLoaded*/%20ctx%5B5%5D;%20%09%09%09%09if%20(dirty%20&%20/*zoomValue*/%204)%20slider_changes.value%20=%20/*zoomValue*/%20ctx%5B2%5D;%20%09%09%09%09slider.$set(slider_changes);%20%20%09%09%09%09if%20(dirty%20&%20/*specCharacters*/%208)%20%7B%20%09%09%09%09%09each_value%20=%20ensure_array_like(/*specCharacters*/%20ctx%5B3%5D);%20%09%09%09%09%09let%20i;%20%20%09%09%09%09%09for%20(i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09const%20child_ctx%20=%20get_each_context$1(ctx,%20each_value,%20i);%20%20%09%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.p(child_ctx,%20dirty);%20%09%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D%20=%20create_each_block$1(child_ctx);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.m(select_1,%20null);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%20%09%09%09%09%09for%20(;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.d(1);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09each_blocks.length%20=%20each_value.length;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*specCharacters*/%208%20&&%20select_1_disabled_value%20!==%20(select_1_disabled_value%20=%20/*specCharacters*/%20ctx%5B3%5D.length%20===%200))%20%7B%20%09%09%09%09%09select_1.disabled%20=%20select_1_disabled_value;%20%09%09%09%09%7D%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*specCharacters*/%208%20&&%20select_1_title_value%20!==%20(select_1_title_value%20=%20/*specCharacters*/%20ctx%5B3%5D.length%20===%200%20%09%09%09%09?%20%22No%20characters%20to%20spectate%22%20%09%09%09%09:%20undefined))%20%7B%20%09%09%09%09%09attr(select_1,%20%22title%22,%20select_1_title_value);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09transition_in(slider.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09transition_out(slider.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(select_1);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%09destroy_component(slider,%20detaching);%20%09%09%09%09destroy_each(each_blocks,%20detaching);%20%09%09%09%09/*select_1_binding*/%20ctx%5B12%5D(null);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$l(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%09%09let%20mounted;%20%09%09let%20dispose;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Freecam%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$f%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%20%09%09%09%09if%20(!mounted)%20%7B%20%09%09%09%09%09dispose%20=%20%5B%20%09%09%09%09%09%09listen(window,%20%22keydown%22,%20/*onKeydown*/%20ctx%5B6%5D),%20%09%09%09%09%09%09listen(window,%20%22keyup%22,%20/*onKeyup*/%20ctx%5B7%5D)%20%09%09%09%09%09%5D;%20%20%09%09%09%09%09mounted%20=%20true;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20specCharacters,%20select,%20$storesLoaded,%20zoomValue,%20spectating,%20freecamming*/%208388671)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%09mounted%20=%20false;%20%09%09%09%09run_all(dispose);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$e($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20$playerId;%20%09%09let%20$storesLoaded;%20%09%09component_subscribe($$self,%20playerId,%20$$value%20=%3E%20$$invalidate(15,%20$playerId%20=%20$$value));%20%09%09component_subscribe($$self,%20storesLoaded,%20$$value%20=%3E%20$$invalidate(5,%20$storesLoaded%20=%20$$value));%20%09%09let%20keys%20=%20new%20Set();%20%09%09let%20select;%20%09%09let%20freecamming%20=%20false;%20%20%09%09function%20onKeydown(event)%20%7B%20%09%09%09if%20(!event.key.startsWith(%22Arrow%22))%20return;%20%20%09%09%09//%20Prevent%20arrow%20keys%20from%20moving%20the%20character%20%09%09%09if%20(freecamming)%20%7B%20%09%09%09%09event.stopImmediatePropagation();%20%09%09%09%7D%20%20%09%09%09keys.add(event.key);%20%09%09%7D%20%20%09%09function%20onKeyup(event)%20%7B%20%09%09%09keys.delete(event.key);%20%09%09%7D%20%20%09%09let%20freecamPos%20=%20%7B%20x:%200,%20y:%200%20%7D;%20%09%09let%20freecamUpdateInterval;%20%09%09let%20zoomValue%20=%201;%20%20%09%09function%20startFreecam()%20%7B%20%09%09%09let%20scene%20=%20getUnsafeWindow().stores.phaser.scene;%20%09%09%09let%20camera%20=%20scene.cameras.cameras%5B0%5D;%20%09%09%09scene.cameraHelper.stopFollow();%20%20%09%09%09freecamPos%20=%20%7B%20%09%09%09%09x:%20camera.midPoint.x,%20%09%09%09%09y:%20camera.midPoint.y%20%09%09%09%7D;%20%20%09%09%09camera.useBounds%20=%20false;%20%20%09%09%09freecamUpdateInterval%20=%20setInterval(%20%09%09%09%09()%20=%3E%20%7B%20%09%09%09%09%09let%20freecamSpeed%20=%2020%20/%20zoomValue%20*%201.75;%20%09%09%09%09%09if%20(keys.has(%22ArrowUp%22))%20freecamPos.y%20-=%20freecamSpeed;%20%09%09%09%09%09if%20(keys.has(%22ArrowDown%22))%20freecamPos.y%20+=%20freecamSpeed;%20%09%09%09%09%09if%20(keys.has(%22ArrowLeft%22))%20freecamPos.x%20-=%20freecamSpeed;%20%09%09%09%09%09if%20(keys.has(%22ArrowRight%22))%20freecamPos.x%20+=%20freecamSpeed;%20%09%09%09%09%09scene.cameraHelper.goTo(freecamPos);%20%09%09%09%09%7D,%20%09%09%09%091000%20/%2030%20%09%09%09);%20%09%09%7D%20%20%09%09function%20stopFreecam()%20%7B%20%09%09%09let%20phaser%20=%20getUnsafeWindow().stores.phaser;%20%09%09%09let%20charObj%20=%20phaser.scene.characterManager.characters.get(phaser.mainCharacter.id).body;%20%09%09%09phaser.scene.cameraHelper.startFollowingObject(%7B%20object:%20charObj%20%7D);%20%09%09%09phaser.scene.cameras.cameras%5B0%5D.useBounds%20=%20true;%20%09%09%09clearInterval(freecamUpdateInterval);%20%09%09%7D%20%20%09%09storesLoaded.subscribe(loaded%20=%3E%20%7B%20%09%09%09if%20(!loaded)%20return;%20%20%09%09%09let%20getZoomInterval%20=%20setInterval(%20%09%09%09%09()%20=%3E%20%7B%20%09%09%09%09%09let%20zoom%20=%20getUnsafeWindow()?.stores?.phaser?.scene?.cameras?.cameras%5B0%5D?.zoom;%20%20%09%09%09%09%09if%20(zoom)%20%7B%20%09%09%09%09%09%09$$invalidate(2,%20zoomValue%20=%20zoom);%20%09%09%09%09%09%09clearInterval(getZoomInterval);%20%09%09%09%09%09%7D%20%09%09%09%09%7D,%20%09%09%09%0950%20%09%09%09);%20%09%09%7D);%20%20%09%09function%20setZoom(event)%20%7B%20%09%09%09$$invalidate(2,%20zoomValue%20=%20event.detail);%20%09%09%09getUnsafeWindow().stores.phaser.scene.cameras.cameras%5B0%5D.setZoom(event.detail);%20%09%09%7D%20%20%09%09let%20specCharacters%20=%20%5B%5D;%20%09%09let%20unbinds%20=%20%5B%5D;%20%20%09%09playerId.subscribe(id%20=%3E%20%7B%20%09%09%09$$invalidate(3,%20specCharacters%20=%20specCharacters.filter(char%20=%3E%20char.id%20!==%20id));%20%09%09%7D);%20%20%09%09serializer.addEventListener(%22load%22,%20()%20=%3E%20%7B%20%09%09%09const%20reloadCharacters%20=%20()%20=%3E%20%7B%20%09%09%09%09$$invalidate(3,%20specCharacters%20=%20%5B%5D);%20%09%09%09%09for%20(let%20unbind%20of%20unbinds)%20unbind();%20%20%09%09%09%09for%20(let%20%5Bid,%20char%5D%20of%20serializer.state.characters.$items)%20%7B%20%09%09%09%09%09if%20(!char.isActive%20%7C%7C%20id%20===%20$playerId)%20continue;%20%09%09%09%09%09specCharacters.push(%7B%20id,%20name:%20char.name%20%7D);%20%20%09%09%09%09%09let%20unbind%20=%20char.listen(%22isActive%22,%20(_,%20prevVal)%20=%3E%20%7B%20%09%09%09%09%09%09if%20(prevVal%20===%20undefined)%20return;%20%09%09%09%09%09%09reloadCharacters();%20%09%09%09%09%09%7D);%20%20%09%09%09%09%09unbinds.push(unbind);%20%09%09%09%09%7D%20%09%09%09%7D;%20%20%09%09%09serializer.state.characters.onChange(reloadCharacters);%20%09%09%09reloadCharacters();%20%09%09%7D);%20%20%09%09let%20spectating%20=%20false;%20%20%09%09function%20onBtnClick()%20%7B%20%09%09%09if%20(spectating)%20%7B%20%09%09%09%09$$invalidate(4,%20spectating%20=%20false);%20%09%09%09%09stopFreecam();%20%09%09%09%09$$invalidate(0,%20select.value%20=%20%22%22,%20select);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09$$invalidate(1,%20freecamming%20=%20!freecamming);%20%09%09%09%09if%20(freecamming)%20startFreecam();%20else%20stopFreecam();%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20selectPlayer()%20%7B%20%09%09%09if%20(!select.value)%20return;%20%09%09%09$$invalidate(4,%20spectating%20=%20true);%20%09%09%09$$invalidate(1,%20freecamming%20=%20false);%20%09%09%09stopFreecam();%20%09%09%09let%20char%20=%20getUnsafeWindow().stores.phaser.scene.characterManager.characters.get(select.value);%20%09%09%09if%20(!char)%20return;%20%09%09%09let%20camHelper%20=%20getUnsafeWindow().stores.phaser.scene.cameraHelper;%20%09%09%09camHelper.startFollowingObject(%7B%20object:%20char.body%20%7D);%20%09%09%7D%20%20%09%09function%20keydown_handler(event)%20%7B%20%09%09%09bubble.call(this,%20$$self,%20event);%20%09%09%7D%20%20%09%09function%20select_1_binding($$value)%20%7B%20%09%09%09binding_callbacks%5B$$value%20?%20'unshift'%20:%20'push'%5D(()%20=%3E%20%7B%20%09%09%09%09select%20=%20$$value;%20%09%09%09%09$$invalidate(0,%20select);%20%09%09%09%09$$invalidate(3,%20specCharacters);%20%09%09%09%7D);%20%09%09%7D%20%20%09%09return%20%5B%20%09%09%09select,%20%09%09%09freecamming,%20%09%09%09zoomValue,%20%09%09%09specCharacters,%20%09%09%09spectating,%20%09%09%09$storesLoaded,%20%09%09%09onKeydown,%20%09%09%09onKeyup,%20%09%09%09setZoom,%20%09%09%09onBtnClick,%20%09%09%09selectPlayer,%20%09%09%09keydown_handler,%20%09%09%09select_1_binding%20%09%09%5D;%20%09%7D%20%20%09class%20Freecam%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$e,%20create_fragment$l,%20safe_not_equal,%20%7B%7D,%20add_css$3);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5C2d%5CHideEnergyPopup.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_fragment$k(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20current;%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09onText:%20%22Show%20Energy%20Popup%22,%20%09%09%09%09%09offText:%20%22Hide%20Energy%20Popup%22,%20%09%09%09%09%09hotkeyId:%20%22toggleEnergyPopup%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09togglebutton.$on(%22click%22,%20/*toggleEnergyPopup*/%20ctx%5B0%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$d($$self)%20%7B%20%09%09let%20popupEl;%20%09%09let%20hiding%20=%20false;%20%20%09%09let%20observer%20=%20new%20MutationObserver(mutations%20=%3E%20%7B%20%09%09%09%09for%20(let%20mutation%20of%20mutations)%20%7B%20%09%09%09%09%09for%20(let%20node%20of%20mutation.addedNodes)%20%7B%20%09%09%09%09%09%09if%20(node.nodeType%20!=%20Node.ELEMENT_NODE)%20continue;%20%20%09%09%09%09%09%09//%20check%20that%20the%20element%20is%20the%20energy%20popup%20%09%09%09%09%09%09if%20(node.matches(%22.maxAll.flex.hc%22)%20&&%20node.querySelector(%22img%5Bsrc%5E='/assets/map/inventory/resources/'%5D%22))%20%7B%20%09%09%09%09%09%09%09popupEl%20=%20node;%20%09%09%09%09%09%09%09if%20(hiding)%20popupEl.style.display%20=%20%22none%22;%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09const%20attach%20=%20()%20=%3E%20%7B%20%09%09%09observer.observe(document.body,%20%7B%20childList:%20true,%20subtree:%20true%20%7D);%20%09%09%7D;%20%20%09%09if%20(document.body)%20attach();%20else%20window.addEventListener(%22DOMContentLoaded%22,%20attach);%20%20%09%09function%20toggleEnergyPopup(event)%20%7B%20%09%09%09hiding%20=%20event.detail;%20%09%09%09if%20(!popupEl)%20return;%20%09%09%09popupEl.style.display%20=%20hiding%20?%20%22none%22%20:%20%22%22;%20%09%09%7D%20%20%09%09return%20%5BtoggleEnergyPopup%5D;%20%09%7D%20%20%09class%20HideEnergyPopup%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$d,%20create_fragment$k,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Cclassic%5CAutoPurchase.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$e(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20current;%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09onText:%20%22Stop%20auto%20purchasing%22,%20%09%09%09%09%09offText:%20%22Auto%20Purchase%20Upgrades%22,%20%09%09%09%09%09hotkeyId:%20%22classicAutoPurchase%22,%20%09%09%09%09%09disabled:%20/*money*/%20ctx%5B0%5D%20==%20null,%20%09%09%09%09%09disabledMsg:%20%22Money%20hasn't%20loaded%20yet%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09togglebutton.$on(%22click%22,%20/*onClick*/%20ctx%5B1%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*money*/%201)%20togglebutton_changes.disabled%20=%20/*money*/%20ctx%5B0%5D%20==%20null;%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$j(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Classic%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$e%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20money*/%20257)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$c($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09const%20upgradesToGet%20=%20%5B%20%09%09%09%5B%22Streak%20Bonus%22,%202,%2020%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%203,%20100%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%203,%20200%5D,%20%09%09%09%5B%22Multiplier%22,%203,%20300%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%204,%202e3%5D,%20%09%09%09%5B%22Multiplier%22,%204,%202e3%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%205,%201e4%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%205,%202e4%5D,%20%09%09%09%5B%22Multiplier%22,%205,%2012e3%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%206,%2075e3%5D,%20%09%09%09%5B%22Multiplier%22,%206,%2085e3%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%206,%202e5%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%207,%202e6%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%208,%202e7%5D,%20%09%09%09%5B%22Multiplier%22,%207,%207e5%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%209,%201e7%5D,%20%09%09%09%5B%22Multiplier%22,%208,%2065e5%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%209,%202e8%5D,%20%09%09%09%5B%22Multiplier%22,%209,%2065e6%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%2010,%202e9%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%2010,%201e8%5D,%20%09%09%09%5B%22Multiplier%22,%2010,%201e9%5D%20%09%09%5D;%20%20%09%09var%20UpgradeType;%20%20%09%09(function%20(UpgradeType)%20%7B%20%09%09%09UpgradeType%5B%22Insurance%22%5D%20=%20%22insurance%22;%20%09%09%09UpgradeType%5B%22Money%20Per%20Question%22%5D%20=%20%22moneyPerQuestion%22;%20%09%09%09UpgradeType%5B%22Multiplier%22%5D%20=%20%22multiplier%22;%20%09%09%09UpgradeType%5B%22Streak%20Bonus%22%5D%20=%20%22streakBonus%22;%20%09%09%7D)(UpgradeType%20%7C%7C%20(UpgradeType%20=%20%7B%7D));%20%20%09%09let%20money%20=%20null;%20%09%09let%20upgradeLevels%20=%20%7B%7D;%20%09%09let%20autoBuy%20=%20false;%20%20%09%09socketManager.addEventListener(%22blueboatMessage%22,%20e%20=%3E%20%7B%20%09%09%09if%20(e.detail.data?.type%20==%20%22UPGRADE_LEVELS%22)%20%7B%20%09%09%09%09upgradeLevels%20=%20e.detail.data.value;%20%20%09%09%09%09//%20delete%20any%20upgrades%20that%20we%20already%20have%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20upgradesToGet.length;%20i++)%20%7B%20%09%09%09%09%09let%20upgrade%20=%20upgradesToGet%5Bi%5D;%20%20%09%09%09%09%09//%20check%20if%20we%20have%20the%20upgrade%20%09%09%09%09%09let%20upgradeAmount%20=%20upgradeLevels%5BUpgradeType%5Bupgrade%5B0%5D%5D%5D;%20%20%09%09%09%09%09if%20(upgradeAmount%20%3E=%20upgrade%5B1%5D)%20%7B%20%09%09%09%09%09%09upgradesToGet.splice(i,%201);%20%09%09%09%09%09%09i--;%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D%20%20%09%09%09if%20(e.detail.data?.type%20==%20%22BALANCE%22)%20%7B%20%09%09%09%09$$invalidate(0,%20money%20=%20e.detail.data.value);%20%09%09%09%09checkAutoBuy();%20%09%09%09%7D%20%09%09%7D);%20%20%09%09function%20checkAutoBuy()%20%7B%20%09%09%09if%20(!autoBuy)%20return;%20%09%09%09let%20upgrade%20=%20upgradesToGet%5B0%5D;%20%09%09%09if%20(!upgrade)%20return;%20%20%09%09%09if%20(money%20%3E=%20upgrade%5B2%5D)%20%7B%20%09%09%09%09purchaseUpgrade(upgrade%5B0%5D,%20upgrade%5B1%5D);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20purchaseUpgrade(name,%20level)%20%7B%20%09%09%09socketManager.sendMessage(%22UPGRADE_PURCHASED%22,%20%7B%20upgradeName:%20name,%20level%20%7D);%20%09%09%7D%20%20%09%09function%20onClick(message)%20%7B%20%09%09%09if%20(message.detail)%20%7B%20%09%09%09%09autoBuy%20=%20true;%20%09%09%09%09checkAutoBuy();%20%09%09%09%7D%20else%20%7B%20%09%09%09%09autoBuy%20=%20false;%20%09%09%09%7D%20%09%09%7D%20%20%09%09return%20%5Bmoney,%20onClick%5D;%20%09%7D%20%20%09let%20AutoPurchase$1%20=%20class%20AutoPurchase%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$c,%20create_fragment$j,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D;%20%20%09/*%20src%5Cscripts%5CsuperRichMode%5CAutoPurchase.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$d(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20current;%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09onText:%20%22Stop%20auto%20purchasing%22,%20%09%09%09%09%09offText:%20%22Auto%20Purchase%20Upgrades%22,%20%09%09%09%09%09hotkeyId:%20%22richModeAutoPurchase%22,%20%09%09%09%09%09disabled:%20/*money*/%20ctx%5B0%5D%20==%20null,%20%09%09%09%09%09disabledMsg:%20%22Money%20hasn't%20loaded%20yet%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09togglebutton.$on(%22click%22,%20/*onClick*/%20ctx%5B1%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*money*/%201)%20togglebutton_changes.disabled%20=%20/*money*/%20ctx%5B0%5D%20==%20null;%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$i(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Super%20Rich%20Mode%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$d%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20money*/%20257)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$b($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09const%20upgradesToGet%20=%20%5B%20%09%09%09%5B%22Streak%20Bonus%22,%202,%201e4%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%203,%205e3%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%203,%201e5%5D,%20%09%09%09%5B%22Multiplier%22,%203,%2015e4%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%204,%201e6%5D,%20%09%09%09%5B%22Multiplier%22,%204,%201e6%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%205,%205e6%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%205,%201e7%5D,%20%09%09%09%5B%22Multiplier%22,%205,%206e6%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%206,%20375e5%5D,%20%09%09%09%5B%22Multiplier%22,%206,%20425e5%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%206,%201e8%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%207,%201e9%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%208,%201e10%5D,%20%09%09%09%5B%22Multiplier%22,%207,%2035e7%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%209,%205e9%5D,%20%09%09%09%5B%22Multiplier%22,%208,%20325e7%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%209,%201e11%5D,%20%09%09%09%5B%22Multiplier%22,%209,%20325e8%5D,%20%09%09%09%5B%22Streak%20Bonus%22,%2010,%201e12%5D,%20%09%09%09%5B%22Money%20Per%20Question%22,%2010,%205e10%5D,%20%09%09%09%5B%22Multiplier%22,%2010,%205e11%5D%20%09%09%5D;%20%20%09%09var%20UpgradeType;%20%20%09%09(function%20(UpgradeType)%20%7B%20%09%09%09UpgradeType%5B%22Insurance%22%5D%20=%20%22insurance%22;%20%09%09%09UpgradeType%5B%22Money%20Per%20Question%22%5D%20=%20%22moneyPerQuestion%22;%20%09%09%09UpgradeType%5B%22Multiplier%22%5D%20=%20%22multiplier%22;%20%09%09%09UpgradeType%5B%22Streak%20Bonus%22%5D%20=%20%22streakBonus%22;%20%09%09%7D)(UpgradeType%20%7C%7C%20(UpgradeType%20=%20%7B%7D));%20%20%09%09let%20money%20=%20null;%20%09%09let%20upgradeLevels%20=%20%7B%7D;%20%09%09let%20autoBuy%20=%20false;%20%20%09%09socketManager.addEventListener(%22blueboatMessage%22,%20e%20=%3E%20%7B%20%09%09%09if%20(e.detail.data?.type%20==%20%22UPGRADE_LEVELS%22)%20%7B%20%09%09%09%09upgradeLevels%20=%20e.detail.data.value;%20%20%09%09%09%09//%20delete%20any%20upgrades%20that%20we%20already%20have%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20upgradesToGet.length;%20i++)%20%7B%20%09%09%09%09%09let%20upgrade%20=%20upgradesToGet%5Bi%5D;%20%20%09%09%09%09%09//%20check%20if%20we%20have%20the%20upgrade%20%09%09%09%09%09let%20upgradeAmount%20=%20upgradeLevels%5BUpgradeType%5Bupgrade%5B0%5D%5D%5D;%20%20%09%09%09%09%09if%20(upgradeAmount%20%3E=%20upgrade%5B1%5D)%20%7B%20%09%09%09%09%09%09upgradesToGet.splice(i,%201);%20%09%09%09%09%09%09i--;%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D%20%20%09%09%09if%20(e.detail.data?.type%20==%20%22BALANCE%22)%20%7B%20%09%09%09%09$$invalidate(0,%20money%20=%20e.detail.data.value);%20%09%09%09%09checkAutoBuy();%20%09%09%09%7D%20%09%09%7D);%20%20%09%09function%20checkAutoBuy()%20%7B%20%09%09%09if%20(!autoBuy)%20return;%20%09%09%09let%20upgrade%20=%20upgradesToGet%5B0%5D;%20%09%09%09if%20(!upgrade)%20return;%20%20%09%09%09if%20(money%20%3E=%20upgrade%5B2%5D)%20%7B%20%09%09%09%09purchaseUpgrade(upgrade%5B0%5D,%20upgrade%5B1%5D);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20purchaseUpgrade(name,%20level)%20%7B%20%09%09%09socketManager.sendMessage(%22UPGRADE_PURCHASED%22,%20%7B%20upgradeName:%20name,%20level%20%7D);%20%09%09%7D%20%20%09%09function%20onClick(message)%20%7B%20%09%09%09if%20(message.detail)%20%7B%20%09%09%09%09autoBuy%20=%20true;%20%09%09%09%09checkAutoBuy();%20%09%09%09%7D%20else%20%7B%20%09%09%09%09autoBuy%20=%20false;%20%09%09%09%7D%20%09%09%7D%20%20%09%09return%20%5Bmoney,%20onClick%5D;%20%09%7D%20%20%09class%20AutoPurchase%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$b,%20create_fragment$i,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5CtrustNoOne%5CShowImposters.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$2(target)%20%7B%20%09%09append_styles(target,%20%22svelte-1h3d0lh%22,%20%22div.svelte-1h3d0lh%7Bpadding-left:10px;padding-right:10px%7D%22);%20%09%7D%20%20%09//%20(12:0)%20%3CGroup%20name=%22Trust%20No%20One%22%3E%20%09function%20create_default_slot$c(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20p;%20%09%09let%20t1;%20%20%09%09let%20t2_value%20=%20(/*imposterNames*/%20ctx%5B0%5D.length%20==%200%20%09%09?%20%22Waiting...%22%20%09%09:%20/*imposterNames*/%20ctx%5B0%5D.join(%22,%20%22))%20+%20%22%22;%20%20%09%09let%20t2;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09p%20=%20element(%22p%22);%20%09%09%09%09p.textContent%20=%20%22This%20script%20will%20only%20work%20if%20you%20don't%20join%20mid-game.%22;%20%09%09%09%09t1%20=%20text(%22%5Cr%5Cn%20%20%20%20%20%20%20%20Imposters:%20%22);%20%09%09%09%09t2%20=%20text(t2_value);%20%09%09%09%09attr(div,%20%22class%22,%20%22svelte-1h3d0lh%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09append(div,%20p);%20%09%09%09%09append(div,%20t1);%20%09%09%09%09append(div,%20t2);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*imposterNames*/%201%20&&%20t2_value%20!==%20(t2_value%20=%20(/*imposterNames*/%20ctx%5B0%5D.length%20==%200%20%09%09%09%09?%20%22Waiting...%22%20%09%09%09%09:%20/*imposterNames*/%20ctx%5B0%5D.join(%22,%20%22))%20+%20%22%22))%20set_data(t2,%20t2_value);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$h(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Trust%20No%20One%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$c%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20imposterNames*/%203)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$a($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20imposterNames%20=%20%5B%5D;%20%20%09%09socketManager.addEventListener(%22blueboatMessage%22,%20e%20=%3E%20%7B%20%09%09%09if%20(e.detail.key%20==%20%22IMPOSTER_MODE_PEOPLE%22)%20%7B%20%09%09%09%09let%20imposters%20=%20e.detail.data.filter(person%20=%3E%20person.role%20==%20%22imposter%22);%20%09%09%09%09$$invalidate(0,%20imposterNames%20=%20imposters.map(person%20=%3E%20person.name));%20%09%09%09%7D%20%09%09%7D);%20%20%09%09return%20%5BimposterNames%5D;%20%09%7D%20%20%09class%20ShowImposters%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$a,%20create_fragment$h,%20safe_not_equal,%20%7B%7D,%20add_css$2);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Cshared%5CPurchaseAnywhere.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_if_block$1(ctx)%20%7B%20%09%09let%20t0;%20%09%09let%20t1_value%20=%20(/*cost*/%20ctx%5B1%5D%20??%20/*purchaseDevices*/%20ctx%5B2%5D%5B0%5D?.options?.amountOfRequiredItem)%20+%20%22%22;%20%09%09let%20t1;%20%09%09let%20t2;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t0%20=%20text(%22(%22);%20%09%09%09%09t1%20=%20text(t1_value);%20%09%09%09%09t2%20=%20text(%22)%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*cost,%20purchaseDevices*/%206%20&&%20t1_value%20!==%20(t1_value%20=%20(/*cost*/%20ctx%5B1%5D%20??%20/*purchaseDevices*/%20ctx%5B2%5D%5B0%5D?.options?.amountOfRequiredItem)%20+%20%22%22))%20set_data(t1,%20t1_value);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(65:0)%20%3CButton%20disabled=%7B!$devicesLoaded%20%7C%7C%20purchaseDevices.length%20==%200%7D%20disabledMsg=%7B!$devicesLoaded%20?%20%22Devices%20haven't%20loaded%20yet%22%20:%20%22No%20matching%20purchase%20devices%22%7D%20%20on:click=%7Bpurchase%7D%20%3E%20%09function%20create_default_slot$b(ctx)%20%7B%20%09%09let%20t0;%20%09%09let%20t1;%20%09%09let%20t2;%20%09%09let%20if_block_anchor;%20%09%09let%20if_block%20=%20/*purchaseDevices*/%20ctx%5B2%5D.length%20%3E%200%20&&%20(/*purchaseDevices*/%20ctx%5B2%5D%5B0%5D?.options?.amountOfRequiredItem%20%7C%7C%20/*cost*/%20ctx%5B1%5D)%20&&%20create_if_block$1(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t0%20=%20text(%22Purchase%20%22);%20%09%09%09%09t1%20=%20text(/*displayText*/%20ctx%5B0%5D);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09if%20(if_block)%20if_block.c();%20%09%09%09%09if_block_anchor%20=%20empty();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09if%20(if_block)%20if_block.m(target,%20anchor);%20%09%09%09%09insert(target,%20if_block_anchor,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*displayText*/%201)%20set_data(t1,%20/*displayText*/%20ctx%5B0%5D);%20%20%09%09%09%09if%20(/*purchaseDevices*/%20ctx%5B2%5D.length%20%3E%200%20&&%20(/*purchaseDevices*/%20ctx%5B2%5D%5B0%5D?.options?.amountOfRequiredItem%20%7C%7C%20/*cost*/%20ctx%5B1%5D))%20%7B%20%09%09%09%09%09if%20(if_block)%20%7B%20%09%09%09%09%09%09if_block.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block%20=%20create_if_block$1(ctx);%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%09if_block.m(if_block_anchor.parentNode,%20if_block_anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20else%20if%20(if_block)%20%7B%20%09%09%09%09%09if_block.d(1);%20%09%09%09%09%09if_block%20=%20null;%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%09detach(if_block_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09if%20(if_block)%20if_block.d(detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$g(ctx)%20%7B%20%09%09let%20button;%20%09%09let%20current;%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09disabled:%20!/*$devicesLoaded*/%20ctx%5B3%5D%20%7C%7C%20/*purchaseDevices*/%20ctx%5B2%5D.length%20==%200,%20%09%09%09%09%09disabledMsg:%20!/*$devicesLoaded*/%20ctx%5B3%5D%20%09%09%09%09%09?%20%22Devices%20haven't%20loaded%20yet%22%20%09%09%09%09%09:%20%22No%20matching%20purchase%20devices%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$b%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20/*purchase*/%20ctx%5B4%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*$devicesLoaded,%20purchaseDevices*/%2012)%20button_changes.disabled%20=%20!/*$devicesLoaded*/%20ctx%5B3%5D%20%7C%7C%20/*purchaseDevices*/%20ctx%5B2%5D.length%20==%200;%20%20%09%09%09%09if%20(dirty%20&%20/*$devicesLoaded*/%208)%20button_changes.disabledMsg%20=%20!/*$devicesLoaded*/%20ctx%5B3%5D%20%09%09%09%09?%20%22Devices%20haven't%20loaded%20yet%22%20%09%09%09%09:%20%22No%20matching%20purchase%20devices%22;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20cost,%20purchaseDevices,%20displayText*/%20135)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$9($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20$devicesLoaded;%20%09%09component_subscribe($$self,%20devicesLoaded,%20$$value%20=%3E%20$$invalidate(3,%20$devicesLoaded%20=%20$$value));%20%09%09let%20%7B%20selector%20%7D%20=%20$$props;%20%09%09let%20%7B%20displayText%20%7D%20=%20$$props;%20%09%09let%20%7B%20reusable%20=%20false%20%7D%20=%20$$props;%20%09%09let%20%7B%20cost%20=%20undefined%20%7D%20=%20$$props;%20%09%09let%20purchaseDevices%20=%20%5B%5D;%20%20%09%09devicesLoaded.subscribe(value%20=%3E%20%7B%20%09%09%09if%20(!value)%20return;%20%09%09%09let%20devices%20=%20getUnsafeWindow()?.stores?.phaser?.scene?.worldManager?.devices?.allDevices;%20%20%09%09%09$$invalidate(2,%20purchaseDevices%20=%20devices.filter(device%20=%3E%20%7B%20%09%09%09%09let%20matches%20=%20true;%20%20%09%09%09%09for%20(let%20%5Bcategory,%20matchFields%5D%20of%20Object.entries(selector))%20%7B%20%09%09%09%09%09for%20(let%20%5Bkey,%20value%5D%20of%20Object.entries(matchFields))%20%7B%20%09%09%09%09%09%09if%20(value.endsWith?.(%22*%22))%20%7B%20%09%09%09%09%09%09%09value%20=%20value.slice(0,%20-1);%20%20%09%09%09%09%09%09%09if%20(!device?.%5Bcategory%5D?.%5Bkey%5D?.startsWith(value))%20%7B%20%09%09%09%09%09%09%09%09matches%20=%20false;%20%09%09%09%09%09%09%09%09break;%20%09%09%09%09%09%09%09%7D%20%09%09%09%09%09%09%7D%20else%20if%20(typeof%20value%20==%20%22function%22)%20%7B%20%09%09%09%09%09%09%09if%20(device?.%5Bcategory%5D?.%5Bkey%5D%20!=%20value())%20%7B%20%09%09%09%09%09%09%09%09matches%20=%20false;%20%09%09%09%09%09%09%09%09break;%20%09%09%09%09%09%09%09%7D%20%09%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09%09//%20find%20an%20exact%20match%20%09%09%09%09%09%09%09if%20(device?.%5Bcategory%5D?.%5Bkey%5D%20!=%20value)%20%7B%20%09%09%09%09%09%09%09%09matches%20=%20false;%20%09%09%09%09%09%09%09%09break;%20%09%09%09%09%09%09%09%7D%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09return%20matches;%20%09%09%09%7D));%20%20%09%09%09purchaseDevices.sort((a,%20b)%20=%3E%20a?.options?.amountOfRequiredItem%20-%20b?.options?.amountOfRequiredItem);%20%09%09%7D);%20%20%09%09async%20function%20purchase()%20%7B%20%09%09%09let%20devices%20=%20getUnsafeWindow()?.stores?.phaser?.scene?.worldManager?.devices?.allDevices;%20%20%09%09%09//%20this%20code%20has%20been%20here%20a%20while%20and%20I%20don't%20know%20what%20exactly%20it%20does%20but%20I%20don't%20dare%20remove%20it%20%09%09%09if%20(!purchaseDevices%5B0%5D?.interactiveZones?.onInteraction)%20%7B%20%09%09%09%09$$invalidate(2,%20purchaseDevices%20=%20purchaseDevices.map(device%20=%3E%20%7B%20%09%09%09%09%09return%20devices.find(d%20=%3E%20d.id%20==%20device.id);%20%09%09%09%09%7D));%20%20%09%09%09%09return;%20%09%09%09%7D%20%20%09%09%09purchaseDevices%5B0%5D?.interactiveZones?.onInteraction();%20%09%09%09if%20(reusable)%20return;%20%20%09%09%09//%20check%20whether%20it%20was%20successfully%20purchased%20%09%09%09//%20wait%20500ms%20for%20the%20purchase%20to%20go%20through%20%09%09%09await%20new%20Promise(resolve%20=%3E%20setTimeout(resolve,%20500));%20%20%09%09%09if%20(purchaseDevices%5B0%5D.state.active)%20return;%20//%20it%20wasn't%20purchased%20%09%09%09purchaseDevices.shift();%20%09%09%09$$invalidate(2,%20purchaseDevices);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('selector'%20in%20$$props)%20$$invalidate(5,%20selector%20=%20$$props.selector);%20%09%09%09if%20('displayText'%20in%20$$props)%20$$invalidate(0,%20displayText%20=%20$$props.displayText);%20%09%09%09if%20('reusable'%20in%20$$props)%20$$invalidate(6,%20reusable%20=%20$$props.reusable);%20%09%09%09if%20('cost'%20in%20$$props)%20$$invalidate(1,%20cost%20=%20$$props.cost);%20%09%09%7D;%20%20%09%09return%20%5B%20%09%09%09displayText,%20%09%09%09cost,%20%09%09%09purchaseDevices,%20%09%09%09$devicesLoaded,%20%09%09%09purchase,%20%09%09%09selector,%20%09%09%09reusable%20%09%09%5D;%20%09%7D%20%20%09class%20PurchaseAnywhere%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%20%09%09%09init(this,%20options,%20instance$9,%20create_fragment$g,%20safe_not_equal,%20%7B%20%09%09%09%09selector:%205,%20%09%09%09%09displayText:%200,%20%09%09%09%09reusable:%206,%20%09%09%09%09cost:%201%20%09%09%09%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Cctf%5CCtf.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$a(ctx)%20%7B%20%09%09let%20purchaseanywhere0;%20%09%09let%20t0;%20%09%09let%20purchaseanywhere1;%20%09%09let%20t1;%20%09%09let%20purchaseanywhere2;%20%09%09let%20t2;%20%09%09let%20purchaseanywhere3;%20%09%09let%20t3;%20%09%09let%20purchaseanywhere4;%20%09%09let%20t4;%20%09%09let%20purchaseanywhere5;%20%09%09let%20current;%20%20%09%09purchaseanywhere0%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Speed%20Upgrade%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Speed%20Upgrade%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere1%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Efficiency%20Upgrade%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Efficiency%20Upgrade%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere2%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Energy%20Per%20Question%20Upgrade%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20%09%09%09%09%09%09%09grantedItemName:%20%22Energy%20Per%20Question%20Upgrade%22%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere3%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Invisabits%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22silver-ore%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere4%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Barrier%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09state:%20%7B%20active:%20true%20%7D,%20%09%09%09%09%09%09options:%20%7B%20%09%09%09%09%09%09%09grantedItemName:%20%22Barrier*%22,%20%09%09%09%09%09%09%09allowedPurchaseTeam:%20/*func*/%20ctx%5B0%5D%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere5%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Big%20Barrier%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09state:%20%7B%20active:%20true%20%7D,%20%09%09%09%09%09%09options:%20%7B%20%09%09%09%09%09%09%09grantedItemName:%20%22Big%20Barrier*%22,%20%09%09%09%09%09%09%09allowedPurchaseTeam:%20/*func_1*/%20ctx%5B1%5D%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(purchaseanywhere0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(purchaseanywhere1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(purchaseanywhere2.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(purchaseanywhere3.$$.fragment);%20%09%09%09%09t3%20=%20space();%20%09%09%09%09create_component(purchaseanywhere4.$$.fragment);%20%09%09%09%09t4%20=%20space();%20%09%09%09%09create_component(purchaseanywhere5.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(purchaseanywhere0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere1,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere2,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere3,%20target,%20anchor);%20%09%09%09%09insert(target,%20t3,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere4,%20target,%20anchor);%20%09%09%09%09insert(target,%20t4,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere5,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere2.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere3.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere4.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere5.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere2.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere3.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere4.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere5.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%09detach(t3);%20%09%09%09%09%09detach(t4);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(purchaseanywhere0,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere1,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere2,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere3,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere4,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere5,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$f(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Capture%20the%20Flag%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$a%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%204)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$8($$self)%20%7B%20%09%09const%20func%20=%20()%20=%3E%20getUnsafeWindow()?.stores?.phaser?.mainCharacter?.teamId;%20%09%09const%20func_1%20=%20()%20=%3E%20getUnsafeWindow()?.stores?.phaser?.mainCharacter?.teamId;%20%09%09return%20%5Bfunc,%20func_1%5D;%20%09%7D%20%20%09class%20Ctf%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$8,%20create_fragment$f,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Ctag%5CTag.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$9(ctx)%20%7B%20%09%09let%20purchaseanywhere0;%20%09%09let%20t0;%20%09%09let%20purchaseanywhere1;%20%09%09let%20t1;%20%09%09let%20purchaseanywhere2;%20%09%09let%20t2;%20%09%09let%20purchaseanywhere3;%20%09%09let%20current;%20%20%09%09purchaseanywhere0%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Speed%20Upgrade%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Speed%20Upgrade%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere1%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Efficiency%20Upgrade%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Efficiency%20Upgrade%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere2%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Energy%20Per%20Question%20Upgrade%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20%09%09%09%09%09%09%09grantedItemName:%20%22Energy%20Per%20Question%20Upgrade%22%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere3%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Endurance%20Upgrade%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Endurance%20Upgrade%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(purchaseanywhere0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(purchaseanywhere1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(purchaseanywhere2.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(purchaseanywhere3.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(purchaseanywhere0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere1,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere2,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere3,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere2.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere3.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere2.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere3.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(purchaseanywhere0,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere1,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere2,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere3,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$e(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Tag%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$9%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09class%20Tag%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20null,%20create_fragment$e,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5ConeWayOut%5COneWayOut.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$8(ctx)%20%7B%20%09%09let%20purchaseanywhere0;%20%09%09let%20t;%20%09%09let%20purchaseanywhere1;%20%09%09let%20current;%20%20%09%09purchaseanywhere0%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Med%20Pack%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22medpack%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere1%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Shield%20Can%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22shield-can%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(purchaseanywhere0.$$.fragment);%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(purchaseanywhere1.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(purchaseanywhere0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere1,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(purchaseanywhere0,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere1,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$d(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22One%20Way%20Out%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$8%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09class%20OneWayOut%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20null,%20create_fragment$d,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Cshared%5CRapidfire.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_fragment$c(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20updating_enabled;%20%09%09let%20current;%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09/*togglebutton_enabled_binding*/%20ctx%5B4%5D(value);%20%09%09%7D%20%20%09%09let%20togglebutton_props%20=%20%7B%20%09%09%09onText:%20%22%22%20+%20(/*message*/%20ctx%5B0%5D%20+%20%22:%20On%22),%20%09%09%09offText:%20%22%22%20+%20(/*message*/%20ctx%5B0%5D%20+%20%22:%20Off%22),%20%09%09%09hotkeyId:%20/*hotkeyId*/%20ctx%5B1%5D%20%09%09%7D;%20%20%09%09if%20(/*rapidfireEnabled*/%20ctx%5B2%5D%20!==%20void%200)%20%7B%20%09%09%09togglebutton_props.enabled%20=%20/*rapidfireEnabled*/%20ctx%5B2%5D;%20%09%09%7D%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20props:%20togglebutton_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(togglebutton,%20'enabled',%20togglebutton_enabled_binding));%20%09%09togglebutton.$on(%22click%22,%20/*onClick*/%20ctx%5B3%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*message*/%201)%20togglebutton_changes.onText%20=%20%22%22%20+%20(/*message*/%20ctx%5B0%5D%20+%20%22:%20On%22);%20%09%09%09%09if%20(dirty%20&%20/*message*/%201)%20togglebutton_changes.offText%20=%20%22%22%20+%20(/*message*/%20ctx%5B0%5D%20+%20%22:%20Off%22);%20%09%09%09%09if%20(dirty%20&%20/*hotkeyId*/%202)%20togglebutton_changes.hotkeyId%20=%20/*hotkeyId*/%20ctx%5B1%5D;%20%20%09%09%09%09if%20(!updating_enabled%20&&%20dirty%20&%20/*rapidfireEnabled*/%204)%20%7B%20%09%09%09%09%09updating_enabled%20=%20true;%20%09%09%09%09%09togglebutton_changes.enabled%20=%20/*rapidfireEnabled*/%20ctx%5B2%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_enabled%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$7($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20rapidfireEnabled%20=%20false;%20%09%09let%20rapidfireInterval;%20%09%09let%20%7B%20message%20%7D%20=%20$$props;%20%09%09let%20%7B%20hotkeyId%20%7D%20=%20$$props;%20%20%09%09function%20onClick()%20%7B%20%09%09%09if%20(rapidfireEnabled)%20%7B%20%09%09%09%09//%20set%20the%20interval%20to%20fire%20when%20the%20mouse%20is%20down%20%09%09%09%09rapidfireInterval%20=%20setInterval(%20%09%09%09%09%09()%20=%3E%20%7B%20%09%09%09%09%09%09let%20mousePointer%20=%20getUnsafeWindow().stores.phaser.scene.input.mousePointer;%20%09%09%09%09%09%09let%20body%20=%20getUnsafeWindow().stores.phaser.mainCharacter.body;%20%09%09%09%09%09%09if%20(!mousePointer%20%7C%7C%20!body%20%7C%7C%20!mousePointer.isDown)%20return;%20%20%09%09%09%09%09%09//%20calculate%20the%20angle%20and%20mine%20%09%09%09%09%09%09let%20Vector2%20=%20getUnsafeWindow().Phaser.Math.Vector2;%20%20%09%09%09%09%09%09let%20vector%20=%20new%20Vector2(mousePointer.worldX%20-%20body.x,%20mousePointer.worldY%20-%20(body.y%20-%203)).normalize();%20%09%09%09%09%09%09let%20angle%20=%20getUnsafeWindow().Phaser.Math.Angle.Between(0,%200,%20vector.x,%20vector.y);%20%09%09%09%09%09%09socketManager.sendMessage(%22FIRE%22,%20%7B%20angle,%20x:%20body.x,%20y:%20body.y%20%7D);%20%09%09%09%09%09%7D,%20%09%09%09%09%0950%20%09%09%09%09);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09clearInterval(rapidfireInterval);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09rapidfireEnabled%20=%20value;%20%09%09%09$$invalidate(2,%20rapidfireEnabled);%20%09%09%7D%20%20%09%09$$self.$$set%20=%20$$props%20=%3E%20%7B%20%09%09%09if%20('message'%20in%20$$props)%20$$invalidate(0,%20message%20=%20$$props.message);%20%09%09%09if%20('hotkeyId'%20in%20$$props)%20$$invalidate(1,%20hotkeyId%20=%20$$props.hotkeyId);%20%09%09%7D;%20%20%09%09return%20%5Bmessage,%20hotkeyId,%20rapidfireEnabled,%20onClick,%20togglebutton_enabled_binding%5D;%20%09%7D%20%20%09class%20Rapidfire%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$7,%20create_fragment$c,%20safe_not_equal,%20%7B%20message:%200,%20hotkeyId:%201%20%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Csnowbrawl%5CSnowbrawl.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$7(ctx)%20%7B%20%09%09let%20purchaseanywhere0;%20%09%09let%20t0;%20%09%09let%20purchaseanywhere1;%20%09%09let%20t1;%20%09%09let%20rapidfire;%20%09%09let%20current;%20%20%09%09purchaseanywhere0%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Med%20Pack%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22medpack%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere1%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Shield%20Can%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22shield-can%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09rapidfire%20=%20new%20Rapidfire(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09message:%20%22Rapid%20fire%22,%20%09%09%09%09%09hotkeyId:%20%22snowbrawlRapidFire%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(purchaseanywhere0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(purchaseanywhere1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(rapidfire.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(purchaseanywhere0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere1,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(rapidfire,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_in(rapidfire.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_out(rapidfire.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(purchaseanywhere0,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere1,%20detaching);%20%09%09%09%09destroy_component(rapidfire,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$b(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Snowbrawl%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$7%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09class%20Snowbrawl%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20null,%20create_fragment$b,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5CfloorIsLava%5CAutoBuild.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_fragment$a(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20updating_enabled;%20%09%09let%20current;%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09/*togglebutton_enabled_binding*/%20ctx%5B2%5D(value);%20%09%09%7D%20%20%09%09let%20togglebutton_props%20=%20%7B%20%09%09%09offText:%20%22Enable%20Auto%20Buy%22,%20%09%09%09onText:%20%22Disable%20Auto%20Buy%22,%20%09%09%09hotkeyId:%20%22floorIsLavaAutoBuy%22%20%09%09%7D;%20%20%09%09if%20(/*enabled*/%20ctx%5B0%5D%20!==%20void%200)%20%7B%20%09%09%09togglebutton_props.enabled%20=%20/*enabled*/%20ctx%5B0%5D;%20%09%09%7D%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20props:%20togglebutton_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(togglebutton,%20'enabled',%20togglebutton_enabled_binding));%20%09%09togglebutton.$on(%22click%22,%20/*onClick*/%20ctx%5B1%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_enabled%20&&%20dirty%20&%20/*enabled*/%201)%20%7B%20%09%09%09%09%09updating_enabled%20=%20true;%20%09%09%09%09%09togglebutton_changes.enabled%20=%20/*enabled*/%20ctx%5B0%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_enabled%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$6($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09const%20structures%20=%20%5B%20%09%09%09%5B%22spaceElevator%22,%205e7%5D,%20%09%09%09%5B%22mountain%22,%205e6%5D,%20%09%09%09%5B%22skyscaper%22,%205e5%5D,%20%09%09%09%5B%22shoppingMall%22,%205e4%5D,%20%09%09%09%5B%22house%22,%205e3%5D,%20%09%09%09%5B%22wall%22,%205e2%5D,%20%09%09%09%5B%22brick%22,%2050%5D,%20%09%09%09%5B%22plank%22,%205%5D%20%09%09%5D;%20//%20not%20a%20typo,%20it's%20actually%20called%20%22skyscaper%22%20%09%09//%20called%20%22staircase%22%20ingame%20%20%09%09let%20money%20=%20null;%20%09%09let%20enabled%20=%20false;%20%09%09let%20cooldown%20=%20false;%20%20%09%09socketManager.addEventListener('blueboatMessage',%20e%20=%3E%20%7B%20%09%09%09if%20(e.detail.data?.type%20==%20%22BALANCE%22)%20%7B%20%09%09%09%09money%20=%20e.detail.data.value;%20%20%09%09%09%09if%20(enabled)%20%7B%20%09%09%09%09%09checkAutoBuy();%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D);%20%20%09%09function%20checkAutoBuy()%20%7B%20%09%09%09if%20(cooldown%20%7C%7C%20!enabled)%20return;%20%09%09%09cooldown%20=%20true;%20%20%09%09%09setTimeout(%20%09%09%09%09()%20=%3E%20%7B%20%09%09%09%09%09cooldown%20=%20false;%20%09%09%09%09%09checkAutoBuy();%20%09%09%09%09%7D,%20%09%09%09%09150%20%09%09%09);%20%20%09%09%09for%20(let%20structure%20of%20structures)%20%7B%20%09%09%09%09if%20(money%20%3E=%20structure%5B1%5D)%20%7B%20%09%09%09%09%09buyStructure(structure%5B0%5D);%20%09%09%09%09%09break;%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20buyStructure(type)%20%7B%20%09%09%09socketManager.sendMessage(%22LAVA_PURCHASE_PIECE%22,%20%7B%20type%20%7D);%20%09%09%7D%20%20%09%09function%20onClick(message)%20%7B%20%09%09%09$$invalidate(0,%20enabled%20=%20message.detail);%20%09%09%09checkAutoBuy();%20%09%09%7D%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09enabled%20=%20value;%20%09%09%09$$invalidate(0,%20enabled);%20%09%09%7D%20%20%09%09return%20%5Benabled,%20onClick,%20togglebutton_enabled_binding%5D;%20%09%7D%20%20%09class%20AutoBuild%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$6,%20create_fragment$a,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5CfloorIsLava%5CHidePopups.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_fragment$9(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20updating_enabled;%20%09%09let%20current;%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09/*togglebutton_enabled_binding*/%20ctx%5B1%5D(value);%20%09%09%7D%20%20%09%09let%20togglebutton_props%20=%20%7B%20%09%09%09offText:%20%22Hide%20Purchase%20Popups%22,%20%09%09%09onText:%20%22Show%20Purchase%20Popups%22,%20%09%09%09hotkeyId:%20%22floorIsLavaHidePopups%22%20%09%09%7D;%20%20%09%09if%20(/*hidingPopups*/%20ctx%5B0%5D%20!==%20void%200)%20%7B%20%09%09%09togglebutton_props.enabled%20=%20/*hidingPopups*/%20ctx%5B0%5D;%20%09%09%7D%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20props:%20togglebutton_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(togglebutton,%20'enabled',%20togglebutton_enabled_binding));%20%09%09togglebutton.$on(%22click%22,%20onClick);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_enabled%20&&%20dirty%20&%20/*hidingPopups*/%201)%20%7B%20%09%09%09%09%09updating_enabled%20=%20true;%20%09%09%09%09%09togglebutton_changes.enabled%20=%20/*hidingPopups*/%20ctx%5B0%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_enabled%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20onClick(message)%20%7B%20%09%09if%20(!message.detail)%20return;%20%20%09%09document.querySelectorAll(%22.Toastify__toast%22).forEach(node%20=%3E%20%7B%20%09%09%09node.style.display%20=%20%22none%22;%20%09%09%09node.querySelector('.Toastify__close-button')?.click();%20%09%09%7D);%20%09%7D%20%20%09function%20instance$5($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20hidingPopups%20=%20false;%20%20%09%09let%20observer%20=%20new%20MutationObserver(mutations%20=%3E%20%7B%20%09%09%09%09if%20(!hidingPopups)%20return;%20%20%09%09%09%09for%20(let%20mutation%20of%20mutations)%20%7B%20%09%09%09%09%09for%20(let%20node%20of%20mutation.addedNodes)%20%7B%20%09%09%09%09%09%09if%20(!(node%20instanceof%20HTMLElement))%20continue;%20%20%09%09%09%09%09%09if%20(node.matches(%22.Toastify__toast%22))%20%7B%20%09%09%09%09%09%09%09node.style.display%20=%20%22none%22;%20%09%09%09%09%09%09%09node.querySelector('.Toastify__close-button')?.click();%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09const%20attachObserver%20=%20()%20=%3E%20%7B%20%09%09%09observer.observe(document.body,%20%7B%20childList:%20true,%20subtree:%20true%20%7D);%20%09%09%7D;%20%20%09%09if%20(!document.body)%20%7B%20%09%09%09window.addEventListener('DOMContentLoaded',%20attachObserver);%20%09%09%7D%20else%20%7B%20%09%09%09attachObserver();%20%09%09%7D%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09hidingPopups%20=%20value;%20%09%09%09$$invalidate(0,%20hidingPopups);%20%09%09%7D%20%20%09%09return%20%5BhidingPopups,%20togglebutton_enabled_binding%5D;%20%09%7D%20%20%09class%20HidePopups%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$5,%20create_fragment$9,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5CfloorIsLava%5CFloorIsLava.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$6(ctx)%20%7B%20%09%09let%20autobuild;%20%09%09let%20t;%20%09%09let%20hidepopups;%20%09%09let%20current;%20%09%09autobuild%20=%20new%20AutoBuild(%7B%7D);%20%09%09hidepopups%20=%20new%20HidePopups(%7B%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(autobuild.$$.fragment);%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(hidepopups.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(autobuild,%20target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(hidepopups,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(autobuild.$$.fragment,%20local);%20%09%09%09%09transition_in(hidepopups.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(autobuild.$$.fragment,%20local);%20%09%09%09%09transition_out(hidepopups.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(autobuild,%20detaching);%20%09%09%09%09destroy_component(hidepopups,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$8(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22The%20Floor%20is%20Lava%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$6%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09class%20FloorIsLava%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20null,%20create_fragment$8,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Cfarmchain%5CAutoPlant.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_fragment$7(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20current;%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09offText:%20%22Start%20Auto%20Planting%22,%20%09%09%09%09%09onText:%20%22Stop%20Auto%20Planting%22,%20%09%09%09%09%09disabled:%20!/*$devicesLoaded*/%20ctx%5B0%5D,%20%09%09%09%09%09disabledMsg:%20%22Farm%20plots%20not%20loaded%22,%20%09%09%09%09%09hotkeyId:%20%22farmchainAutoPlant%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09togglebutton.$on(%22click%22,%20/*onClick*/%20ctx%5B1%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*$devicesLoaded*/%201)%20togglebutton_changes.disabled%20=%20!/*$devicesLoaded*/%20ctx%5B0%5D;%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$4($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20$devicesLoaded;%20%09%09component_subscribe($$self,%20devicesLoaded,%20$$value%20=%3E%20$$invalidate(0,%20$devicesLoaded%20=%20$$value));%20%20%09%09const%20seedRanking%20=%20%5B%20%09%09%09'yellow-seed',%20%09%09%09'tan-seed',%20%09%09%09'brown-seed',%20%09%09%09'purple-seed',%20%09%09%09'magenta-seed',%20%09%09%09'green-seed',%20%09%09%09'bronze-seed',%20%09%09%09'orange-seed',%20%09%09%09'gold-seed',%20%09%09%09'dark-green-seed',%20%09%09%09'red-seed',%20%09%09%09'blue-seed',%20%09%09%09'teal-seed'%20%09%09%5D;%20%20%09%09let%20autoPlantInterval%20=%20undefined;%20%20%09%09function%20onClick(e)%20%7B%20%09%09%09if%20(e.detail)%20%7B%20%09%09%09%09let%20devices%20=%20getUnsafeWindow()?.stores?.phaser?.scene?.worldManager?.devices?.allDevices;%20%09%09%09%09let%20plots%20=%20devices.filter(device%20=%3E%20device.options.style%20==%20%22plant%22);%20%09%09%09%09let%20recipieDevices%20=%20%7B%7D;%20%20%09%09%09%09for%20(let%20device%20of%20devices)%20%7B%20%09%09%09%09%09if%20(!seedRanking.includes(device.options?.ingredient1Item))%20continue;%20%09%09%09%09%09recipieDevices%5Bdevice.options?.ingredient1Item%5D%20=%20device;%20%09%09%09%09%7D%20%20%09%09%09%09//%20set%20up%20auto%20plant%20%09%09%09%09autoPlantInterval%20=%20setInterval(%20%09%09%09%09%09()%20=%3E%20%7B%20%09%09%09%09%09%09let%20inventory%20=%20getUnsafeWindow()?.stores?.me?.inventory?.slots;%20%09%09%09%09%09%09if%20(!inventory)%20return;%20%20%09%09%09%09%09%09//%20find%20the%20most%20valuable%20seed%20that%20we%20can%20plant%20%09%09%09%09%09%09let%20mostValuableSeed%20=%20undefined;%20%20%09%09%09%09%09%09for%20(let%20seed%20of%20seedRanking)%20%7B%20%09%09%09%09%09%09%09let%20recipie%20=%20recipieDevices%5Bseed%5D;%20%09%09%09%09%09%09%09let%20canPlant%20=%20true;%20%20%09%09%09%09%09%09%09//%20check%20if%20we%20have%20enough%20of%20each%20ingredient%20%09%09%09%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%205;%20i++)%20%7B%20%09%09%09%09%09%09%09%09let%20reqIngredient%20=%20recipie?.options?.%5B%60ingredient$%7Bi%7DItem%60%5D;%20%09%09%09%09%09%09%09%09if%20(!reqIngredient)%20continue;%20%20%09%09%09%09%09%09%09%09if%20(!inventory.get(reqIngredient)?.amount%20%3E=%20recipie.options%5B%60ingredient$%7Bi%7DAmount%60%5D)%20%7B%20%09%09%09%09%09%09%09%09%09canPlant%20=%20false;%20%09%09%09%09%09%09%09%09%09break;%20%09%09%09%09%09%09%09%09%7D%20%09%09%09%09%09%09%09%7D%20%20%09%09%09%09%09%09%09if%20(canPlant)%20%7B%20%09%09%09%09%09%09%09%09mostValuableSeed%20=%20seed;%20%09%09%09%09%09%09%09%09break;%20%09%09%09%09%09%09%09%7D%20%09%09%09%09%09%09%7D%20%20%09%09%09%09%09%09if%20(!mostValuableSeed)%20return;%20%20%09%09%09%09%09%09//%20plant%20the%20seed%20in%20the%20last%20idle%20plot%20%09%09%09%09%09%09let%20plantPlot%20=%20plots.findLast(plot%20=%3E%20plot.state.status%20==%20%22idle%22);%20%20%09%09%09%09%09%09socketManager.sendMessage(%22MESSAGE_FOR_DEVICE%22,%20%7B%20%09%09%09%09%09%09%09key:%20%22craft%22,%20%09%09%09%09%09%09%09deviceId:%20plantPlot.id,%20%09%09%09%09%09%09%09data:%20%7B%20%09%09%09%09%09%09%09%09recipe:%20recipieDevices%5BmostValuableSeed%5D.id%20%09%09%09%09%09%09%09%7D%20%09%09%09%09%09%09%7D);%20%09%09%09%09%09%7D,%20%09%09%09%09%09100%20%09%09%09%09);%20%09%09%09%7D%20else%20%7B%20%09%09%09%09clearInterval(autoPlantInterval);%20%09%09%09%7D%20%09%09%7D%20%20%09%09return%20%5B$devicesLoaded,%20onClick%5D;%20%09%7D%20%20%09class%20AutoPlant%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$4,%20create_fragment$7,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Cfarmchain%5CAutoHarvest.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_fragment$6(ctx)%20%7B%20%09%09let%20togglebutton;%20%09%09let%20updating_enabled;%20%09%09let%20current;%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09/*togglebutton_enabled_binding*/%20ctx%5B1%5D(value);%20%09%09%7D%20%20%09%09let%20togglebutton_props%20=%20%7B%20%09%09%09hotkeyId:%20%22farmchainAutoHarvest%22,%20%09%09%09offText:%20%22Start%20Auto%20Harvesting%22,%20%09%09%09onText:%20%22Stop%20Auto%20Harvesting%22%20%09%09%7D;%20%20%09%09if%20(/*autoHarvesting*/%20ctx%5B0%5D%20!==%20void%200)%20%7B%20%09%09%09togglebutton_props.enabled%20=%20/*autoHarvesting*/%20ctx%5B0%5D;%20%09%09%7D%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20props:%20togglebutton_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(togglebutton,%20'enabled',%20togglebutton_enabled_binding));%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_enabled%20&&%20dirty%20&%20/*autoHarvesting*/%201)%20%7B%20%09%09%09%09%09updating_enabled%20=%20true;%20%09%09%09%09%09togglebutton_changes.enabled%20=%20/*autoHarvesting*/%20ctx%5B0%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_enabled%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$3($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20autoHarvesting%20=%20false;%20%20%09%09socketManager.addEventListener('deviceChanges',%20e%20=%3E%20%7B%20%09%09%09if%20(!autoHarvesting)%20return;%20%09%09%09let%20changes%20=%20e.detail;%20%20%09%09%09for%20(let%20change%20of%20changes)%20%7B%20%09%09%09%09for%20(let%20key%20in%20change.data)%20%7B%20%09%09%09%09%09if%20(!key.endsWith(%22status%22)%20%7C%7C%20change.data%5Bkey%5D%20!=%20%22availableForCollection%22)%20continue;%20%20%09%09%09%09%09//%20harvest%20it%20%09%09%09%09%09let%20packet%20=%20%7B%20key:%20%22collect%22,%20deviceId:%20change.id%20%7D;%20%20%09%09%09%09%09socketManager.sendMessage(%22MESSAGE_FOR_DEVICE%22,%20packet);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D);%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09autoHarvesting%20=%20value;%20%09%09%09$$invalidate(0,%20autoHarvesting);%20%09%09%7D%20%20%09%09return%20%5BautoHarvesting,%20togglebutton_enabled_binding%5D;%20%09%7D%20%20%09class%20AutoHarvest%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$3,%20create_fragment$6,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Cfarmchain%5CFarmchain.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot_2$2(ctx)%20%7B%20%09%09let%20purchaseanywhere0;%20%09%09let%20t0;%20%09%09let%20purchaseanywhere1;%20%09%09let%20t1;%20%09%09let%20purchaseanywhere2;%20%09%09let%20t2;%20%09%09let%20purchaseanywhere3;%20%09%09let%20t3;%20%09%09let%20purchaseanywhere4;%20%09%09let%20t4;%20%09%09let%20purchaseanywhere5;%20%09%09let%20t5;%20%09%09let%20purchaseanywhere6;%20%09%09let%20t6;%20%09%09let%20purchaseanywhere7;%20%09%09let%20t7;%20%09%09let%20purchaseanywhere8;%20%09%09let%20t8;%20%09%09let%20purchaseanywhere9;%20%09%09let%20t9;%20%09%09let%20purchaseanywhere10;%20%09%09let%20t10;%20%09%09let%20purchaseanywhere11;%20%09%09let%20t11;%20%09%09let%20purchaseanywhere12;%20%09%09let%20current;%20%20%09%09purchaseanywhere0%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Corn%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemId:%20%22yellow-seed%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere1%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Wheat%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22tan-seed%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere2%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Potato%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22brown-seed%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere3%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Grape%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemId:%20%22purple-seed%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere4%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Raspberry%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemId:%20%22magenta-seed%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere5%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Watermelon%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22green-seed%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere6%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Coffee%20Bean%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemId:%20%22bronze-seed%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere7%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Orange%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemId:%20%22orange-seed%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere8%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Gimberry%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22gold-seed%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere9%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Cash%20Berry%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemId:%20%22dark-green-seed%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere10%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Pepper%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22red-seed%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere11%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Energy%20Bar%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22blue-seed%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere12%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Lottery%20Ticket%20Seed%22,%20%09%09%09%09%09reusable:%20true,%20%09%09%09%09%09selector:%20%7B%20options:%20%7B%20grantedItemId:%20%22teal-seed%22%20%7D%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(purchaseanywhere0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(purchaseanywhere1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(purchaseanywhere2.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(purchaseanywhere3.$$.fragment);%20%09%09%09%09t3%20=%20space();%20%09%09%09%09create_component(purchaseanywhere4.$$.fragment);%20%09%09%09%09t4%20=%20space();%20%09%09%09%09create_component(purchaseanywhere5.$$.fragment);%20%09%09%09%09t5%20=%20space();%20%09%09%09%09create_component(purchaseanywhere6.$$.fragment);%20%09%09%09%09t6%20=%20space();%20%09%09%09%09create_component(purchaseanywhere7.$$.fragment);%20%09%09%09%09t7%20=%20space();%20%09%09%09%09create_component(purchaseanywhere8.$$.fragment);%20%09%09%09%09t8%20=%20space();%20%09%09%09%09create_component(purchaseanywhere9.$$.fragment);%20%09%09%09%09t9%20=%20space();%20%09%09%09%09create_component(purchaseanywhere10.$$.fragment);%20%09%09%09%09t10%20=%20space();%20%09%09%09%09create_component(purchaseanywhere11.$$.fragment);%20%09%09%09%09t11%20=%20space();%20%09%09%09%09create_component(purchaseanywhere12.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(purchaseanywhere0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere1,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere2,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere3,%20target,%20anchor);%20%09%09%09%09insert(target,%20t3,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere4,%20target,%20anchor);%20%09%09%09%09insert(target,%20t4,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere5,%20target,%20anchor);%20%09%09%09%09insert(target,%20t5,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere6,%20target,%20anchor);%20%09%09%09%09insert(target,%20t6,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere7,%20target,%20anchor);%20%09%09%09%09insert(target,%20t7,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere8,%20target,%20anchor);%20%09%09%09%09insert(target,%20t8,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere9,%20target,%20anchor);%20%09%09%09%09insert(target,%20t9,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere10,%20target,%20anchor);%20%09%09%09%09insert(target,%20t10,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere11,%20target,%20anchor);%20%09%09%09%09insert(target,%20t11,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere12,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere2.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere3.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere4.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere5.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere6.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere7.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere8.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere9.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere10.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere11.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere12.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere2.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere3.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere4.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere5.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere6.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere7.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere8.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere9.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere10.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere11.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere12.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%09detach(t3);%20%09%09%09%09%09detach(t4);%20%09%09%09%09%09detach(t5);%20%09%09%09%09%09detach(t6);%20%09%09%09%09%09detach(t7);%20%09%09%09%09%09detach(t8);%20%09%09%09%09%09detach(t9);%20%09%09%09%09%09detach(t10);%20%09%09%09%09%09detach(t11);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(purchaseanywhere0,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere1,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere2,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere3,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere4,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere5,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere6,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere7,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere8,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere9,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere10,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere11,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere12,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(38:4)%20%3CGroup%20name=%22Unlock%20Seeds%22%3E%20%09function%20create_default_slot_1$2(ctx)%20%7B%20%09%09let%20purchaseanywhere0;%20%09%09let%20t0;%20%09%09let%20purchaseanywhere1;%20%09%09let%20t1;%20%09%09let%20purchaseanywhere2;%20%09%09let%20t2;%20%09%09let%20purchaseanywhere3;%20%09%09let%20t3;%20%09%09let%20purchaseanywhere4;%20%09%09let%20t4;%20%09%09let%20purchaseanywhere5;%20%09%09let%20t5;%20%09%09let%20purchaseanywhere6;%20%09%09let%20t6;%20%09%09let%20purchaseanywhere7;%20%09%09let%20current;%20%20%09%09purchaseanywhere0%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Unlock%20Wheat%20Seed%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Wheat%20Seed%20Unlock%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere1%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Unlock%20Potato%20Seed%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Potato%20Seed%20Unlock%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere2%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Unlock%20Grape%20Seed%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Grape%20Seed%20Unlock%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere3%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Unlock%20Raspberry%20Seed%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Raspberry%20Seed%20Unlock%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere4%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Unlock%20Watermelon%20Seed%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20%09%09%09%09%09%09%09grantedItemName:%20%22Watermelon%20Seed%20Unlock%22%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere5%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Unlock%20Coffee%20Bean%20Seed%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20%09%09%09%09%09%09%09grantedItemName:%20%22Coffee%20Bean%20Seed%20Unlock%22%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere6%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Unlock%20Orange%20Seed%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Orange%20Seed%20Unlock%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchaseanywhere7%20=%20new%20PurchaseAnywhere(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09displayText:%20%22Unlock%20Gimberry%20Seed%22,%20%09%09%09%09%09selector:%20%7B%20%09%09%09%09%09%09options:%20%7B%20grantedItemName:%20%22Gimberry%20Seed%20Unlock%22%20%7D%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(purchaseanywhere0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(purchaseanywhere1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(purchaseanywhere2.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(purchaseanywhere3.$$.fragment);%20%09%09%09%09t3%20=%20space();%20%09%09%09%09create_component(purchaseanywhere4.$$.fragment);%20%09%09%09%09t4%20=%20space();%20%09%09%09%09create_component(purchaseanywhere5.$$.fragment);%20%09%09%09%09t5%20=%20space();%20%09%09%09%09create_component(purchaseanywhere6.$$.fragment);%20%09%09%09%09t6%20=%20space();%20%09%09%09%09create_component(purchaseanywhere7.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(purchaseanywhere0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere1,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere2,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere3,%20target,%20anchor);%20%09%09%09%09insert(target,%20t3,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere4,%20target,%20anchor);%20%09%09%09%09insert(target,%20t4,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere5,%20target,%20anchor);%20%09%09%09%09insert(target,%20t5,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere6,%20target,%20anchor);%20%09%09%09%09insert(target,%20t6,%20anchor);%20%09%09%09%09mount_component(purchaseanywhere7,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere2.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere3.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere4.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere5.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere6.$$.fragment,%20local);%20%09%09%09%09transition_in(purchaseanywhere7.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(purchaseanywhere0.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere1.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere2.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere3.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere4.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere5.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere6.$$.fragment,%20local);%20%09%09%09%09transition_out(purchaseanywhere7.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%09detach(t3);%20%09%09%09%09%09detach(t4);%20%09%09%09%09%09detach(t5);%20%09%09%09%09%09detach(t6);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(purchaseanywhere0,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere1,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere2,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere3,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere4,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere5,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere6,%20detaching);%20%09%09%09%09destroy_component(purchaseanywhere7,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(7:0)%20%3CGroup%20name=%22Farmchain%22%3E%20%09function%20create_default_slot$5(ctx)%20%7B%20%09%09let%20autoharvest;%20%09%09let%20t0;%20%09%09let%20autoplant;%20%09%09let%20t1;%20%09%09let%20group0;%20%09%09let%20t2;%20%09%09let%20group1;%20%09%09let%20current;%20%09%09autoharvest%20=%20new%20AutoHarvest(%7B%7D);%20%09%09autoplant%20=%20new%20AutoPlant(%7B%7D);%20%20%09%09group0%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Purchase%20Seeds%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_2$2%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09group1%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Unlock%20Seeds%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_1$2%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(autoharvest.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(autoplant.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(group0.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(group1.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(autoharvest,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(autoplant,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(group0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(group1,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20group0_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group0_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group0.$set(group0_changes);%20%09%09%09%09const%20group1_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group1_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group1.$set(group1_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(autoharvest.$$.fragment,%20local);%20%09%09%09%09transition_in(autoplant.$$.fragment,%20local);%20%09%09%09%09transition_in(group0.$$.fragment,%20local);%20%09%09%09%09transition_in(group1.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(autoharvest.$$.fragment,%20local);%20%09%09%09%09transition_out(autoplant.$$.fragment,%20local);%20%09%09%09%09transition_out(group0.$$.fragment,%20local);%20%09%09%09%09transition_out(group1.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(autoharvest,%20detaching);%20%09%09%09%09destroy_component(autoplant,%20detaching);%20%09%09%09%09destroy_component(group0,%20detaching);%20%09%09%09%09destroy_component(group1,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$5(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Farmchain%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$5%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09class%20Farmchain%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20null,%20create_fragment$5,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5C2d%5CMovement.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$4(ctx)%20%7B%20%09%09let%20slider;%20%09%09let%20updating_value;%20%09%09let%20t;%20%09%09let%20togglebutton;%20%09%09let%20updating_enabled;%20%09%09let%20current;%20%20%09%09function%20slider_value_binding(value)%20%7B%20%09%09%09/*slider_value_binding*/%20ctx%5B6%5D(value);%20%09%09%7D%20%20%09%09let%20slider_props%20=%20%7B%20%09%09%09title:%20%22Speedup%20Amount%22,%20%09%09%09min:%201,%20%09%09%09max:%20/*maxSpeedupMultiplier*/%20ctx%5B3%5D,%20%09%09%09step:%200.005%20%09%09%7D;%20%20%09%09if%20(/*speedupMultiplier*/%20ctx%5B0%5D%20!==%20void%200)%20%7B%20%09%09%09slider_props.value%20=%20/*speedupMultiplier*/%20ctx%5B0%5D;%20%09%09%7D%20%20%09%09slider%20=%20new%20Slider(%7B%20props:%20slider_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(slider,%20'value',%20slider_value_binding));%20%09%09slider.$on(%22input%22,%20/*onSpeedupMultChange*/%20ctx%5B5%5D);%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09/*togglebutton_enabled_binding*/%20ctx%5B7%5D(value);%20%09%09%7D%20%20%09%09let%20togglebutton_props%20=%20%7B%20%09%09%09disabled:%20!/*$storesLoaded*/%20ctx%5B2%5D,%20%09%09%09onText:%20%22Speedup:%20On%22,%20%09%09%09offText:%20%22Speedup:%20Off%22,%20%09%09%09hotkeyId:%20%22speedup%22%20%09%09%7D;%20%20%09%09if%20(/*speedupEnabled*/%20ctx%5B1%5D%20!==%20void%200)%20%7B%20%09%09%09togglebutton_props.enabled%20=%20/*speedupEnabled*/%20ctx%5B1%5D;%20%09%09%7D%20%20%09%09togglebutton%20=%20new%20ToggleButton(%7B%20props:%20togglebutton_props%20%7D);%20%09%09binding_callbacks.push(()%20=%3E%20bind(togglebutton,%20'enabled',%20togglebutton_enabled_binding));%20%09%09togglebutton.$on(%22click%22,%20/*click_handler*/%20ctx%5B8%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(slider.$$.fragment);%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(togglebutton.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(slider,%20target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(togglebutton,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20slider_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(!updating_value%20&&%20dirty%20&%20/*speedupMultiplier*/%201)%20%7B%20%09%09%09%09%09updating_value%20=%20true;%20%09%09%09%09%09slider_changes.value%20=%20/*speedupMultiplier*/%20ctx%5B0%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_value%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09slider.$set(slider_changes);%20%09%09%09%09const%20togglebutton_changes%20=%20%7B%7D;%20%09%09%09%09if%20(dirty%20&%20/*$storesLoaded*/%204)%20togglebutton_changes.disabled%20=%20!/*$storesLoaded*/%20ctx%5B2%5D;%20%20%09%09%09%09if%20(!updating_enabled%20&&%20dirty%20&%20/*speedupEnabled*/%202)%20%7B%20%09%09%09%09%09updating_enabled%20=%20true;%20%09%09%09%09%09togglebutton_changes.enabled%20=%20/*speedupEnabled*/%20ctx%5B1%5D;%20%09%09%09%09%09add_flush_callback(()%20=%3E%20updating_enabled%20=%20false);%20%09%09%09%09%7D%20%20%09%09%09%09togglebutton.$set(togglebutton_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(slider.$$.fragment,%20local);%20%09%09%09%09transition_in(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(slider.$$.fragment,%20local);%20%09%09%09%09transition_out(togglebutton.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(slider,%20detaching);%20%09%09%09%09destroy_component(togglebutton,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$4(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Movement%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$4%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20$storesLoaded,%20speedupEnabled,%20speedupMultiplier*/%204103)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$2($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20$storesLoaded;%20%09%09component_subscribe($$self,%20storesLoaded,%20$$value%20=%3E%20$$invalidate(2,%20$storesLoaded%20=%20$$value));%20%09%09const%20maxSpeedupMultiplier%20=%20490%20/%20357;%20//%20gathered%20from%20some%20testing,%20any%20higher%20and%20we%20get%20teleported%20back%20%20%09%09//%20this%20file%20is%20a%20hot%20mess,%20but%20it%20works%20%09%09let%20speedupMultiplier%20=%201;%20%20%09%09let%20nativeSpeed%20=%20-1;%20%09%09let%20lastSetTo%20=%20undefined;%20%09%09let%20speedupEnabled%20=%20false;%20%20%09%09function%20enableSpeedup(value)%20%7B%20%09%09%09if%20(!getUnsafeWindow()?.stores?.me)%20return;%20%20%09%09%09//%20restore%20or%20set%20the%20speed%20%09%09%09if%20(!value)%20%7B%20%09%09%09%09getUnsafeWindow().stores.me.movementSpeed%20=%20nativeSpeed;%20%09%09%09%7D%20else%20%7B%20%09%09%09%09let%20newSpeed%20=%20nativeSpeed%20*%20speedupMultiplier;%20%09%09%09%09lastSetTo%20=%20newSpeed;%20%09%09%09%09getUnsafeWindow().stores.me.movementSpeed%20=%20newSpeed;%20%09%09%09%7D%20%09%09%7D%20%20%09%09setInterval(checkSpeed,%20500);%20%20%09%09function%20checkSpeed()%20%7B%20%09%09%09if%20(!getUnsafeWindow()?.stores?.me)%20return;%20%20%09%09%09//%202d%20modes%20%09%09%09let%20currentSpeed%20=%20getUnsafeWindow().stores.me.movementSpeed;%20%20%09%09%09if%20(currentSpeed%20!==%20lastSetTo)%20%7B%20%09%09%09%09nativeSpeed%20=%20currentSpeed;%20%09%09%09%09if%20(speedupEnabled)%20enableSpeedup(true);%20%09%09%09%7D%20%09%09%7D%20%20%09%09function%20onSpeedupMultChange(value)%20%7B%20%09%09%09$$invalidate(0,%20speedupMultiplier%20=%20value.detail);%20%09%09%09if%20(!getUnsafeWindow()?.stores?.me%20%7C%7C%20!speedupEnabled)%20return;%20%09%09%09let%20newSpeed%20=%20nativeSpeed%20*%20value.detail;%20%09%09%09lastSetTo%20=%20newSpeed;%20%09%09%09getUnsafeWindow().stores.me.movementSpeed%20=%20newSpeed;%20%09%09%7D%20%20%09%09function%20slider_value_binding(value)%20%7B%20%09%09%09speedupMultiplier%20=%20value;%20%09%09%09$$invalidate(0,%20speedupMultiplier);%20%09%09%7D%20%20%09%09function%20togglebutton_enabled_binding(value)%20%7B%20%09%09%09speedupEnabled%20=%20value;%20%09%09%09$$invalidate(1,%20speedupEnabled);%20%09%09%7D%20%20%09%09const%20click_handler%20=%20e%20=%3E%20enableSpeedup(e.detail);%20%20%09%09return%20%5B%20%09%09%09speedupMultiplier,%20%09%09%09speedupEnabled,%20%09%09%09$storesLoaded,%20%09%09%09maxSpeedupMultiplier,%20%09%09%09enableSpeedup,%20%09%09%09onSpeedupMultChange,%20%09%09%09slider_value_binding,%20%09%09%09togglebutton_enabled_binding,%20%09%09%09click_handler%20%09%09%5D;%20%09%7D%20%20%09class%20Movement%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$2,%20create_fragment$4,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5CdigItUp%5CPurchasers.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css$1(target)%20%7B%20%09%09append_styles(target,%20%22svelte-1a7yjpn%22,%20%22.notLoaded.svelte-1a7yjpn%7Bwidth:100%25;text-align:center%7D%22);%20%09%7D%20%20%09function%20get_each_context(ctx,%20list,%20i)%20%7B%20%09%09const%20child_ctx%20=%20ctx.slice();%20%09%09child_ctx%5B9%5D%20=%20list%5Bi%5D;%20%09%09return%20child_ctx;%20%09%7D%20%20%09function%20get_each_context_1(ctx,%20list,%20i)%20%7B%20%09%09const%20child_ctx%20=%20ctx.slice();%20%09%09child_ctx%5B9%5D%20=%20list%5Bi%5D;%20%09%09return%20child_ctx;%20%09%7D%20%20%09//%20(52:4)%20%7B:else%7D%20%09function%20create_else_block_1(ctx)%20%7B%20%09%09let%20each_1_anchor;%20%09%09let%20current;%20%09%09let%20each_value_1%20=%20ensure_array_like(/*permitDevices*/%20ctx%5B0%5D);%20%09%09let%20each_blocks%20=%20%5B%5D;%20%20%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value_1.length;%20i%20+=%201)%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20create_each_block_1(get_each_context_1(ctx,%20each_value_1,%20i));%20%09%09%7D%20%20%09%09const%20out%20=%20i%20=%3E%20transition_out(each_blocks%5Bi%5D,%201,%201,%20()%20=%3E%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20null;%20%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%7D%20%20%09%09%09%09each_1_anchor%20=%20empty();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.m(target,%20anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09insert(target,%20each_1_anchor,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*buyPermit,%20permitDevices*/%209)%20%7B%20%09%09%09%09%09each_value_1%20=%20ensure_array_like(/*permitDevices*/%20ctx%5B0%5D);%20%09%09%09%09%09let%20i;%20%20%09%09%09%09%09for%20(i%20=%200;%20i%20%3C%20each_value_1.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09const%20child_ctx%20=%20get_each_context_1(ctx,%20each_value_1,%20i);%20%20%09%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.p(child_ctx,%20dirty);%20%09%09%09%09%09%09%09transition_in(each_blocks%5Bi%5D,%201);%20%09%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D%20=%20create_each_block_1(child_ctx);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%09%09%09transition_in(each_blocks%5Bi%5D,%201);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.m(each_1_anchor.parentNode,%20each_1_anchor);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09for%20(i%20=%20each_value_1.length;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09out(i);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value_1.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09transition_in(each_blocks%5Bi%5D);%20%09%09%09%09%7D%20%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09each_blocks%20=%20each_blocks.filter(Boolean);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09transition_out(each_blocks%5Bi%5D);%20%09%09%09%09%7D%20%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(each_1_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_each(each_blocks,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(47:4)%20%7B%23if%20permitDevices.length%20==%200%7D%20%09function%20create_if_block_1(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20t1;%20%09%09let%20button;%20%09%09let%20current;%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_4$1%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20/*checkDevices*/%20ctx%5B2%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09div.textContent%20=%20%22Permits%20haven't%20loaded%20in%20yet%22;%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%09attr(div,%20%22class%22,%20%22notLoaded%20svelte-1a7yjpn%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%2016384)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(54:12)%20%3CButton%20on:click=%7B()%20=%3E%20buyPermit(device)%7D%3E%20%09function%20create_default_slot_5$1(ctx)%20%7B%20%09%09let%20t0_value%20=%20/*device*/%20ctx%5B9%5D.options.text%20+%20%22%22;%20%09%09let%20t0;%20%09%09let%20t1;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t0%20=%20text(t0_value);%20%09%09%09%09t1%20=%20space();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*permitDevices*/%201%20&&%20t0_value%20!==%20(t0_value%20=%20/*device*/%20ctx%5B9%5D.options.text%20+%20%22%22))%20set_data(t0,%20t0_value);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(53:8)%20%7B%23each%20permitDevices%20as%20device%7D%20%09function%20create_each_block_1(ctx)%20%7B%20%09%09let%20button;%20%09%09let%20current;%20%20%09%09function%20click_handler()%20%7B%20%09%09%09return%20/*click_handler*/%20ctx%5B5%5D(/*device*/%20ctx%5B9%5D);%20%09%09%7D%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_5$1%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20click_handler);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(new_ctx,%20dirty)%20%7B%20%09%09%09%09ctx%20=%20new_ctx;%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20permitDevices*/%2016385)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(51:8)%20%3CButton%20on:click=%7BcheckDevices%7D%3E%20%09function%20create_default_slot_4$1(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Retry%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(46:0)%20%3CGroup%20name=%22Permits%22%3E%20%09function%20create_default_slot_3$1(ctx)%20%7B%20%09%09let%20current_block_type_index;%20%09%09let%20if_block;%20%09%09let%20if_block_anchor;%20%09%09let%20current;%20%09%09const%20if_block_creators%20=%20%5Bcreate_if_block_1,%20create_else_block_1%5D;%20%09%09const%20if_blocks%20=%20%5B%5D;%20%20%09%09function%20select_block_type(ctx,%20dirty)%20%7B%20%09%09%09if%20(/*permitDevices*/%20ctx%5B0%5D.length%20==%200)%20return%200;%20%09%09%09return%201;%20%09%09%7D%20%20%09%09current_block_type_index%20=%20select_block_type(ctx);%20%09%09if_block%20=%20if_blocks%5Bcurrent_block_type_index%5D%20=%20if_block_creators%5Bcurrent_block_type_index%5D(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09if_block.c();%20%09%09%09%09if_block_anchor%20=%20empty();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09if_blocks%5Bcurrent_block_type_index%5D.m(target,%20anchor);%20%09%09%09%09insert(target,%20if_block_anchor,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09let%20previous_block_index%20=%20current_block_type_index;%20%09%09%09%09current_block_type_index%20=%20select_block_type(ctx);%20%20%09%09%09%09if%20(current_block_type_index%20===%20previous_block_index)%20%7B%20%09%09%09%09%09if_blocks%5Bcurrent_block_type_index%5D.p(ctx,%20dirty);%20%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09transition_out(if_blocks%5Bprevious_block_index%5D,%201,%201,%20()%20=%3E%20%7B%20%09%09%09%09%09%09if_blocks%5Bprevious_block_index%5D%20=%20null;%20%09%09%09%09%09%7D);%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%09if_block%20=%20if_blocks%5Bcurrent_block_type_index%5D;%20%20%09%09%09%09%09if%20(!if_block)%20%7B%20%09%09%09%09%09%09if_block%20=%20if_blocks%5Bcurrent_block_type_index%5D%20=%20if_block_creators%5Bcurrent_block_type_index%5D(ctx);%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09if_block.m(if_block_anchor.parentNode,%20if_block_anchor);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(if_block);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(if_block);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(if_block_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09if_blocks%5Bcurrent_block_type_index%5D.d(detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(66:4)%20%7B:else%7D%20%09function%20create_else_block(ctx)%20%7B%20%09%09let%20each_1_anchor;%20%09%09let%20current;%20%09%09let%20each_value%20=%20ensure_array_like(/*pickaxeDevices*/%20ctx%5B1%5D);%20%09%09let%20each_blocks%20=%20%5B%5D;%20%20%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20create_each_block(get_each_context(ctx,%20each_value,%20i));%20%09%09%7D%20%20%09%09const%20out%20=%20i%20=%3E%20transition_out(each_blocks%5Bi%5D,%201,%201,%20()%20=%3E%20%7B%20%09%09%09each_blocks%5Bi%5D%20=%20null;%20%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%7D%20%20%09%09%09%09each_1_anchor%20=%20empty();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09each_blocks%5Bi%5D.m(target,%20anchor);%20%09%09%09%09%09%7D%20%09%09%09%09%7D%20%20%09%09%09%09insert(target,%20each_1_anchor,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*buyPickaxe,%20pickaxeDevices*/%2018)%20%7B%20%09%09%09%09%09each_value%20=%20ensure_array_like(/*pickaxeDevices*/%20ctx%5B1%5D);%20%09%09%09%09%09let%20i;%20%20%09%09%09%09%09for%20(i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09const%20child_ctx%20=%20get_each_context(ctx,%20each_value,%20i);%20%20%09%09%09%09%09%09if%20(each_blocks%5Bi%5D)%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.p(child_ctx,%20dirty);%20%09%09%09%09%09%09%09transition_in(each_blocks%5Bi%5D,%201);%20%09%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09%09each_blocks%5Bi%5D%20=%20create_each_block(child_ctx);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.c();%20%09%09%09%09%09%09%09transition_in(each_blocks%5Bi%5D,%201);%20%09%09%09%09%09%09%09each_blocks%5Bi%5D.m(each_1_anchor.parentNode,%20each_1_anchor);%20%09%09%09%09%09%09%7D%20%09%09%09%09%09%7D%20%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09for%20(i%20=%20each_value.length;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09%09out(i);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_value.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09transition_in(each_blocks%5Bi%5D);%20%09%09%09%09%7D%20%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09each_blocks%20=%20each_blocks.filter(Boolean);%20%20%09%09%09%09for%20(let%20i%20=%200;%20i%20%3C%20each_blocks.length;%20i%20+=%201)%20%7B%20%09%09%09%09%09transition_out(each_blocks%5Bi%5D);%20%09%09%09%09%7D%20%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(each_1_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_each(each_blocks,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(61:4)%20%7B%23if%20pickaxeDevices.length%20==%200%7D%20%09function%20create_if_block(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20t1;%20%09%09let%20button;%20%09%09let%20current;%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_1$1%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20/*checkDevices*/%20ctx%5B2%5D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09div.textContent%20=%20%22Pickaxes%20haven't%20loaded%20in%20yet%22;%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%09attr(div,%20%22class%22,%20%22notLoaded%20svelte-1a7yjpn%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%2016384)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(68:12)%20%3CButton%20on:click=%7B()%20=%3E%20buyPickaxe(device)%7D%3E%20%09function%20create_default_slot_2$1(ctx)%20%7B%20%09%09let%20t0_value%20=%20/*device*/%20ctx%5B9%5D.options.text%20+%20%22%22;%20%09%09let%20t0;%20%09%09let%20t1;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t0%20=%20text(t0_value);%20%09%09%09%09t1%20=%20space();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09if%20(dirty%20&%20/*pickaxeDevices*/%202%20&&%20t0_value%20!==%20(t0_value%20=%20/*device*/%20ctx%5B9%5D.options.text%20+%20%22%22))%20set_data(t0,%20t0_value);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(67:8)%20%7B%23each%20pickaxeDevices%20as%20device%7D%20%09function%20create_each_block(ctx)%20%7B%20%09%09let%20button;%20%09%09let%20current;%20%20%09%09function%20click_handler_1()%20%7B%20%09%09%09return%20/*click_handler_1*/%20ctx%5B6%5D(/*device*/%20ctx%5B9%5D);%20%09%09%7D%20%20%09%09button%20=%20new%20Button(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_2$1%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09button.$on(%22click%22,%20click_handler_1);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(button.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(button,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(new_ctx,%20dirty)%20%7B%20%09%09%09%09ctx%20=%20new_ctx;%20%09%09%09%09const%20button_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20pickaxeDevices*/%2016386)%20%7B%20%09%09%09%09%09button_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09button.$set(button_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(button.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(button,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(65:8)%20%3CButton%20on:click=%7BcheckDevices%7D%3E%20%09function%20create_default_slot_1$1(ctx)%20%7B%20%09%09let%20t;%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09t%20=%20text(%22Retry%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(60:0)%20%3CGroup%20name=%22Pickaxes%22%3E%20%09function%20create_default_slot$3(ctx)%20%7B%20%09%09let%20current_block_type_index;%20%09%09let%20if_block;%20%09%09let%20if_block_anchor;%20%09%09let%20current;%20%09%09const%20if_block_creators%20=%20%5Bcreate_if_block,%20create_else_block%5D;%20%09%09const%20if_blocks%20=%20%5B%5D;%20%20%09%09function%20select_block_type_1(ctx,%20dirty)%20%7B%20%09%09%09if%20(/*pickaxeDevices*/%20ctx%5B1%5D.length%20==%200)%20return%200;%20%09%09%09return%201;%20%09%09%7D%20%20%09%09current_block_type_index%20=%20select_block_type_1(ctx);%20%09%09if_block%20=%20if_blocks%5Bcurrent_block_type_index%5D%20=%20if_block_creators%5Bcurrent_block_type_index%5D(ctx);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09if_block.c();%20%09%09%09%09if_block_anchor%20=%20empty();%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09if_blocks%5Bcurrent_block_type_index%5D.m(target,%20anchor);%20%09%09%09%09insert(target,%20if_block_anchor,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09let%20previous_block_index%20=%20current_block_type_index;%20%09%09%09%09current_block_type_index%20=%20select_block_type_1(ctx);%20%20%09%09%09%09if%20(current_block_type_index%20===%20previous_block_index)%20%7B%20%09%09%09%09%09if_blocks%5Bcurrent_block_type_index%5D.p(ctx,%20dirty);%20%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09group_outros();%20%20%09%09%09%09%09transition_out(if_blocks%5Bprevious_block_index%5D,%201,%201,%20()%20=%3E%20%7B%20%09%09%09%09%09%09if_blocks%5Bprevious_block_index%5D%20=%20null;%20%09%09%09%09%09%7D);%20%20%09%09%09%09%09check_outros();%20%09%09%09%09%09if_block%20=%20if_blocks%5Bcurrent_block_type_index%5D;%20%20%09%09%09%09%09if%20(!if_block)%20%7B%20%09%09%09%09%09%09if_block%20=%20if_blocks%5Bcurrent_block_type_index%5D%20=%20if_block_creators%5Bcurrent_block_type_index%5D(ctx);%20%09%09%09%09%09%09if_block.c();%20%09%09%09%09%09%7D%20else%20%7B%20%09%09%09%09%09%09if_block.p(ctx,%20dirty);%20%09%09%09%09%09%7D%20%20%09%09%09%09%09transition_in(if_block,%201);%20%09%09%09%09%09if_block.m(if_block_anchor.parentNode,%20if_block_anchor);%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(if_block);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(if_block);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(if_block_anchor);%20%09%09%09%09%7D%20%20%09%09%09%09if_blocks%5Bcurrent_block_type_index%5D.d(detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$3(ctx)%20%7B%20%09%09let%20group0;%20%09%09let%20t;%20%09%09let%20group1;%20%09%09let%20current;%20%20%09%09group0%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Permits%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_3$1%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09group1%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Pickaxes%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$3%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group0.$$.fragment);%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(group1.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(group1,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group0_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20permitDevices*/%2016385)%20%7B%20%09%09%09%09%09group0_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group0.$set(group0_changes);%20%09%09%09%09const%20group1_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope,%20pickaxeDevices*/%2016386)%20%7B%20%09%09%09%09%09group1_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group1.$set(group1_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group0.$$.fragment,%20local);%20%09%09%09%09transition_in(group1.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group0.$$.fragment,%20local);%20%09%09%09%09transition_out(group1.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(group0,%20detaching);%20%09%09%09%09destroy_component(group1,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance$1($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20permitDevices%20=%20%5B%5D;%20%09%09let%20permitPurchaseDevice%20=%20null;%20%09%09let%20pickaxeDevices%20=%20%5B%5D;%20%09%09let%20pickaxePurchaseDevice%20=%20null;%20%20%09%09const%20checkDevices%20=%20()%20=%3E%20%7B%20%09%09%09let%20devices%20=%20getUnsafeWindow().stores.phaser.scene.worldManager.devices.allDevices;%20%20%09%09%09//%20set%20permit%20devices%20%09%09%09$$invalidate(0,%20permitDevices%20=%20devices.filter(device%20=%3E%20device.options.group%20===%20%22permit%20upgrade%22));%20%20%09%09%09permitPurchaseDevice%20=%20permitDevices.find(d%20=%3E%20d.options.message);%20%09%09%09$$invalidate(0,%20permitDevices%20=%20permitDevices.filter(d%20=%3E%20d%20!==%20permitPurchaseDevice));%20%20%09%09%09//%20set%20pickaxe%20devices%20%09%09%09$$invalidate(1,%20pickaxeDevices%20=%20devices.filter(device%20=%3E%20device.options.group%20===%20%22pickaxe%20upgrade%22));%20%20%09%09%09pickaxePurchaseDevice%20=%20pickaxeDevices.find(d%20=%3E%20d.options.message);%20%09%09%09$$invalidate(1,%20pickaxeDevices%20=%20pickaxeDevices.filter(d%20=%3E%20d%20!==%20pickaxePurchaseDevice));%20%09%09%7D;%20%20%09%09devicesLoaded.subscribe(val%20=%3E%20%7B%20%09%09%09if%20(!val)%20return;%20%09%09%09checkDevices();%20%09%09%7D);%20%20%09%09function%20buyPermit(device)%20%7B%20%09%09%09socketManager.sendMessage(%22MESSAGE_FOR_DEVICE%22,%20%7B%20%09%09%09%09key:%20%22action%22,%20%09%09%09%09deviceId:%20permitPurchaseDevice.id,%20%09%09%09%09data:%20%7B%20action:%20device.id%20%7D%20%09%09%09%7D);%20%09%09%7D%20%20%09%09function%20buyPickaxe(device)%20%7B%20%09%09%09socketManager.sendMessage(%22MESSAGE_FOR_DEVICE%22,%20%7B%20%09%09%09%09key:%20%22action%22,%20%09%09%09%09deviceId:%20pickaxePurchaseDevice.id,%20%09%09%09%09data:%20%7B%20action:%20device.id%20%7D%20%09%09%09%7D);%20%09%09%7D%20%20%09%09const%20click_handler%20=%20device%20=%3E%20buyPermit(device);%20%09%09const%20click_handler_1%20=%20device%20=%3E%20buyPickaxe(device);%20%20%09%09return%20%5B%20%09%09%09permitDevices,%20%09%09%09pickaxeDevices,%20%09%09%09checkDevices,%20%09%09%09buyPermit,%20%09%09%09buyPickaxe,%20%09%09%09click_handler,%20%09%09%09click_handler_1%20%09%09%5D;%20%09%7D%20%20%09class%20Purchasers%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance$1,%20create_fragment$3,%20safe_not_equal,%20%7B%7D,%20add_css$1);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5CdigItUp%5CDigItUp.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$2(ctx)%20%7B%20%09%09let%20rapidfire;%20%09%09let%20t;%20%09%09let%20purchasers;%20%09%09let%20current;%20%20%09%09rapidfire%20=%20new%20Rapidfire(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09message:%20%22Speedmine%22,%20%09%09%09%09%09hotkeyId:%20%22speedMine%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09purchasers%20=%20new%20Purchasers(%7B%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(rapidfire.$$.fragment);%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(purchasers.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(rapidfire,%20target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(purchasers,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(rapidfire.$$.fragment,%20local);%20%09%09%09%09transition_in(purchasers.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(rapidfire.$$.fragment,%20local);%20%09%09%09%09transition_out(purchasers.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(rapidfire,%20detaching);%20%09%09%09%09destroy_component(purchasers,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$2(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Dig%20it%20Up%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$2%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09class%20DigItUp%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20null,%20create_fragment$2,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Cscripts%5Cknockback%5CKnockback.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20create_default_slot$1(ctx)%20%7B%20%09%09let%20rapidfire;%20%09%09let%20current;%20%20%09%09rapidfire%20=%20new%20Rapidfire(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09message:%20%22Rapid%20fire%22,%20%09%09%09%09%09hotkeyId:%20%22knockbackRapidFire%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(rapidfire.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(rapidfire,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(rapidfire.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(rapidfire.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(rapidfire,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment$1(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Knockback%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot$1%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%201)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09class%20Knockback%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20null,%20create_fragment$1,%20safe_not_equal,%20%7B%7D);%20%09%09%7D%20%09%7D%20%20%09/*%20src%5Chud%5CHud.svelte%20generated%20by%20Svelte%20v4.2.19%20*/%20%20%09function%20add_css(target)%20%7B%20%09%09append_styles(target,%20%22svelte-1byew0x%22,%20%22%23gc-hud.svelte-1byew0x%7Bposition:absolute;top:0;left:0;z-index:9999999999;width:100vw;height:100vh;pointer-events:none;color:var(--textColor)%7D%22);%20%09%7D%20%20%09//%20(35:12)%20%3CGroup%20name=%22Menu%20Appearance%22%3E%20%09function%20create_default_slot_5(ctx)%20%7B%20%09%09let%20colorpicker0;%20%09%09let%20t0;%20%09%09let%20colorpicker1;%20%09%09let%20t1;%20%09%09let%20colorpicker2;%20%09%09let%20t2;%20%09%09let%20colorpicker3;%20%09%09let%20current;%20%20%09%09colorpicker0%20=%20new%20ColorPicker(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09text:%20%22Background%20Color%22,%20%09%09%09%09%09bindValue:%20%22menuBackgroundColor%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09colorpicker1%20=%20new%20ColorPicker(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09text:%20%22Outline%20Color%22,%20%09%09%09%09%09bindValue:%20%22menuOutlineColor%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09colorpicker2%20=%20new%20ColorPicker(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09text:%20%22Header%20Color%22,%20%09%09%09%09%09bindValue:%20%22menuHeaderBackgroundColor%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09colorpicker3%20=%20new%20ColorPicker(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09text:%20%22Header%20Text%20Color%22,%20%09%09%09%09%09bindValue:%20%22menuHeaderTextColor%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(colorpicker0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(colorpicker1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(colorpicker2.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(colorpicker3.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(colorpicker0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(colorpicker1,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(colorpicker2,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(colorpicker3,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(colorpicker0.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker1.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker2.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker3.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(colorpicker0.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker1.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker2.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker3.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(colorpicker0,%20detaching);%20%09%09%09%09destroy_component(colorpicker1,%20detaching);%20%09%09%09%09destroy_component(colorpicker2,%20detaching);%20%09%09%09%09destroy_component(colorpicker3,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(41:12)%20%3CGroup%20name=%22Button%20Appearance%22%3E%20%09function%20create_default_slot_4(ctx)%20%7B%20%09%09let%20colorpicker0;%20%09%09let%20t;%20%09%09let%20colorpicker1;%20%09%09let%20current;%20%20%09%09colorpicker0%20=%20new%20ColorPicker(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09text:%20%22Background%20Color%22,%20%09%09%09%09%09bindValue:%20%22buttonBackgroundColor%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09colorpicker1%20=%20new%20ColorPicker(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09text:%20%22Outline%20Color%22,%20%09%09%09%09%09bindValue:%20%22buttonBorderColor%22%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(colorpicker0.$$.fragment);%20%09%09%09%09t%20=%20space();%20%09%09%09%09create_component(colorpicker1.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(colorpicker0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t,%20anchor);%20%09%09%09%09mount_component(colorpicker1,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p:%20noop,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(colorpicker0.$$.fragment,%20local);%20%09%09%09%09transition_in(colorpicker1.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(colorpicker0.$$.fragment,%20local);%20%09%09%09%09transition_out(colorpicker1.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(colorpicker0,%20detaching);%20%09%09%09%09destroy_component(colorpicker1,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(33:8)%20%3CGroup%20name=%22HUD%20Appearance%22%3E%20%09function%20create_default_slot_3(ctx)%20%7B%20%09%09let%20colorpicker;%20%09%09let%20t0;%20%09%09let%20group0;%20%09%09let%20t1;%20%09%09let%20group1;%20%09%09let%20current;%20%20%09%09colorpicker%20=%20new%20ColorPicker(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09text:%20%22Text%20Color%22,%20%09%09%09%09%09bindValue:%20%22textColor%22,%20%09%09%09%09%09minOpactiy:%200.3%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09group0%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Menu%20Appearance%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_5%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09group1%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Button%20Appearance%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_4%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(colorpicker.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(group0.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(group1.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(colorpicker,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(group0,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(group1,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20group0_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%202)%20%7B%20%09%09%09%09%09group0_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group0.$set(group0_changes);%20%09%09%09%09const%20group1_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%202)%20%7B%20%09%09%09%09%09group1_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group1.$set(group1_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(colorpicker.$$.fragment,%20local);%20%09%09%09%09transition_in(group0.$$.fragment,%20local);%20%09%09%09%09transition_in(group1.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(colorpicker.$$.fragment,%20local);%20%09%09%09%09transition_out(group0.$$.fragment,%20local);%20%09%09%09%09transition_out(group1.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(colorpicker,%20detaching);%20%09%09%09%09destroy_component(group0,%20detaching);%20%09%09%09%09destroy_component(group1,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(32:4)%20%3CMenu%20name=%22Customization%22%3E%20%09function%20create_default_slot_2(ctx)%20%7B%20%09%09let%20group;%20%09%09let%20t0;%20%09%09let%20resetstyles;%20%09%09let%20t1;%20%09%09let%20cosmeticpicker;%20%09%09let%20t2;%20%09%09let%20customtheme;%20%09%09let%20current;%20%20%09%09group%20=%20new%20Group(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22HUD%20Appearance%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_3%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09resetstyles%20=%20new%20ResetStyles(%7B%7D);%20%09%09cosmeticpicker%20=%20new%20CosmeticPicker(%7B%7D);%20%09%09customtheme%20=%20new%20CustomTheme(%7B%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(group.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(resetstyles.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(cosmeticpicker.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(customtheme.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(group,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(resetstyles,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(cosmeticpicker,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(customtheme,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20dirty)%20%7B%20%09%09%09%09const%20group_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%202)%20%7B%20%09%09%09%09%09group_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09group.$set(group_changes);%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(group.$$.fragment,%20local);%20%09%09%09%09transition_in(resetstyles.$$.fragment,%20local);%20%09%09%09%09transition_in(cosmeticpicker.$$.fragment,%20local);%20%09%09%09%09transition_in(customtheme.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(group.$$.fragment,%20local);%20%09%09%09%09transition_out(resetstyles.$$.fragment,%20local);%20%09%09%09%09transition_out(cosmeticpicker.$$.fragment,%20local);%20%09%09%09%09transition_out(customtheme.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(group,%20detaching);%20%09%09%09%09destroy_component(resetstyles,%20detaching);%20%09%09%09%09destroy_component(cosmeticpicker,%20detaching);%20%09%09%09%09destroy_component(customtheme,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(51:4)%20%3CMenu%20name=%22General%20Cheats%22%3E%20%09function%20create_default_slot_1(ctx)%20%7B%20%09%09let%20autoanswer;%20%09%09let%20t0;%20%09%09let%20instantuse;%20%09%09let%20t1;%20%09%09let%20movement;%20%09%09let%20t2;%20%09%09let%20playerhighlighter;%20%09%09let%20t3;%20%09%09let%20freecam;%20%09%09let%20t4;%20%09%09let%20hideenergypopup;%20%09%09let%20current;%20%09%09autoanswer%20=%20new%20AutoAnswer(%7B%7D);%20%09%09instantuse%20=%20new%20InstantUse(%7B%7D);%20%09%09movement%20=%20new%20Movement(%7B%7D);%20%09%09playerhighlighter%20=%20new%20PlayerHighlighter(%7B%7D);%20%09%09freecam%20=%20new%20Freecam(%7B%7D);%20%09%09hideenergypopup%20=%20new%20HideEnergyPopup(%7B%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(autoanswer.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(instantuse.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(movement.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(playerhighlighter.$$.fragment);%20%09%09%09%09t3%20=%20space();%20%09%09%09%09create_component(freecam.$$.fragment);%20%09%09%09%09t4%20=%20space();%20%09%09%09%09create_component(hideenergypopup.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(autoanswer,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(instantuse,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(movement,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(playerhighlighter,%20target,%20anchor);%20%09%09%09%09insert(target,%20t3,%20anchor);%20%09%09%09%09mount_component(freecam,%20target,%20anchor);%20%09%09%09%09insert(target,%20t4,%20anchor);%20%09%09%09%09mount_component(hideenergypopup,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(autoanswer.$$.fragment,%20local);%20%09%09%09%09transition_in(instantuse.$$.fragment,%20local);%20%09%09%09%09transition_in(movement.$$.fragment,%20local);%20%09%09%09%09transition_in(playerhighlighter.$$.fragment,%20local);%20%09%09%09%09transition_in(freecam.$$.fragment,%20local);%20%09%09%09%09transition_in(hideenergypopup.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(autoanswer.$$.fragment,%20local);%20%09%09%09%09transition_out(instantuse.$$.fragment,%20local);%20%09%09%09%09transition_out(movement.$$.fragment,%20local);%20%09%09%09%09transition_out(playerhighlighter.$$.fragment,%20local);%20%09%09%09%09transition_out(freecam.$$.fragment,%20local);%20%09%09%09%09transition_out(hideenergypopup.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%09detach(t3);%20%09%09%09%09%09detach(t4);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(autoanswer,%20detaching);%20%09%09%09%09destroy_component(instantuse,%20detaching);%20%09%09%09%09destroy_component(movement,%20detaching);%20%09%09%09%09destroy_component(playerhighlighter,%20detaching);%20%09%09%09%09destroy_component(freecam,%20detaching);%20%09%09%09%09destroy_component(hideenergypopup,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09//%20(60:4)%20%3CMenu%20name=%22Gamemode%20Specific%20Cheats%22%3E%20%09function%20create_default_slot(ctx)%20%7B%20%09%09let%20classicautopurchase;%20%09%09let%20t0;%20%09%09let%20richautopurchase;%20%09%09let%20t1;%20%09%09let%20digitup;%20%09%09let%20t2;%20%09%09let%20knockback;%20%09%09let%20t3;%20%09%09let%20ctf;%20%09%09let%20t4;%20%09%09let%20tag;%20%09%09let%20t5;%20%09%09let%20onewayout;%20%09%09let%20t6;%20%09%09let%20snowbrawl;%20%09%09let%20t7;%20%09%09let%20floorislava;%20%09%09let%20t8;%20%09%09let%20showimposters;%20%09%09let%20t9;%20%09%09let%20farmchain;%20%09%09let%20current;%20%09%09classicautopurchase%20=%20new%20AutoPurchase$1(%7B%7D);%20%09%09richautopurchase%20=%20new%20AutoPurchase(%7B%7D);%20%09%09digitup%20=%20new%20DigItUp(%7B%7D);%20%09%09knockback%20=%20new%20Knockback(%7B%7D);%20%09%09ctf%20=%20new%20Ctf(%7B%7D);%20%09%09tag%20=%20new%20Tag(%7B%7D);%20%09%09onewayout%20=%20new%20OneWayOut(%7B%7D);%20%09%09snowbrawl%20=%20new%20Snowbrawl(%7B%7D);%20%09%09floorislava%20=%20new%20FloorIsLava(%7B%7D);%20%09%09showimposters%20=%20new%20ShowImposters(%7B%7D);%20%09%09farmchain%20=%20new%20Farmchain(%7B%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09create_component(classicautopurchase.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(richautopurchase.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(digitup.$$.fragment);%20%09%09%09%09t2%20=%20space();%20%09%09%09%09create_component(knockback.$$.fragment);%20%09%09%09%09t3%20=%20space();%20%09%09%09%09create_component(ctf.$$.fragment);%20%09%09%09%09t4%20=%20space();%20%09%09%09%09create_component(tag.$$.fragment);%20%09%09%09%09t5%20=%20space();%20%09%09%09%09create_component(onewayout.$$.fragment);%20%09%09%09%09t6%20=%20space();%20%09%09%09%09create_component(snowbrawl.$$.fragment);%20%09%09%09%09t7%20=%20space();%20%09%09%09%09create_component(floorislava.$$.fragment);%20%09%09%09%09t8%20=%20space();%20%09%09%09%09create_component(showimposters.$$.fragment);%20%09%09%09%09t9%20=%20space();%20%09%09%09%09create_component(farmchain.$$.fragment);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09mount_component(classicautopurchase,%20target,%20anchor);%20%09%09%09%09insert(target,%20t0,%20anchor);%20%09%09%09%09mount_component(richautopurchase,%20target,%20anchor);%20%09%09%09%09insert(target,%20t1,%20anchor);%20%09%09%09%09mount_component(digitup,%20target,%20anchor);%20%09%09%09%09insert(target,%20t2,%20anchor);%20%09%09%09%09mount_component(knockback,%20target,%20anchor);%20%09%09%09%09insert(target,%20t3,%20anchor);%20%09%09%09%09mount_component(ctf,%20target,%20anchor);%20%09%09%09%09insert(target,%20t4,%20anchor);%20%09%09%09%09mount_component(tag,%20target,%20anchor);%20%09%09%09%09insert(target,%20t5,%20anchor);%20%09%09%09%09mount_component(onewayout,%20target,%20anchor);%20%09%09%09%09insert(target,%20t6,%20anchor);%20%09%09%09%09mount_component(snowbrawl,%20target,%20anchor);%20%09%09%09%09insert(target,%20t7,%20anchor);%20%09%09%09%09mount_component(floorislava,%20target,%20anchor);%20%09%09%09%09insert(target,%20t8,%20anchor);%20%09%09%09%09mount_component(showimposters,%20target,%20anchor);%20%09%09%09%09insert(target,%20t9,%20anchor);%20%09%09%09%09mount_component(farmchain,%20target,%20anchor);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(classicautopurchase.$$.fragment,%20local);%20%09%09%09%09transition_in(richautopurchase.$$.fragment,%20local);%20%09%09%09%09transition_in(digitup.$$.fragment,%20local);%20%09%09%09%09transition_in(knockback.$$.fragment,%20local);%20%09%09%09%09transition_in(ctf.$$.fragment,%20local);%20%09%09%09%09transition_in(tag.$$.fragment,%20local);%20%09%09%09%09transition_in(onewayout.$$.fragment,%20local);%20%09%09%09%09transition_in(snowbrawl.$$.fragment,%20local);%20%09%09%09%09transition_in(floorislava.$$.fragment,%20local);%20%09%09%09%09transition_in(showimposters.$$.fragment,%20local);%20%09%09%09%09transition_in(farmchain.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(classicautopurchase.$$.fragment,%20local);%20%09%09%09%09transition_out(richautopurchase.$$.fragment,%20local);%20%09%09%09%09transition_out(digitup.$$.fragment,%20local);%20%09%09%09%09transition_out(knockback.$$.fragment,%20local);%20%09%09%09%09transition_out(ctf.$$.fragment,%20local);%20%09%09%09%09transition_out(tag.$$.fragment,%20local);%20%09%09%09%09transition_out(onewayout.$$.fragment,%20local);%20%09%09%09%09transition_out(snowbrawl.$$.fragment,%20local);%20%09%09%09%09transition_out(floorislava.$$.fragment,%20local);%20%09%09%09%09transition_out(showimposters.$$.fragment,%20local);%20%09%09%09%09transition_out(farmchain.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(t0);%20%09%09%09%09%09detach(t1);%20%09%09%09%09%09detach(t2);%20%09%09%09%09%09detach(t3);%20%09%09%09%09%09detach(t4);%20%09%09%09%09%09detach(t5);%20%09%09%09%09%09detach(t6);%20%09%09%09%09%09detach(t7);%20%09%09%09%09%09detach(t8);%20%09%09%09%09%09detach(t9);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(classicautopurchase,%20detaching);%20%09%09%09%09destroy_component(richautopurchase,%20detaching);%20%09%09%09%09destroy_component(digitup,%20detaching);%20%09%09%09%09destroy_component(knockback,%20detaching);%20%09%09%09%09destroy_component(ctf,%20detaching);%20%09%09%09%09destroy_component(tag,%20detaching);%20%09%09%09%09destroy_component(onewayout,%20detaching);%20%09%09%09%09destroy_component(snowbrawl,%20detaching);%20%09%09%09%09destroy_component(floorislava,%20detaching);%20%09%09%09%09destroy_component(showimposters,%20detaching);%20%09%09%09%09destroy_component(farmchain,%20detaching);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20create_fragment(ctx)%20%7B%20%09%09let%20div;%20%09%09let%20menu0;%20%09%09let%20t0;%20%09%09let%20menu1;%20%09%09let%20t1;%20%09%09let%20menu2;%20%09%09let%20current;%20%20%09%09menu0%20=%20new%20Menu(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Customization%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_2%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09menu1%20=%20new%20Menu(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22General%20Cheats%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot_1%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09menu2%20=%20new%20Menu(%7B%20%09%09%09%09props:%20%7B%20%09%09%09%09%09name:%20%22Gamemode%20Specific%20Cheats%22,%20%09%09%09%09%09$$slots:%20%7B%20default:%20%5Bcreate_default_slot%5D%20%7D,%20%09%09%09%09%09$$scope:%20%7B%20ctx%20%7D%20%09%09%09%09%7D%20%09%09%09%7D);%20%20%09%09return%20%7B%20%09%09%09c()%20%7B%20%09%09%09%09div%20=%20element(%22div%22);%20%09%09%09%09create_component(menu0.$$.fragment);%20%09%09%09%09t0%20=%20space();%20%09%09%09%09create_component(menu1.$$.fragment);%20%09%09%09%09t1%20=%20space();%20%09%09%09%09create_component(menu2.$$.fragment);%20%09%09%09%09attr(div,%20%22id%22,%20%22gc-hud%22);%20%09%09%09%09set_style(div,%20%22display%22,%20/*$showHud*/%20ctx%5B0%5D%20?%20'block'%20:%20'none');%20%09%09%09%09attr(div,%20%22class%22,%20%22svelte-1byew0x%22);%20%09%09%09%7D,%20%09%09%09m(target,%20anchor)%20%7B%20%09%09%09%09insert(target,%20div,%20anchor);%20%09%09%09%09mount_component(menu0,%20div,%20null);%20%09%09%09%09append(div,%20t0);%20%09%09%09%09mount_component(menu1,%20div,%20null);%20%09%09%09%09append(div,%20t1);%20%09%09%09%09mount_component(menu2,%20div,%20null);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09p(ctx,%20%5Bdirty%5D)%20%7B%20%09%09%09%09const%20menu0_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%202)%20%7B%20%09%09%09%09%09menu0_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09menu0.$set(menu0_changes);%20%09%09%09%09const%20menu1_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%202)%20%7B%20%09%09%09%09%09menu1_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09menu1.$set(menu1_changes);%20%09%09%09%09const%20menu2_changes%20=%20%7B%7D;%20%20%09%09%09%09if%20(dirty%20&%20/*$$scope*/%202)%20%7B%20%09%09%09%09%09menu2_changes.$$scope%20=%20%7B%20dirty,%20ctx%20%7D;%20%09%09%09%09%7D%20%20%09%09%09%09menu2.$set(menu2_changes);%20%20%09%09%09%09if%20(!current%20%7C%7C%20dirty%20&%20/*$showHud*/%201)%20%7B%20%09%09%09%09%09set_style(div,%20%22display%22,%20/*$showHud*/%20ctx%5B0%5D%20?%20'block'%20:%20'none');%20%09%09%09%09%7D%20%09%09%09%7D,%20%09%09%09i(local)%20%7B%20%09%09%09%09if%20(current)%20return;%20%09%09%09%09transition_in(menu0.$$.fragment,%20local);%20%09%09%09%09transition_in(menu1.$$.fragment,%20local);%20%09%09%09%09transition_in(menu2.$$.fragment,%20local);%20%09%09%09%09current%20=%20true;%20%09%09%09%7D,%20%09%09%09o(local)%20%7B%20%09%09%09%09transition_out(menu0.$$.fragment,%20local);%20%09%09%09%09transition_out(menu1.$$.fragment,%20local);%20%09%09%09%09transition_out(menu2.$$.fragment,%20local);%20%09%09%09%09current%20=%20false;%20%09%09%09%7D,%20%09%09%09d(detaching)%20%7B%20%09%09%09%09if%20(detaching)%20%7B%20%09%09%09%09%09detach(div);%20%09%09%09%09%7D%20%20%09%09%09%09destroy_component(menu0);%20%09%09%09%09destroy_component(menu1);%20%09%09%09%09destroy_component(menu2);%20%09%09%09%7D%20%09%09%7D;%20%09%7D%20%20%09function%20instance($$self,%20$$props,%20$$invalidate)%20%7B%20%09%09let%20$showHud;%20%09%09component_subscribe($$self,%20showHud,%20$$value%20=%3E%20$$invalidate(0,%20$showHud%20=%20$$value));%20%20%09%09keybindManager.addKeybind(new%20Set(%5B%22%5C%5C%22%5D),%20()%20=%3E%20%7B%20%09%09%09showHud.update(v%20=%3E%20!v);%20%09%09%7D);%20%20%09%09return%20%5B$showHud%5D;%20%09%7D%20%20%09class%20Hud%20extends%20SvelteComponent%20%7B%20%09%09constructor(options)%20%7B%20%09%09%09super();%20%09%09%09init(this,%20options,%20instance,%20create_fragment,%20safe_not_equal,%20%7B%7D,%20add_css);%20%09%09%7D%20%09%7D%20%20%09async%20function%20createHud()%20%7B%20%09%20%20%20%20if%20(!document.body)%20%7B%20%09%20%20%20%20%20%20%20%20await%20new%20Promise(res%20=%3E%20window.addEventListener('DOMContentLoaded',%20res));%20%09%20%20%20%20%7D%20%09%20%20%20%20new%20Hud(%7B%20%09%20%20%20%20%20%20%20%20target:%20document.body%20%09%20%20%20%20%7D);%20%09%20%20%20%20addVars();%20%09%7D%20%20%09async%20function%20exposeValues()%20%7B%20%09%20%20%20%20if%20(!document.body)%20%7B%20%09%20%20%20%20%20%20%20%20await%20new%20Promise((res)%20=%3E%20document.addEventListener('DOMContentLoaded',%20res));%20%09%20%20%20%20%7D%20%09%20%20%20%20const%20script%20=%20document.querySelector(%22script%5Bsrc%5D%5Btype='module'%5D%22);%20%09%20%20%20%20if%20(!script)%20%09%20%20%20%20%20%20%20%20throw%20new%20Error(%22Failed%20to%20find%20script%22);%20%09%20%20%20%20const%20res%20=%20await%20fetch(script.src);%20%09%20%20%20%20const%20text%20=%20await%20res.text();%20%09%20%20%20%20const%20gameScriptUrl%20=%20text.match(/FixSpinePlugin-%5B%5E.%5D+%5C.js/)?.%5B0%5D;%20%09%20%20%20%20if%20(!gameScriptUrl)%20%09%20%20%20%20%20%20%20%20throw%20new%20Error(%22Failed%20to%20find%20game%20script%20URL%22);%20%09%20%20%20%20const%20gameScript%20=%20await%20import(%60/assets/$%7BgameScriptUrl%7D%60);%20%09%20%20%20%20const%20stores%20=%20Object.values(gameScript).find(v%20=%3E%20v.assignment);%20%09%20%20%20%20getUnsafeWindow().stores%20=%20stores;%20%09%20%20%20%20storesLoaded.set(true);%20%09%20%20%20%20console.log(%22GC:%20Stores%20loaded%22);%20%09%7D%20%20%09//%20confirm%20that%20no%20amplitude.com%20script%20exists%20%09let%20gameLoaded%20=%20document.querySelector('script%5Bsrc*=%22amplitude.com%22%5D')%20!==%20null;%20%09if%20(gameLoaded)%20%7B%20%09%20%20%20%20alert(%22This%20script%20can%20only%20be%20run%20before%20you%20join%20the%20game.%20Please%20reload%20the%20page%20and%20try%20again.%22);%20%09%7D%20%09else%20%7B%20%09%20%20%20%20exposeValues();%20%09%20%20%20%20socketManager.setup();%20%09%20%20%20%20createHud();%20%09%7D%20%20%7D)();
